<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<serviceQuery>
    <uri>/crm/novedadesScoring/{DOC}</uri>
    <serviceDescription>ConsultaNovedadesSinHistoricoScoring</serviceDescription>
    <title>ConsultaNovedadesSinHistoricoScoring</title>
    <querys>
        <query id="1" name="Respuesta" type="MULTIPLE">
            <sql>DECLARE	@cuit VARCHAR(25) = ?;&#13;
&#13;
IF (isnumeric(@cuit) = 0 OR len(@cuit) &lt;&gt; 11)&#13;
	THROW 50000, 'Parametros incorrectos.', 1;&#13;
&#13;
SELECT 	  cr.NUMEROSOLICITUD&#13;
		, CASE WHEN substring(convert(VARCHAR,cr.CODPRODUCTOSOLICITADO),1,3) = '512' THEN 1 ELSE 2 END AS ID&#13;
		, CASE WHEN substring(convert(VARCHAR,cr.CODPRODUCTOSOLICITADO),1,3) = '512' THEN 'Scoring Línea 512 LINK L1' ELSE 'Scoring Línea 514 LINK L2' END AS DESCRIPCION&#13;
		, FECHARECEPCIONSOLICITUD AS FECHA_NOVEDAD&#13;
		, cr.CODIGOSUCURSAL AS ID_SUCURSAL&#13;
		, S.NOMBRESUCURSAL&#13;
		, CONVERT(NUMERIC,substring(convert(VARCHAR,cr.CODPRODUCTOSOLICITADO),1,3)) AS LINEA&#13;
		, convert(VARCHAR,cr.MONTOSOLICITADO) AS MONTOSOLICITADO&#13;
		, cr.CANTIDADCUOTAS&#13;
		, cr.USUARIOINGRESOSOLICITUD AS USUARIO_INTERVINIENTE &#13;
FROM VW_CLI_X_DOC cd (nolock)&#13;
JOIN CRE_SOLICITUDCREDITO cr (nolock) ON cd.CODIGOCLIENTE = cr.CLIENTE&#13;
JOIN SUCURSALES s (nolock) ON cr.CODIGOSUCURSAL = s.SUCURSAL&#13;
WHERE 	substring(convert(VARCHAR,cr.CODPRODUCTOSOLICITADO),1,3) IN  ('512','514')&#13;
		AND cr.ESTADOSOLICITUD IN ('04','21','22','23','32')&#13;
		AND cd.NUMERODOC =@cuit&#13;
ORDER BY FECHARECEPCIONSOLICITUD DESC</sql>
            <input>
                <inParameter description="Documento" type="LONG">DOC</inParameter>
            </input>
            <output>
                <level groupby="" name="novedades">
                    <outParameter description="" type="LONG">
                        <queryname>NUMEROSOLICITUD</queryname>
                        <servicename>nroSolicitud</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>ID</queryname>
                        <servicename>tipoNovedad.id</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>DESCRIPCION</queryname>
                        <servicename>tipoNovedad.descripcion</servicename>
                    </outParameter>
                    <outParameter description="" type="DATE">
                        <queryname>FECHA_NOVEDAD</queryname>
                        <servicename>fechaNovedad</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>ID_SUCURSAL</queryname>
                        <servicename>sucursal.id</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>NOMBRESUCURSAL</queryname>
                        <servicename>sucursal.descripcion</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>LINEA</queryname>
                        <servicename>linea</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>MONTOSOLICITADO</queryname>
                        <servicename>monto</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>CANTIDADCUOTAS</queryname>
                        <servicename>cantCuotas</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>USUARIO_INTERVINIENTE</queryname>
                        <servicename>usuarioInterviniente</servicename>
                    </outParameter>
                </level>
            </output>
        </query>
        <query id="2" name="dummy" type="SIMPLE">
            <sql>select '' as algo&#13;
from parametros where 1=2</sql>
            <input/>
            <output>
                <level groupby="" name="dummy">
                    <outParameter description="" type="STRING">
                        <queryname>algo</queryname>
                        <servicename>algo</servicename>
                    </outParameter>
                </level>
            </output>
        </query>
    </querys>
</serviceQuery>
