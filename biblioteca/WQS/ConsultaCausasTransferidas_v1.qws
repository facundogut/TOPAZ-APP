<?xml version="1.0" encoding="ISO-8859-1" standalone="yes"?>
<serviceQuery>
    <uri>/depjudicial/causasTransferidas/{juzgadoOrigen}/{juzgadoDestino}/{pagina}/{largopagina}</uri>
    <serviceDescription>ConsultaCausasTransferidas</serviceDescription>
    <title>ConsultaCausasTransferidas</title>
    <querys>
        <query id="1" name="paginado" type="MULTIPLE">
            <sql>

	DECLARE
		@JUZGADO_ORIGEN NUMERIC(12,0) = ?,
		@JUZGADO_DESTINO NUMERIC(12,0) = ?,
		@pagina AS INT = ?,
		@largopagina AS INT = ?,
		@TotalRegistros INT = 0,
		@resto INT = 0,
		@primerRegistroPag INT = 0,
		@ultimoRegistroPag INT = 0;
 
	SET @TotalRegistros = (
		SELECT COUNT(1)
		FROM DJ_CAUSAS o
		INNER JOIN DJ_CAUSAS d ON o.CAUSA_DESTINO = d.NRO_CAUSA AND d.TZ_LOCK = 0
		WHERE 
			o.TZ_LOCK = 0
			AND o.ESTADO = 'T'
			AND (@JUZGADO_ORIGEN = 0 OR o.JUZGADO = @JUZGADO_ORIGEN)
			AND (@JUZGADO_DESTINO = 0 OR d.JUZGADO = @JUZGADO_DESTINO)
	);
	
  SET @resto = @TotalRegistros - (((@pagina -1) * @largopagina) + @largopagina)
  SET @primerRegistroPag = ((@pagina -1) * @largopagina) +1
  SET @ultimoRegistroPag = (((@pagina -1) * @largopagina) + @largopagina)
  
  IF (@resto &lt; 0)
  	BEGIN
  		SET @resto = 0
  	END 
  IF (@ultimoRegistroPag &gt;@TotalRegistros )
  	BEGIN
  	    SET @ultimoRegistroPag=@TotalRegistros
  	END 
  


IF(@pagina&gt;(select dbo.ITFcantPaginas (@TotalRegistros, @largopagina)))
BEGIN
SELECT NULL AS idCausa,
	@pagina 																	AS paginaActual, 
	(select dbo.ITFcantPaginas (@TotalRegistros, @largopagina)) 				AS cantidadPaginas,
	@largopagina 																AS registroPorPag,
	@TotalRegistros 														  	AS totalRegistros,
	@primerRegistroPag 													  		AS primerRegistroPag,
	@ultimoRegistroPag 													  		AS ultimoRegistroPag,
	@resto 																	  	AS siguientesRegistros 
END
ELSE
BEGIN
SELECT 	ROW_NUMBER() OVER(ORDER BY idCausa) AS ORDEN, 
		idCausa,
		paginaActual,
		cantidadPaginas,
		registroPorPag,
		totalRegistros,
		primerRegistroPag,
		ultimoRegistroPag,
		siguientesRegistros


FROM
(SELECT o.NRO_CAUSA AS idCausa,
	@pagina 																	AS paginaActual, 
	(select dbo.ITFcantPaginas (@TotalRegistros, @largopagina)) 				AS cantidadPaginas,
	@largopagina 																AS registroPorPag,
	@TotalRegistros 														  	AS totalRegistros,
	@primerRegistroPag 													  		AS primerRegistroPag,
	@ultimoRegistroPag 													  		AS ultimoRegistroPag,
	@resto 																	  	AS siguientesRegistros 		
 
	FROM DJ_CAUSAS o
	INNER JOIN DJ_CAUSAS d ON o.CAUSA_DESTINO = d.NRO_CAUSA AND d.TZ_LOCK = 0
	WHERE 
		o.TZ_LOCK = 0
		AND o.ESTADO = 'T'
		AND (@JUZGADO_ORIGEN = 0 OR o.JUZGADO = @JUZGADO_ORIGEN)
		AND (@JUZGADO_DESTINO = 0 OR d.JUZGADO = @JUZGADO_DESTINO)
) DATOS 
ORDER BY ORDEN
OFFSET ((@pagina - 1) * @largopagina) ROWS 
FETCH NEXT @largopagina ROWS ONLY;

END
</sql>
            <input>
			    <inParameter description="" type="FLOAT">juzgadoOrigen</inParameter>
                <inParameter description="" type="FLOAT">juzgadoDestino</inParameter>
                <inParameter description="" type="INTEGER">pagina</inParameter>
                <inParameter description="" type="INTEGER">largopagina</inParameter>

            </input>
            <output>
                <level groupby="paginaActual" name="paginado">
                    <outParameter description="" type="INTEGER">
                        <queryname>totalRegistros</queryname>
                        <servicename>paginado.totalRegistros</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>paginaActual</queryname>
                        <servicename>paginado.paginaActual</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>primerRegistroPag</queryname>
                        <servicename>paginado.primerRegistroPag</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>registroPorPag</queryname>
                        <servicename>paginado.registroPorPag</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>ultimoRegistroPag</queryname>
                        <servicename>paginado.ultimoRegistroPag</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>siguientesRegistros</queryname>
                        <servicename>paginado.siguientesRegistros</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>cantidadPaginas</queryname>
                        <servicename>paginado.cantidadPaginas</servicename>
                    </outParameter>
                </level>
                <level groupby="" name="causas">
                    <outParameter description="" type="INTEGER">
                        <queryname>idCausa</queryname>
                        <servicename>idCausa</servicename>
                    </outParameter>
                </level>
            </output>
        </query>
    </querys>
</serviceQuery>
