<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<serviceQuery>
    <uri>/DetallePrestamo/{jtsOid}</uri>
    <serviceDescription>Servicio que devuelve el detalle de los prestamos a partir de jtsOid</serviceDescription>
    <title>1.31.19 DOIT Consultar Prestamos</title>
    <querys>
        <query id="1" name="getCreditos" type="SIMPLE">
            <sql>declare @jtsOid numeric(10,0)=?&#13;
SELECT s.SUCURSAL AS IdSucursal,
(SELECT sc.NOMBRESUCURSAL  FROM SUCURSALES sc WHERE sc.SUCURSAL = s.SUCURSAL AND sc.TZ_LOCK=0) AS NombreSucursal,
s.PRODUCTO AS IdProducto,
(SELECT p.C6251 FROM PRODUCTOS p WHERE p.C6250 = s.PRODUCTO AND p.TZ_LOCK=0) AS NombreProducto,
s.CUENTA,
s.MONEDA AS IdMoneda,
(SELECT m.C6400 FROM MONEDAS m WHERE m.C6399 = s.MONEDA AND m.TZ_LOCK=0) AS DescMoneda,
s.OPERACION,
s.ORDINAL,
s.C1704 AS solicitud,
ISNULL(CONVERT(varchar(10),s.C1620,103),0) AS fechaAlta,
(CASE WHEN s.C1642 = 0 THEN ISNULL(DATEDIFF(day, s.C1620, s.C1628), 0) ELSE s.C1642 END) AS plazoDias,
s.C1601 AS capitalInicial,
s.C1604 AS saldoCapital,
s.C1644 AS cantOriginalCuotas,
s.C1645 AS cantCuotasPendientes,
--hp.CUOTA AS importeCuota,
s.C1612 as importeCuota,
ISNULL(CONVERT(varchar(10),s.C1627,103),0) AS fechaVencimiento,
s.CUOTAS_GRACIA AS Cuotas_gracia,
S.C1632 AS TNA,
S.C1632 AS TEA,
s.JTS_OID,
ISNULL((SELECT cr.CFT FROM CRE_SALDOS cr WHERE cr.SALDOS_JTS_OID = s.JTS_OID),0) AS CFT,
(SELECT SUBSTRING(cod.DESCRIPCION, 8, LEN(cod.DESCRIPCION)) AS estado FROM CR_CODIGOS_ATRASO_CARTERA cod WHERE s.C1728 = cod.COD_ATRASO) AS Estado
FROM SALDOS s (NOLOCK)
WHERE s.C1785=5 AND s.TZ_LOCK = 0 AND s.JTS_OID = @jtsOid  </sql>
            <input>
                <inParameter description="" type="INTEGER">jtsOid</inParameter>
            </input>
            <output>
                <level groupby="" name="creditos">
                    <outParameter description="" type="INTEGER">
                        <queryname>IdSucursal</queryname>
                        <servicename>creditos.credito.sucursal.id</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>NombreSucursal</queryname>
                        <servicename>creditos.credito.sucursal.descripcion</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>IdProducto</queryname>
                        <servicename>creditos.credito.producto.id</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>NombreProducto</queryname>
                        <servicename>creditos.credito.producto.descripcion</servicename>
                    </outParameter>
                    <outParameter description="" type="BIGDECIMAL">
                        <queryname>CUENTA</queryname>
                        <servicename>creditos.credito.cuenta</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>IdMoneda</queryname>
                        <servicename>creditos.credito.moneda.id</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>DescMoneda</queryname>
                        <servicename>creditos.credito.moneda.descripcion</servicename>
                    </outParameter>
                    <outParameter description="" type="BIGDECIMAL">
                        <queryname>OPERACION</queryname>
                        <servicename>creditos.credito.operacion</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>ORDINAL</queryname>
                        <servicename>creditos.credito.ordinal</servicename>
                    </outParameter>
                    <outParameter description="" type="BIGDECIMAL">
                        <queryname>solicitud</queryname>
                        <servicename>creditos.solicitud</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>fechaAlta</queryname>
                        <servicename>creditos.fechaAlta</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>plazoDias</queryname>
                        <servicename>creditos.plazoDias</servicename>
                    </outParameter>
                    <outParameter description="" type="BIGDECIMAL">
                        <queryname>capitalInicial</queryname>
                        <servicename>creditos.capitalInicial</servicename>
                    </outParameter>
                    <outParameter description="" type="BIGDECIMAL">
                        <queryname>saldoCapital</queryname>
                        <servicename>creditos.saldoCapital</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>cantOriginalCuotas</queryname>
                        <servicename>creditos.cantOriginalCuotas</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>cantCuotasPendientes</queryname>
                        <servicename>creditos.cantCuotasPendientes</servicename>
                    </outParameter>
                    <outParameter description="" type="BIGDECIMAL">
                        <queryname>importeCuota</queryname>
                        <servicename>creditos.importeCuota</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>fechaVencimiento</queryname>
                        <servicename>creditos.fechaVencimiento</servicename>
                    </outParameter>
                    <outParameter description="" type="INTEGER">
                        <queryname>Cuotas_gracia</queryname>
                        <servicename>creditos.cuotasGracia</servicename>
                    </outParameter>
                    <outParameter description="" type="FLOAT">
                        <queryname>TNA</queryname>
                        <servicename>creditos.TNA</servicename>
                    </outParameter>
                    <outParameter description="" type="FLOAT">
                        <queryname>CFT</queryname>
                        <servicename>creditos.CFT</servicename>
                    </outParameter>
                    <outParameter description="" type="STRING">
                        <queryname>Estado</queryname>
                        <servicename>creditos.estado</servicename>
                    </outParameter>
                    <outParameter description="" type="BIGDECIMAL">
                        <queryname>JTS_OID</queryname>
                        <servicename>creditos.JTS_OID</servicename>
                    </outParameter>
                    <outParameter description="" type="FLOAT">
                        <queryname>TEA</queryname>
                        <servicename>creditos.TEA</servicename>
                    </outParameter>
                </level>
                
            </output>
        </query>
    </querys>
</serviceQuery>
