<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>ITF_DJP_ACPRIV_PROCESA_GENERICO</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
      <parameter>
        <name>BANDEJA_LOTE_ID</name>
        <default_value/>
        <description/>
      </parameter>
      <parameter>
        <name>CODIGO_AFIP</name>
        <default_value/>
        <description/>
      </parameter>
      <parameter>
        <name>DOMINIO</name>
        <default_value/>
        <description/>
      </parameter>
      <parameter>
        <name>PAGO_CONVENIO</name>
        <default_value/>
        <description/>
      </parameter>
      <parameter>
        <name>PAGO_CONVENIO_TIPO</name>
        <default_value/>
        <description/>
      </parameter>
      <parameter>
        <name>SUBDOMINIO</name>
        <default_value/>
        <description/>
      </parameter>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2025/02/10 13:33:14.888</created_date>
    <modified_user>-</modified_user>
    <modified_date>2025/02/10 13:33:14.888</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>TopazDS</name>
    <server/>
    <type>MSSQL</type>
    <access>JNDI</access>
    <database>TopazDS</database>
    <port>1521</port>
    <username/>
    <password>Encrypted </password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>MSSQL_DOUBLE_DECIMAL_SEPARATOR</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1521</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>Validaciones</from>
      <to>Mappeo de valores SIDEBA-Topaz</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Escribe bandeja</from>
      <to>Output</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Duraznito</from>
      <to>Escribe bandeja</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Validaciones</from>
      <to>Normaliza</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Valores default</from>
      <to>Duraznito</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Input</from>
      <to>SECUENCIA</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>SECUENCIA</from>
      <to>Obtiene Variables</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Separa nombre y apellido</from>
      <to>Maneja telefono</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Mappeo de valores SIDEBA-Topaz</from>
      <to>Normaliza 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Normaliza</from>
      <to>Error</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Normaliza 2</from>
      <to>Error</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Obtiene localidades</from>
      <to>Aplica duros si no encontro</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Aplica duros si no encontro</from>
      <to>Asume domicilio como localidad de nacimiento</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Obtiene Variables</from>
      <to>Cocina nombres</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Cocina nombres</from>
      <to>Obtiene sucursal topa</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Obtiene sucursal topa</from>
      <to>Validaciones</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sucursales</from>
      <to>Parsea sucursales</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Parsea sucursales</from>
      <to>Obtiene sucursal topa</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Mappeo de valores SIDEBA-Topaz</from>
      <to>Obtiene localidades</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Asume domicilio como localidad de nacimiento</from>
      <to>Separa nombre y apellido</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Maneja telefono</from>
      <to>Maneja numéricos opcionales</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Maneja numéricos opcionales</from>
      <to>Valores default</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Aplica duros si no encontro</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

if (TOPAZ_LOCALIDAD_ENCONTRADA != 1) {
	TOPAZ_CODIGO_POSTAL = 3500;
	TOPAZ_PROVINCIA	= 'H';
	TOPAZ_PROVINCIA_NOMBRE = 'CHACO';
	TOPAZ_DEPARTAMENTO = 21;
	TOPAZ_DEPARTAMENTO_NOMBRE = 'SAN FERNANDO';
	TOPAZ_LOCALIDAD = 3;
	TOPAZ_LOCALIDAD_NOMBRE = 'RESISTENCIA';
}</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOPAZ_CODIGO_POSTAL</name>
        <rename>TOPAZ_CODIGO_POSTAL</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>TOPAZ_PROVINCIA</name>
        <rename>TOPAZ_PROVINCIA</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>TOPAZ_PROVINCIA_NOMBRE</name>
        <rename>TOPAZ_PROVINCIA_NOMBRE</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>TOPAZ_DEPARTAMENTO</name>
        <rename>TOPAZ_DEPARTAMENTO</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>TOPAZ_DEPARTAMENTO_NOMBRE</name>
        <rename>TOPAZ_DEPARTAMENTO_NOMBRE</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>TOPAZ_LOCALIDAD</name>
        <rename>TOPAZ_LOCALIDAD</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>TOPAZ_LOCALIDAD_NOMBRE</name>
        <rename>TOPAZ_LOCALIDAD_NOMBRE</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1680</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Asume domicilio como localidad de nacimiento</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

TOPAZ_NACIMIENTO_PROVINCIA = TOPAZ_PROVINCIA;
TOPAZ_NACIMIENTO_DEPARTAMENTO = TOPAZ_DEPARTAMENTO;
TOPAZ_NACIMIENTO_LOCALIDAD = TOPAZ_LOCALIDAD;</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOPAZ_NACIMIENTO_PROVINCIA</name>
        <rename>TOPAZ_NACIMIENTO_PROVINCIA</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_NACIMIENTO_DEPARTAMENTO</name>
        <rename>TOPAZ_NACIMIENTO_DEPARTAMENTO</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_NACIMIENTO_LOCALIDAD</name>
        <rename>TOPAZ_NACIMIENTO_LOCALIDAD</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1968</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Cocina nombres</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

TOPAZ_NOMBRE_COMPLETO = String(NOMBRE_COMPLETO).replace(/\t/g, ' ');
TOPAZ_BARRIO = String(BARRIO).replace(/\t/g, ' ');
TOPAZ_APARTAMENTO = String(APARTAMENTO).replace(/\t/g, ' ');</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOPAZ_NOMBRE_COMPLETO</name>
        <rename>TOPAZ_NOMBRE_COMPLETO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_BARRIO</name>
        <rename>TOPAZ_BARRIO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_APARTAMENTO</name>
        <rename>TOPAZ_APARTAMENTO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>624</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Duraznito</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

TOPAZ_ORIGEN_CODIGO = 'CP';
TOPAZ_ACCION_CODIGO = 1;
TOPAZ_TITULAR_APODERADO = 'T';
TOPAZ_ESTADO_INGRESADO = 'I';</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOPAZ_ORIGEN_CODIGO</name>
        <rename>TOPAZ_ORIGEN_CODIGO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_ACCION_CODIGO</name>
        <rename>TOPAZ_ACCION_CODIGO</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_TITULAR_APODERADO</name>
        <rename>TOPAZ_TITULAR_APODERADO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_ESTADO_INGRESADO</name>
        <rename>TOPAZ_ESTADO_INGRESADO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3088</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Error</name>
    <type>MappingOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1136</xloc>
      <yloc>624</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Escribe bandeja</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <schema>dbo</schema>
    <table>MA_BANDEJA_ENTRADA</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>N</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>Y</return_keys>
    <return_field>BANDEJA_ID</return_field>
    <fields>
      <field>
        <column_name>ConvenioPago</column_name>
        <stream_name>PAGO_CONVENIO</stream_name>
      </field>
      <field>
        <column_name>TipoConvenio</column_name>
        <stream_name>PAGO_CONVENIO_TIPO</stream_name>
      </field>
      <field>
        <column_name>Dominio</column_name>
        <stream_name>TOPAZ_DOMINIO</stream_name>
      </field>
      <field>
        <column_name>Subdominio</column_name>
        <stream_name>TOPAZ_SUBDOMINIO</stream_name>
      </field>
      <field>
        <column_name>Origen</column_name>
        <stream_name>TOPAZ_ORIGEN_CODIGO</stream_name>
      </field>
      <field>
        <column_name>Accion</column_name>
        <stream_name>TOPAZ_ACCION_CODIGO</stream_name>
      </field>
      <field>
        <column_name>Titular_Apoderado</column_name>
        <stream_name>TOPAZ_TITULAR_APODERADO</stream_name>
      </field>
      <field>
        <column_name>CUIL</column_name>
        <stream_name>CUIT</stream_name>
      </field>
      <field>
        <column_name>Apellido</column_name>
        <stream_name>TOPAZ_APELLIDOS</stream_name>
      </field>
      <field>
        <column_name>Nombre</column_name>
        <stream_name>TOPAZ_NOMBRES</stream_name>
      </field>
      <field>
        <column_name>Cod_Postal</column_name>
        <stream_name>TOPAZ_CODIGO_POSTAL</stream_name>
      </field>
      <field>
        <column_name>Departamento</column_name>
        <stream_name>TOPAZ_DEPARTAMENTO</stream_name>
      </field>
      <field>
        <column_name>Localidad</column_name>
        <stream_name>TOPAZ_LOCALIDAD</stream_name>
      </field>
      <field>
        <column_name>Provincia</column_name>
        <stream_name>TOPAZ_PROVINCIA</stream_name>
      </field>
      <field>
        <column_name>Calle</column_name>
        <stream_name>TOPAZ_CALLE</stream_name>
      </field>
      <field>
        <column_name>Numero</column_name>
        <stream_name>TOPAZ_PUERTA</stream_name>
      </field>
      <field>
        <column_name>Piso</column_name>
        <stream_name>TOPAZ_PISO</stream_name>
      </field>
      <field>
        <column_name>Fecha_Nacimiento</column_name>
        <stream_name>NACIMIENTO_FECHA</stream_name>
      </field>
      <field>
        <column_name>Sexo</column_name>
        <stream_name>SEXO</stream_name>
      </field>
      <field>
        <column_name>Estado_Civil</column_name>
        <stream_name>TOPAZ_ESTADO_CIVIL</stream_name>
      </field>
      <field>
        <column_name>Telefono</column_name>
        <stream_name>TOPAZ_TELEFONO</stream_name>
      </field>
      <field>
        <column_name>Email</column_name>
        <stream_name>TOPAZ_MAIL</stream_name>
      </field>
      <field>
        <column_name>Codigo_Afip</column_name>
        <stream_name>TOPAZ_CODIGO_AFIP</stream_name>
      </field>
      <field>
        <column_name>Sucursal</column_name>
        <stream_name>CUENTA_SUCURSAL</stream_name>
      </field>
      <field>
        <column_name>Localidad_Nac</column_name>
        <stream_name>TOPAZ_NACIMIENTO_LOCALIDAD</stream_name>
      </field>
      <field>
        <column_name>Provincia_Nac</column_name>
        <stream_name>TOPAZ_NACIMIENTO_PROVINCIA</stream_name>
      </field>
      <field>
        <column_name>Departamento_Nac</column_name>
        <stream_name>TOPAZ_NACIMIENTO_DEPARTAMENTO</stream_name>
      </field>
      <field>
        <column_name>Barrio</column_name>
        <stream_name>TOPAZ_BARRIO</stream_name>
      </field>
      <field>
        <column_name>Nro_Lote</column_name>
        <stream_name>BANDEJA_LOTE_ID</stream_name>
      </field>
      <field>
        <column_name>Estado</column_name>
        <stream_name>TOPAZ_ESTADO_INGRESADO</stream_name>
      </field>
      <field>
        <column_name>ID_TRAMITE</column_name>
        <stream_name>TOPAZ_TRAMITE_ID</stream_name>
      </field>
      <field>
        <column_name>APARTAMENTO</column_name>
        <stream_name>TOPAZ_APARTAMENTO</stream_name>
      </field>
      <field>
        <column_name>Tipo_Doc_Fisico</column_name>
        <stream_name>TOPAZ_DOCUMENTO_TIPO</stream_name>
      </field>
      <field>
        <column_name>Num_Doc_Fisico</column_name>
        <stream_name>DOCUMENTO_NUMERO</stream_name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3312</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Input</name>
    <type>MappingInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>SECUENCIA</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>DOCUMENTO_TIPO</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>DOCUMENTO_NUMERO</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>CUIT</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>SEXO</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>CUENTA_SUCURSAL</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>NOMBRE_COMPLETO</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>NACIMIENTO_FECHA</name>
        <type>Date</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>CALLE</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>PUERTA</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>PISO</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>APARTAMENTO</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>BARRIO</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>CODIGO_POSTAL</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>LOCALIDAD</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>ESTADO_CIVIL</name>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>TELEFONO</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>TRAMITE_ID</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>MAIL</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>176</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Maneja numéricos opcionales</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>TOPAZ_PUERTA = parseaOpcional(PUERTA);
TOPAZ_PISO = parseaOpcional(PISO);
TOPAZ_TRAMITE_ID = parseaOpcional(TRAMITE_ID);</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>LoadScriptFromTab('Util');</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>-1</jsScript_type>
        <jsScript_name>Util</jsScript_name>
        <jsScript_script>//Script here

const patronNumerico = /^\d+$/

function esNumerico(numero) {
	return patronNumerico.test( trim(numero) );
}

function parseaOpcional(numero) {
	if ( esNumerico(numero) )
		return parseInt(numero, 10);
	else
		return 0;
}</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOPAZ_TRAMITE_ID</name>
        <rename>TOPAZ_TRAMITE_ID</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_PUERTA</name>
        <rename>TOPAZ_PUERTA</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_PISO</name>
        <rename>TOPAZ_PISO</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2656</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Maneja telefono</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

TELEFONO_AREA_CODIGO = null;
TELEFONO_NUMERO = null;

if (TELEFONO == null)
	TELEFONO = '0';

TOPAZ_TELEFONO = TELEFONO.replace(/[^\d]/g, '');

partesTelefono = TELEFONO.split('-');

if (partesTelefono.length == 1) { // Si no esta separado por guion
	
	telefonoCompleto = trim(partesTelefono[0]);

	if ( esNumerico(telefonoCompleto) &amp;&amp; String(parseInt(telefonoCompleto, 10)).length == 10 ) {
		TELEFONO_AREA_CODIGO = parseInt(telefonoCompleto.substring(0, telefonoCompleto.length - 7), 10);
		TELEFONO_NUMERO = parseInt(telefonoCompleto.substring(telefonoCompleto.length - 7), 10);
	}

} else if (partesTelefono.length == 2) { //Si esta separado por guion
	telefonoAreaCodigo = trim(partesTelefono[0]);
	telefonoNumero = trim(partesTelefono[1]);

	if ( 
		esNumerico(telefonoAreaCodigo) &amp;&amp; 
		esNumerico(telefonoNumero) &amp;&amp; 
		( numLength(telefonoAreaCodigo) + numLength(telefonoNumero) )== 10
	) {
		TELEFONO_AREA_CODIGO = parseInt(telefonoAreaCodigo, 10);
		TELEFONO_NUMERO = parseInt(telefonoNumero, 10);
	}
}

if (TELEFONO_AREA_CODIGO == null || TELEFONO_NUMERO == null)
	TOPAZ_TELEFONO = '+54-000-0000000';
else
	TOPAZ_TELEFONO = '+54-' + TELEFONO_AREA_CODIGO + '-' + TELEFONO_NUMERO;
</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>//Script here

const patronNumerico = /\d+/;

function esNumerico(numero) {
	return patronNumerico.test( trim(numero) );
}

function numLength(numero) {
	return String( parseInt(numero, 10) ).length;
}</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOPAZ_TELEFONO</name>
        <rename>TOPAZ_TELEFONO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2448</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Mappeo de valores SIDEBA-Topaz</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>trans_Status = CONTINUE_TRANSFORMATION;

ERROR = null;
ERROR_CODIGO = null;


//Mappea valores
TOPAZ_DOCUMENTO_TIPO = mapDocumentoTipo[parseInt(DOCUMENTO_TIPO,10)];
TOPAZ_ESTADO_CIVIL = mapEstadoCivil[parseInt(ESTADO_CIVIL,10)];


// Valida mappeos
if (TOPAZ_DOCUMENTO_TIPO == null)
	setError(74, 'Error: El campo Tipo de Documento llegó con valor inválido');

else if (TOPAZ_ESTADO_CIVIL == null)
	setError(75, 'Error: El campo Estado Civil llegó con valor inválido');


// Retorna error
if (ERROR_CODIGO != null)
	putError(ERROR_CODIGO, ERROR);</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>LoadScriptFromTab('Util');

const mapDocumentoTipo = {
	96: 'DNI',
	90: 'LC',
	89: 'LE'
}

const mapEstadoCivil = {
	1: 'S',
	2: 'C',
	3: 'V',
	4: 'D',
	5: 'U'
}
</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>-1</jsScript_type>
        <jsScript_name>Util</jsScript_name>
        <jsScript_script>//Script here


function putError(codigo, error) {
	_step_.putError(rowMeta, row, 1, error, null, codigo);
	trans_Status = SKIP_TRANSFORMATION;
}

function setError(codigo, error) {
	ERROR_CODIGO = codigo;
	ERROR = error;
}

Array.prototype.includes = function( value ) {
	return this.some( function(e) { return e === value } );
}</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOPAZ_DOCUMENTO_TIPO</name>
        <rename>TOPAZ_DOCUMENTO_TIPO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_ESTADO_CIVIL</name>
        <rename>TOPAZ_ESTADO_CIVIL</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1248</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Normaliza</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>SECUENCIA_GENERICO</name>
      </remove>
      <remove>
        <name>PAGO_CONVENIO</name>
      </remove>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Normaliza 2</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>SECUENCIA_GENERICO</name>
      </remove>
      <remove>
        <name>PAGO_CONVENIO</name>
      </remove>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1248</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Obtiene Variables</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

BANDEJA_LOTE_ID = BANDEJA_LOTE_ID;
PAGO_CONVENIO = PAGO_CONVENIO;
PAGO_CONVENIO_TIPO = PAGO_CONVENIO_TIPO;
TOPAZ_DOMINIO = TOPAZ_DOMINIO;
TOPAZ_SUBDOMINIO = TOPAZ_SUBDOMINIO;
TOPAZ_CODIGO_AFIP = TOPAZ_CODIGO_AFIP;
</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>//Script here

BANDEJA_LOTE_ID = String(getVariable("BANDEJA_LOTE_ID", ""));
PAGO_CONVENIO = String(getVariable("PAGO_CONVENIO", ""));
PAGO_CONVENIO_TIPO = String(getVariable("PAGO_CONVENIO_TIPO", ""));
TOPAZ_DOMINIO = String(getVariable("DOMINIO", ""));
TOPAZ_SUBDOMINIO = String(getVariable("SUBDOMINIO", ""));
TOPAZ_CODIGO_AFIP = String(getVariable("CODIGO_AFIP", ""));

function esVariableNumericaValida(valor) {
	if (valor == null) {
		writeToLog('e', 'El valor ' + valor + ' no es numérico porque es nulo');
		return false;
	}

	if (valor == '') {
		writeToLog('e', 'El valor ' + valor + ' no es numérico porque es string vacío');
		return false;
	}

	if ( ! /^\d+(?:\.\d+)?$/.test(valor) ) {
		writeToLog('e', 'El valor ' + valor + ' no es numérico porque no valida la expresión regular');
		return false;	
	}

	return true;
}	

function abortar(errorCodigo, error) {
	writeToLog('e', 'ABORTANDO PROCESO GENERICO => ' + error);
	setVariable("DESC_MENSAJE", error, 'r');
	setVariable("COD_ERROR", errorCodigo, 'r');
	_step_.setErrors(1);
	_step_.stopAll();
}


if ( !esVariableNumericaValida(BANDEJA_LOTE_ID) )
	abortar(51,"Error: No se obtuvo ID de Lote de Bandeja");
else
	BANDEJA_LOTE_ID = parseInt(BANDEJA_LOTE_ID, 10);


if ( !esVariableNumericaValida(PAGO_CONVENIO) )
	abortar(52, "Error: No se obtuvo Convenio de Pago válido");
else
	PAGO_CONVENIO = parseInt(PAGO_CONVENIO, 10);


if ( !esVariableNumericaValida(PAGO_CONVENIO_TIPO) )
	abortar(53, "Error: No se obtuvo Tipo de Convenio de Pago válido");
else
	PAGO_CONVENIO_TIPO = parseInt(PAGO_CONVENIO_TIPO, 10);


if ( !esVariableNumericaValida(TOPAZ_DOMINIO) )
	abortar(54, "Error: No se obtuvo Dominio válido [" + TOPAZ_DOMINIO + "]");
else
	TOPAZ_DOMINIO = parseInt(TOPAZ_DOMINIO, 10);


if ( !esVariableNumericaValida(TOPAZ_SUBDOMINIO) )
	abortar(55, "Error: No se obtuvo SubDominio válido [" + TOPAZ_SUBDOMINIO + "]");
else
	TOPAZ_SUBDOMINIO = parseInt(TOPAZ_SUBDOMINIO, 10);
</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>BANDEJA_LOTE_ID</name>
        <rename>BANDEJA_LOTE_ID</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>PAGO_CONVENIO</name>
        <rename>PAGO_CONVENIO</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>PAGO_CONVENIO_TIPO</name>
        <rename>PAGO_CONVENIO_TIPO</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_DOMINIO</name>
        <rename>TOPAZ_DOMINIO</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_SUBDOMINIO</name>
        <rename>TOPAZ_SUBDOMINIO</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_CODIGO_AFIP</name>
        <rename>TOPAZ_CODIGO_AFIP</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>448</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Obtiene localidades</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT TOP 1
	1 AS "TOPAZ_LOCALIDAD_ENCONTRADA",
	TOPAZ_CODIGO_POSTAL,
	TOPAZ_PROVINCIA,
	P.DESCRIPCION AS "TOPAZ_PROVINCIA_NOMBRE",
	TOPAZ_DEPARTAMENTO,
	D.NOMBREDEP AS "TOPAZ_DEPARTAMENTO_NOMBRE",
	TOPAZ_LOCALIDAD,
	L.DESCRIPCION_DIM3 AS "TOPAZ_LOCALIDAD_NOMBRE"
FROM MA_MAP_LOCALIDADES MAP WITH (NOLOCK)
INNER JOIN CLI_LOCALIDADES L WITH (NOLOCK) ON L.DIM1 = MAP.TOPAZ_PROVINCIA AND L.DIM2 = MAP.TOPAZ_DEPARTAMENTO AND L.DIM3 = MAP.TOPAZ_LOCALIDAD
INNER JOIN CLI_DEPARTAMENTOS D WITH (NOLOCK) ON D.DEPARTAMENTO = L.DIM2 AND D.PROVINCIA = L.DIM1
INNER JOIN CLI_PROVINCIAS P WITH (NOLOCK) ON P.DIM1 = L.DIM1
WHERE
	(MAP.SIDEBA_CODIGO_POSTAL = ? AND MAP.SIDEBA_LOCALIDAD = ?) OR
	(MAP.SIDEBA_CODIGO_POSTAL = ? AND MAP.SIDEBA_LOCALIDAD IS NULL)</sql>
    <outer_join>Y</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
      <field>
        <name>CODIGO_POSTAL</name>
        <type>String</type>
      </field>
      <field>
        <name>LOCALIDAD</name>
        <type>Integer</type>
      </field>
      <field>
        <name>CODIGO_POSTAL</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1456</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Obtiene sucursal topa</name>
    <type>StreamLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <from>Parsea sucursales</from>
    <input_sorted>N</input_sorted>
    <preserve_memory>Y</preserve_memory>
    <sorted_list>Y</sorted_list>
    <integer_pair>N</integer_pair>
    <lookup>
      <key>
        <name>CUENTA_SUCURSAL</name>
        <field>SUCURSAL</field>
      </key>
      <value>
        <name>SUCURSAL</name>
        <rename>TOPAZ_SUCURSAL_EXISTE</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>784</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Output</name>
    <type>MappingOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>3488</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Parsea sucursales</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>SUCURSAL</name>
        <rename>SUCURSAL</rename>
        <type>Integer</type>
        <length>5</length>
        <precision>0</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>784</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>SECUENCIA</name>
    <type>Sequence</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <valuename>SECUENCIA_GENERICO</valuename>
    <use_database>N</use_database>
    <connection>TopazDS</connection>
    <schema/>
    <seqname>SEQ_</seqname>
    <use_counter>Y</use_counter>
    <counter_name>c44fd0b9-f1db-408a-9f75-a74571f59aee</counter_name>
    <start_at>1</start_at>
    <increment_by>1</increment_by>
    <max_value>999999999</max_value>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>304</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Separa nombre y apellido</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var tokens = trim(String(NOMBRE_COMPLETO)).split(' ').filter( function(e) { return e != ''; } );

// Arreglo donde se guardan las palabras del nombre.
var tokens_nuevo = [];

for (var i = 0; i &lt; tokens.length; i++) {
  token = tokens[i];
  palabra = token;
  while (token != null &amp;&amp; special_tokens.includes(token.toUpperCase())) {
    token = tokens[++i];
    palabra += ' ' + token;    
  }
  tokens_nuevo.push(palabra);
}

obj = separaNombreApellido(tokens_nuevo);

var TOPAZ_APELLIDOS = obj.apellidos;
var TOPAZ_NOMBRES = obj.nombres;</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>// Palabras de apellidos y nombres compuestos
var special_tokens = [
	'DA',
	'DE',
	'DEL',
	'LA',
	'LAS',
	'LOS',
	'MAC',
	'MC',
	'VAN',
	'VON',
	'Y',
	'I',
	'SAN',
	'SANTA'
];

function separaNombreApellido (tokens) {
	switch(tokens.length) {
	
		case 0:
			return {
				"apellidos": "", 
				"nombres": ""
			};

		case 1:
			return {
				"apellidos": "",
				"nombres": tokens[0]
			};

		case 2:
			return {
				"apellidos": tokens[0],
				"nombres": tokens[1]
			}

		case 3:
			return {
				"apellidos": tokens[0],
				"nombres": tokens[1] + ' ' + tokens[2]
			}

		case 4:
			return {
				"apellidos": tokens[0] + ' ' + tokens[1],
				"nombres": tokens[2] + ' ' + tokens[3]
			}
	
		default:
			apellidos = tokens[0] + ' ' + tokens[1];
			tokens.splice(0,2);
			nombres = tokens.join(' ');
			return {
				"apellidos": apellidos,
				"nombres": nombres
			}
	}
}

Array.prototype.includes = function( value ) {
	return this.some( function(e) { return e === value } );
}

</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOPAZ_APELLIDOS</name>
        <rename>TOPAZ_APELLIDOS</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_NOMBRES</name>
        <rename>TOPAZ_NOMBRES</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2240</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Sucursales</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <sql>SELECT * FROM SUCURSALES WHERE SUCURSAL &lt;= 30</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>784</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Validaciones</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>trans_Status = CONTINUE_TRANSFORMATION;

ERROR = null;
ERROR_CODIGO = null;

// Validaciones enum

if ( String(DOCUMENTO_NUMERO).length &lt; 7 )
	setError(56, 'Error: Número de Documento con menos de 8 dígitos');

else if ( String(DOCUMENTO_NUMERO).length > 8 )
	setError(57, 'Error: Número de Documento con más de 8 dígitos');

else if ( String(CUIT).length &lt; 11 )
	setError(58, 'Error: Campo CUIT con menos de 11 dígitos');

else if ( String(CUIT).length > 11 )
	setError(59, 'Error: Campo CUIT con más de 11 dígitos');

else if ( parseInt(String(CUIT).substring(2,10), 10) != DOCUMENTO_NUMERO)
	setError(60, 'Error: Número de Documento dentro del CUIL distinto al informado en el otro campo');

else if ( ![20, 23, 24, 27].includes( parseInt(String(CUIT).substring(0,2), 10) ) )
	setError(61, 'Error: CUIL con primeros 2 dígitos inválidos');

else if ( !['M', 'F', 'X'].includes( String(SEXO) ) )
	setError(62, 'Error: el campo Sexo del titular llegó con valor inválido');

else if ( !patronNombre.test(trim(NOMBRE_COMPLETO)) )
	setError(63, 'Error: el campo Nombre Completo se recibió con caracteres inválidos');

else if ( trim(NOMBRE_COMPLETO).length &lt; 3 )
	setError(64, 'Error: el campo Nombre Completo tiene menos o igual a 3 caracteres');
	
else if ( trim(NOMBRE_COMPLETO).length > 30 )
	setError(65, 'Error: el campo Nombre Completo tiene mas de 30 caracteres');

else if ( String(CALLE).length > 30 )
	setError(66, 'Error: el campo Calle tiene más de 30 caracteres');

else if ( String(PUERTA).length > 6 )
	setError(67, 'Error: el campo Puerta tiene más de 6 dígitos');

else if ( String(PISO).length > 3 )
	setError(68, 'Error: el campo Piso tiene más de 3 dígitos');

else if ( !patronDireccion.test(BARRIO) )
	setError(69, 'Error: el campo Barrio se recibió con caracteres inválidos');

else if ( !patronDireccion.test(APARTAMENTO) )
	setError(70, 'Error: el campo Apartamento se recibió con caracteres inválidos');

else if ( String(TRAMITE_ID).length > 10 )
	setError(71, 'Error: el campo ID de Trámite tiene más de 10 dígitos');

else if ( TOPAZ_SUCURSAL_EXISTE == null &amp;&amp; parseInt(CUENTA_SUCURSAL,10) != 0 )
	setError(72, 'Error: la sucursal recibida no existe');

else if ( dateDiff( NACIMIENTO_FECHA, FECHA_PROCESO, 'y') &lt; 5 )
	setError(73, 'Error: la persona es menor a la edad permitida (5 años)');

if (ERROR_CODIGO != null) {
	putError(ERROR_CODIGO, ERROR);
}</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>LoadScriptFromTab('Util');

caracteresNombre = getVariable("topaz.formulas.validchars.nombre", "abcdefghijklmnñopqrstuvwxyzABCDEFGHIJKLMNÑOPQRSTUVWXYZáéíóúàèìòùäëïöüÁÉÍÓÚÀÈÌÒÙÂÊÎÔÛ");
caracteresDireccion = getVariable("topaz.formulas.validchars.direccion", "ABCDEFGHIJKLMNÑOPQRSTUVWXYZÁÉÍÓÚabcdefghijklmnñopqrstuvwxyzáéíóú,./-0123456789&amp;@_");


const patronNumerico = /^\d+$/

const patronNombre = new RegExp("^[" + caracteresNombre + " " + "]+$");

const patronDireccion = new RegExp("^[" + caracteresDireccion + " " + "]*$");

const FECHA_PROCESO = str2date(getVariable("FECHATOP", ""), 'yyyyMMdd');

</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>-1</jsScript_type>
        <jsScript_name>Util</jsScript_name>
        <jsScript_script>//Script here

function esNumerico(numero) {
	return patronNumerico.test( trim(numero) );
}

function esStringVacio(cadena) {
	return cadena == null || trim(cadena).length == 0;
}

function putError(codigo, error) {
	_step_.putError(rowMeta, row, 1, error, null, codigo);
	trans_Status = SKIP_TRANSFORMATION;
}

Array.prototype.includes = function( value ) {
	return this.some( function(e) { return e === value } );
}

function setError(codigo, error) {
	ERROR = error;
	ERROR_CODIGO = codigo;
}</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1024</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Valores default</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

TOPAZ_MAIL = MAIL;
TOPAZ_CALLE = CALLE;

if (MAIL == null || trim(MAIL) == '' || trim(MAIL).length > 50)
	TOPAZ_MAIL = 'notienemail@canal.no';

if (CALLE == null || trim(CALLE) == '')
	TOPAZ_CALLE = 'SIN CALLE ESPECIFICADA';

if (parseInt(CUENTA_SUCURSAL, 10) == 0)
	CUENTA_SUCURSAL = 30;</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOPAZ_MAIL</name>
        <rename>TOPAZ_MAIL</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>TOPAZ_CALLE</name>
        <rename>TOPAZ_CALLE</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>CUENTA_SUCURSAL</name>
        <rename>CUENTA_SUCURSAL</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2896</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
    <error>
      <source_step>Mappeo de valores SIDEBA-Topaz</source_step>
      <target_step>Normaliza 2</target_step>
      <is_enabled>Y</is_enabled>
      <nr_valuename/>
      <descriptions_valuename>ERROR</descriptions_valuename>
      <fields_valuename/>
      <codes_valuename>ERROR_CODIGO</codes_valuename>
      <max_errors/>
      <max_pct_errors/>
      <min_pct_rows/>
    </error>
    <error>
      <source_step>Obtiene Variables</source_step>
      <target_step/>
      <is_enabled>N</is_enabled>
      <nr_valuename/>
      <descriptions_valuename/>
      <fields_valuename/>
      <codes_valuename/>
      <max_errors/>
      <max_pct_errors/>
      <min_pct_rows/>
    </error>
    <error>
      <source_step>Validaciones</source_step>
      <target_step>Normaliza</target_step>
      <is_enabled>Y</is_enabled>
      <nr_valuename/>
      <descriptions_valuename>ERROR</descriptions_valuename>
      <fields_valuename/>
      <codes_valuename>ERROR_CODIGO</codes_valuename>
      <max_errors/>
      <max_pct_errors/>
      <min_pct_rows/>
    </error>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
