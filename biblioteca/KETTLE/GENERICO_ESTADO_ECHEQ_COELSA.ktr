<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>GENERICO_ESTADO_ECHEQ_COELSA</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2025/03/20 08:10:38.540</created_date>
    <modified_user>-</modified_user>
    <modified_date>2025/03/20 08:10:38.540</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
    <notepad>
      <note>Para la alta diaria, igualmente es requerido el cbu, se puede enviar cualquier cosa</note>
      <xloc>128</xloc>
      <yloc>480</yloc>
      <width>569</width>
      <heigth>32</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>12</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
  </notepads>
  <connection>
    <name>TopazDS</name>
    <server/>
    <type>MSSQL</type>
    <access>JNDI</access>
    <database>TopazDS</database>
    <port>1521</port>
    <username/>
    <password>Encrypted </password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>MSSQL_DOUBLE_DECIMAL_SEPARATOR</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1521</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>Fila Dummy</from>
      <to>Get Token</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Token</from>
      <to>Parsea Token</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>KEY URL y Token</from>
      <to>Obtiene url</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Obtiene url</from>
      <to>Obtiene Token</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Parsea Token</from>
      <to>Obtiene Token</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Parsea URL</from>
      <to>Obtiene url</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>URLs Property Input</from>
      <to>Parsea URL</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>limpio campos 2</from>
      <to>Maneja Respuesta</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>INPUT</from>
      <to>Campos Reservados</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Campos Reservados</from>
      <to>KEY URL y Token</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Obtiene Token</from>
      <to>A, B, C, X</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>A, B, C, X</from>
      <to>ALTA</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>A, B, C, X</from>
      <to>ALTA DIARIA</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>OBTENGO JTS_OID CON CBU</from>
      <to>no permito echeqs</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>no permito echeqs</from>
      <to>actualizo campo permite echeqs</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Maneja Respuesta</from>
      <to>limpio campos 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>limpio campos 3</from>
      <to>Filter rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>actualizo campo permite echeqs</from>
      <to>remuevo campos</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>existe cbu?</from>
      <to>NO EXISTE EL CBU EN TOPAZ</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Constructor Consulta</from>
      <to>limpio campos</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>limpio campos</from>
      <to>existe cbu?</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>existe cbu?</from>
      <to>consulta coelsa</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>NO EXISTE EL CBU EN TOPAZ</from>
      <to>limpio campos 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>consulta coelsa</from>
      <to>limpio campos 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>A, B, C, X</from>
      <to>BAJA</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows</from>
      <to>OBTENGO JTS_OID CON CBU</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows</from>
      <to>unifico flujos</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>remuevo campos</from>
      <to>unifico flujos</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>unifico flujos</from>
      <to>remuevo campos 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>remuevo campos 2</from>
      <to>OUTPUT</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>A, B, C, X</from>
      <to>CONSULTA</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>ALTA DIARIA</from>
      <to>ultima fila</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>CONSULTA</from>
      <to>ultima fila</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>ALTA</from>
      <to>ultima fila</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>BAJA</from>
      <to>ultima fila</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>ultima fila</from>
      <to>Constructor Consulta</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>A, B, C, X</name>
    <type>SwitchCase</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fieldname>TIPO_CONSULTA</fieldname>
    <use_contains>N</use_contains>
    <case_value_type>String</case_value_type>
    <case_value_format/>
    <case_value_decimal/>
    <case_value_group/>
    <default_target_step/>
    <cases>
      <case>
        <value>A</value>
        <target_step>ALTA</target_step>
      </case>
      <case>
        <value>B</value>
        <target_step>BAJA</target_step>
      </case>
      <case>
        <value>C</value>
        <target_step>CONSULTA</target_step>
      </case>
      <case>
        <value>X</value>
        <target_step>ALTA DIARIA</target_step>
      </case>
    </cases>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>800</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>ALTA</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT TOP 1
	FORMAT(s.SUCURSAL, '0000') as 'sucursal_codigo',
	suc.NOMBRESUCURSAL as 'sucursal_nombre',
	CONCAT(cd.CALLE, ' ', cd.NUMERO) as 'sucursal_domicilio',
	TRY_CAST(cd.CPA_VIEJO AS VARCHAR(4)) AS 'sucursal_codigoPostal',
	cp.DESCRIPCION as 'sucursal_provincia',
	TRY_CAST(cdp.NUMERODOCUMENTO AS NUMERIC(11, 0)) AS 'emisor_cuit',
	cc.NOMBRECLIENTE as 'emisor_razonSocial',
	vs.CTA_CBU as 'emisor_cbu',
	FORMAT(s.CUENTA, '00000000000') AS 'emisor_cuenta',
	'' as 'emisor_subcuenta',
	FORMAT(s.C1620, 'yyyy-MM-ddTHH:mm:ssZ') as 'emisor_cuentaFechaAlta',
	FORMAT(cp.CODIGOPAIS, '000') as 'emisor_moneda',
	CONCAT(cd2.CALLE, ' ', cd2.NUMERO) as 'emisor_domicilio',
	TRY_CAST(cd2.CPA_VIEJO AS VARCHAR(4)) AS 'emisor_codigoPostal',
	STRING_AGG(ce.EMAIL, ', ') as 'emisor_emails'
FROM VTA_SALDOS (nolock) vs
  JOIN SALDOS (nolock) s ON vs.JTS_OID_SALDO = s.JTS_OID
    AND s.TZ_LOCK = 0
  LEFT JOIN SUCURSALES (nolock) suc ON s.SUCURSAL = suc.SUCURSAL 
  	and suc.TZ_LOCK = 0
  LEFT JOIN CLI_DIRECCIONES (nolock) cd ON s.SUCURSAL = cd.ID 
    and cd.FORMATO = 'S' 
    and cd.TIPODIRECCION = 'R'
    and cd.TZ_LOCK = 0
  LEFT JOIN CLI_PROVINCIAS (nolock) cp ON cd.PROVINCIA = cp.DIM1 
    AND cd.PAIS = cp.CODIGOPAIS	
    and cp.TZ_LOCK = 0
  LEFT JOIN CLI_CLIENTES (nolock) cc ON s.C1803 = cc.CODIGOCLIENTE 
  	and cc.TZ_LOCK = 0
  LEFT JOIN CLI_ClientePersona (nolock) ccp ON cc.CODIGOCLIENTE = ccp.CODIGOCLIENTE
    AND ccp.TITULARIDAD = 'T'
    and ccp.TZ_LOCK = 0
  LEFT JOIN CLI_DocumentosPFPJ (nolock) cdp ON ccp.NUMEROPERSONA = cdp.NUMEROPERSONAFJ
  	and cdp.TZ_LOCK = 0
  LEFT JOIN CLI_DIRECCIONES (nolock) cd2 on cdp.NUMEROPERSONAFJ = cd2.ID 
    and cd2.FORMATO &lt;&gt; 'S'
    and cd2.TIPODIRECCION =
      case
        when cd2.FORMATO = 'PJ' then 'L'
        when cd2.FORMATO = 'PF' then 'PR'
      end
     and cd2.TZ_LOCK = 0
   LEFT JOIN CLI_EMAILS ce ON cdp.NUMEROPERSONAFJ = ce.ID
    and ce.FORMATO &lt;&gt; 'S'
    and ce.TZ_LOCK = 0
  WHERE vs.CTA_CBU = ?
GROUP BY 
	s.SUCURSAL, suc.NOMBRESUCURSAL, cd.CALLE, cd.NUMERO, cd.CPA_VIEJO, 
	cp.DESCRIPCION, cdp.NUMERODOCUMENTO, cc.NOMBRECLIENTE, vs.CTA_CBU, 
	s.CUENTA, s.C1620, cp.CODIGOPAIS, cd2.CALLE, cd2.NUMERO, cd2.CPA_VIEJO;</sql>
    <outer_join>Y</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>CBU</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>960</xloc>
      <yloc>448</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>ALTA DIARIA</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT 
	FORMAT(s.SUCURSAL, '0000') as 'sucursal_codigo',
	suc.NOMBRESUCURSAL as 'sucursal_nombre',
	CONCAT(cd.CALLE, ' ', cd.NUMERO) as 'sucursal_domicilio',
	TRY_CAST(cd.CPA_VIEJO AS VARCHAR(4)) AS 'sucursal_codigoPostal',
	cp.DESCRIPCION as 'sucursal_provincia',
	TRY_CAST(cdp.NUMERODOCUMENTO AS NUMERIC(11, 0)) AS 'emisor_cuit',
	cc.NOMBRECLIENTE as 'emisor_razonSocial',
	vs.CTA_CBU as 'emisor_cbu',
	FORMAT(s.CUENTA, '00000000000') AS 'emisor_cuenta',
	'' as 'emisor_subcuenta',
	FORMAT(s.C1620, 'yyyy-MM-ddTHH:mm:ssZ') as 'emisor_cuentaFechaAlta',
	FORMAT(cp.CODIGOPAIS, '000') as 'emisor_moneda',
	CONCAT(cd2.CALLE, ' ', cd2.NUMERO) as 'emisor_domicilio',
	TRY_CAST(cd2.CPA_VIEJO AS VARCHAR(4)) AS 'emisor_codigoPostal',
	STRING_AGG(ce.EMAIL, ', ') as 'emisor_emails'
FROM SALDOS (nolock) s
	JOIN VTA_SALDOS (nolock) vs on s.JTS_OID = vs.JTS_OID_SALDO
		and vs.TZ_LOCK = 0
	LEFT JOIN SUCURSALES (nolock) suc on s.SUCURSAL = suc.SUCURSAL 
		and suc.TZ_LOCK = 0
	LEFT JOIN CLI_DIRECCIONES (nolock) cd on s.SUCURSAL = cd.ID 
		and cd.FORMATO = 'S' 
		and cd.TIPODIRECCION = 'R'
		and cd.TZ_LOCK = 0
	LEFT JOIN CLI_PROVINCIAS (nolock) cp on cd.PROVINCIA = cp.DIM1 
		and cd.PAIS = cp.CODIGOPAIS	
		and cp.TZ_LOCK = 0
	LEFT JOIN CLI_CLIENTES (nolock) cc on s.C1803 = cc.CODIGOCLIENTE 
		and cc.TZ_LOCK = 0
	LEFT JOIN CLI_ClientePersona (nolock) ccp on cc.CODIGOCLIENTE = ccp.CODIGOCLIENTE
		and ccp.TITULARIDAD = 'T'
		and ccp.TZ_LOCK = 0 
	LEFT JOIN CLI_DocumentosPFPJ (nolock) cdp on ccp.NUMEROPERSONA = cdp.NUMEROPERSONAFJ
		and cdp.TZ_LOCK = 0
	LEFT JOIN CLI_DIRECCIONES (nolock) cd2 on cdp.NUMEROPERSONAFJ = cd2.ID 
		and cd2.FORMATO &lt;&gt; 'S' 
		and cd2.TIPODIRECCION =
			case
				when cd2.FORMATO = 'PJ' then 'L'
				when cd2.FORMATO = 'PF' then 'PR'
			end
		and cd2.TZ_LOCK = 0
	LEFT JOIN CLI_EMAILS ce ON cdp.NUMEROPERSONAFJ = ce.ID
		and ce.FORMATO &lt;&gt; 'S'
		and ce.TZ_LOCK = 0
	WHERE s.C1620 = '${COELSAEC_FECHA_ALTA}'
		and s.C1679 = 0
		and s.C1785 = 2
		and s.PERMITE_ECHEQ = 'S'
GROUP BY 
	s.SUCURSAL, suc.NOMBRESUCURSAL, cd.CALLE, cd.NUMERO, cd.CPA_VIEJO, 
	cp.DESCRIPCION, cdp.NUMERODOCUMENTO, cc.NOMBRECLIENTE, vs.CTA_CBU, 
	s.CUENTA, s.C1620, cp.CODIGOPAIS, cd2.CALLE, cd2.NUMERO, cd2.CPA_VIEJO;</sql>
    <outer_join>Y</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>960</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>BAJA</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT TOP 1
  '' as 'sucursal_codigo',
  '' as 'sucursal_nombre',
  '' as 'sucursal_domicilio',
  '' as 'sucursal_codigoPostal',
  '' as 'sucursal_provincia',
	TRY_CAST(cdp.NUMERODOCUMENTO AS NUMERIC(11, 0)) AS 'emisor_cuit',
  '' as 'emisor_razonSocial',
  '' as 'emisor_cbu',
  '' as 'emisor_cuenta',
  '' as 'emisor_subcuenta',
  '' as 'emisor_cuentaFechaAlta',
  '' as 'emisor_moneda',
  '' as 'emisor_domicilio',
  '' as 'emisor_codigoPostal',
  '' as 'emisor_emails'
FROM SALDOS (nolock) s 
JOIN VTA_SALDOS (nolock) vs on s.JTS_OID = vs.JTS_OID_SALDO 
  and vs.CTA_CBU = ?
  and vs.TZ_LOCK = 0
JOIN CLI_ClientePersona (nolock) ccp on s.C1803 = ccp.CODIGOCLIENTE
  and ccp.TITULARIDAD = 'T'
  and ccp.TZ_LOCK = 0
JOIN CLI_DocumentosPFPJ (nolock) cdp on ccp.NUMEROPERSONA = cdp.NUMEROPERSONAFJ
	and ccp.TZ_LOCK = 0
WHERE s.TZ_LOCK = 0</sql>
    <outer_join>Y</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>CBU</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>960</xloc>
      <yloc>560</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>CONSULTA</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT TOP 1
  '' as 'sucursal_codigo',
  '' as 'sucursal_nombre',
  '' as 'sucursal_domicilio',
  '' as 'sucursal_codigoPostal',
  '' as 'sucursal_provincia',
	TRY_CAST(cdp.NUMERODOCUMENTO AS NUMERIC(11, 0)) AS 'emisor_cuit',
  '' as 'emisor_razonSocial',
  '' as 'emisor_cbu',
  '' as 'emisor_cuenta',
  '' as 'emisor_subcuenta',
  '' as 'emisor_cuentaFechaAlta',
  '' as 'emisor_moneda',
  '' as 'emisor_domicilio',
  '' as 'emisor_codigoPostal',
  '' as 'emisor_emails'
FROM SALDOS (nolock) s 
JOIN VTA_SALDOS (nolock) vs on s.JTS_OID = vs.JTS_OID_SALDO 
  and vs.CTA_CBU = ?
  and vs.TZ_LOCK = 0
JOIN CLI_ClientePersona (nolock) ccp on s.C1803 = ccp.CODIGOCLIENTE
  and ccp.TITULARIDAD = 'T'
  and ccp.TZ_LOCK = 0
JOIN CLI_DocumentosPFPJ (nolock) cdp on ccp.NUMEROPERSONA = cdp.NUMEROPERSONAFJ
	and ccp.TZ_LOCK = 0
WHERE s.TZ_LOCK = 0</sql>
    <outer_join>Y</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>CBU</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>960</xloc>
      <yloc>336</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Campos Reservados</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//HHHH
if (['A','B','C','X'].indexOf(String(TIPO_CONSULTA)) == -1) {
    writeToLog('e', '*** [TIPO_CONSULTA = '+TIPO_CONSULTA+'] INVALIDO ***');
	_step_.setErrors(1);
}

if (TIPO_CONSULTA != 'X' &amp;&amp; (CBU.length != 22 || !isNum(CBU))) {
    writeToLog('e', '*** [CBU = '+CBU+'] INVALIDO ***');
	_step_.setErrors(1);
} else if (TIPO_CONSULTA == 'X') {
	var fecha_alta = parseDate(fecha, 'yyyyMMdd')

	if (fecha == 'default') {
    writeToLog('e', '*** LA FECHA ES REQUERIDA PARA LA ALTA DIARIA ***');
	_step_.setErrors(1);
	} else if (!fecha_alta) {
    writeToLog('e', '*** [FECHA = '+fecha+'] INVALIDA ***');
	_step_.setErrors(1);
	} else {
	var temp_cbu = 'X'
	}
} else {
	var temp_cbu = CBU
}</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>var fecha = getVariable('COELSAEC_FECHA_ALTA', 'default')

var camposReservados = [
	'COELSAEC_keyURL',
	'COELSAEC_keyTOKEN',
	'COELSAEC_URL_CONSULTA',
	'COELSAEC_TOKEN',
	'COELSAEC_URL',
	'COELSAEC_BODY',
	'COELSAEC_METODO',
	'COELSAEC_respuesta',
	'COELSAEC_codRespuesta', 
	'COELSAEC_EMISOR_CBU',
	'COELSAEC_BANCO_CODIGO',
	'COELSAEC_EMISOR_CUENTA',
	'COELSAEC_EMISOR_SUBCUENTA',
	'COELSAEC_EMISOR_MONEDA',
	'COELSAEC_EMISOR_CUENTA_FECHA_ALTA',
	'COELSAEC_SUCURSAL_CODIGO',
	'COELSAEC_SUCURSAL_NOMBRE',
	'COELSAEC_SUCURSAL_DOMICILIO',
	'COELSAEC_SUCURSAL_CP',
	'COELSAEC_SUCURSAL_PROVINCIA',
	'COELSAEC_EMISOR_CUIT',
	'COELSAEC_EMISOR_RAZON_SOCIAL',
	'COELSAEC_EMISOR_DOMICILIO',
	'COELSAEC_EMISOR_CP',
	'COELSAEC_CUENTA_ESTADO',
	'COELSAEC_FECHA_ALTA',
	'COELSAEC_FECHA_ULT_MODIFICACION',
	'COELSAEC_CUENTA_FIRMANTES'

]

var camposObligatorios = [
    'TIPO_CONSULTA',
    'CBU'
];

// No tocar

var camposReservadosEncontrados = [];
var camposFaltantes = [];

Array.prototype.contains = function(value) {
    return (this.indexOf(value) !== -1);
};

const valueMetaList = rowMeta.getValueMetaList();
var camposEncontrados = []; 

for (var valueMetaIndex = 0; valueMetaIndex &lt; valueMetaList.size(); valueMetaIndex++) {
    var valueMeta = valueMetaList.get(valueMetaIndex);
    var valueMetaName = valueMeta.getName();
    
    if (camposReservados.contains(String(valueMetaName))) {
        camposReservadosEncontrados.push(String(valueMetaName));
    }
    
    camposEncontrados.push(String(valueMetaName));
}

for (var i = 0; i &lt; camposObligatorios.length; i++) {
    if (!camposEncontrados.contains(camposObligatorios[i])) {
        camposFaltantes.push(camposObligatorios[i]);
    }
}

if (camposReservadosEncontrados.length !== 0 || camposFaltantes.length !== 0) {
    writeToLog('e', '*** ERROR INICIALIZANDO TRANSFORMACIÓN GENÉRICA ESTADO_ECHEQ_COELSA ***');
    
    if (camposReservadosEncontrados.length !== 0) {
        writeToLog('e', '*** Se recibieron los campos reservados [' + camposReservadosEncontrados.join(', ') + '] ***');
    }

    if (camposFaltantes.length !== 0) {
        writeToLog('e', '*** Faltan los campos obligatorios [' + camposFaltantes.join(', ') + '] ***');
    }

    _step_.setErrors(1);
}


const parseDate = function (date, format) {
  var parsedDate;
  try {
    parsedDate = str2date( date, format);
  } catch (ex) {
    return null;
  }
 
  var reversedDate = date2str( parsedDate, format);
 
  if ( reversedDate == date) {
    return parsedDate;
  } else {
    return null;
  }
}</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>temp_cbu</name>
        <rename>CBU</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>224</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Constructor Consulta</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here
var busqueda = null;
var BODY = null;
var ERROR = null;

var TOKEN = "Bearer " + COELSAEC_TOKEN

if (emisor_subcuenta === null &amp;&amp; ULTIMA) {
    var fechaVar = date2str(str2date(getVariable('COELSAEC_FECHA_ALTA', '00000000'), 'yyyyMMdd'), 'yyyy/MM/dd');
	ERROR = (TIPO_CONSULTA == 'X')
    ? 'NO SE ENCONTRARON SOLICITUDES DE ALTA PARA LA FECHA [' + fechaVar + ']'
    : 'NO SE PUDO ENCONTRAR EL CBU EN TOPAZ';
	busqueda = 'ERROR'
    RequestLog(TIPO_CONSULTA, null, null, null, ERROR);
} else {
    if (TIPO_CONSULTA == 'C') {
        var URL = COELSAEC_URL_CONSULTA + '?cbu=' + CBU + '&amp;cuit=' + emisor_cuit
        var METODO = 'GET'
        RequestLog(TIPO_CONSULTA, CBU, METODO, BODY, ERROR);
    } else if (TIPO_CONSULTA == 'A' || TIPO_CONSULTA == 'X') {

        if (!sucursal_codigo) {
            ERROR = 'No se pudo encontrar el codigo de la sucursal';
        } else if (!sucursal_nombre) {
            ERROR = 'No se pudo encontrar el nombre de la sucursal';
        } else if (!sucursal_domicilio) {
            ERROR = 'No se pudo encontrar la direccion de la sucursal';
        } else if (!sucursal_codigoPostal) {
            ERROR = 'No se pudo encontrar el codigo postal de la sucursal';
        } else if (!sucursal_provincia) {
            ERROR = 'No se pudo encontrar la provincia de la sucursal';
        } else if (!emisor_cuit) {
            ERROR = 'No se pudo encontrar el cuit del emisor';
        } else if (!emisor_razonSocial) {
            ERROR = 'No se pudo encontrar la razon social del emisor';
        } else if (!emisor_cbu) {
            ERROR = 'No se pudo encontrar el cbu del emisor';
        } else if (!emisor_cuenta) {
            ERROR = 'No se pudo encontrar la cuenta del emisor';
        } else if (!emisor_cuentaFechaAlta) {
            ERROR = 'No se pudo encontrar la fecha de alta de la cuenta del emisor';
        } else if (!emisor_moneda) {
            ERROR = 'No se pudo encontrar la moneda del emisor';
        } else if (!emisor_domicilio) {
            ERROR = 'No se pudo encontrar el domicilio del emisor';
        } else if (!emisor_codigoPostal) {
            ERROR = 'No se pudo encontrar el codigo postal del emisor';
        } else if (!emisor_emails || emisor_emails.length == 0) {
            ERROR = 'No se pudo encontrar el/los emails del emisor';
        }


        var emailsArray = [];
        if (emisor_emails &amp;&amp; emisor_emails.length > 0) {
            var emailsSplit = emisor_emails.split(", ");
            for (var i = 0; i &lt; emailsSplit.length; i++) {
                emailsArray.push({ email: emailsSplit[i] });
            }
        }

        var obj = {
            sucursal: {
                codigo: sucursal_codigo || null,
                nombre: sucursal_nombre ? normalizarTexto(sucursal_nombre) : null,
                domicilio: sucursal_domicilio ? normalizarTexto(sucursal_domicilio) : null,
                codigoPostal: sucursal_codigoPostal || null,
                provincia: sucursal_provincia ? normalizarTexto(sucursal_provincia) : null
            },
            emisor: {
                cuit: emisor_cuit || null,
                razonSocial: emisor_razonSocial ? normalizarTexto(emisor_razonSocial) : null,
                cbu: emisor_cbu || null,
                cuenta: emisor_cuenta || null,
                subcuenta: emisor_subcuenta || null,
                cuentaFechaAlta: emisor_cuentaFechaAlta || null,
                moneda: emisor_moneda || null,
                domicilio: emisor_domicilio ? normalizarTexto(emisor_domicilio) : null,
                codigoPostal: emisor_codigoPostal || null,
                emails: emailsArray
            }
        };

        BODY = JSON.stringify(obj);

        if (ERROR != null) {
            busqueda = 'ERROR';
        }

        var URL = COELSAEC_URL_CONSULTA;
        var METODO = 'POST';
        RequestLog(TIPO_CONSULTA, emisor_cbu, METODO, obj, ERROR);
    } else if (TIPO_CONSULTA == 'B') {
        var URL = COELSAEC_URL_CONSULTA + '/' + CBU + '/' + emisor_cuit;
        var METODO = 'DELETE'
        RequestLog(TIPO_CONSULTA, CBU, METODO, BODY, ERROR);
    }
}
</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>LoadScriptFromTab('utils')

const mapaCaracteres = {
  "A": "A", "a": "A", "Á": "A", "á": "A",
  "B": "B", "b": "B",
  "C": "C", "c": "C",
  "D": "D", "d": "D",
  "E": "E", "e": "E", "É": "E", "é": "E",
  "F": "F", "f": "F",
  "G": "G", "g": "G",
  "H": "H", "h": "H",
  "I": "I", "i": "I", "Í": "I", "í": "I",
  "J": "J", "j": "J",
  "K": "K", "k": "K",
  "L": "L", "l": "L",
  "M": "M", "m": "M",
  "N": "N", "n": "N",
  "Ñ": " ", "ñ": " ",
  "O": "O", "o": "O", "Ó": "O", "ó": "O",
  "P": "P", "p": "P",
  "Q": "Q", "q": "Q",
  "R": "R", "r": "R",
  "S": "S", "s": "S",
  "T": "T", "t": "T",
  "U": "U", "u": "U", "Ú": "U", "ú": "U",
  "V": "V", "v": "V",
  "W": "W", "w": "W",
  "X": "X", "x": "X",
  "Y": "Y", "y": "Y",
  "Z": "Z", "z": "Z",
  "0": "0", "1": "1", "2": "2", "3": "3", "4": "4",
  "5": "5", "6": "6", "7": "7", "8": "8", "9": "9", 
  ".": ".","@": "@"
};

function normalizarTexto(texto) {
	var lista = String(texto).split('')
	var listaSalida = [];
	for (i=0; i &lt; lista.length; i++) {
		listaSalida.push(mapaCaracteres[lista[i]]);
	}
	return listaSalida.join('')
}


function RequestLog(TIPO_CONSULTA, CBU, METODO, BODY, ERROR) {
    var msg = null;
    switch (String(TIPO_CONSULTA)) {
        case 'C':
            msg = 'Se consulta el estado para operar con eCheques del';
            break;
        case 'A':
            msg = 'Se solicita autorizacion para operar con eCheques para el';
            break;
        case 'B':
            msg = 'Se solicita revocar la autorizacion para operar con eCheques del';
            break;
        case 'X':
            msg = '(PROCESO DIARIO) Se solicita autorizacion para operar con eCheques para el';
            break;
    }

    writeToLog('b', '\n############################################################################\n'
        + (ERROR != null ? '>>>>> ERROR: ' + ERROR + ' &lt;&lt;&lt;&lt;&lt;\n\n' : '')
        + '*** ' + msg + ' CBU = [' + CBU + '] ***'
        + '\n*** HTTP Method = [' + METODO + '] ***'
        + '\n********INICIO REQUEST\n' + JSON.stringify(BODY, null, 2) + '\n********FIN REQUEST'
        + '\n#');
}</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>-1</jsScript_type>
        <jsScript_name>utils</jsScript_name>
        <jsScript_script>var JSON = {};
 
if (!String.hasOwnProperty("repeat")) {
  String.prototype.repeat = function (n) {
    var s = "";
    var a = this;
    for (;;) {
      if (n &amp; 1) s += a;
      n >>= 1;
      if (n) {
        a += a;
      } else break;
    }
    return s;
  };
}
 
if (!Array.hasOwnProperty("reduce")) {
    Array.prototype.reduce = function (callback, initialValue) {
    if (this == null) {
      throw new TypeError(
        "Array.prototype.myReduce called on null or undefined"
      );
    }
 
    if (typeof callback !== "function") {
      throw new TypeError(callback + " is not a function");
    }
 
    var length = this.length;
    var index = 0;
    var accumulator;
 
    if (arguments.length >= 2) {
      accumulator = initialValue;
    } else {
      if (length === 0) {
        throw new TypeError("Reduce of empty array with no initial value");
      }
      accumulator = this[0];
      index = 1;
    }
 
    for (; index &lt; length; index++) {
      if (index in this) {
        accumulator = callback(accumulator, this[index], index, this);
      }
    }
 
    return accumulator;
  };
}
 
(function () {
  JSON.parse = function (json) {
    var pattern = /[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/;
    var replacedJson = json.replace(/\"(\\.|[^"\\])*\"/g, "");
    return !pattern.test(replacedJson) &amp;&amp; eval("(" + json + ")");
  };
 
  var javaTypes = {
    "java.lang.String": "string",
    "java.math.BigDecimal": "number",
    "java.lang.Long": "number",
    "java.lang.Double": "number",
    "java.lang.Boolean": "boolean",
    "java.util.Date": "date",
    "java.sql.Timestamp": "date",
    "java.net.Inet4Address": "string",
  };
 
  var escapeCharacters = function (str) {
    str = String(str);
    var newStr = "";
    for (var i = 0; i &lt; str.length; i++) {
      var character = str[i];
      switch (character) {
        case "\\":
        case '"':
        case "/":
          newStr += "\\" + character;
          break;
        case "\b":
          newStr += "\\b";
          break;
        case "\f":
          newStr += "\\f";
          break;
        case "\n":
          newStr += "\\n";
          break;
        case "\r":
          newStr += "\\r";
          break;
        case "\t":
          newStr += "\\t";
          break;
        default:
          // /[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/;
          if (!/[\u0020-\u007e]/.test(character)) {
            newStr += "\\u" + lpad(character.charCodeAt(0).toString(16), "0", 4);
          } else {
            newStr += character;
          }
          break;
      }
    }
    return newStr;
  };
 
  var getValue = function (type, value, replacer, space, indentation) {
    switch (type) {
      case "number":
        return isNaN(value) ? null : value;
      case "boolean":
      case "null":
        return value;
      case "array":
        return arrayStringify(value, replacer, space, indentation);
      case "javaArray":
        return arrayStringify(
          javaArrayShallowCopy(value),
          replacer,
          space,
          indentation
        );
      case "list":
        return arrayStringify(
          javaListShallowCopy(value),
          replacer,
          space,
          indentation
        );
      case "object":
        return stringify(value, replacer, space, indentation + 1);
      case "date":
        return (
          '"' + date2str(value, "yyyy-MM-dd'T'HH:mm:ss.SSSZ", "es", "AGT") + '"'
        );
      default:
        return '"' + escapeCharacters(value) + '"';
    }
  };
 
  var getIndentation = function (space, indentation) {
    if (getType(space) === "number" &amp;&amp; space > 0) {
      return "\n" + " ".repeat(space * indentation);
    } else if (getType(space) === "string") {
      return "\n" + String(space).repeat(indentation);
    }
    return "";
  };
 
  var arrayStringify = function (array, replacer, space, indentation) {
    return (
      "[" +
      array
        .reduce(function (acc, e) {
          return (
            acc +
            stringify(e, replacer, space, indentation + 1) +
            "," +
            getIndentation(space, indentation)
          );
        }, getIndentation(space, indentation))
        .slice(0, -1 - getIndentation(space, indentation).length) +
      getIndentation(space, indentation - 1) +
      "]"
    );
  };
 
  var getType = function (obj) {
    if (obj === null || obj === undefined) return "null";
 
    switch (Object.prototype.toString.call(obj)) {
      case "[object Array]":
        return "array";
      case "[object Date]":
        return "date";
      case "[object Boolean]":
        return "boolean";
      case "[object Number]":
        return "number";
      case "[object String]":
        return "string";
      case "[object Object]":
        return "object";
      case "[object JavaArray]":
        return "javaArray";
      case "[object JavaObject]":
        if (
          java.lang.Class.forName("java.util.List").isAssignableFrom(
            obj.getClass()
          )
        )
          return "list";
        return javaTypes[obj.getClass().getName()];
      default:
        return "undefined";
    }
  };
 
  var javaListShallowCopy = function (list) {
    var arr = [];
    for (var i = 0; i &lt; list.size(); i++) {
      arr.push(list.get(i));
    }
    return arr;
  };
 
  var javaArrayShallowCopy = function (arr) {
    var jsArr = [];
    for (var i = 0; i &lt; arr.length; i++) {
      jsArr.push(arr[i]);
    }
    return jsArr;
  };
 
  var stringify = function (object, replacer, space, indentation) {
    var type = getType(object);
 
    if (type != "object")
      return getValue(type, object, replacer, space, indentation);
 
    var accumulator = getIndentation(space, indentation);
 
    for (var key in object) {
      var value = object[key];
 
      if (typeof value !== "function" &amp;&amp; value !== undefined) {
        // Si hay valor
        if (typeof replacer == "array" &amp;&amp; !replacer.contains(key)) {
          continue;
        } else if (typeof replacer === "function") {
          // Si es una funcion, hay que usarla para retornar valores
          value = replacer(key, value);
        }
        accumulator +=
          '"' +
          key +
          '":' +
          (space ? " " : "") +
          getValue(type, value, replacer, space, indentation) +
          "," +
          getIndentation(space, indentation);
      }
    }
 
    return (
      "{" +
      accumulator.slice(0, -1 - getIndentation(space, indentation).length) +
      getIndentation(space, indentation - 1) +
      "}"
    );
  };
 
  JSON.stringify = function (object, replacer, space) {
    return stringify(object, replacer, space, 1);
  };
})();</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>TOKEN</name>
        <rename>COELSAEC_TOKEN</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>URL</name>
        <rename>COELSAEC_URL</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>BODY</name>
        <rename>COELSAEC_BODY</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>METODO</name>
        <rename>COELSAEC_METODO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>busqueda</name>
        <rename>busqueda</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>ERROR</name>
        <rename>ERROR</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1136</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Fila Dummy</name>
    <type>DataGrid</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>DUMMY</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <data>
      <line>
        <item>DUMMY</item>
      </line>
    </data>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>656</xloc>
      <yloc>144</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Filter rows</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to>unifico flujos</send_true_to>
    <send_false_to>OBTENGO JTS_OID CON CBU</send_false_to>
    <compare>
      <condition>
        <negated>N</negated>
        <leftvalue>marcadorX</leftvalue>
        <function>IS NULL</function>
        <rightvalue/>
      </condition>
    </compare>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2096</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Get Token</name>
    <type>TransExecutor</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <specification_method>filename</specification_method>
    <trans_object_id/>
    <trans_name/>
    <filename>${Top.Repository}GENERICO_GET_TOKENS.ktr</filename>
    <directory_path/>
    <group_size>1</group_size>
    <group_field/>
    <group_time/>
    <parameters>
      <inherit_all_vars>Y</inherit_all_vars>
    </parameters>
    <execution_result_target_step/>
    <execution_time_field>ExecutionTime</execution_time_field>
    <execution_result_field>ExecutionResult</execution_result_field>
    <execution_errors_field>ExecutionNrErrors</execution_errors_field>
    <execution_lines_read_field>ExecutionLinesRead</execution_lines_read_field>
    <execution_lines_written_field>ExecutionLinesWritten</execution_lines_written_field>
    <execution_lines_input_field>ExecutionLinesInput</execution_lines_input_field>
    <execution_lines_output_field>ExecutionLinesOutput</execution_lines_output_field>
    <execution_lines_rejected_field>ExecutionLinesRejected</execution_lines_rejected_field>
    <execution_lines_updated_field>ExecutionLinesUpdated</execution_lines_updated_field>
    <execution_lines_deleted_field>ExecutionLinesDeleted</execution_lines_deleted_field>
    <execution_files_retrieved_field>ExecutionFilesRetrieved</execution_files_retrieved_field>
    <execution_exit_status_field>ExecutionExitStatus</execution_exit_status_field>
    <execution_log_text_field>ExecutionLogText</execution_log_text_field>
    <execution_log_channelid_field>ExecutionLogChannelId</execution_log_channelid_field>
    <result_rows_target_step>Parsea Token</result_rows_target_step>
    <result_rows_field>
      <name>key</name>
      <type>String</type>
      <length>-1</length>
      <precision>-1</precision>
    </result_rows_field>
    <result_rows_field>
      <name>value</name>
      <type>String</type>
      <length>-1</length>
      <precision>-1</precision>
    </result_rows_field>
    <result_files_target_step/>
    <result_files_file_name_field>FileName</result_files_file_name_field>
    <executors_output_step/>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>656</xloc>
      <yloc>224</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>INPUT</name>
    <type>MappingInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>TIPO_CONSULTA</name>
        <type>String</type>
        <length>1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>CBU</name>
        <type>String</type>
        <length>22</length>
        <precision>-1</precision>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>80</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>KEY URL y Token</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>COELSAEC_keyURL</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>externos.echeq.consulta</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>COELSAEC_keyTOKEN</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>TOKEN_MULE</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>384</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Maneja Respuesta</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//////
var marcadorX = null;

if (TIPO_CONSULTA == 'X' &amp;&amp; !busqueda) {
    var body = jsonParse(String(COELSAEC_BODY)) || {};
    CBU_body = body.emisor.cbu;
}
var CBU_actual = TIPO_CONSULTA == 'X' ? CBU_body : CBU;

if (COELSAEC_codRespuesta != 999) writeInfoLog(CBU_actual, TIPO_CONSULTA, COELSAEC_respuesta);

if (COELSAEC_codRespuesta == 999 &amp;&amp; TIPO_CONSULTA == 'X') {
	MENSAJE = ERROR;
    CODIGO = 999;
} else if (COELSAEC_codRespuesta == 999 &amp;&amp; TIPO_CONSULTA == 'A') {
	MENSAJE = ERROR;
    CODIGO = 999;
} else if (COELSAEC_codRespuesta != 200) {
    MENSAJE = 'ERROR EN LA CONSULTA A COELSA';
    CODIGO = COELSAEC_codRespuesta;
} else if (COELSAEC_codRespuesta == 200) {

    var response = jsonParse(String(COELSAEC_respuesta)) || {};


    if (response) {
        if (TIPO_CONSULTA == 'A' || TIPO_CONSULTA == 'X') {
            MENSAJE = response.respuesta.descripcion;
            CODIGO_COELSA = response.respuesta.codigo;
            CODIGO = COELSAEC_codRespuesta;
        } else if (TIPO_CONSULTA == 'B') {
            MENSAJE = response.respuesta.descripcion;
            CODIGO_COELSA = response.respuesta.codigo;
            CODIGO = COELSAEC_codRespuesta;
        } else if (TIPO_CONSULTA == 'C') {
            procesarConsultaC();
        }
    }
}

if (COELSAEC_codRespuesta != 999 &amp;&amp; TIPO_CONSULTA == 'X' &amp;&amp; !(CODIGO_COELSA == '1100' || CODIGO_COELSA == '1000')) {
    marcadorX = 1;
}

function manejarErroresConsultaC(totalCuentas) {
    var mensajes = {
        0: 'La cuenta no esta dada de alta en COELSA.',
        2: 'La consulta devolvio mas de una cuenta, leer log.',
    };

    MENSAJE = mensajes[totalCuentas];
    CODIGO = COELSAEC_codRespuesta;
    CODIGO_COELSA = 11;
}

function procesarConsultaC() {
    var totalCuentas = response.totalCuentas || 0;

    if (totalCuentas == 1 &amp;&amp; response.cuentas &amp;&amp; response.cuentas.length > 0) {
        var cuenta = response.cuentas[0];
        EMISOR_CBU = cuenta.emisor_cbu;
        BANCO_CODIGO = cuenta.banco_codigo;
        EMISOR_CUENTA = cuenta.emisor_cuenta;
        EMISOR_SUBCUENTA = cuenta.emisor_subcuenta;
        EMISOR_MONEDA = cuenta.emisor_moneda;
        EMISOR_CUENTA_FECHA_ALTA = cuenta.emisor_cuenta_fecha_alta;
        SUCURSAL_CODIGO = cuenta.sucursal_codigo;
        SUCURSAL_NOMBRE = cuenta.sucursal_nombre;
        SUCURSAL_DOMICILIO = cuenta.sucursal_domicilio;
        SUCURSAL_CP = cuenta.sucursal_cp;
        SUCURSAL_PROVINCIA = cuenta.sucursal_provincia;
        EMISOR_CUIT = cuenta.emisor_cuit;
        EMISOR_RAZON_SOCIAL = cuenta.emisor_razon_social;
        EMISOR_DOMICILIO = cuenta.emisor_domicilio;
        EMISOR_CP = cuenta.emisor_cp;
        CUENTA_ESTADO = cuenta.cuenta_estado;
        FECHA_ALTA = cuenta.fecha_alta;
        FECHA_ULT_MODIFICACION = cuenta.fecha_ult_modificacion;
        CUENTA_FIRMANTES = cuenta.cuenta_firmantes;

        MENSAJE = 'El estado de la cuenta es: ' + cuenta.cuenta_estado;
        CODIGO = COELSAEC_codRespuesta;
        CODIGO_COELSA = 22;
    } else {
        manejarErroresConsultaC(totalCuentas);
    }
}</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>//Script here
var CBU_body = null;

const jsonParse = function(json) {
   var pattern = /[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/ 
    var replacedJson = json.replace(/\"(\\.|[^"\\])*\"/g, '')
   return !( pattern.test( replacedJson ) ) &amp;&amp; eval('(' + json + ')');
}

var CODIGO_COELSA = null
var MENSAJE = null;
var CODIGO = null;
var EMISOR_CBU = null;
var BANCO_CODIGO = null;
var EMISOR_CUENTA = null;
var EMISOR_SUBCUENTA = null;
var EMISOR_MONEDA = null;
var EMISOR_CUENTA_FECHA_ALTA = null;
var SUCURSAL_CODIGO = null;
var SUCURSAL_NOMBRE = null;
var SUCURSAL_DOMICILIO = null;
var SUCURSAL_CP = null;
var SUCURSAL_PROVINCIA = null;
var EMISOR_CUIT = null;
var EMISOR_RAZON_SOCIAL = null;
var EMISOR_DOMICILIO = null;
var EMISOR_CP = null;
var CUENTA_ESTADO = null;
var FECHA_ALTA = null;
var FECHA_ULT_MODIFICACION = null;
var CUENTA_FIRMANTES = null;

function writeInfoLog(CBU_actual, TIPO_CONSULTA, COELSAEC_respuesta) {
	writeToLog('b', '\n#######################################################################\n'
	+ '*** Se consulta el CBU = [' + CBU_actual + '] ***\n'
	+ '*** Tipo consulta: ['+TIPO_CONSULTA+'] ***\n'
    + '\n********INICIO RESPUESTA\n' + COELSAEC_respuesta + '\n********FIN RESPUESTA'
	+ '#\n'
	);
}

</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>CODIGO</name>
        <rename>COELSAEC_CODIGO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>MENSAJE</name>
        <rename>COELSAEC_MENSAJE</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>CODIGO_COELSA</name>
        <rename>COELSAEC_CODIGO_COELSA</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>EMISOR_CBU</name>
        <rename>COELSAEC_EMISOR_CBU</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>BANCO_CODIGO</name>
        <rename>COELSAEC_BANCO_CODIGO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>EMISOR_CUENTA</name>
        <rename>COELSAEC_EMISOR_CUENTA</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>EMISOR_SUBCUENTA</name>
        <rename>COELSAEC_EMISOR_SUBCUENTA</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>EMISOR_MONEDA</name>
        <rename>COELSAEC_EMISOR_MONEDA</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>EMISOR_CUENTA_FECHA_ALTA</name>
        <rename>COELSAEC_EMISOR_CUENTA_FECHA_ALTA</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>SUCURSAL_CODIGO</name>
        <rename>COELSAEC_SUCURSAL_CODIGO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>SUCURSAL_NOMBRE</name>
        <rename>COELSAEC_SUCURSAL_NOMBRE</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>SUCURSAL_DOMICILIO</name>
        <rename>COELSAEC_SUCURSAL_DOMICILIO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>SUCURSAL_CP</name>
        <rename>COELSAEC_SUCURSAL_CP</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>SUCURSAL_PROVINCIA</name>
        <rename>COELSAEC_SUCURSAL_PROVINCIA</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>EMISOR_CUIT</name>
        <rename>COELSAEC_EMISOR_CUIT</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>EMISOR_RAZON_SOCIAL</name>
        <rename>COELSAEC_EMISOR_RAZON_SOCIAL</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>EMISOR_DOMICILIO</name>
        <rename>COELSAEC_EMISOR_DOMICILIO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>EMISOR_CP</name>
        <rename>COELSAEC_EMISOR_CP</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>CUENTA_ESTADO</name>
        <rename>COELSAEC_CUENTA_ESTADO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>FECHA_ALTA</name>
        <rename>COELSAEC_FECHA_ALTA</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>FECHA_ULT_MODIFICACION</name>
        <rename>COELSAEC_FECHA_ULT_MODIFICACION</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>CUENTA_FIRMANTES</name>
        <rename>COELSAEC_CUENTA_FIRMANTES</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>CBU_actual</name>
        <rename>CBU</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>marcadorX</name>
        <rename>marcadorX</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1824</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>NO EXISTE EL CBU EN TOPAZ</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>COELSAEC_respuesta</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>COELSAEC_codRespuesta</name>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>999</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1536</xloc>
      <yloc>528</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>OBTENGO JTS_OID CON CBU</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <cache>N</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema>dbo</schema>
      <table>"VTA_SALDOS" (NOLOCK)</table>
      <orderby/>
      <fail_on_multiple>Y</fail_on_multiple>
      <eat_row_on_failure>Y</eat_row_on_failure>
      <key>
        <name>CBU</name>
        <field>CTA_CBU</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>JTS_OID_SALDO</name>
        <rename>JTS_OID_SALDO</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2096</xloc>
      <yloc>496</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>OUTPUT</name>
    <type>MappingOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2640</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Obtiene Token</name>
    <type>StreamLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <from>Parsea Token</from>
    <input_sorted>N</input_sorted>
    <preserve_memory>Y</preserve_memory>
    <sorted_list>Y</sorted_list>
    <integer_pair>N</integer_pair>
    <lookup>
      <key>
        <name>COELSAEC_keyTOKEN</name>
        <field>key</field>
      </key>
      <value>
        <name>value</name>
        <rename>COELSAEC_TOKEN</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>656</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Obtiene url</name>
    <type>StreamLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <from>Parsea URL</from>
    <input_sorted>N</input_sorted>
    <preserve_memory>Y</preserve_memory>
    <sorted_list>Y</sorted_list>
    <integer_pair>N</integer_pair>
    <lookup>
      <key>
        <name>COELSAEC_keyURL</name>
        <field>Key</field>
      </key>
      <value>
        <name>Value</name>
        <rename>COELSAEC_URL_CONSULTA</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>512</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Parsea Token</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>key</name>
      </field>
      <field>
        <name>value</name>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>key</name>
        <rename>key</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>value</name>
        <rename>value</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>656</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Parsea URL</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>Key</name>
      </field>
      <field>
        <name>Value</name>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>Key</name>
        <rename>Key</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>Value</name>
        <rename>Value</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>512</xloc>
      <yloc>304</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>URLs Property Input</name>
    <type>PropertyInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <file_type>property</file_type>
    <encoding>UTF-8</encoding>
    <include>N</include>
    <include_field/>
    <filename_Field/>
    <rownum>N</rownum>
    <isaddresult>Y</isaddresult>
    <filefield>N</filefield>
    <rownum_field/>
    <resetrownumber>N</resetrownumber>
    <resolvevaluevariable>N</resolvevaluevariable>
    <ini_section>N</ini_section>
    <ini_section_field/>
    <section/>
    <file>
      <name>${Top.Param}WS_URLs.properties</name>
      <exclude_filemask/>
      <filemask/>
      <file_required>Y</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>Key</name>
        <column>key</column>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>-1</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Value</name>
        <column>value</column>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>-1</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>512</xloc>
      <yloc>224</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>actualizo campo permite echeqs</name>
    <type>Update</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <skip_lookup>N</skip_lookup>
    <commit>0</commit>
    <use_batch>N</use_batch>
    <error_ignored>N</error_ignored>
    <ignore_flag_field/>
    <lookup>
      <schema>dbo</schema>
      <table>SALDOS</table>
      <key>
        <name>JTS_OID_SALDO</name>
        <field>JTS_OID</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>PERMITE_ECHEQ</name>
        <rename>no permito echeqs</rename>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2096</xloc>
      <yloc>688</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>consulta coelsa</name>
    <type>Rest</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <applicationType>JSON</applicationType>
    <method>POST</method>
    <url/>
    <urlInField>Y</urlInField>
    <dynamicMethod>Y</dynamicMethod>
    <methodFieldName>COELSAEC_METODO</methodFieldName>
    <urlField>COELSAEC_URL</urlField>
    <bodyField>COELSAEC_BODY</bodyField>
    <httpLogin/>
    <httpPassword>Encrypted </httpPassword>
    <proxyHost/>
    <proxyPort/>
    <preemptive>N</preemptive>
    <trustStoreFile/>
    <trustStorePassword>Encrypted </trustStorePassword>
    <headers>
      <header>
        <field>COELSAEC_TOKEN</field>
        <name>Authorization</name>
      </header>
    </headers>
    <parameters>
      </parameters>
    <matrixParameters>
      </matrixParameters>
    <result>
      <name>COELSAEC_respuesta</name>
      <code>COELSAEC_codRespuesta</code>
      <response_time/>
      <response_header/>
    </result>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1536</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>existe cbu?</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to>consulta coelsa</send_true_to>
    <send_false_to>NO EXISTE EL CBU EN TOPAZ</send_false_to>
    <compare>
      <condition>
        <negated>N</negated>
        <leftvalue>busqueda</leftvalue>
        <function>IS NULL</function>
        <rightvalue/>
      </condition>
    </compare>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1408</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>limpio campos</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>COELSAEC_URL_CONSULTA</name>
      </remove>
      <remove>
        <name>COELSAEC_keyTOKEN</name>
      </remove>
      <remove>
        <name>COELSAEC_keyURL</name>
      </remove>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1296</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>limpio campos 2</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>COELSAEC_METODO</name>
      </remove>
      <remove>
        <name>COELSAEC_TOKEN</name>
      </remove>
      <remove>
        <name>COELSAEC_URL</name>
      </remove>
      <remove>
        <name>emisor_cbu</name>
      </remove>
      <remove>
        <name>emisor_codigoPostal</name>
      </remove>
      <remove>
        <name>emisor_cuenta</name>
      </remove>
      <remove>
        <name>emisor_cuentaFechaAlta</name>
      </remove>
      <remove>
        <name>emisor_cuit</name>
      </remove>
      <remove>
        <name>emisor_domicilio</name>
      </remove>
      <remove>
        <name>emisor_emails</name>
      </remove>
      <remove>
        <name>emisor_moneda</name>
      </remove>
      <remove>
        <name>emisor_razonSocial</name>
      </remove>
      <remove>
        <name>emisor_subcuenta</name>
      </remove>
      <remove>
        <name>sucursal_codigo</name>
      </remove>
      <remove>
        <name>sucursal_codigoPostal</name>
      </remove>
      <remove>
        <name>sucursal_domicilio</name>
      </remove>
      <remove>
        <name>sucursal_nombre</name>
      </remove>
      <remove>
        <name>sucursal_provincia</name>
      </remove>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1664</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>limpio campos 3</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>COELSAEC_codRespuesta</name>
      </remove>
      <remove>
        <name>COELSAEC_respuesta</name>
      </remove>
      <remove>
        <name>COELSAEC_BODY</name>
      </remove>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1968</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>no permito echeqs</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>no permito echeqs</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif>N</nullif>
        <length>1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2096</xloc>
      <yloc>592</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>remuevo campos</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>no permito echeqs</name>
      </remove>
      <remove>
        <name>JTS_OID_SALDO</name>
      </remove>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2320</xloc>
      <yloc>688</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>remuevo campos 2</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>marcadorX</name>
      </remove>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2480</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>ultima fila</name>
    <type>DetectLastRow</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <resultfieldname>ULTIMA</resultfieldname>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1136</xloc>
      <yloc>240</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>unifico flujos</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>2320</xloc>
      <yloc>384</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
