<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>GENERICO_CREDITO_INTERBANCO</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>1</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>100</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2024/07/31 10:35:09.750</created_date>
    <modified_user>-</modified_user>
    <modified_date>2024/07/31 10:35:09.750</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
    <notepad>
      <note>CAMPOS DE ENTRADA:

NRO_TARJETA_ORIGEN: BigNumber (Numero de Tarjeta Requerido para Credito por Red Link)
CBU_ORIGEN: String
CBU_DESTINO: String
IMPORTE: BigNumber (0.00)
MONEDA_IMPORTE: String (Codigo SWIFT)
MOTIVO: String (3 Caracteres)
REFERENCIA: String</note>
      <xloc>48</xloc>
      <yloc>32</yloc>
      <width>499</width>
      <heigth>153</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>CAMPOS DE SALIDA

GECREINTER_RESPONSE_ERROR = String (Codigo de Resultado, "OK" significa que hubo exito, sino error)
GECREINTER_RESULTADO_DESCRIPCION = String (Descripcion de Resultado, Solo relevante en caso de error)
GECREINTER_ID_REQUERIMIENTO = String (Identificacion de Transferencia de Red Link, NULL en caso de error)</note>
      <xloc>608</xloc>
      <yloc>32</yloc>
      <width>588</width>
      <heigth>89</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>En caso de errores:

-	El ID_REQUERIMIENTO estara NULL ya que no se pudo realizar el movimiento por Red Link

-	El RESPONSE_ERROR estara en distinto de "OK"

- 	Logueadores seteados en 'Minimal'.</note>
      <xloc>1248</xloc>
      <yloc>32</yloc>
      <width>530</width>
      <heigth>119</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
    <notepad>
      <note>Campos Reservados

- GECREINTER_Authorization
- GECREINTER_ERROR
- GECREINTER_TOKEN
- GECREINTER_TOKEN_MULE_KEY
- GECREINTER_URL
- GECREINTER_URL_KEY
- GECREINTER_accept
- GECREINTER_content-type
- GECREINTER_requestBody
- GECREINTER_response
- GECREINTER_responseTime
- GECREINTER_statusCode
- GECREINTER_HANDLING_ERROR
- GECREINTER_RESPONSE_ERROR
- GECREINTER_RESULTADO_DESCRIPCION
- GECREINTER_ID_REQUERIMIENTO</note>
      <xloc>848</xloc>
      <yloc>160</yloc>
      <width>230</width>
      <heigth>297</heigth>
      <fontname>Segoe UI</fontname>
      <fontsize>9</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>0</fontcolorred>
      <fontcolorgreen>0</fontcolorgreen>
      <fontcolorblue>0</fontcolorblue>
      <backgroundcolorred>255</backgroundcolorred>
      <backgroundcolorgreen>205</backgroundcolorgreen>
      <backgroundcolorblue>112</backgroundcolorblue>
      <bordercolorred>100</bordercolorred>
      <bordercolorgreen>100</bordercolorgreen>
      <bordercolorblue>100</bordercolorblue>
      <drawshadow>Y</drawshadow>
    </notepad>
  </notepads>
  <order>
    <hop>
      <from>Fila Dummy</from>
      <to>Get Token</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Valores Duros</from>
      <to>Obtiene url</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Obtiene url</from>
      <to>Obtiene TOKEN</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>URLs Property Input</from>
      <to>Parse URL</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Token</from>
      <to>Parse Token</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Parse URL</from>
      <to>Obtiene url</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Parse Token</from>
      <to>Obtiene TOKEN</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Obtiene TOKEN</from>
      <to>Valida Datos</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Valida Datos</from>
      <to>Filtra Errores</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filtra Errores</from>
      <to>Error set de datos</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Construye cuerpo</from>
      <to>Ejecuta API Credito Interbanco</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Ejecuta API Credito Interbanco</from>
      <to>Log Response</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Log Response</from>
      <to>Maneja respuesta</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Ejecuta API Credito Interbanco</from>
      <to>Error inesperado</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Error inesperado</from>
      <to>Elimina Handling</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Error set de datos</from>
      <to>Log Error</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Elimina Campos de Proceso</from>
      <to>Out</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Input</from>
      <to>Campos Reservados</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Campos Reservados</from>
      <to>Valores Duros</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filtra Errores</from>
      <to>Construye cuerpo</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Maneja respuesta</from>
      <to>Elimina Campos de Proceso</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Elimina Handling</from>
      <to>Log Response</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Log Error</from>
      <to>Maneja respuesta</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Campos Reservados</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>var camposReservados = [
  'GECREINTER_Authorization',
  'GECREINTER_ERROR',
  'GECREINTER_TOKEN',
  'GECREINTER_TOKEN_MULE_KEY',
  'GECREINTER_URL',
  'GECREINTER_URL_KEY',
  'GECREINTER_accept',
  'GECREINTER_content-type',
  'GECREINTER_requestBody',
  'GECREINTER_response',
  'GECREINTER_responseTime',
  'GECREINTER_statusCode',
  'GECREINTER_HANDLING_ERROR',
  'GECREINTER_RESPONSE_ERROR',
  'GECREINTER_RESULTADO_DESCRIPCION',
  'GECREINTER_ID_REQUERIMIENTO'
]

// No tocar

var camposReservadosEncontrados = [];

Array.prototype.contains = function( value ) {
  return ( this.indexOf( value ) !== -1 )
}

const valueMetaList = rowMeta.getValueMetaList();

for ( var valueMetaIndex = 0; valueMetaIndex &lt; valueMetaList.size(); valueMetaIndex++ ) {
  var valueMeta = valueMetaList.get(valueMetaIndex);
  var valueMetaName = valueMeta.getName()
  if ( camposReservados.contains( String(valueMetaName) ) ) {
	camposReservadosEncontrados.push( String(valueMetaName) );
  }
}

if ( camposReservadosEncontrados.length !== 0 ) {
	writeToLog('e', '*** ERROR INICIALIZANDO TRANSFORMACIÓN GENÉRICA ***');
	writeToLog('e', '*** Se recibieron los campos reservados [' + camposReservadosEncontrados.join(', ') + '] ***');
	_step_.setErrors( 1 );
}

</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>224</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Construye cuerpo</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here
var Authorization = 'Bearer ' + GECREINTER_TOKEN;


var requestBody = {
	"nroTarjeta": getCampo('NRO_TARJETA_ORIGEN'),
	"cbuOrigen": CBU_ORIGEN,
	"cbuDestino": CBU_DESTINO,
	"importe": getCampo('IMPORTE'),
	"moneda": MONEDA_IMPORTE,
	"motivo": MOTIVO,
	"referencia": REFERENCIA
}

requestBody = JSON.stringify(requestBody);

</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>

// Función para obtener objeto bignumber de java
const getCampo = function(campo) {
  return row[ getInputRowMeta().indexOfValue( String(campo) ) ];
}


var JSON = {};

if (!String.hasOwnProperty("repeat")) {
  String.prototype.repeat = function (n) {
    var s = "";
    var a = this;
    for (;;) {
      if (n &amp; 1) s += a;
      n >>= 1;
      if (n) {
        a += a;
      } else break;
    }
    return s;
  };
}

(function () {
  JSON.parse = function (json) {
    var pattern = /[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/;
    var replacedJson = json.replace(/\"(\\.|[^"\\])*\"/g, "");
    return !pattern.test(replacedJson) &amp;&amp; eval("(" + json + ")");
  };

  var javaTypes = {
    "java.lang.String": "string",
    "java.math.BigDecimal": "number",
    "java.lang.Long": "number",
    "java.lang.Double": "number",
    "java.lang.Boolean": "boolean",
    "java.util.Date": "date",
    "java.sql.Timestamp": "date",
    "java.net.Inet4Address": "string",
  };

  var getValue = function (type, value, replacer, space, indentation) {
    switch (type) {
      case "number":
      case "boolean":
      case "null":
        return value;
      case "array":
        return arrayStringify(value, replacer, space, indentation);
      case "javaArray":
        return arrayStringify(
          javaArrayShallowCopy(value),
          replacer,
          space,
          indentation
        );
      case "list":
        return arrayStringify(
          javaListShallowCopy(value),
          replacer,
          space,
          indentation
        );
      case "object":
        return stringify(value, replacer, space, indentation + 1);
      case "date":
        return (
          '"' + date2str(value, "yyyy-MM-dd'T'HH:mm:ss.SSSZ", "es", "AGT") + '"'
        );
      default:
        return '"' + value + '"';
    }
  };

  var getIndentation = function (space, indentation) {
    if (getType(space) === "number" &amp;&amp; space > 0) {
      return "\n" + " ".repeat(space * indentation);
    } else if (getType(space) === "string") {
      return "\n" + String(space).repeat(indentation);
    }
    return "";
  };

  var arrayStringify = function (array, replacer, space, indentation) {
    return (
      "[" +
      array
        .reduce(function (acc, e) {
          return (
            acc +
            stringify(e, replacer, space, indentation + 1) +
            "," +
            getIndentation(space, indentation)
          );
        }, getIndentation(space, indentation))
        .slice(0, -1 - getIndentation(space, indentation).length) +
      getIndentation(space, indentation - 1) +
      "]"
    );
  };

  var getType = function (obj) {
    if (obj === null || obj === undefined) return "null";

    switch (Object.prototype.toString.call(obj)) {
      case "[object Array]":
        return "array";
      case "[object Date]":
        return "date";
      case "[object Boolean]":
        return "boolean";
      case "[object Number]":
        return "number";
      case "[object String]":
        return "string";
      case "[object Object]":
        return "object";
      case "[object JavaArray]":
        return "javaArray";
      case "[object JavaObject]":
        if (
          java.lang.Class.forName("java.util.List").isAssignableFrom(
            obj.getClass()
          )
        )
          return "list";
        return javaTypes[obj.getClass().getName()];
      default:
        return "undefined";
    }
  };

  var javaListShallowCopy = function (list) {
    var arr = [];
    for (var i = 0; i &lt; list.size(); i++) {
      arr.push(list.get(i));
    }
    return arr;
  };

  var javaArrayShallowCopy = function (arr) {
    var jsArr = [];
    for (var i = 0; i &lt; arr.length; i++) {
      jsArr.push(arr[i]);
    }
    return jsArr;
  };

  var stringify = function (object, replacer, space, indentation) {
    var type = getType(object);

    if (type != "object")
      return getValue(type, object, replacer, space, indentation);

    var accumulator = getIndentation(space, indentation);

    for (var key in object) {
      var value = object[key];

      if (typeof value !== "function" &amp;&amp; value !== undefined) {
        // Si hay valor
        if (typeof replacer == "array" &amp;&amp; !replacer.contains(key)) {
          continue;
        } else if (typeof replacer === "function") {
          // Si es una funcion, hay que usarla para retornar valores
          value = replacer(key, value);
        }
        accumulator +=
          '"' +
          key +
          '":' +
          (space ? " " : "") +
          getValue(type, value, replacer, space, indentation) +
          "," +
          getIndentation(space, indentation);
      }
    }

    return (
      "{" +
      accumulator.slice(0, -1 - getIndentation(space, indentation).length) +
      getIndentation(space, indentation - 1) +
      "}"
    );
  };

  JSON.stringify = function (object, replacer, space) {
    return stringify(object, replacer, space, 1);
  };
})();
</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>Authorization</name>
        <rename>GECREINTER_Authorization</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>requestBody</name>
        <rename>GECREINTER_requestBody</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1072</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Ejecuta API Credito Interbanco</name>
    <type>Rest</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <applicationType>JSON</applicationType>
    <method>POST</method>
    <url/>
    <urlInField>Y</urlInField>
    <dynamicMethod>N</dynamicMethod>
    <methodFieldName/>
    <urlField>GECREINTER_URL</urlField>
    <bodyField>GECREINTER_requestBody</bodyField>
    <httpLogin/>
    <httpPassword>Encrypted </httpPassword>
    <proxyHost/>
    <proxyPort/>
    <preemptive>N</preemptive>
    <trustStoreFile/>
    <trustStorePassword>Encrypted </trustStorePassword>
    <headers>
      <header>
        <field>GECREINTER_Authorization</field>
        <name>Authorization</name>
      </header>
      <header>
        <field>GECREINTER_content-type</field>
        <name>content-type</name>
      </header>
      <header>
        <field>GECREINTER_accept</field>
        <name>accept</name>
      </header>
    </headers>
    <parameters>
      </parameters>
    <matrixParameters>
      </matrixParameters>
    <result>
      <name>GECREINTER_response</name>
      <code>GECREINTER_statusCode</code>
      <response_time>GECREINTER_responseTime</response_time>
      <response_header/>
    </result>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1248</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Elimina Campos de Proceso</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>GECREINTER_Authorization</name>
      </remove>
      <remove>
        <name>GECREINTER_ERROR</name>
      </remove>
      <remove>
        <name>GECREINTER_TOKEN</name>
      </remove>
      <remove>
        <name>GECREINTER_TOKEN_MULE_KEY</name>
      </remove>
      <remove>
        <name>GECREINTER_URL</name>
      </remove>
      <remove>
        <name>GECREINTER_URL_KEY</name>
      </remove>
      <remove>
        <name>GECREINTER_accept</name>
      </remove>
      <remove>
        <name>GECREINTER_content-type</name>
      </remove>
      <remove>
        <name>GECREINTER_requestBody</name>
      </remove>
      <remove>
        <name>GECREINTER_response</name>
      </remove>
      <remove>
        <name>GECREINTER_responseTime</name>
      </remove>
      <remove>
        <name>GECREINTER_statusCode</name>
      </remove>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1808</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Elimina Handling</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <remove>
        <name>GECREINTER_HANDLING_ERROR</name>
      </remove>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1440</xloc>
      <yloc>800</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Error inesperado</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var response = 'Descripción del handling error: ' + GECREINTER_HANDLING_ERROR;
var statusCode = null;
var responseTime = null;

</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>response</name>
        <rename>GECREINTER_response</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>statusCode</name>
        <rename>GECREINTER_statusCode</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>responseTime</name>
        <rename>GECREINTER_responseTime</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1248</xloc>
      <yloc>800</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Error set de datos</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var Authorization = null;
var requestBody = null;
var response = GECREINTER_ERROR;
var statusCode = null;
var responseTime = null;

</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>Authorization</name>
        <rename>GECREINTER_Authorization</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>requestBody</name>
        <rename>GECREINTER_requestBody</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>response</name>
        <rename>GECREINTER_response</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>statusCode</name>
        <rename>GECREINTER_statusCode</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>responseTime</name>
        <rename>GECREINTER_responseTime</rename>
        <type>Integer</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>928</xloc>
      <yloc>896</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Fila Dummy</name>
    <type>DataGrid</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>DUMMY</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <data>
      <line>
        <item>DUMMY</item>
      </line>
    </data>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>608</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Filtra Errores</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to>Construye cuerpo</send_true_to>
    <send_false_to>Error set de datos</send_false_to>
    <compare>
      <condition>
        <negated>N</negated>
        <leftvalue>GECREINTER_ERROR</leftvalue>
        <function>IS NULL</function>
        <rightvalue/>
      </condition>
    </compare>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>928</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Get Token</name>
    <type>TransExecutor</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <specification_method>filename</specification_method>
    <trans_object_id/>
    <trans_name/>
    <filename>${Top.Repository}GENERICO_GET_TOKENS.ktr</filename>
    <directory_path/>
    <group_size>1</group_size>
    <group_field/>
    <group_time/>
    <parameters>
      <inherit_all_vars>Y</inherit_all_vars>
    </parameters>
    <execution_result_target_step/>
    <execution_time_field>ExecutionTime</execution_time_field>
    <execution_result_field>ExecutionResult</execution_result_field>
    <execution_errors_field>ExecutionNrErrors</execution_errors_field>
    <execution_lines_read_field>ExecutionLinesRead</execution_lines_read_field>
    <execution_lines_written_field>ExecutionLinesWritten</execution_lines_written_field>
    <execution_lines_input_field>ExecutionLinesInput</execution_lines_input_field>
    <execution_lines_output_field>ExecutionLinesOutput</execution_lines_output_field>
    <execution_lines_rejected_field>ExecutionLinesRejected</execution_lines_rejected_field>
    <execution_lines_updated_field>ExecutionLinesUpdated</execution_lines_updated_field>
    <execution_lines_deleted_field>ExecutionLinesDeleted</execution_lines_deleted_field>
    <execution_files_retrieved_field>ExecutionFilesRetrieved</execution_files_retrieved_field>
    <execution_exit_status_field>ExecutionExitStatus</execution_exit_status_field>
    <execution_log_text_field>ExecutionLogText</execution_log_text_field>
    <execution_log_channelid_field>ExecutionLogChannelId</execution_log_channelid_field>
    <result_rows_target_step>Parse Token</result_rows_target_step>
    <result_rows_field>
      <name>key</name>
      <type>String</type>
      <length>-1</length>
      <precision>-1</precision>
    </result_rows_field>
    <result_rows_field>
      <name>value</name>
      <type>String</type>
      <length>-1</length>
      <precision>-1</precision>
    </result_rows_field>
    <result_files_target_step/>
    <result_files_file_name_field>FileName</result_files_file_name_field>
    <executors_output_step/>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>608</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Input</name>
    <type>MappingInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>NRO_TARJETA_ORIGEN</name>
        <type>BigNumber</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>CBU_ORIGEN</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>CBU_DESTINO</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>IMPORTE</name>
        <type>BigNumber</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>MONEDA_IMPORTE</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>MOTIVO</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>REFERENCIA</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>112</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Log Error</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <loglevel>log_level_minimal</loglevel>
    <displayHeader>Y</displayHeader>
    <limitRows>N</limitRows>
    <limitRowsNumber>0</limitRowsNumber>
    <logmessage>
***CREDITO INTERBANCO SERVICIO***
***Log Error Dato***
</logmessage>
    <fields>
      <field>
        <name>NRO_TARJETA_ORIGEN</name>
      </field>
      <field>
        <name>CBU_ORIGEN</name>
      </field>
      <field>
        <name>CBU_DESTINO</name>
      </field>
      <field>
        <name>IMPORTE</name>
      </field>
      <field>
        <name>MONEDA_IMPORTE</name>
      </field>
      <field>
        <name>MOTIVO</name>
      </field>
      <field>
        <name>REFERENCIA</name>
      </field>
      <field>
        <name>GECREINTER_URL_KEY</name>
      </field>
      <field>
        <name>GECREINTER_content-type</name>
      </field>
      <field>
        <name>GECREINTER_accept</name>
      </field>
      <field>
        <name>GECREINTER_TOKEN_MULE_KEY</name>
      </field>
      <field>
        <name>GECREINTER_URL</name>
      </field>
      <field>
        <name>GECREINTER_ERROR</name>
      </field>
      <field>
        <name>GECREINTER_requestBody</name>
      </field>
      <field>
        <name>GECREINTER_response</name>
      </field>
      <field>
        <name>GECREINTER_statusCode</name>
      </field>
      <field>
        <name>GECREINTER_responseTime</name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1632</xloc>
      <yloc>896</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Log Response</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <loglevel>log_level_minimal</loglevel>
    <displayHeader>Y</displayHeader>
    <limitRows>N</limitRows>
    <limitRowsNumber>0</limitRowsNumber>
    <logmessage>
***CREDITO INTERBANCO SERVICIO***
***Respuesta de WS***
</logmessage>
    <fields>
      <field>
        <name>NRO_TARJETA_ORIGEN</name>
      </field>
      <field>
        <name>CBU_ORIGEN</name>
      </field>
      <field>
        <name>CBU_DESTINO</name>
      </field>
      <field>
        <name>IMPORTE</name>
      </field>
      <field>
        <name>MONEDA_IMPORTE</name>
      </field>
      <field>
        <name>MOTIVO</name>
      </field>
      <field>
        <name>REFERENCIA</name>
      </field>
      <field>
        <name>GECREINTER_URL_KEY</name>
      </field>
      <field>
        <name>GECREINTER_content-type</name>
      </field>
      <field>
        <name>GECREINTER_accept</name>
      </field>
      <field>
        <name>GECREINTER_TOKEN_MULE_KEY</name>
      </field>
      <field>
        <name>GECREINTER_URL</name>
      </field>
      <field>
        <name>GECREINTER_ERROR</name>
      </field>
      <field>
        <name>GECREINTER_requestBody</name>
      </field>
      <field>
        <name>GECREINTER_response</name>
      </field>
      <field>
        <name>GECREINTER_statusCode</name>
      </field>
      <field>
        <name>GECREINTER_responseTime</name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1440</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Maneja respuesta</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Declaración de variables
var RESPONSE_ERROR = null;
var RESULTADO_DESCRIPCION = null;
var ID_REQUERIMIENTO = null;


// Obtener respuesta
var responseObject = jsonParse( String(GECREINTER_response) );

// Existe error? Ej. Token 
if (GECREINTER_statusCode!=200) {
	RESPONSE_ERROR = ' Error al ejecutar el servicio de transferencia interbanco. ';
	if (GECREINTER_statusCode == null)
	{
		RESULTADO_DESCRIPCION = GECREINTER_response;
	}
	else
	{
		try
		{
			if (responseObject.detail.descripcion != null)
			{
				RESULTADO_DESCRIPCION = responseObject.detail.descripcion;
			}
			else if (responseObject.detail != null)
			{
				RESULTADO_DESCRIPCION = responseObject.detail;
			}
			else
			{
				RESULTADO_DESCRIPCION = ' Error desconocido en el servicio de transferencia interbanco. '
			}
		}
		catch(e)
		{
			RESULTADO_DESCRIPCION = GECREINTER_response;
		}
	}
} else {
	RESPONSE_ERROR = 'OK';
	RESULTADO_DESCRIPCION = ' Transferencia Realizada con Exito. ';
	ID_REQUERIMIENTO = responseObject.idRequerimiento;
}
</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>
const jsonParse = function(json) {
	var pattern = /[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/	
	var replacedJson = json.replace(/\"(\\.|[^"\\])*\"/g, '')
	return !( pattern.test( replacedJson ) ) &amp;&amp; eval('(' + json + ')');
}

const getBigDecimal = function (num) {
	return new java.math.BigDecimal( num.toFixed(2) );	
}</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>RESPONSE_ERROR</name>
        <rename>GECREINTER_RESPONSE_ERROR</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>RESULTADO_DESCRIPCION</name>
        <rename>GECREINTER_RESULTADO_DESCRIPCION</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>ID_REQUERIMIENTO</name>
        <rename>GECREINTER_ID_REQUERIMIENTO</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1632</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Obtiene TOKEN</name>
    <type>StreamLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <from>Parse Token</from>
    <input_sorted>N</input_sorted>
    <preserve_memory>Y</preserve_memory>
    <sorted_list>Y</sorted_list>
    <integer_pair>N</integer_pair>
    <lookup>
      <key>
        <name>GECREINTER_TOKEN_MULE_KEY</name>
        <field>key</field>
      </key>
      <value>
        <name>value</name>
        <rename>GECREINTER_TOKEN</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>608</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Obtiene url</name>
    <type>StreamLookup</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <from>Parse URL</from>
    <input_sorted>N</input_sorted>
    <preserve_memory>Y</preserve_memory>
    <sorted_list>Y</sorted_list>
    <integer_pair>N</integer_pair>
    <lookup>
      <key>
        <name>GECREINTER_URL_KEY</name>
        <field>Key</field>
      </key>
      <value>
        <name>Value</name>
        <rename>GECREINTER_URL</rename>
        <default/>
        <type>String</type>
      </value>
    </lookup>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>464</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Out</name>
    <type>MappingOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1968</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Parse Token</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>key</name>
      </field>
      <field>
        <name>value</name>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>key</name>
        <rename>key</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>value</name>
        <rename>value</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>608</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Parse URL</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>Key</name>
      </field>
      <field>
        <name>Value</name>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>Key</name>
        <rename>Key</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>Value</name>
        <rename>Value</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>464</xloc>
      <yloc>544</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>URLs Property Input</name>
    <type>PropertyInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <file_type>property</file_type>
    <encoding>UTF-8</encoding>
    <include>N</include>
    <include_field/>
    <filename_Field/>
    <rownum>N</rownum>
    <isaddresult>Y</isaddresult>
    <filefield>N</filefield>
    <rownum_field/>
    <resetrownumber>N</resetrownumber>
    <resolvevaluevariable>N</resolvevaluevariable>
    <ini_section>N</ini_section>
    <ini_section_field/>
    <section/>
    <file>
      <name>${Top.Param}WS_URLs.properties</name>
      <exclude_filemask/>
      <filemask/>
      <file_required>Y</file_required>
      <include_subfolders>N</include_subfolders>
    </file>
    <fields>
      <field>
        <name>Key</name>
        <column>key</column>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>-1</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>Value</name>
        <column>value</column>
        <type>String</type>
        <format/>
        <length>-1</length>
        <precision>-1</precision>
        <currency/>
        <decimal/>
        <group/>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
    <sizeFieldName/>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>464</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Valida Datos</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var ERROR = '';

//Validaciones Campos Entrada (Tipos de Dato)

//Valida Tipos de Dato
for (prop in objCamposConTipos) {
	if ( validaTipoDato(prop, objCamposConTipos[prop]) ) {
		ERROR += prop +' Tipo incorrecto. Esperado ['+objCamposConTipos[prop]+']. ';
	}
}

//Valida Largo de Dato
for (prop in objCamposConLargos) {
	if ( validaLargo(prop, objCamposConLargos[prop]) ) {
		ERROR += prop +' Largo incorrecto. Esperado máximo ['+objCamposConLargos[prop]+']. ';
	}
}

if (ERROR == '')
{
	ERROR = null;
}

</jsScript_script>
      </jsScript>
      <jsScript>
        <jsScript_type>1</jsScript_type>
        <jsScript_name>Item_0</jsScript_name>
        <jsScript_script>// Tipos de datos de pentaho
var mapaTipos = {
	'Integer' : org.pentaho.di.core.row.ValueMetaInterface.TYPE_INTEGER,
	'String' : org.pentaho.di.core.row.ValueMetaInterface.TYPE_STRING,
	'Number' : org.pentaho.di.core.row.ValueMetaInterface.TYPE_NUMBER,
	'BigNumber' : org.pentaho.di.core.row.ValueMetaInterface.TYPE_BIGNUMBER,
	'Date' : org.pentaho.di.core.row.ValueMetaInterface.TYPE_DATE,
	'Boolean' : org.pentaho.di.core.row.ValueMetaInterface.TYPE_BOOLEAN,
	'Binary' : org.pentaho.di.core.row.ValueMetaInterface.TYPE_BINARY
}

// Objeto que contiene mis campos con los tipos de datos esperados
const objCamposConTipos = {
	'NRO_TARJETA_ORIGEN' : 'BigNumber',
	'CBU_ORIGEN' : 'String',
	'CBU_DESTINO' : 'String',
	'IMPORTE' : 'BigNumber',
	'MONEDA_IMPORTE' : 'String',
	'MOTIVO' : 'String',
	'REFERENCIA' : 'String'
}

// Objeto que contiene mis campos con el largo de dato esperado
const objCamposConLargos = {
	'NRO_TARJETA_ORIGEN' : 19,
	'CBU_ORIGEN' : 22,
	'CBU_DESTINO' : 22,
	'IMPORTE' : 12,
	'MONEDA_IMPORTE' : 3,
	'MOTIVO' : 3,
	'REFERENCIA' : 12
}

const validaTipoDato = function (nombreCampo, tipoEsperado) {
	
	// Recibe el nombre del campo en string y obtengo el tipo de dato del campo
	var tipoCampo = rowMeta.getValueMeta(rowMeta.indexOfValue(String(nombreCampo))).getType()

	// Obtener tipo de dato esperado de pentaho
	var tipo = mapaTipos[String(tipoEsperado)]

	// Devolver nulo si no hay error
	if (tipoCampo == tipo) {
		return null
	} else {
		return tipo
	}

}

// Devuelve nulo si no hay error
const validaLargo = function (field, large) {
	
	fieldValue = String( row[ getInputRowMeta().indexOfValue(String(field)) ] )

	if (fieldValue == null) {
		return 'error'
	} else if (fieldValue.length > large || fieldValue == '') {
		return 'error'
	} else {
		return null
	}
}</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>ERROR</name>
        <rename>GECREINTER_ERROR</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>768</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Valores Duros</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>GECREINTER_URL_KEY</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>externos.transferenciaBancaEmpresa.url</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>GECREINTER_content-type</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>application/json</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>GECREINTER_accept</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>application/json</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>GECREINTER_TOKEN_MULE_KEY</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>TOKEN_MULE</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>352</xloc>
      <yloc>656</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
    <error>
      <source_step>Ejecuta API Credito Interbanco</source_step>
      <target_step>Error inesperado</target_step>
      <is_enabled>Y</is_enabled>
      <nr_valuename/>
      <descriptions_valuename>GECREINTER_HANDLING_ERROR</descriptions_valuename>
      <fields_valuename/>
      <codes_valuename/>
      <max_errors/>
      <max_pct_errors/>
      <min_pct_rows/>
    </error>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
