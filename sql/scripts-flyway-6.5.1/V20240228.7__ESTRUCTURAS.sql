EXECUTE('
IF OBJECT_ID (''dbo.VW_EXCLUSIONES_PRODUCTOS'') IS NOT NULL
	DROP VIEW dbo.VW_EXCLUSIONES_PRODUCTOS
')

EXECUTE('
CREATE VIEW dbo.VW_EXCLUSIONES_PRODUCTOS AS (
SELECT 
EP.TIPO AS ''Tipo'',
O.DESCRIPCION AS ''Descripción Tipo'',
EP.ITEM AS ''Item'',  
CASE WHEN EP.TIPO=''F'' THEN F.DESCRIPCION    
     WHEN EP.TIPO=''P'' THEN P.C6251
    ELSE ''Sin Descripción'' END AS ''Descripción Item'',
O2.DESCRIPCION AS ''Graduación'',
O3.DESCRIPCION AS ''Grandes Exposiciones''
FROM CRE_EXCLUSIONES_PRODUCTOS AS EP WITH(NOLOCK)
LEFT JOIN PRODUCTOS AS P WITH(NOLOCK) ON EP.ITEM=P.C6250
LEFT JOIN CRE_FAMILIAS AS F WITH(NOLOCK) ON EP.ITEM=F.FAMILIAPROD
LEFT JOIN OPCIONES AS O WITH(NOLOCK) ON O.NUMERODECAMPO=44033 AND O.OPCIONINTERNA=EP.TIPO
LEFT JOIN OPCIONES AS O2 WITH(NOLOCK) ON O2.NUMERODECAMPO=44035 AND O2.OPCIONINTERNA=EP.GRADUACION
LEFT JOIN OPCIONES AS O3 WITH(NOLOCK) ON O3.NUMERODECAMPO=44036 AND O3.OPCIONINTERNA=EP.FRACCIONAMIENTO
WHERE EP.TZ_LOCK=0)
')