EXECUTE('
-- Paso 1
-- Actualizar TASASBASE.TASA_CONVERTIDA
UPDATE TASASBASE SET TASA_CONVERTIDA=TASA WHERE TIPOTASABASE IN 
(SELECT DISTINCT T.TIPOTASAINT FROM TASAS T WITH(nolock) INNER JOIN PRODUCTOS P WITH(nolock) ON P.C6250=T.PRODUCTO WHERE P.C6252=5 AND P.TZ_LOCK=0)
AND TZ_LOCK=0;
')

EXECUTE('
-- Paso 2
-- Actualizar TASASBASE.TASA (TEA)
UPDATE TASASBASE SET TASA=round((CAST((POWER((1 + CAST((TASA)AS NUMERIC(11,7)) / (365*100)*30.41666), ((CAST(365 AS NUMERIC(11,7)) / 30.4166))) - 1) * 100 AS NUMERIC(11,7))),4,1)
WHERE TIPOTASABASE IN 
(SELECT DISTINCT T.TIPOTASAINT FROM TASAS T WITH(nolock) INNER JOIN PRODUCTOS P WITH(nolock) ON P.C6250=T.PRODUCTO WHERE P.C6252=5 AND P.TZ_LOCK=0)
AND TZ_LOCK=0;
')

EXECUTE('
--Paso 3
-- Actualizar TASASBASE_CODIGOS 
UPDATE TASASBASE_CODIGOS SET DESTINO=5 WHERE TIPOTASABASE IN (''BBP'',''BBT'',''BPP'',''C'',''N'',''TPJ'')
UPDATE TASASBASE_CODIGOS SET DESTINO=1 WHERE TIPOTASABASE = ''BAN''
UPDATE TASASBASE_CODIGOS SET DESTINO=6 WHERE TIPOTASABASE = ''ND''
UPDATE TASASBASE_CODIGOS SET DESTINO=4 WHERE TIPOTASABASE IN (''N4'',''PE'',''PN'')
')