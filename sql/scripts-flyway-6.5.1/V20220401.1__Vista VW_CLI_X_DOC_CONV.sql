EXECUTE('
----
IF OBJECT_ID (''dbo.VW_CLI_X_DOC_CONV'') IS NOT NULL
	DROP VIEW dbo.VW_CLI_X_DOC_CONV
----
')

EXECUTE('
----
CREATE VIEW [dbo].[VW_CLI_X_DOC_CONV] (
									   TIPODOC, 
									   NUMERODOC,
									   PAISDOCUMENTO,
									   [CODIGOCLIENTE], 
									   NOMBRECLIENTE,
									   NUMEROPERSONA,
									   TIPOPERSONA,
									   ESTADO,
									   NIVELAPERTURA,
									   CODIGOACTAFIP)
AS 
SELECT 
	V.TIPODOCUMENTO AS TIPODOC, 
	V.NUMERODOCUMENTO AS NUMERODOC, 
	v.PAISDOCUMENTO,
	R.[CODIGOCLIENTE],
	R.NOMBRECLIENTE,
	V.NUMEROPERSONAFJ AS NUMEROPERSONA,
	''Física'' AS TIPOPERSONA,
	OE.DESCRIPCION AS ESTADO,
	OA.DESCRIPCION AS NIVELAPERTURA,
	A.CODIGO_ACTIVIDAD AS CODIGOACTAFIP
FROM 
    dbo.CLI_CLIENTES  AS R with (nolock) 
INNER JOIN dbo.CLI_CLIENTEPERSONA AS T WITH (nolock) ON 
	R.[CODIGOCLIENTE] = T.[CODIGOCLIENTE]
	AND t.TITULARIDAD=''T''
	AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
	AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_PERSONASFISICAS AS U WITH (nolock) ON 
	U.NUMEROPERSONAFISICA = T.NUMEROPERSONA
	AND (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
	AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ AS V WITH (nolock) ON 
	U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
	AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
	AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_ACTIVIDAD_ECONOMICA AS A WITH (nolock) ON 
	U.NUMEROPERSONAFISICA = A.CODIGO_PERSONA_CLIENTE 
	AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
	AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
LEFT JOIN OPCIONES AS OE WITH (nolock) ON
	OE.NUMERODECAMPO = 1038
	AND OE.OPCIONINTERNA = R.ESTADO
	AND OE.IDIOMA = ''E''
LEFT JOIN OPCIONES AS OA WITH (nolock) ON
	OA.NUMERODECAMPO = 2216
	AND OA.OPCIONINTERNA = R.NIVEL_APERTURA
	AND OA.IDIOMA = ''E''
WHERE (	
	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
	AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) 

UNION ALL

SELECT 
	V.TIPODOCUMENTO AS TIPODOC, 
	V.NUMERODOCUMENTO AS NUMERODOC, 
	v.PAISDOCUMENTO,
	R.[CODIGOCLIENTE],
	R.NOMBRECLIENTE,
	V.NUMEROPERSONAFJ AS NUMEROPERSONA,
	''Jurídica'' AS TIPOPERSONA,
	OE.DESCRIPCION AS ESTADO,
	OA.DESCRIPCION AS NIVELAPERTURA,
	A.CODIGO_ACTIVIDAD AS CODIGOACTAFIP
FROM 
    dbo.CLI_CLIENTES AS R WITH (nolock) 
INNER JOIN dbo.CLI_CLIENTEPERSONA AS T WITH (nolock) ON 
	R.[CODIGOCLIENTE] = T.[CODIGOCLIENTE]
	AND t.TITULARIDAD=''T''
	AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
	AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_PERSONASJURIDICAS AS S WITH (nolock) ON 
	S.NUMEROPERSONAJURIDICA = T.NUMEROPERSONA 
	AND (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
	AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ AS V WITH (nolock) ON 
	S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
	AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
	AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_ACTIVIDAD_ECONOMICA AS A WITH (nolock) ON 
	S.NUMEROPERSONAJURIDICA = A.CODIGO_PERSONA_CLIENTE 
	AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
	AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))	 															
LEFT JOIN OPCIONES AS OE WITH (nolock) ON
	OE.NUMERODECAMPO = 1038
	AND OE.OPCIONINTERNA = R.ESTADO
	AND OE.IDIOMA = ''E''
LEFT JOIN OPCIONES AS OA WITH (nolock) ON
	OA.NUMERODECAMPO = 2216
	AND OA.OPCIONINTERNA = R.NIVEL_APERTURA
	AND OA.IDIOMA = ''E''
WHERE (	
	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
	AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000))
----
')
