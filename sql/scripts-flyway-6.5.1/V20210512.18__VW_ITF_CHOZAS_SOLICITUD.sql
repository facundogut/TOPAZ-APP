
EXECUTE('DROP VIEW IF EXISTS VW_ITF_CHOZAS_SOLICITUD')

EXECUTE('CREATE VIEW VW_ITF_CHOZAS_SOLICITUD AS

SELECT ''311'' AS NROBANCO,

(CASE WHEN CH.TIPOCHEQUES = ''D'' THEN ''02'' ELSE ''00'' end) AS TIPOFORMULARIO,

RIGHT(''000''+CAST(SUCURSAL AS VARCHAR(3)),3) AS NRO_SUCURSAL,

RIGHT(''00000000000''+CAST(CUENTA AS VARCHAR(11)),11) AS NRO_CUENTA,

RIGHT(''000''+CAST(CANTIDAD AS VARCHAR(3)),3) AS CANTIDAD_LIBRETAS,

RIGHT(''00000''+CAST(''''as VARCHAR(5)),5) AS TIPO_LIBRETA,

LEFT((SELECT P.APE_NOMBRE WHERE TITULARIDAD = ''T'' AND P.[CODIGOCLIENTE]=CH.CLIENTE)+''                                        '',40) AS TITULAR_FIRMANTE_1,
LEFT(P.TIPODOC+''    '',4) AS TIPO_DOCUMENTO_TIT_1,
RIGHT(''           ''+CAST(P.NUMERODOC AS VARCHAR(11)),11) AS NRO_DOCUMENTO_TIT_1,

LEFT(''                                        '',40) AS TITULAR_FIRMANTE_2,
LEFT(''    '',4) AS TIPO_DOCUMENTO_TIT_2,
RIGHT(''           '',11) AS NRO_DOCUMENTO_TIT_2,

LEFT( ''                                        '',40) AS TITULAR_FIRMANTE_3,
LEFT(''    '',4) AS TIPO_DOCUMENTO_TIT_3,
RIGHT(''           '',11 )AS NRO_DOCUMENTO_TIT_3,

dbo.NCADENAS(rtrim(ltrim(concat(CH.CALLE, '' '',CH.NROPUERTA,'' '',ll.DESCRIPCION_DIM3,'' '',D.PROVINCIA))),60,'' '',''P'') AS DOMICILIO,

LEFT((SELECT MAX (FORMAT(C1621,''MMyy'')) FROM SALDOS S WHERE S.CUENTA = CH.CUENTA AND TZ_LOCK = 0),4)  AS FECHA_APERTURA,
CONCAT(dbo.NCADENAS(CAST(CH.NROSOLICITUD_SUCURSAL_CUENTA AS VARCHAR(10)),10,''0'',''P''),dbo.NCADENAS(CAST(CH.NROSOLICITUD AS VARCHAR(10)),10,''0'',''P'')) AS NRO_PEDIDO,
''A'' AS LETRA,
LEFT(''0000000000'',10) AS NROCHEQUERA,
concat(''${Top.Output}Imprenta Chozas/NBCH'',CONVERT(CHAR(8),(SELECT FECHAPROCESO FROM PARAMETROS),112)) AS NOM_ARCHIVO 


FROM (CHE_CHEQUESIMPRENTA CH INNER JOIN VW_CLIENTES_PERSONAS P ON (CH.CLIENTE = P.[CODIGOCLIENTE]) AND  CH.ESTADO = ''M'' and P.TITULARIDAD = ''T'' AND CH.TZ_LOCK = 0)
LEFT JOIN CLI_DIRECCIONES D ON D.ID=P.[CODIGOCLIENTE] AND (D.FORMATO IN (''PF'',''PJ'') AND D.TIPODIRECCION = ''PR'' AND D.TZ_LOCK = 0 ) 
LEFT JOIN CLI_LOCALIDADES ll ON (ll.DIM1 = D.PROVINCIA AND ll.DIM2=D.DEPARTAMENTO AND ll.DIM3 = D.LOCALIDAD AND ll.TZ_LOCK = 0)')



