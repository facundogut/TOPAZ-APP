EXECUTE('
IF OBJECT_ID (''dbo.VW_SOS_ACT_ECO'') IS NOT NULL
	DROP VIEW dbo.VW_SOS_ACT_ECO
')

EXECUTE('
CREATE       VIEW [dbo].[VW_SOS_ACT_ECO] 
AS    
	SELECT
		c.CODIGO_ACTIVIDAD AS COD_ACTIVIDAD,
		a.DESCRIPCION,
		c.INICIO_ACTIVIDAD AS PERIODO_ACTIVIDAD,
		(CASE 
			WHEN c.ORDEN_AFIP=1 THEN ''Primaria''
			WHEN ((	SELECT COUNT(1) 
					FROM CLI_ACTIVIDAD_ECONOMICA a WITH(NOLOCK)
					WHERE a.CODIGO_PERSONA_CLIENTE= c.CODIGO_PERSONA_CLIENTE 
						AND a.ORDEN_AFIP = 99 
						AND (	(a.TZ_LOCK < 300000000000000 OR a.TZ_LOCK >= 400000000000000) 
							AND (a.TZ_LOCK < 100000000000000 OR a.TZ_LOCK >= 200000000000000))
					) = (	SELECT COUNT(1) 
							FROM CLI_ACTIVIDAD_ECONOMICA a WITH (NOLOCK)
							WHERE a.CODIGO_PERSONA_CLIENTE= c.CODIGO_PERSONA_CLIENTE 
								AND (	(a.TZ_LOCK < 300000000000000 OR a.TZ_LOCK >= 400000000000000) 
									AND (a.TZ_LOCK < 100000000000000 OR a.TZ_LOCK >= 200000000000000))) 
									AND (	SELECT MIN(a.ORDINAL_ACTIVIDAD) 
											FROM CLI_ACTIVIDAD_ECONOMICA a WITH (NOLOCK) 
											WHERE a.CODIGO_PERSONA_CLIENTE = c.CODIGO_PERSONA_CLIENTE 
												AND (	(a.TZ_LOCK < 300000000000000 OR a.TZ_LOCK >= 400000000000000) 
													AND (a.TZ_LOCK < 100000000000000 OR a.TZ_LOCK >= 200000000000000))
										) =  c.ORDINAL_ACTIVIDAD ) THEN ''Primaria''
		ELSE ''Secundaria''
		END) AS TIPO_ACTIVIDAD,
		c.VERIFICADO_AFIP AS VERIFICADO_AFIP,
		c.FECHA_VERIFICADO,
		c.CODIGO_PERSONA_CLIENTE AS CODIGO_PERSONA,
		c.ORDINAL_ACTIVIDAD AS ORDINAL,
		c.ORDEN_AFIP,
		a.CODIGO_ACT_AFIP,
		a.CODIGO_BCRA
	FROM CLI_ACTIVIDAD_ECONOMICA c WITH(NOLOCK)
	INNER JOIN CLI_Cod_Act_AFIP a  WITH(NOLOCK)ON c.CODIGO_ACTIVIDAD=a.CODIGO_ACT_AFIP 
												AND (	(c.TZ_LOCK < 300000000000000 OR c.TZ_LOCK >= 400000000000000) 
													AND (c.TZ_LOCK < 100000000000000 OR c.TZ_LOCK >= 200000000000000))

')