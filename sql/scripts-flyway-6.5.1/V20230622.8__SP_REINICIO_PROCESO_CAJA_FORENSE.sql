EXECUTE('
CREATE OR ALTER PROCEDURE SP_REINICIO_PROCESO_CAJA_FORENSE
	--PARÁMETROS DE INPUT POR DEFECTO
	@P_ASIENTO float(10),
	@P_OPERACION VARCHAR(4),
	@P_USUARIO VARCHAR(10),
	@P_HORA VARCHAR(8),
	@P_FECHA_VENCIMIENTO DATE,

	--PARÁMETROS DE OUTPUT PARA ESTADO Y MENSAJE
	@P_RET_PROCESO float(53)  OUTPUT,
	@P_MSG_PROCESO varchar(max)  OUTPUT

AS

BEGIN

	--CONSTANTE PARA SP MENSAJE DE ERROR.
	DECLARE
		@v_constante VARCHAR(1)

	BEGIN TRANSACTION

	BEGIN TRY
		-- MODIFICAMOS A ''R'' TODOS LOS REGISTROS CON ESTADO ''A''
		UPDATE
			DJ_HISTORICO_INACTIVAS
		SET
			ESTADO_CTA = ''R''
		WHERE
			ESTADO_CTA = ''A''
			AND TZ_LOCK = 0

		COMMIT TRANSACTION;
		
		--RETORNO MENSAJE Y ESTADO 1 SI TODO ES CORRECTO
		SET @P_RET_PROCESO = 1
		SET @P_MSG_PROCESO = ''El proceso se reinició correctamente.''
	END TRY
		
	BEGIN CATCH
		ROLLBACK TRANSACTION
		SET @P_RET_PROCESO = ERROR_NUMBER()
		SET @P_MSG_PROCESO = ERROR_MESSAGE()
		EXECUTE dbo.pkg_constantes$VarcharConstantes ''C_LOG_TIPO_ERROR'', @v_constante OUTPUT;
	END CATCH

END
')