EXECUTE('
IF OBJECT_ID (''VW_STOCK_GARANTIAS'') IS NOT NULL
	DROP VIEW VW_STOCK_GARANTIAS
')

EXECUTE('
CREATE   VIEW [dbo].[VW_STOCK_GARANTIAS] (
										[codigo_org],
										nombre_org,
										cuit_org,
										num_garantia,
										fecha_ini,
										fecha_vto,
										tipo,
										sucursal,
										familia,
										producto,
										monto_utilizado,
										nro_certificado,
										tipo_doc,
										nro_doc,
										descripcion,
										valor_actual,
										valor_garantia
										)
AS
SELECT  (SELECT -1) AS [codigo_org], 
		(SELECT '''')AS nombre_org,
		(SELECT '''') AS cuit_org,gr.NUM_GARANTIA AS num_garantia, 
		gr.FECHA_INICIO AS fecha_ini, 
		gr.FCHVTO_GARANTIA AS fecha_vto, 
		gr.TIPOGARANTIA AS tipo, 
		gr.SUCURSAL_GARANTIA AS sucursal,
		gp.Familia AS familia, 
		gp.Linea AS producto, 
		SUM(ISNULL(gp.Monto_Utilizado,0)) AS monto_utilizado, 
		(SELECT NULL) AS nro_certificado,
		gr.TIPODOCUMENTO AS tipo_doc, 
		gr.NUMERODOCUMENTO AS nro_doc, 
		t.DSC_TIPO_GARANTIA AS descripcion, 
		gr.IMPORTE_REAL AS valor_actual, 
		gr.IMPORTECONTRACTUAL AS valor_garantia
FROM CRE_GARANTIASRECIBIDAS gr WITH (NOLOCK)
LEFT JOIN VW_GARANTIASPRESTAMOS gp  WITH (NOLOCK)
								ON gr.NUM_GARANTIA = gp.Garantia
JOIN CRE_GARANTIA_BIENES gb WITH (NOLOCK)
							ON gr.NUM_GARANTIA = gb.NUM_GARANTIA 
							AND gb.TZ_LOCK = 0
JOIN BIE_MOBILIARIO m  WITH (NOLOCK)
					ON m.NUMERO_BIEN = gb.NUMERO_BIEN 
					AND gb.TIPO_BIEN = 1 
					AND m.TZ_LOCK = 0
LEFT JOIN CRE_TIPOSGARANTIAS t WITH (NOLOCK) 
							ON gr.TIPOGARANTIA = t.TIPO_GARANTIA 
							AND t.TZ_LOCK = 0
WHERE gr.TZ_LOCK = 0 AND gr.ESTADO_GARANTIA <> ''RR''
GROUP BY gr.NUM_GARANTIA, 
		gr.FECHA_INICIO, 
		gr.FCHVTO_GARANTIA, 
		gr.TIPOGARANTIA,
		gr.SUCURSAL_GARANTIA,
		gr.TIPODOCUMENTO,
		gr.NUMERODOCUMENTO,
		gr.DSC_GARANTIA, 
		gr.IMPORTE_REAL,
		gr.IMPORTECONTRACTUAL ,
		gp.Garantia, 
		gp.Linea, 
		gp.Familia, 
		t.DSC_TIPO_GARANTIA

UNION
-- BIENES INMOBILIARIOS
SELECT	(SELECT -1) AS [codigo_org], 
		(SELECT '''') AS nombre_org,
		(SELECT '''') AS cuit_org,  
		gr.NUM_GARANTIA AS num_garantia, 
		gr.FECHA_INICIO AS fecha_ini, 
		gr.FCHVTO_GARANTIA AS fecha_vto, 
		gr.TIPOGARANTIA AS tipo, 
		gr.SUCURSAL_GARANTIA AS sucursal,
		gp.Familia AS familia, 
		gp.Linea AS producto, 
		SUM(ISNULL(gp.Monto_Utilizado,0)) AS monto_utilizado, 
		(SELECT NULL) AS nro_certificado,
		gr.TIPODOCUMENTO AS tipo_doc, 
		gr.NUMERODOCUMENTO AS nro_doc, 
		t.DSC_TIPO_GARANTIA AS descripcion, 
		gr.IMPORTE_REAL AS valor_actual, 
		gr.IMPORTECONTRACTUAL AS valor_garantia
FROM CRE_GARANTIASRECIBIDAS gr WITH (NOLOCK) 
LEFT JOIN VW_GARANTIASPRESTAMOS gp WITH (NOLOCK) ON gr.NUM_GARANTIA = gp.Garantia
JOIN CRE_GARANTIA_BIENES gb WITH (NOLOCK)
						ON gr.NUM_GARANTIA = gb.NUM_GARANTIA 
						AND gb.TZ_LOCK = 0
JOIN BIE_INMOBILIARIO i WITH (NOLOCK) 
						ON i.NUMERO_BIEN = gb.NUMERO_BIEN 
						AND gb.TIPO_BIEN = 2 
						AND i.TZ_LOCK = 0
LEFT JOIN CRE_TIPOSGARANTIAS t WITH (NOLOCK) ON gr.TIPOGARANTIA = t.TIPO_GARANTIA 
										AND t.TZ_LOCK = 0
WHERE gr.TZ_LOCK = 0 AND gr.ESTADO_GARANTIA <> ''RR''
GROUP BY gr.NUM_GARANTIA, 
		gr.FECHA_INICIO, 
		gr.FCHVTO_GARANTIA, 
		gr.TIPOGARANTIA,
		gr.SUCURSAL_GARANTIA,
		gr.TIPODOCUMENTO,
		gr.NUMERODOCUMENTO,
		gr.DSC_GARANTIA, 
		gr.IMPORTE_REAL,
		gr.IMPORTECONTRACTUAL ,
		gp.Garantia, 
		gp.Linea, 
		gp.Familia, 
		t.DSC_TIPO_GARANTIA

UNION
-- BIENES OTROS
SELECT  ISNULL(org.[CODIGO],-1) AS [codigo_org], 
		ISNULL(org.NOMBRE,'''') AS nombre_org, 
		ISNULL(org.CUIT,'''') AS cuit_org,
		gr.NUM_GARANTIA AS num_garantia, 
		gr.FECHA_INICIO AS fecha_ini, 
		gr.FCHVTO_GARANTIA AS fecha_vto, 
		gr.TIPOGARANTIA AS tipo,
		gr.SUCURSAL_GARANTIA AS sucursal,
		gp.Familia AS familia, 
		gp.Linea AS producto, 
		SUM(ISNULL(gp.Monto_Utilizado,0)), 
		o.NUMERO_CERTIFICADO AS nro_certificado,
		gr.TIPODOCUMENTO AS tipo_doc, 
		gr.NUMERODOCUMENTO AS nro_doc, 
		t.DSC_TIPO_GARANTIA AS descripcion, 
		gr.IMPORTE_REAL AS valor_actual, 
		gr.IMPORTECONTRACTUAL AS valor_garantia
FROM CRE_GARANTIASRECIBIDAS gr WITH (NOLOCK) 
LEFT JOIN VW_GARANTIASPRESTAMOS gp WITH (NOLOCK) 
								ON gr.NUM_GARANTIA = gp.Garantia
JOIN CRE_GARANTIA_BIENES gb WITH (NOLOCK)
							ON gr.NUM_GARANTIA = gb.NUM_GARANTIA 
							AND gb.TZ_LOCK = 0
JOIN BIE_OTROS o WITH (NOLOCK) 
				ON o.NUMERO_BIEN = gb.NUMERO_BIEN 
				AND gb.TIPO_BIEN = 3 
				AND o.TZ_LOCK = 0
LEFT JOIN CRE_GAR_ORGANISMOS org  WITH (NOLOCK)ON

									CASE 
									-- JOINEO CUANDO [TENGO] VALOR EN UNO SOLO DE LOS CAMPOS DEL CASE Y ADEMAS SE PUEDE CASTERA A NUMERIC 4 casos (NUMERO_REGISTRO YA ES NUMERIC)
										WHEN o.NUMERO_REGISTRO IS NOT NULL AND TRY_CAST(o.EMISOR AS NUMERIC) IS NULL AND TRY_CAST(o.ACOPIADOR AS NUMERIC) IS NULL AND TRY_CAST(o.ORGANISMO_EMISOR AS NUMERIC) IS NULL AND TRY_CAST(o.AVALISTA AS NUMERIC) IS NULL THEN o.NUMERO_REGISTRO
										WHEN TRY_CAST(o.EMISOR AS NUMERIC) IS NOT NULL AND o.NUMERO_REGISTRO IS NULL AND TRY_CAST(o.ACOPIADOR AS NUMERIC) IS NULL AND TRY_CAST(o.ORGANISMO_EMISOR AS NUMERIC) IS NULL AND TRY_CAST(o.AVALISTA AS NUMERIC) IS NULL THEN CAST(o.EMISOR AS NUMERIC)
										WHEN TRY_CAST(o.ACOPIADOR AS NUMERIC) IS NOT NULL AND o.NUMERO_REGISTRO IS NULL AND TRY_CAST(o.EMISOR AS NUMERIC) IS NULL AND TRY_CAST(o.ORGANISMO_EMISOR AS NUMERIC) IS NULL AND TRY_CAST(o.AVALISTA AS NUMERIC) IS NULL THEN CAST(o.ACOPIADOR AS NUMERIC)
										WHEN TRY_CAST(o.ORGANISMO_EMISOR AS NUMERIC) IS NOT NULL AND o.NUMERO_REGISTRO IS NULL AND  TRY_CAST(o.EMISOR AS NUMERIC) IS NULL AND TRY_CAST(o.ACOPIADOR AS NUMERIC) IS NULL AND TRY_CAST(o.AVALISTA AS NUMERIC) IS NULL THEN CAST(o.ORGANISMO_EMISOR AS NUMERIC)
										WHEN TRY_CAST(o.AVALISTA AS NUMERIC) IS NOT NULL AND o.NUMERO_REGISTRO IS NULL AND TRY_CAST(o.ACOPIADOR AS NUMERIC) IS NULL AND TRY_CAST(o.ORGANISMO_EMISOR AS NUMERIC) IS NULL AND TRY_CAST(o.EMISOR AS NUMERIC) IS NULL THEN CAST(o.AVALISTA AS NUMERIC)
									ELSE -1 
									END = org.[CODIGO] 
									AND org.TZ_LOCK = 0
LEFT JOIN CRE_TIPOSGARANTIAS t  WITH (NOLOCK)ON gr.TIPOGARANTIA = t.TIPO_GARANTIA 
											AND t.TZ_LOCK = 0
WHERE gr.TZ_LOCK = 0  AND gr.ESTADO_GARANTIA <> ''RR''
--AGRUPO PARA SUMAR LOS DISTINTOS REGISTROSM EN LA VW_GARANTIASPRESTAMOS
GROUP BY gr.NUM_GARANTIA, 
		gr.FECHA_INICIO, 
		gr.FCHVTO_GARANTIA, 
		gr.TIPOGARANTIA,
		gr.SUCURSAL_GARANTIA,
		gr.TIPODOCUMENTO,
		gr.NUMERODOCUMENTO,
		gr.DSC_GARANTIA, 
		gr.IMPORTE_REAL,
		gr.IMPORTECONTRACTUAL ,
		gp.Garantia, 
		gp.Linea, 
		gp.Familia, 
		o.ORGANISMO_EMISOR, 
		o.NUMERO_CERTIFICADO,
		org.[CODIGO], 
		org.NOMBRE,
		org.CUIT, 
		t.DSC_TIPO_GARANTIA;
		
')

EXECUTE('
IF OBJECT_ID (''VW_SaldosClienteLimite'') IS NOT NULL
	DROP VIEW VW_SaldosClienteLimite
')

EXECUTE('
CREATE   VIEW [dbo].[VW_SaldosClienteLimite] 
AS 
select	s.C1803 AS cliente,
		(CASE
		WHEN (C1604+C1605) <0 THEN
			(C1604+C1605) * -1
		ELSE
			(C1604+C1605)
		END) AS IMPORTE,
			s.C1601 AS CAPITAL_ORIGINAL,
		s.c1608 AS INTERESES,
		s.moneda as MONEDA,
		s.jts_oid AS SALDO_JTS_OID,
		p.c6283 as FAMILIAPROD,
		s.PRODUCTO,
		s.c1612 as CUOTA_APROBADA,
		s.MATRICULA_LIMITE	
from saldos s WITH (NOLOCK)
INNER JOIN productos p WITH (NOLOCK)ON s.producto = p.C6250
									and p.tz_lock = 0
									and (p.EVALUA_DEUDA = ''S'') 	
INNER JOIN planctas pc WITH (NOLOCK)ON pc.C6326 = s.C1730
									and pc.tz_lock = 0
WHERE (s.tz_lock = 0 	OR (s.TZ_LOCK > 099999999999999 AND s.TZ_LOCK < 199999999999999 ))
UNION												
SELECT	s.C1803 AS CLIENTE, 
		(v.IMPORTE - v.IMPORTE_CONSUMIDO) AS IMPORTE, 
		v.IMPORTE AS  CAPITAL_ORIGINAL, 
		0 AS INTERES,
		s.MONEDA AS MONEDA,
		s.JTS_OID AS SALDO_JTS_OID, 
		p.C6283 as FAMILIAPROD, 
		v.NROLINEA AS PRODUCTO,
		0 AS CUOTA_APROBADA , 
		'' '' AS MATRICULA_LIMITE
FROM VTA_SOBREGIROS v WITH(NOLOCK)
INNER JOIN SALDOS s WITH(NOLOCK) ON v.JTS_OID_SALDO = s.JTS_OID AND s.TZ_LOCK = 0
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON v.NROLINEA = p.C6250 
									AND p.TZ_LOCK = 0
									AND  p.EVALUA_DEUDA = ''S''
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 AND m.TZ_LOCK = 0
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON v.SUCURSAL_ACUERDO = suc.SUCURSAL 
										AND suc.TZ_LOCK = 0
										AND v.ESTADO = 1 
										AND v.TZ_LOCK =0

')

EXECUTE('
IF OBJECT_ID (''VW_ASISTENCIAS'') IS NOT NULL
	DROP VIEW VW_ASISTENCIAS
')

EXECUTE('
CREATE VIEW [dbo].[VW_ASISTENCIAS] (
									SUCURSAL,    
									NOMBRESUCURSAL, 
									PRODUCTO, 
									NOMBREPRODUCTO, 
									CUENTA, 
									OPERACION,
									DESGLOSE, 
									MONEDA, 
									MONTOORIGEN,
									SALDO,
									VENCIMIENTO,
									CLIENTE,
									TIPO,
									JTS_OID,
									ORDINAL,
									PORCENTAJE_PAGO,
									TASA,
									GARANTIA_DESEMBOLSO,
									SITUACION,
									FAMILIA,
									CLASIFICACION,
									ESTADO)
AS
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		s.PRODUCTO AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		s.OPERACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		s.C1601 AS MONTOORIGEN, 
		CASE WHEN C1785 = 1 THEN s.C1604 ELSE s.C1604*-1 END AS SALDO, 
		s.C1627 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		0 AS ORDINAL,
		CASE WHEN s.C1644 > 0 AND s.C1785 = 5 THEN round(s.C1645 * 100 / s.C1644,2) ELSE NULL END AS PORCENTAJE_PAGO,
		s.C1632 AS TASA,
		ext.GARANTIA_DESEMBOLSO,
		c.CATEGORIARESULTANTE AS SITUACION,
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		CASE WHEN s.C1728 = ''Z'' THEN ''Cedido'' WHEN s.C1728 = ''C'' THEN ''Castigado'' ELSE ''Normal'' END AS ESTADO
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND p.TZ_LOCK = 0
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND f.TZ_LOCK = 0						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND m.TZ_LOCK = 0
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND suc.TZ_LOCK = 0
LEFT JOIN CRE_SALDOS ext WITH(NOLOCK) ON s.JTS_OID = ext.SALDOS_JTS_OID AND ext.TZ_LOCK = 0							
INNER JOIN CLI_CLIENTES c WITH(NOLOCK) ON s.C1803 = c.CODIGOCLIENTE AND c.TZ_LOCK = 0
WHERE (s.C1785 IN (5,6) OR (s.C1785 = 1 AND p.C6800 = ''GO'')) AND s.TZ_LOCK = 0
UNION
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		v.NROLINEA AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		v.NRO_AUTORIZACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		v.IMPORTE AS MONTOORIGEN, 
		v.IMPORTE - v.IMPORTE_CONSUMIDO AS SALDO, 
		v.FECHA_VENCIMIENTO AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		1 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		v.ORDINAL AS ORDINAL,
		NULL AS PORCENTAJE_PAGO,
		NULL AS TASA,
		NULL AS GARANTIA_DESEMBOLSO,
		NULL AS SITUACION,
		NULL AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		''Normal'' AS ESTADO
FROM VTA_SOBREGIROS v WITH(NOLOCK)
INNER JOIN SALDOS s WITH(NOLOCK) ON v.JTS_OID_SALDO = s.JTS_OID 
					AND s.TZ_LOCK = 0
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON v.NROLINEA = p.C6250 
						AND p.TZ_LOCK = 0						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
					AND m.TZ_LOCK = 0
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON v.SUCURSAL_ACUERDO = suc.SUCURSAL 
						AND suc.TZ_LOCK = 0
WHERE v.ESTADO = 1 AND v.TZ_LOCK = 0
UNION
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		s.PRODUCTO AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		s.OPERACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		s.C1832 AS MONTOORIGEN, 
		s.C1832 AS SALDO, 
		s.C1761 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		0 AS ORDINAL,
		NULL AS PORCENTAJE_PAGO,
		NULL AS TASA,
		NULL AS GARANTIA_DESEMBOLSO,
		NULL AS SITUACION,
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		''Normal'' AS ESTADO
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND p.TZ_LOCK = 0
						AND p.C6800 = ''T'' 
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND f.TZ_LOCK = 0						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND m.TZ_LOCK = 0
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND suc.TZ_LOCK = 0						
INNER JOIN CLI_CLIENTES c WITH(NOLOCK) ON s.C1803 = c.CODIGOCLIENTE AND c.TZ_LOCK = 0
WHERE s.C1785 = 1 
	AND s.TZ_LOCK = 0
')

EXECUTE('
IF OBJECT_ID (''VW_CASTIGOCARTERA'') IS NOT NULL
	DROP VIEW VW_CASTIGOCARTERA
')

EXECUTE('
CREATE   VIEW [dbo].[VW_CASTIGOCARTERA] (
TipoDocumento, 
Documento,
Nombre,
TipoPersona, 
Cliente)
AS 
SELECT DISTINCT cli.TIPODOC AS TipoDocumento, 
		cli.NUMERODOC AS Documento, 
		cli.NOMBRECLIENTE AS Nombre, 
		cli.TIPOPERSONA AS TipoPersona, 
		cli.CODIGOCLIENTE AS Cliente
FROM VW_CLI_X_DOC cli WITH(NOLOCK)
INNER JOIN HISTORICO_CALIF_X_CLIENTE h WITH(NOLOCK) ON cli.CODIGOCLIENTE = h.CLIENTE AND h.TZ_LOCK = 0
AND h.FECHA >= DATEADD(MM, -(SELECT DIASINMOVILIZADA FROM CRE_PARAMETROS WITH(NOLOCK) WHERE CODIGO = 160),(SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK))) AND h.FECHA <= (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK)) 
INNER JOIN CLI_CLASUBJETIVA c WITH(NOLOCK) ON h.CALIFICACION_RESULTANTE = c.CATEGORIASUB 
AND c.PONDERACION >= (SELECT PONDERACION FROM CLI_CLASUBJETIVA WITH(NOLOCK) WHERE CATEGORIASUB = (SELECT PARAMETRO_ALFA FROM CRE_PARAMETROS WITH(NOLOCK) WHERE CODIGO = 161)) AND c.TZ_LOCK = 0
WHERE NOT EXISTS (SELECT h1.* FROM HISTORICO_CALIF_X_CLIENTE h1
				INNER JOIN CLI_CLASUBJETIVA c1 WITH(NOLOCK) ON h1.CALIFICACION_RESULTANTE = c1.CATEGORIASUB 
				AND c1.PONDERACION < (SELECT PONDERACION FROM CLI_CLASUBJETIVA WITH(NOLOCK) WHERE CATEGORIASUB = (SELECT PARAMETRO_ALFA FROM CRE_PARAMETROS WITH(NOLOCK) WHERE CODIGO = 161)) AND c.TZ_LOCK = 0
				WHERE h1.CLIENTE = cli.CODIGOCLIENTE AND h1.TZ_LOCK = 0 AND 
				h1.FECHA >= DATEADD(MM, -(SELECT DIASINMOVILIZADA FROM CRE_PARAMETROS WITH(NOLOCK) WHERE CODIGO = 160),(SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK))) AND h1.FECHA <= (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK)))
')


EXECUTE('
IF OBJECT_ID (''VW_SUBSIDIOS_PRESTAMO_ASIGNADO'') IS NOT NULL
	DROP VIEW VW_SUBSIDIOS_PRESTAMO_ASIGNADO
')

EXECUTE('
CREATE   VIEW [dbo].[VW_SUBSIDIOS_PRESTAMO_ASIGNADO] (
															TipoDocumento, 
															NumeroDocumento, 
															Nombre, 
															Sucursal, 
															Producto, 
															Cuenta, 
															Operacion, 
															Desglose, 
															Subsidio, 
															Descripcion, 
															FechaDesde, 
															Jts_asistencia,
															Prioridad,
															Moneda)
AS
SELECT c.TIPODOC AS TipoDocumento, 
		c.NUMERODOC AS NumeroDocumento, 
		c.NOMBRECLIENTE AS Nombre, 
		p.NOMBRESUCURSAL AS Sucursal, 
		p.NOMBREPRODUCTO AS Producto, 
		p.CUENTA AS Cuenta, 
		p.OPERACION AS Operacion, 
		p.DESGLOSE AS Desglose, 
		s.CodigoSubsidio AS Subsidio, 
		sub.Descripcion, 
		s.FechaDesde, 
		s.Jts_asistencia, 
		s.Prioridad, 
		p.MONEDA AS Moneda
FROM CRE_SUBSIDIOS_PRESTAMOS s WITH(NOLOCK)
INNER JOIN CRE_SUBSIDIOS sub WITH(NOLOCK) ON s.CodigoSubsidio = sub.CodigoSubsidio AND sub.TZ_LOCK = 0
INNER JOIN VW_ASISTENCIAS p WITH(NOLOCK) ON s.Jts_asistencia = p.JTS_OID
INNER JOIN VW_CLI_X_DOC c WITH(NOLOCK) ON p.CLIENTE = c.CODIGOCLIENTE
WHERE s.Estado = ''A'' 
		AND s.TZ_LOCK = 0;
')


EXECUTE('
IF OBJECT_ID (''VW_GARANTIASCREDITOS'') IS NOT NULL
	DROP VIEW VW_GARANTIASCREDITOS
')

EXECUTE('
CREATE     VIEW [dbo].[VW_GARANTIASCREDITOS] (
												   Cliente, 
												   Garantia,
												   Credito_Usuario,
												   Desvinculado,
												   JTS_OID)
AS 
SELECT gc.COD_CLIENTE AS Cliente, 
		gc.NUM_GARANTIA AS Garantia, 
		CASE WHEN s.C1785 = 5 THEN s.OPERACION 
		ELSE s.CUENTA 
		END AS Credito_Usuario, 
		gc.DESVINCULADO AS Desvinculado, 
		s.JTS_OID 
FROM CRE_GARANTIACREDITO gc WITH (NOLOCK)
INNER JOIN SALDOS s  WITH (NOLOCK)ON gc.JTSOID_SALDO = s.JTS_OID 
									AND s.TZ_LOCK = 0
INNER JOIN CRE_GARANTIASRECIBIDAS g  WITH (NOLOCK)ON gc.NUM_GARANTIA = g.NUM_GARANTIA 
													AND gc.TZ_LOCK = 0
WHERE gc.DESVINCULADO = ''N'' 
		AND gc.TZ_LOCK = 0;
')



EXECUTE('
IF OBJECT_ID (''VW_CESIONCARTERA'') IS NOT NULL
	DROP VIEW VW_CESIONCARTERA
')

EXECUTE('
CREATE   VIEW [dbo].[VW_CESIONCARTERA] (
												Cesion, 
												Tipo, 
												Documento, 
												Nombre, 
												Recursos, 
												TipoCesion, 
												CuotaDesde, 
												CuotaHasta, 
												Estado)
AS
SELECT DISTINCT c.NUMERO_CESION AS Cesion, 
				cli.TIPODOC AS Tipo, 
				cli.NUMERODOC AS Documento, 
				cli.NOMBRECLIENTE AS Nombre, 
				cr.DESCRIPCION AS Recursos, 
				tc.DESCRIPCION AS TipoCesion, 
				c.CUOTA_DESDE AS CuotaDesde, 
				c.CUOTA_HASTA AS CuotaHasta, 
				c.ESTADO AS Estado
FROM CRE_CAB_CESIONCARTERA c WITH(NOLOCK)
INNER JOIN VW_CLI_X_DOC cli WITH(NOLOCK) ON c.CLIENTE = cli.CODIGOCLIENTE
INNER JOIN OPCIONES cr WITH(NOLOCK) ON c.CON_RECURSOS = cr.OPCIONINTERNA 
									AND cr.NUMERODECAMPO = 43820
INNER JOIN OPCIONES tc WITH(NOLOCK) ON c.TIPO_CESION = tc.OPCIONINTERNA 
									AND tc.NUMERODECAMPO = 43821
WHERE c.TZ_LOCK = 0;
')



EXECUTE('
IF OBJECT_ID (''VW_CRE_GASTOS_LEASING'') IS NOT NULL
	DROP VIEW VW_CRE_GASTOS_LEASING
')

EXECUTE('
CREATE   VIEW [dbo].[VW_CRE_GASTOS_LEASING] (
													Codigo, 
													Descripcion, 
													Categoria,
													Tipo,
													DistribuidoCanon,
													CuotaDesde, 
													CuotaHasta, 
													Importe, 
													FechaAlta, 
													NUMERO_BIEN, 
													SALDOS_JTS_OID)
AS 
SELECT DISTINCT g.CODIGO_TRAMITE AS Codigo, 
		t.DESCRIPCION AS Descripcion, 
		c.DESCRIPCION AS Categoria, 
		tt.DESCRIPCION AS Tipo, 
		dc.DESCRIPCION AS DistribuidoCanon,
		g.CUOTA_DESDE AS CuotaDesde, 
		g.CUOTA_HASTA AS CuotaHasta, 
		g.IMPORTE AS Importe, 
		g.FECHA_ALTA AS FechaAlta, 
		g.NUMERO_BIEN, 
		g.SALDOS_JTS_OID
FROM CRE_GASTOS_LEASING g WITH(NOLOCK)
INNER JOIN CRE_TIPO_TRAMITE_LEASING t WITH(NOLOCK) ON g.CODIGO_TRAMITE = t.CODIGO AND t.TZ_LOCK = 0
INNER JOIN OPCIONES c WITH(NOLOCK) ON t.CATEGORIA = c.OPCIONINTERNA AND c.NUMERODECAMPO = 43374
INNER JOIN OPCIONES tt WITH(NOLOCK) ON t.TIPO = tt.OPCIONINTERNA AND tt.NUMERODECAMPO = 43371
INNER JOIN OPCIONES dc WITH(NOLOCK) ON t.DISTRIBUIDO_CUOTAS = dc.OPCIONINTERNA AND dc.NUMERODECAMPO = 43843;
')

