EXECUTE('
IF OBJECT_ID (''dbo.VW_CLE_RECEPCION_CHEQUES_DEV'') IS NOT NULL
	DROP VIEW dbo.VW_CLE_RECEPCION_CHEQUES_DEV
')

EXECUTE('
CREATE VIEW VW_CLE_RECEPCION_CHEQUES_DEV
	(BANCO,
	SUCURSAL,
	NOMBRE_BANCO,
	NUMERO_CUENTA_GIRADORA,
	FECHA_DEVUELTO,
	SUCURSAL_INGRESO,
	NOMBRE_SUC_INGRESO,
	SERIE_CHEQUE,
	NUMERO_CHEQUE,
	CODIGO_RECHAZO,
	CAUSAL_RECHAZO,
	ESTADO,
	DESCRIPCION_ESTADO,
	TIPO_DOCUMENTO)
AS
SELECT R.BANCO_GIRADO,
	R.SUCURSAL_BANCO_GIRADO,
	B.NOMBRE,
	R.NUMERO_CUENTA_GIRADORA,
	R.FECHA_ALTA,
	L.SUCURSAL_DE_INGRESO,
	S.NOMBRESUCURSAL,
	R.SERIE_DEL_CHEQUE,
	R.NUMERO_CHEQUE,
	R.CODIGO_RECHAZO,
	C.DESCRIPCION,
	R.ESTADO_DEVOLUCION,
	CASE 
	WHEN R.ESTADO_DEVOLUCION = 1
		THEN ''A PROCESAR''
	WHEN R.ESTADO_DEVOLUCION = 2
		THEN ''PROCESADO''
	END,
	R.TIPO_DOCUMENTO
FROM CLE_RECEPCION_CHEQUES_DEV AS R WITH (nolock)
LEFT JOIN CLI_BANCOSPLAZA AS B WITH (nolock) ON 
	R.BANCO_GIRADO = B.CODIGOBC 
	AND B.SUCURSAL = 0 
	AND B.TZ_LOCK = 0
INNER JOIN CLE_CHEQUES_SALIENTE AS L WITH (nolock) ON
	L.SERIE_DEL_CHEQUE = R.SERIE_DEL_CHEQUE
	AND L.NUMERO_CHEQUE = R.NUMERO_CHEQUE
	AND L.BANCO_GIRADO = R.BANCO_GIRADO
	AND L.SUCURSAL_BANCO_GIRADO = R.SUCURSAL_BANCO_GIRADO
	AND L.NUMERICO_CUENTA_GIRADORA = R.NUMERO_CUENTA_GIRADORA
	AND L.TIPO_DOCUMENTO = R.TIPO_DOCUMENTO
	AND L.TZ_LOCK = 0
	AND L.ESTADO = 70
LEFT JOIN SUCURSALES AS S WITH (nolock) ON
	L.SUCURSAL_DE_INGRESO = S.SUCURSAL
	AND S.TZ_LOCK = 0
LEFT JOIN CLE_TIPO_CAUSAL AS C WITH (nolock) ON
	C.CODIGO_NACHA = R.CODIGO_RECHAZO
	AND C.CODIGO_DE_CAUSAL IN (SELECT TOP 1 CODIGO_DE_CAUSAL FROM CLE_TIPO_CAUSAL WITH (nolock)
		WHERE CODIGO_NACHA = C.CODIGO_NACHA AND TZ_LOCK = 0
		ORDER BY CODIGO_DE_CAUSAL)
	AND C.TZ_LOCK = 0
')

