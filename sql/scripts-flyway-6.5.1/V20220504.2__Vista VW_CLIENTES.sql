EXECUTE('
----
IF OBJECT_ID (''dbo.VW_CLIENTES'') IS NOT NULL
	DROP VIEW dbo.VW_CLIENTES
----
')
EXECUTE('
----
CREATE   VIEW [dbo].[VW_CLIENTES] (
										[Cliente], 
										[Nombre Cliente], 
										[Nivel Cliente], 
										[Tipo Cliente], 
										[Código Bloqueo], 
										[Motivo Inhabilitado],
										[Motivo Código Bloqueo], 
										--TIPOAPERTURA, 
										[Estado Cliente])
AS 
   SELECT 
      U.CODIGOCLIENTE, 
      U.NOMBRECLIENTE, 
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 2216 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.NIVEL_APERTURA) AS NIVELAPERTURA,
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 1040 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.TIPO) AS TIPOCLIENTE,
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 1022 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.CODIGOBLOQUEO) AS CODIGOBLOQUEO,
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 37306 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.MOTIVO_INHABILITADO) AS MOTIVOINHABILITADO,
      (SELECT TOP 1 CAUSABLOQUEO FROM CLI_BLOQUEOS WITH(NOLOCK) WHERE NROCLIENTE=u.CODIGOCLIENTE AND TZ_LOCK=0 ORDER BY FECHABLOQUEO DESC, HORABLOQUEO DESC) AS CAUSABLOQUEO,
      --(SELECT DESCRIPCION FROM OPCIONES WHERE NUMERODECAMPO = 1048 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.TIPOAPERTURA) AS TIPOAPERTURA,
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 1038 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.ESTADO) AS ESTADO   
   FROM dbo.CLI_CLIENTES  AS U WITH(NOLOCK)
   WHERE (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
		AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000))
----
')

