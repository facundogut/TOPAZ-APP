EXECUTE('
----
IF OBJECT_ID (''dbo.VW_CHEQUES_RECIBIDOS_SALDOS'') IS NOT NULL
	DROP VIEW dbo.VW_CHEQUES_RECIBIDOS_SALDOS
----
')
EXECUTE('
----
CREATE VIEW [VW_CHEQUES_RECIBIDOS_SALDOS](
		SUCURSAL, 
		MONEDA, 
		CUENTA,
		NOMBRE_CUENTA,
		PRODUCTO,
		NUMERO_CHEQUE,
		IMPORTE_CHEQUE,
		CODIGO_CAUSAL_DEVOLUCION,
		FECHA,
		NUMERO_SERIE,
		ESTADO_DEVOLUCION )
AS
SELECT 
	CR.SUCURSAL, 
	CR.MONEDA, 
	CR.CUENTA,
	ISNULL(VS.NOMBRE_CUENTA, ''''),
	CR.PRODUCTO,
	CR.NUMERO_CHEQUE,
	CR.IMPORTE_CHEQUE,
	CR.CODIGO_CAUSAL_DEVOLUCION,
	CR.FECHA,
	CR.NUMERO_SERIE,
	CR.ESTADO_DEVOLUCION  
FROM CLE_CHEQUES_CLEARING_RECIBIDO AS CR WITH(NOLOCK)
LEFT JOIN SALDOS AS S WITH(NOLOCK) ON 
	S.SUCURSAL = CR.SUCURSAL 
	AND S.MONEDA = CR.MONEDA
	AND S.CUENTA = CR.CUENTA
	AND S.PRODUCTO = CR.PRODUCTO
	AND S.OPERACION = CR.OPERACION
	AND S.ORDINAL = 0
	AND ((S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
		AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)
	)
LEFT JOIN VTA_SALDOS AS VS WITH(NOLOCK) ON 
	VS.JTS_OID_SALDO = S.JTS_OID
	AND ((VS.TZ_LOCK < 300000000000000 OR VS.TZ_LOCK >= 400000000000000) 
		AND (VS.TZ_LOCK < 100000000000000 OR VS.TZ_LOCK >= 200000000000000)
	)
WHERE
	((CR.TZ_LOCK < 300000000000000 OR CR.TZ_LOCK >= 400000000000000) 
		AND (CR.TZ_LOCK < 100000000000000 OR CR.TZ_LOCK >= 200000000000000)
	)
----
')
