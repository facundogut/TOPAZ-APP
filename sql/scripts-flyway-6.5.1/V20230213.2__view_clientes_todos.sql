EXECUTE ('
CREATE OR ALTER  VIEW [dbo].[VW_CLIENTES_TODOS] (
										[Cliente], 
										[Nombre Cliente], 
										[Nivel Cliente], 
										[Tipo Cliente], 
										[Código Bloqueo], 
										[Motivo Inhabilitado],
										[Motivo Código Bloqueo], 
										[Estado Cliente])
AS 
   SELECT 
      U.CODIGOCLIENTE, 
      U.NOMBRECLIENTE, 
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 2216 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.NIVEL_APERTURA) AS NIVELAPERTURA,
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 1040 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.TIPO) AS TIPOCLIENTE,
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 1022 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.CODIGOBLOQUEO) AS CODIGOBLOQUEO,
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 37306 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.MOTIVO_INHABILITADO) AS MOTIVOINHABILITADO,
      (SELECT TOP 1 CAUSABLOQUEO FROM CLI_BLOQUEOS WITH(NOLOCK) WHERE NROCLIENTE=u.CODIGOCLIENTE AND TZ_LOCK=0 ORDER BY FECHABLOQUEO DESC, HORABLOQUEO DESC) AS CAUSABLOQUEO,
      (SELECT DESCRIPCION FROM OPCIONES WITH(NOLOCK) WHERE NUMERODECAMPO = 1038 AND IDIOMA = ''E'' AND OPCIONINTERNA = U.ESTADO) AS ESTADO   
   FROM dbo.CLI_CLIENTES  AS U WITH(NOLOCK)
   WHERE U.TZ_LOCK=0

')









