EXECUTE('
IF OBJECT_ID (''dbo.VW_VINCULACIONES_JUDICIALES'') IS NOT NULL
	DROP VIEW dbo.VW_VINCULACIONES_JUDICIALES
')

EXECUTE('
CREATE VIEW [dbo].[VW_VINCULACIONES_JUDICIALES] AS (
SELECT 
CAU.ANO,
CONVERT(NUMERIC(12),CAU.EXPEDIENTE) AS EXPEDIENTE,
CAU.TIPO_CAUSA,
CAU.JUZGADO,
conv.ID_CONVENIO,
conv.NUMERODOCUMENTO,
conv.ID_DOMINIO,
ben.ID_BENEFICIARIO,
ben.JTS_OID_CUENTA
FROM DJ_CAUSAS cau WITH(NOLOCK)
INNER JOIN DJ_BENEFICIARIOS ben WITH(NOLOCK) ON ben.NRO_CAUSA = cau.NRO_CAUSA
LEFT JOIN VW_VINCULACIONES_CONVENIOS conv WITH(NOLOCK) ON conv.ID_PERSONA = ben.ID_BENEFICIARIO
AND conv.JTS_OID_CV = ben.JTS_OID_CUENTA
WHERE ((cau.tz_lock < 300000000000000 OR cau.tz_lock >= 400000000000000) AND 
(cau.tz_lock < 100000000000000 OR cau.tz_lock >= 200000000000000)) AND 
((ben.tz_lock < 300000000000000 OR ben.tz_lock >= 400000000000000) AND 
(ben.tz_lock < 100000000000000 OR ben.tz_lock >= 200000000000000)) 
AND ISNUMERIC(CAU.EXPEDIENTE) = 1 
)
')

