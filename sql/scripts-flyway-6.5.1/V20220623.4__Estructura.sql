EXECUTE('
UPDATE CRE_ENTIDADEXTERNA SET COD_ECOM= 0 WHERE ISNUMERIC(COD_ECOM) = 0

UPDATE CRE_VINCULACIONES_CONVENIOS SET ID_JURISDICCION= ''0'' WHERE ISNUMERIC(ID_JURISDICCION) = 0
')

EXECUTE('
IF OBJECT_ID (''dbo.CRE_CODIGOS_DEDUCCIONES'') IS NOT NULL
	DROP TABLE dbo.CRE_CODIGOS_DEDUCCIONES
')
EXECUTE('
CREATE TABLE dbo.CRE_CODIGOS_DEDUCCIONES
	(
	TZ_LOCK     NUMERIC (15),
	ID          NUMERIC (5) NOT NULL,
	DESCRIPCION VARCHAR (50),
	TIPO        VARCHAR (2),
	CONSTRAINT PK_CRE_CODIGOS_DEDUCCIONES PRIMARY KEY (ID)
	)
')
EXECUTE('
ALTER TABLE CRE_ENTIDADEXTERNA ALTER COLUMN COD_ECOM NUMERIC(5)
')

EXECUTE('
IF OBJECT_ID (''dbo.SDS_WS_ERRORES'') IS NOT NULL
	DROP TABLE dbo.SDS_WS_ERRORES
')
EXECUTE('

CREATE TABLE dbo.SDS_WS_ERRORES
	(
	TZ_LOCK       NUMERIC (15),
	COD_ERROR     VARCHAR (20) NOT NULL,
	DESCRIPCION   VARCHAR (100),
	MENSAJE       VARCHAR (100),
	ERR_HTTP_CODE NUMERIC (5),
	CONSTRAINT PK_SDS_WS_ERRORES PRIMARY KEY (COD_ERROR)
	)
')

EXECUTE('
CREATE NONCLUSTERED INDEX IDX_ID_PERSONA 
ON CRE_VINCULACIONES_CONVENIOS (ID_PERSONA)
')

EXECUTE('
IF OBJECT_ID (''dbo.VW_VINCULACIONES_CONVENIOS'') IS NOT NULL
	DROP VIEW dbo.VW_VINCULACIONES_CONVENIOS
')
EXECUTE('
CREATE VIEW dbo.VW_VINCULACIONES_CONVENIOS
AS 
SELECT 
vinc.ID_CONVENIO,
conv.NomConvPago AS DESC_CONVENIO, 
vinc.ID_PERSONA,
s.C1803 AS CLIENTE,
doc.NUMERODOCUMENTO,
vinc.ID_JURISDICCION AS ID_DOMINIO,
dom.DESCRIPCION AS DESC_DOMINIO,
vinc.JTS_CV AS JTS_OID_CV,
s.CUENTA,
s.SUCURSAL,
s.PRODUCTO,
s.MONEDA,
s.OPERACION,
s.ORDINAL,
vinc.ID_BLOQUEO, 
vinc.CBU
FROM CRE_VINCULACIONES_CONVENIOS vinc WITH (NOLOCK)
INNER JOIN CONV_CONVENIOS_PAG conv WITH (NOLOCK) ON conv.ID_ConvPago=vinc.ID_CONVENIO
LEFT JOIN CONV_DOMINIOS dom WITH (NOLOCK) ON dom.ID_CONVENIO=vinc.ID_CONVENIO AND dom.ID_DOMINIO=vinc.ID_JURISDICCION
INNER JOIN SALDOS s WITH (NOLOCK) ON s.JTS_OID=vinc.JTS_CV AND s.TZ_LOCK=0
INNER JOIN CLI_CLIENTES cli WITH (NOLOCK) ON cli.CODIGOCLIENTE=s.C1803
INNER JOIN CLI_DocumentosPFPJ doc WITH (NOLOCK) ON doc.NUMEROPERSONAFJ=vinc.ID_PERSONA AND doc.TZ_LOCK=0
')
EXECUTE('
IF OBJECT_ID (''dbo.CONV_DOMINIOS'') IS NOT NULL
	DROP TABLE dbo.CONV_DOMINIOS
')
EXECUTE('
CREATE TABLE dbo.CONV_DOMINIOS
	(
	TZ_LOCK               NUMERIC (15),
	ID_CONVENIO           NUMERIC (15) NOT NULL,
	ID_DOMINIO            NUMERIC (4) NOT NULL,
	DESCRIPCION           VARCHAR (80),
	CUENTA_PRINCIPAL      NUMERIC (12),
	CUENTA_SECUNDARIA     NUMERIC (12),
	CONC_CONT_TRANSITORIO NUMERIC (10),
	CONSTRAINT PK_CONV_DOMINIOS PRIMARY KEY (ID_CONVENIO, ID_DOMINIO)
	)
')

EXECUTE('
IF OBJECT_ID (''dbo.VW_CRE_ORDEN_COBRANZA_ASISTENCIAS'') IS NOT NULL
	DROP VIEW dbo.VW_CRE_ORDEN_COBRANZA_ASISTENCIAS
')
EXECUTE('
CREATE VIEW dbo.VW_CRE_ORDEN_COBRANZA_ASISTENCIAS
AS 
SELECT cod.CODIGO,b.ORDEN,a.JTS_OID,a.CLIENTE,a.VENCIMIENTO,a.TIPO, a.CLASIFICACION
FROM CRE_COB_CODIGOS cod with (nolock)
INNER JOIN CRE_COB_ORDEN_COBRANZA b with (nolock) ON cod.CODIGO=b.CODIGO_COBRANZA AND b.TZ_LOCK=0
INNER JOIN VW_ASISTENCIAS a with (nolock) ON (a.FAMILIA=b.CODIGO_ITEM OR a.PRODUCTO=b.CODIGO_ITEM)
WHERE cod.SOLO_ACREDITA=''N'' AND cod.TZ_LOCK=0 AND a.SALDO>0
')

EXECUTE('
IF OBJECT_ID (''dbo.VW_SDS_COD_COBRANZA'') IS NOT NULL
	DROP VIEW dbo.VW_SDS_COD_COBRANZA
')
EXECUTE('
CREATE   VIEW [dbo].[VW_SDS_COD_COBRANZA]
AS
SELECT	cd.[CODIGO] AS [ID_CODIGO] ,
		cd.DESCRIPCION AS DESCRIPCION,
		cd.SOLO_ACREDITA AS MODALIDAD,
		CASE WHEN cd.SOLO_ACREDITA=''S'' THEN ''SOLO ACREDITACIÓN'' ELSE ''ACREDITACIÓN Y COBRANZA'' END AS MODALIDAD_DESC,
		cd.PARTICULARIDAD,		
		O2.DESCRIPCION AS PARTICULARIDAD_DESC
FROM [CRE_COB_CODIGOS] cd WITH(NOLOCK)
INNER JOIN OPCIONES O1 WITH (NOLOCK) ON O1.NUMERODECAMPO=45224 AND O1.OPCIONINTERNA=cd.SOLO_ACREDITA
INNER JOIN OPCIONES O2 WITH (NOLOCK) ON O2.NUMERODECAMPO=45227 AND O2.OPCIONINTERNA=cd.PARTICULARIDAD
')