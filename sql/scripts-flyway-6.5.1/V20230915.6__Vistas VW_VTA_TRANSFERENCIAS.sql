EXECUTE('
IF OBJECT_ID (''dbo.VW_VTA_TRANSFERENCIAS_ENVIADAS'') IS NOT NULL
	DROP VIEW dbo.VW_VTA_TRANSFERENCIAS_ENVIADAS
----
IF OBJECT_ID (''dbo.VW_VTA_TRANSFERENCIAS_RECIBIDAS'') IS NOT NULL
	DROP VIEW dbo.VW_VTA_TRANSFERENCIAS_RECIBIDAS
----
')
EXECUTE('
CREATE VIEW VW_VTA_TRANSFERENCIAS_ENVIADAS
AS
SELECT
	T.OP_NUMERO AS NRO_TRANSFERENCIA,
	T.OP_FECHA_PRES AS FECHA_PRESENTACION,
	TT.DESCRIPCION_PRESENT,
	M.C6400 AS MONEDA,
	T.OP_IMPORTE AS IMPORTE,
	T.ORD_NOMBRE AS NOMBRE_ORDENANTE,
	OS.DESCRIPCION AS TIPO_CUENTA_ORDENANTE,
	S.CUENTA AS CUENTA_ORDENANTE,
	T.BEN_CBU AS CBU_BENEFICIARIO,
	OT.DESCRIPCION AS MISMO_TITULAR,
	OE.DESCRIPCION AS ESTADO,
	CASE 
		WHEN R.CODIGO_NACHA IS NULL
			THEN T.OP_FECHA_PRES
		ELSE T.FECHA_ESTADO
	END AS FECHA_ESTADO,
	CASE 
		WHEN R.CODIGO_NACHA IS NULL
			THEN ''''
		ELSE CONCAT(R.CODIGO_NACHA, '' - '', R.DESCRIPCION) 
	END AS MOTIVO_RECHAZO,
	OC.DESCRIPCION AS CONTABILIZADA		
FROM 
	VTA_TRANSFERENCIAS AS T WITH (nolock)
INNER JOIN VTA_TRANSFERENCIAS_TIPOS AS TT WITH (nolock) ON
	TT.ID_TIPO = T.OP_TIPO
	AND ((TT.TZ_LOCK < 100000000000000 OR TT.TZ_LOCK >= 200000000000000)
		AND (TT.TZ_LOCK < 300000000000000 OR TT.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN MONEDAS AS M WITH (nolock) ON
	M.C6399 = T.OP_MONEDA
	AND ((M.TZ_LOCK < 100000000000000 OR M.TZ_LOCK >= 200000000000000)
		AND (M.TZ_LOCK < 300000000000000 OR M.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN SALDOS AS S WITH (nolock) ON
	S.JTS_OID = T.ORD_JTS_OID_CUENTA
	AND ((S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)
		AND (S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN SNP_MOTIVOS_RECHAZO AS R WITH (nolock) ON
	R.ID_MOTIVO = T.MOTIVO_RECHAZO
	AND ((R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)
		AND (R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN OPCIONES AS OS WITH (nolock) ON
	OS.NUMERODECAMPO = 1785
	AND OS.IDIOMA = ''E''
	AND OS.OPCIONINTERNA = S.C1785
LEFT JOIN OPCIONES AS OT WITH (nolock) ON
	OT.NUMERODECAMPO = 34243
	AND OT.IDIOMA = ''E''
	AND OT.OPCIONINTERNA = T.BEN_MISMO_TITULAR
LEFT JOIN OPCIONES AS OE WITH (nolock) ON
	OE.NUMERODECAMPO = 45446
	AND OE.IDIOMA = ''E''
	AND OE.OPCIONINTERNA = T.ESTADO
LEFT JOIN OPCIONES AS OC WITH (nolock) ON
	OC.NUMERODECAMPO = 45449
	AND OC.IDIOMA = ''E''
	AND OC.OPCIONINTERNA = T.CONTABILIZADA
WHERE
	T.TZ_LOCK = 0
	AND T.OP_CLASE_TRANS = ''E''
')
-----------
EXECUTE('
CREATE VIEW VW_VTA_TRANSFERENCIAS_RECIBIDAS
AS
SELECT
	T.OP_NUMERO AS NRO_TRANSFERENCIA,
	T.OP_FECHA_PRES AS FECHA_PRESENTACION,
	TT.DESCRIPCION_PRESENT,
	M.C6400 AS MONEDA,
	T.OP_IMPORTE AS IMPORTE,
	T.ORD_NOMBRE AS NOMBRE_ORDENANTE,
	T.ORD_CBU AS CBU_ORDENANTE,
	OS.DESCRIPCION AS TIPO_CUENTA_BENEFICIARIO,
	S.CUENTA AS CUENTA_BENEFICIARIO,
	OT.DESCRIPCION AS MISMO_TITULAR,
	OE.DESCRIPCION AS ESTADO,
	CASE 
		WHEN R.CODIGO_NACHA IS NULL
			THEN T.OP_FECHA_PRES
		ELSE T.FECHA_ESTADO
	END AS FECHA_ESTADO,
	CASE 
		WHEN R.CODIGO_NACHA IS NULL
			THEN ''''
		ELSE CONCAT(R.CODIGO_NACHA, '' - '', R.DESCRIPCION) 
	END AS MOTIVO_RECHAZO			
FROM 
	VTA_TRANSFERENCIAS AS T WITH (nolock)
INNER JOIN VTA_TRANSFERENCIAS_TIPOS AS TT WITH (nolock) ON
	TT.ID_TIPO = T.OP_TIPO
	AND ((TT.TZ_LOCK < 100000000000000 OR TT.TZ_LOCK >= 200000000000000)
		AND (TT.TZ_LOCK < 300000000000000 OR TT.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN MONEDAS AS M WITH (nolock) ON
	M.C6399 = T.OP_MONEDA
	AND ((M.TZ_LOCK < 100000000000000 OR M.TZ_LOCK >= 200000000000000)
		AND (M.TZ_LOCK < 300000000000000 OR M.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN SALDOS AS S WITH (nolock) ON
	S.JTS_OID = T.BEN_JTS_OID_CUENTA
	AND ((S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)
		AND (S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN SNP_MOTIVOS_RECHAZO AS R WITH (nolock) ON
	R.ID_MOTIVO = T.MOTIVO_RECHAZO
	AND ((R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)
		AND (R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN OPCIONES AS OS WITH (nolock) ON
	OS.NUMERODECAMPO = 1785
	AND OS.IDIOMA = ''E''
	AND OS.OPCIONINTERNA = S.C1785
LEFT JOIN OPCIONES AS OT WITH (nolock) ON
	OT.NUMERODECAMPO = 34243
	AND OT.IDIOMA = ''E''
	AND OT.OPCIONINTERNA = T.BEN_MISMO_TITULAR
LEFT JOIN OPCIONES AS OE WITH (nolock) ON
	OE.NUMERODECAMPO = 45446
	AND OE.IDIOMA = ''E''
	AND OE.OPCIONINTERNA = T.ESTADO
WHERE
	T.TZ_LOCK = 0
	AND T.OP_CLASE_TRANS = ''R''
')