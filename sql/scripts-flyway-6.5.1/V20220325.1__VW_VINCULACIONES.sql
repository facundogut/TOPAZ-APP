execute(' IF  EXISTS (select * from sys.views where  name = ''VW_VINCULACIONES'')
	DROP view [dbo].VW_VINCULACIONES; ')
execute(' CREATE OR ALTER   view [dbo].[VW_VINCULACIONES] 
as
select
	vi.ID,
	vi.TIPO_PERSONA_VINCULANTE as TP_VINCULANTE,
	d1.TIPODOCUMENTO as TD_VINCULANTE,
	d1.NUMERODOCUMENTO as DOC_VINCULANTE,
	case vi.TIPO_PERSONA_VINCULANTE
    when ''F'' then
		(select
			concat(f.APELLIDOPATERNO, '' '', f.PRIMERNOMBRE)
		from
			CLI_PERSONASFISICAS f WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(f.TZ_LOCK < 300000000000000 or f.TZ_LOCK >= 400000000000000) 
			and	(f.TZ_LOCK < 100000000000000 or f.TZ_LOCK >= 200000000000000)
			and	f.NUMEROPERSONAFISICA = vi.PERSONA_VINCULANTE)
    else
		(select
			j.RAZONSOCIAL
		from
			CLI_PERSONASJURIDICAS j WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
			and	(j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
			and	j.NUMEROPERSONAJURIDICA = vi.PERSONA_VINCULANTE)
	end VINCULANTE,
	vi.TIPO_PERSONA_VINCULADA as TP_VINCULADO,
	d2.TIPODOCUMENTO as TD_VINCULADO,
	d2.NUMERODOCUMENTO as DOC_VINCULADO,
	case vi.TIPO_PERSONA_VINCULADA
    when ''F'' then
		(select
			concat(f.APELLIDOPATERNO, '' '', f.PRIMERNOMBRE)
		from
			CLI_PERSONASFISICAS f WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(f.TZ_LOCK < 300000000000000 or f.TZ_LOCK >= 400000000000000) 
			and	(f.TZ_LOCK < 100000000000000 or f.TZ_LOCK >= 200000000000000)
			and	f.NUMEROPERSONAFISICA = vi.PERSONA_VINCULADA)
    else
		(select
			j.RAZONSOCIAL
		from
			CLI_PERSONASJURIDICAS j WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
			and	(j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
			and	j.NUMEROPERSONAJURIDICA = vi.PERSONA_VINCULADA)
	end VINCULADO,
	vi.ROL,
	vi.VINCULO,
	vs.MODALIDAD,
	vi.GRUPO_PRIMARIO
from CLI_VINCULACIONES vi WITH (NOLOCK)
inner join CLI_DOCUMENTOSPFPJ d1 WITH (NOLOCK) on d1.NUMEROPERSONAFJ = vi.PERSONA_VINCULANTE
												and (d1.TZ_LOCK < 300000000000000 or d1.TZ_LOCK >= 400000000000000) 
												and (d1.TZ_LOCK < 100000000000000 or d1.TZ_LOCK >= 200000000000000)
												AND (vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
												and (vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
												and vi.REGISTRO = ''C''
inner join CLI_DOCUMENTOSPFPJ d2 WITH (NOLOCK) on d2.NUMEROPERSONAFJ = vi.PERSONA_VINCULADA
												and (d2.TZ_LOCK < 300000000000000 or d2.TZ_LOCK >= 400000000000000) 
												and (d2.TZ_LOCK < 100000000000000 or d2.TZ_LOCK >= 200000000000000)
inner join CLI_VINCULOS vc WITH (NOLOCK) on vc.ID = vi.VINCULO
										and (vc.TZ_LOCK < 300000000000000 or vc.TZ_LOCK >= 400000000000000) 
										and (vc.TZ_LOCK < 100000000000000 or vc.TZ_LOCK >= 200000000000000)

inner join CLI_VINCULOS_SECUNDARIOS vs WITH (NOLOCK) on vs.ID = vc.VINCULO_SECUNDARIO
													and (vs.TZ_LOCK < 300000000000000 or vs.TZ_LOCK >= 400000000000000) 
													and (vs.TZ_LOCK < 100000000000000 or vs.TZ_LOCK >= 200000000000000)
union all
select
	vi.ID,
	vi.TIPO_PERSONA_VINCULANTE as TP_VINCULANTE,
	d1.TIPODOCUMENTO as TD_VINCULANTE,
	d1.NUMERODOCUMENTO as DOC_VINCULANTE,
	case vi.TIPO_PERSONA_VINCULANTE
    when ''F'' then
		(select
			concat(f.APELLIDOPATERNO, '' '', f.PRIMERNOMBRE)
		from
			CLI_PERSONASFISICAS f WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(f.TZ_LOCK < 300000000000000 or f.TZ_LOCK >= 400000000000000) 
			and	(f.TZ_LOCK < 100000000000000 or f.TZ_LOCK >= 200000000000000)
			and	f.NUMEROPERSONAFISICA = vi.PERSONA_VINCULANTE)
    else
		(select
			j.RAZONSOCIAL
		from
			CLI_PERSONASJURIDICAS j  WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
			and	(j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
			and	j.NUMEROPERSONAJURIDICA = vi.PERSONA_VINCULANTE)
	end VINCULANTE,
	vi.TIPO_PERSONA_VINCULADA as TP_VINCULADO,
	d2.TIPODOCUMENTO as TD_VINCULADO,
	d2.NUMERODOCUMENTO as DOC_VINCULADO,
	d2.RAZONSOCIAL as VINCULADO,
	vi.ROL,
	vi.VINCULO,
	vs.MODALIDAD,
	vi.GRUPO_PRIMARIO
from CLI_VINCULACIONES vi  WITH (NOLOCK)
inner join CLI_DOCUMENTOSPFPJ d1  WITH (NOLOCK)on d1.NUMEROPERSONAFJ = vi.PERSONA_VINCULANTE
											AND	(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
											and (vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
											and (d1.TZ_LOCK < 300000000000000 or d1.TZ_LOCK >= 400000000000000) 
											and (d1.TZ_LOCK < 100000000000000 or d1.TZ_LOCK >= 200000000000000)
											and vi.REGISTRO = ''V''
inner join CLI_VINCULADOSJURIDICOS d2  WITH (NOLOCK) on d2.NUMEROPERSONAJURIDICA = vi.PERSONA_VINCULADA
													and (d2.TZ_LOCK < 300000000000000 or d2.TZ_LOCK >= 400000000000000) 
													and (d2.TZ_LOCK < 100000000000000 or d2.TZ_LOCK >= 200000000000000)
inner join CLI_VINCULOS vc  WITH (NOLOCK)on vc.ID = vi.VINCULO
												and (vc.TZ_LOCK < 300000000000000 or vc.TZ_LOCK >= 400000000000000) 
												and (vc.TZ_LOCK < 100000000000000 or vc.TZ_LOCK >= 200000000000000)
inner join CLI_VINCULOS_SECUNDARIOS vs  WITH (NOLOCK)on vs.ID = vc.VINCULO_SECUNDARIO
														and (vs.TZ_LOCK < 300000000000000 or vs.TZ_LOCK >= 400000000000000) 
														and (vs.TZ_LOCK < 100000000000000 or vs.TZ_LOCK >= 200000000000000); ')