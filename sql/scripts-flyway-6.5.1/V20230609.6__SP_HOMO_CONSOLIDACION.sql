EXECUTE('
CREATE OR ALTER PROCEDURE [dbo].[ITF_EMPR_HOMO_CONSOLIDACION]
AS
BEGIN	
	
	TRUNCATE TABLE SNP_PRESTACIONES_EMPRESAS;
	
	INSERT INTO SNP_PRESTACIONES_EMPRESAS(CUIT_EO, NOMBRE_EMPRESA, PRESTACION, ENTIDAD, ORIGINANTE, LARGO_ID, SEGUNDO_VTO,
	  REINTENTOS, PERIODICIDAD_PAGO, TIPO_COMISION, ESTADO, FECHA_ALTA, ID_CONVENIO, NOMENTIDAD, TZ_LOCK)
	SELECT A.CUIT_EO, A.NOMBRE_EMPRESA, A.PRESTACION, A.ENTIDAD, A.ORIGINANTE, A.LARGO_ID, A.SEGUNDO_VTO,
	  A.REINTENTOS, A.PERIODICIDAD_PAGO, A.TIPO_COMISION, A.ESTADO, A.FECHA_ALTA, 
	  (SELECT MAX(X.Id_ConvRec) 
	   FROM CONV_CONVENIOS_REC X
	   WHERE X.CUIT = A.CUIT_EO
	     AND X.Estado = ''A''
		 AND EXISTS(SELECT 1 FROM CONV_TIPOS t WHERE t.TpoContrato = 2 AND t.Id_TpoConv = X.Id_TpoConv)
	  ) AS ID_CONVENIO, A.NomEntidad, TZ_LOCK
	FROM SNP_PRESTACIONES_EMPRESAS_AUX A;
	
	TRUNCATE TABLE SNP_PRESTACIONES_EMPRESAS_AUX;
	
END
')