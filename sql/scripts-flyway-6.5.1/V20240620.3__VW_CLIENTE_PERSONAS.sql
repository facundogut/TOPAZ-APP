EXECUTE('
IF OBJECT_ID (''dbo.VW_CLIENTE_PERSONAS'') IS NOT NULL
	DROP VIEW dbo.VW_CLIENTE_PERSONAS
')

EXECUTE('
CREATE VIEW VW_CLIENTE_PERSONAS
AS (


  SELECT A.CODIGOCLIENTE, A.NUMEROPERSONA, 
    (CASE WHEN A.TITULARIDAD = ''C'' THEN ''COT'' WHEN A.TITULARIDAD = ''T'' THEN ''TIT'' END) AS CODIGOCARGO, B.TIPOPERSONA,
    B.TIPODOCUMENTO, B.NUMERODOCUMENTO
  FROM CLI_ClientePersona A
    INNER JOIN CLI_DocumentosPFPJ B ON B.NUMEROPERSONAFJ = A.NUMEROPERSONA
  WHERE (A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000) 
    AND (B.TZ_LOCK < 300000000000000 OR B.TZ_LOCK >= 400000000000000) 
  UNION ALL
  --Juridicos
  SELECT A.CODIGOCLIENTE, A.NUMEROPERSONA, C.CODIGOCARGO, C.TIPO_PERSONA, CDOC.TIPODOCUMENTO, CDOC.NUMERODOCUMENTO
  FROM CLI_ClientePersona A
    INNER JOIN CLI_DocumentosPFPJ B ON B.NUMEROPERSONAFJ = A.NUMEROPERSONA
    INNER JOIN CLI_INTEGRANTESPJ C ON C.NUMEROPERSONAJURIDICA = B.NUMEROPERSONAFJ
    INNER JOIN CLI_DocumentosPFPJ CDOC ON CDOC.NUMEROPERSONAFJ = C.NUMEROPERSONAFISICA
  WHERE (A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000) 
    AND (B.TZ_LOCK < 300000000000000 OR B.TZ_LOCK >= 400000000000000) 
    AND (C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000) 
    AND (CDOC.TZ_LOCK < 300000000000000 OR CDOC.TZ_LOCK >= 400000000000000) 
)
')