EXECUTE('
DROP TABLE ITF_LINK_UMOZ_AUX
CREATE TABLE dbo.ITF_LINK_UMOZ_AUX
	(
	ID_TICKET NUMERIC (16) NOT NULL,
	NRO_LINEA INT NOT NULL,
	CUENTA    VARCHAR (18) NOT NULL,
	FECHA     VARCHAR (6),
	CONCEPTO  VARCHAR (10),
	IMPORTE   VARCHAR (9),
	SALDO     VARCHAR (9),
	JTS_OID_SALDO NUMERIC (10) NOT NULL,
	CONSTRAINT PK__ITF_LINK_UMOZ_AUX PRIMARY KEY (ID_TICKET, NRO_LINEA, CUENTA)
	)
DROP TABLE dbo.ITF_MASTER_LINEAS
CREATE TABLE dbo.ITF_MASTER_LINEAS
	(
	ID_TICKET     NUMERIC (16) NOT NULL,
	TIPO_REGISTRO VARCHAR (1) NOT NULL,
	NRO_LINEA     INT IDENTITY NOT NULL,
	CONTENIDO     VARCHAR (8000) NOT NULL,
	TipoDetalle   VARCHAR (25),
	JTS_OID_SALDO NUMERIC (10) NOT NULL
	CONSTRAINT PK__ITF_MASTER_LINEAS PRIMARY KEY (ID_TICKET, TIPO_REGISTRO, NRO_LINEA)
	)

')
EXECUTE('
ALTER VIEW VW_ITF_LINK_UMOZ AS
	SELECT 
		(RIGHT(''0000000000000000000''+ VT.CTA_REDLINK, 18)) AS ''NROCUENTA'',
		(SELECT CASE 
				WHEN S.C1604 < 0  then ''-''+RIGHT(((''00000000''+REPLACE(REPLACE(s.C1604,''-'',''''),''.'',''''))),8)
				when S.C1604 >= 0 then ''+''+RIGHT((''00000000''+(REPLACE(s.C1604,''.'',''''))),8) 
				end) as ''SALDOPLANO'',
		S.C1604 AS ''SALDO_ORIGINAL'',
		SPACE(23) AS ''FILLER'',
		HV.CONCEPTO AS ''CONCEPTO'',

		(SELECT (case 
				when hv.DEBITO_CREDITO = ''C'' THEN (''+''+RIGHT(''00000000''+(REPLACE(HV.MONTO,''.'','''')),8))
				when hv.DEBITO_CREDITO  = ''D'' then (''-''+RIGHT(''00000000''+(REPLACE(HV.MONTO,''.'','''')),8))
				END))  AS ''IMPORTEDETALLE'',
		(SELECT (case 
				when hv.DEBITO_CREDITO = ''C'' THEN (''+'') 
				when hv.DEBITO_CREDITO = ''D'' then (''-'') 
				end)) as ''SIGNO'',
		(select convert(varchar(6),HV.FECHA_VALOR,12)) AS ''FECHA'',
		(SELECT(CASE 
				WHEN s.moneda= 1 and S.C1785 =2 THEN ''Cuenta Corriente en Pesos''
				WHEN s.moneda = 2 and S.C1785 = 3 then ''Caja Ahorro en Dolares''
				WHEN s.moneda = 1 and S.C1785 = 3 then ''Caja Ahorro en Pesos'' END)) as ''TipoDetalle'',
		(select HV.MONTO)  as IMPORTEORIGINAL,
		S.JTS_OID,
		HV.MOV_JTS_OID
	FROM ITF_MOVCONFORMADOS ITF 

	INNER JOIN HISTORIA_VISTA HV ON ITF.asiento=HV.ASIENTO  
			AND itf.fch_procesado=hv.FECHA_PROCESADO 
			AND itf.sucursal=hv.SUCURSAL 
			AND itf.nro_mov=hv.NUMERO_MOVIMIENTO 
			AND itf.ordinal=hv.ORDINAL 
			AND itf.TRTIPO=hv.TRTIPO 
			AND itf.TRVIRTUAL=hv.TRVIRTUAL 
			AND itf.jts_oid=hv.SALDO_JTS_OID
	INNER JOIN VTA_SALDOS VT ON VT.JTS_OID_SALDO=ITF.JTS_OID
	INNER JOIN saldos s ON s.JTS_OID=itf.jts_oid;

')

EXECUTE('
ALTER VIEW VW_ITF_CABEZERA_LINK_UMOV AS 
 SELECT ''HRMOVIMIENTOS''+ ''0'' +(SELECT convert(varchar(8),NUMERICO)
                    FROM PARAMETROSGENERALES
                    WHERE CODIGO = 2)+(SELECT convert(varchar(6),FECHAPROCESO,12) FROM PARAMETROS)+
                   (''TC'')+(select SPACE(275)) AS ''CABECERA'',1 AS LINENUMBER
')


