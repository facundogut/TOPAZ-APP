EXECUTE('
IF OBJECT_ID (''dbo.VW_SNP_EMPRESAS_HOMOLOGADAS'') IS NOT NULL
	DROP VIEW dbo.VW_SNP_EMPRESAS_HOMOLOGADAS
')
EXECUTE('
CREATE VIEW VW_SNP_EMPRESAS_HOMOLOGADAS
AS
SELECT
	DISTINCT
		PE.CUIT_EO,
		(	
			SELECT TOP 1 NOMBRE_EMPRESA
			FROM SNP_PRESTACIONES_EMPRESAS
			WHERE 
				CUIT_EO = PE.CUIT_EO
				AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
					AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  )
		) AS NOMBRE_EMPRESA,
		PE.ENTIDAD AS ENTIDAD_ORIGINANTE,
		(	
			SELECT TOP 1 NOMENTIDAD
			FROM SNP_PRESTACIONES_EMPRESAS
			WHERE
				ENTIDAD = PE.ENTIDAD
				AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
					AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  )
		) AS NOMBRE_ENTIDAD
FROM SNP_PRESTACIONES_EMPRESAS AS PE WITH (nolock)
WHERE
	((PE.TZ_LOCK < 100000000000000 OR PE.TZ_LOCK >= 200000000000000)
		AND (PE.TZ_LOCK < 300000000000000 OR PE.TZ_LOCK >= 400000000000000)  )
')

