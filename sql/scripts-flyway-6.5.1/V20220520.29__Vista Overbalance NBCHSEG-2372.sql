EXECUTE('
----
IF OBJECT_ID (''dbo.VW_COMISION_MANT_CONVENIOS'') IS NOT NULL
	DROP VIEW dbo.VW_COMISION_MANT_CONVENIOS
----
')
EXECUTE('
----
CREATE VIEW VW_COMISION_MANT_CONVENIOS (
		ID_CONVENIO,
		ID_TPO_CONVENIO,
		CLASE_CONVENIO,
		CODIGO_CLIENTE,
		JTS_OID_COBRO,
		SEGMENTO,
		MONEDA,
		USF,
		INMOVILIZADO)
AS
	SELECT 
		C.Id_ConvRec AS ID_CONVENIO,
		C.Id_TpoConv AS ID_TPO_CONVENIO,
		''RECAUDACIONES'' AS CLASE_CONVENIO,
		S.C1803 AS COD_CLIENTE,
		S.JTS_OID AS JTS_OID_COBRO,
		C.TpoConvSegM AS SEGMENTO,
		S.MONEDA AS MONEDA,
		L.USF AS USF,
		S.C1728 AS INMOVILIZADO
	FROM CONV_CONVENIOS_REC AS C WITH (nolock)
	INNER JOIN SALDOS AS S WITH (nolock) ON
		C.CuentaCom = S.JTS_OID
	INNER JOIN CLI_CLIENTES AS L WITH (nolock) ON
		S.C1803 = L.CODIGOCLIENTE
		AND L.TZ_LOCK = 0
	WHERE
		C.TZ_LOCK = 0
		AND (SELECT FECHAPROCESO FROM PARAMETROS) = 
			(SELECT dbo.ULTIMODIAHABIL((SELECT FECHAPROCESO FROM PARAMETROS)))
	
	UNION ALL
	
	SELECT 
		C.ID_ConvPago AS ID_CONVENIO,
		C.Id_TpoConv AS ID_TPO_CONVENIO,
		''PAGOS'' AS CLASE_CONVENIO,
		S.C1803 AS COD_CLIENTE,
		S.JTS_OID AS JTS_OID_COBRO,
		C.SegmentoMen AS SEGMENTO,
		S.MONEDA AS MONEDA,
		L.USF AS USF,
		S.C1728 AS INMOVILIZADO
	FROM CONV_CONVENIOS_PAG AS C WITH (nolock)
	INNER JOIN SALDOS AS S WITH (nolock) ON
		C.CuentaDeb = S.JTS_OID
	INNER JOIN CLI_CLIENTES AS L WITH (nolock) ON
		S.C1803 = L.CODIGOCLIENTE
		AND L.TZ_LOCK = 0
	WHERE
		C.TZ_LOCK = 0
	   	AND (SELECT FECHAPROCESO FROM PARAMETROS) = 
			(SELECT dbo.ULTIMODIAHABIL((SELECT FECHAPROCESO FROM PARAMETROS)))
----
')

