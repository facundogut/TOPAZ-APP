EXECUTE('



CREATE TABLE dbo.CON_RUBROS_CUADRO_SALDOS
	(
	RUBRO       NUMERIC (12) DEFAULT ((0)) NOT NULL,
	DESCRIPCION VARCHAR (70) DEFAULT ('' ''),
	TZ_LOCK     NUMERIC (15) DEFAULT ((0)) NOT NULL,
	CONSTRAINT PK_CON_RUBROS_CUADRO_SALDOS_01 PRIMARY KEY (RUBRO)
	)
 

INSERT INTO dbo.DESCRIPTORES (TITULO, IDENTIFICACION, TIPODEARCHIVO, DESCRIPCION, GRUPODELMAPA, NOMBREFISICO, TIPODEDBMS, LARGODELREGISTRO, INICIALIZACIONDELREGISTRO, BASE, SELECCION, ACEPTA_MOVS_DIFERIDO)
VALUES (20, 5003, NULL, ''Rubros para Cuadro de Saldos'', 0, ''CON_RUBROS_CUADRO_SALDOS'', ''D'', NULL, NULL, ''Top/Clientes'', NULL, ''N'')
 

INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (49624, '' '', 0, ''Rubro Contable'', ''Rubro Contable'', 12, ''N'', 0, NULL, 0, 0, 0, 0, 0, 0, 0, 5003, ''RUBRO'', 0, NULL)
 

INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (49625, '' '', 0, ''Descripción'', ''Descripción'', 70, ''A'', 0, NULL, 0, 0, 0, 0, 0, 0, 0, 5003, ''DESCRIPCION'', 0, NULL)
 

INSERT INTO dbo.INDICES (NUMERODEARCHIVO, NUMERODEINDICE, DESCRIPCION, CLAVESREPETIDAS, CAMPO1, CAMPO2, CAMPO3, CAMPO4, CAMPO5, CAMPO6, CAMPO7, CAMPO8, CAMPO9, CAMPO10, CAMPO11, CAMPO12, CAMPO13, CAMPO14, CAMPO15, CAMPO16, CAMPO17, CAMPO18, CAMPO19, CAMPO20)
VALUES (5003, 1, ''Indice'', 0, 49624, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL)
 

INSERT INTO dbo.AYUDAS (NUMERODEARCHIVO, NUMERODEAYUDA, DESCRIPCION, FILTRO, MOSTRARTODOS, CAMPOS, CAMPOSVISTA, BASEVISTA, NOMBREVISTA, AYUDAGRANDE)
VALUES (5003, 50031, ''Ayuda Principal'', '''', 0, ''49624R;49625;'', NULL, NULL, NULL, 0)
 
INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (49626, '' '', 0, ''Rubro Contable'', ''Rubro Contable'', 12, ''N'', 0, NULL, 0, 0, 0, 0, 0, 50031, 0, 0, ''RUBRO'', 0, NULL)
 


INSERT INTO dbo.OPERACIONES (TITULO, IDENTIFICACION, NOMBRE, DESCRIPCION, MNEMOTECNICO, AUTORIZACION, FORMULARIOPRINCIPAL, PROXOPERACION, ESTADO, TZ_LOCK, COPIAS, SUBOPERACION, PERMITEBAJA, COMPORTAMIENTOENCIERRE, REQUIERECONTRASENA, PERMITECONCURRENTE, PERMITEESTADODIFERIDO, ICONO_TITULO, ESTILO)
VALUES (2000, 2057, ''ABMC Rubros Cuadro de Saldos'', ''ABMC Rubros Cuadro de Saldos'', ''2057'', ''N'', NULL, NULL, ''P'', 0, NULL, 0, ''S'', ''N'', ''N'', ''S'', ''S'', NULL, NULL)
 

INSERT INTO dbo.REPORTES (TITULO, IDENTIFICACION, DESCRIPCION, TIPO, BIGREPORT, TIPOSALIDA, GENERAREPORTE, GENERAONLINEREPORTE, GRUPO_REIMPRESION, EJ_DE_OPERACION)
VALUES (2000, 2617, ''Consulta Rubros Cuadro Saldos'', ''J'', 0, NULL, 0, 0, 0, ''N'')
 


INSERT INTO dbo.REPORTES (TITULO, IDENTIFICACION, DESCRIPCION, TIPO, BIGREPORT, TIPOSALIDA, GENERAREPORTE, GENERAONLINEREPORTE, GRUPO_REIMPRESION, EJ_DE_OPERACION)
VALUES (2000, 2618, ''Consulta Rubros Cuadro Saldos'', ''J'', 0, NULL, 0, 0, 0, ''N'')
 

INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (49630, '' '', 0, ''Opciones Reportes Contabilidad'', ''Opciones Reportes Contabilidad'', 12, ''N'', 0, NULL, 0, 0, 0, 0, 0, 0, 1, 0, NULL, 0, NULL)
 


INSERT INTO dbo.OPCIONES (NUMERODECAMPO, IDIOMA, DESCRIPCION, OPCIONINTERNA, OPCIONDEPANTALLA)
VALUES (49630, ''E'', ''Detalle de Movimientos de Caja'', ''1'', ''1'')
 

INSERT INTO dbo.OPCIONES (NUMERODECAMPO, IDIOMA, DESCRIPCION, OPCIONINTERNA, OPCIONDEPANTALLA)
VALUES (49630, ''E'', ''Cuadro de Saldos por Sucursal'', ''2'', ''2'')
 

INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (49631, '' '', 0, ''Opcion Rubros'', ''Opcion Rubros'', 1, ''N'', 0, NULL, 0, 0, 0, 0, 0, 0, 1, 0, NULL, 0, NULL)
 


INSERT INTO dbo.OPCIONES (NUMERODECAMPO, IDIOMA, DESCRIPCION, OPCIONINTERNA, OPCIONDEPANTALLA)
VALUES (49631, ''E'', ''Todos los Rubros'', ''1'', ''1'')
 

INSERT INTO dbo.OPCIONES (NUMERODECAMPO, IDIOMA, DESCRIPCION, OPCIONINTERNA, OPCIONDEPANTALLA)
VALUES (49631, ''E'', ''Rubros parametrizados'', ''2'', ''2'')
 


INSERT INTO dbo.REPORTESJASPER (IDENTIFICACION, DESTINO, DATAQUERY, COMPILADO, FORCE, SELECTIVEDESTINATION)
VALUES (2617, 1, NULL, 0, 0, 1)


INSERT INTO dbo.REPORTESJASPER (IDENTIFICACION, DESTINO, DATAQUERY, COMPILADO, FORCE, SELECTIVEDESTINATION)
VALUES (2618, 1, NULL, 0, 0, 1)


INSERT INTO dbo.OPCIONES (NUMERODECAMPO, IDIOMA, DESCRIPCION, OPCIONINTERNA, OPCIONDEPANTALLA)
VALUES (49630, ''E'', ''Consulta Saldos Impropios'', ''3'', ''3'')
 


INSERT INTO dbo.REPORTES (TITULO, IDENTIFICACION, DESCRIPCION, TIPO, BIGREPORT, TIPOSALIDA, GENERAREPORTE, GENERAONLINEREPORTE, GRUPO_REIMPRESION, EJ_DE_OPERACION)
VALUES (2000, 2619, ''Consulta Saldos Impropios'', ''J'', 0, NULL, 0, 0, 0, ''N'')
 


INSERT INTO dbo.REPORTESJASPER (IDENTIFICACION, DESTINO, DATAQUERY, COMPILADO, FORCE, SELECTIVEDESTINATION)
VALUES (2619, 1, NULL, 0, 0, 1)
 



INSERT INTO dbo.OPCIONES (NUMERODECAMPO, IDIOMA, DESCRIPCION, OPCIONINTERNA, OPCIONDEPANTALLA)
VALUES (49630, ''E'', ''Mayor de Cuentas'', ''4'', ''4'')
 

INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (49632, '' '', 0, ''Tipo de Fecha'', ''Tipo de Fecha'', 1, ''A'', 0, NULL, 0, 0, 0, 0, 0, 0, 1, 0, ''TIPO_FECHA'', 0, NULL)
 

INSERT INTO dbo.OPCIONES (NUMERODECAMPO, IDIOMA, DESCRIPCION, OPCIONINTERNA, OPCIONDEPANTALLA)
VALUES (49632, ''E'', ''Proceso'', ''P'', ''P'')
 

INSERT INTO dbo.OPCIONES (NUMERODECAMPO, IDIOMA, DESCRIPCION, OPCIONINTERNA, OPCIONDEPANTALLA)
VALUES (49632, ''E'', ''Valor'', ''V'', ''V'')
 

INSERT INTO dbo.REPORTES (TITULO, IDENTIFICACION, DESCRIPCION, TIPO, BIGREPORT, GENERAONLINEREPORTE, GRUPO_REIMPRESION)
VALUES (2000, 9953, ''Mayor contable - Pantalla'', ''J'', 0, 0, 0)
 
INSERT INTO dbo.REPORTESJASPER (IDENTIFICACION, DESTINO, DATAQUERY, COMPILADO, FORCE, SELECTIVEDESTINATION)
VALUES (9953, 1, NULL, 1, 0, 1)
 


INSERT INTO dbo.REPORTES (TITULO, IDENTIFICACION, DESCRIPCION, TIPO, BIGREPORT, TIPOSALIDA, GENERAREPORTE, GENERAONLINEREPORTE, GRUPO_REIMPRESION, EJ_DE_OPERACION)
VALUES (2000, 2622, ''Consulta de saldos y promedios (V.N.)'', ''J'', 0, NULL, 0, 0, 0, ''N'')
 

INSERT INTO dbo.REPORTESJASPER (IDENTIFICACION, DESTINO, DATAQUERY, COMPILADO, FORCE, SELECTIVEDESTINATION)
VALUES (2622, 1, NULL, 0, 0, 1)
 

INSERT INTO dbo.OPCIONES (NUMERODECAMPO, IDIOMA, DESCRIPCION, OPCIONINTERNA, OPCIONDEPANTALLA)
VALUES (49630, ''E'', ''Consulta de saldos y promedios (V.N.)'', ''5'', ''5'')
 

')


EXECUTE('



CREATE FUNCTION [SALDO_CORTE]
(
   @rubro BIGINT,
   @sucursal numeric(3),
   @moneda numeric(5),
   @p_fecha DATE
   --@p_tipo VARCHAR(1)
)
RETURNS NUMERIC(15,2) 
AS 
	BEGIN   
		DECLARE @v_monto_inicial NUMERIC(15,2) 
		SET @v_monto_inicial= ISNULL(    
		(SELECT TOP 1
		    sd.SALDO_AJUSTADO			
		FROM CON_SALDOS_DIARIOS sd			
		WHERE sd.FECHA < @p_fecha
		AND sd.RUBRO=@rubro
		AND sd.SUCURSAL=@sucursal
		AND sd.MONEDA=@moneda
		ORDER BY sd.FECHA DESC),0)   
		
		RETURN @v_monto_inicial
	END

 

')

EXECUTE('


CREATE FUNCTION [SALDO_FINAL]
(
   @rubro BIGINT,
   @sucursal numeric(3),
   @moneda numeric(5),
   @p_fecha DATE
   --@p_tipo VARCHAR(1)
)
RETURNS NUMERIC(15,2) 
AS 
	BEGIN   
		DECLARE @v_monto_final NUMERIC(15,2)  
		SET @v_monto_final= ISNULL(  
		(SELECT TOP 1
			sd.SALDO_AJUSTADO
		FROM CON_SALDOS_DIARIOS sd			
		WHERE sd.FECHA <= @p_fecha
		AND sd.RUBRO=@rubro
		AND sd.SUCURSAL=@sucursal
		AND sd.MONEDA=@moneda
		ORDER BY sd.FECHA DESC),0) 
		RETURN @v_monto_final
	END

 

')