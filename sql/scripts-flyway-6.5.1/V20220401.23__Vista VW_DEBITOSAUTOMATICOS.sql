EXECUTE('
----
IF OBJECT_ID (''dbo.VW_DEBITOSAUTOMATICOS'') IS NOT NULL
	DROP VIEW dbo.VW_DEBITOSAUTOMATICOS
----
')
EXECUTE('
----
CREATE VIEW [dbo].[VW_DEBITOSAUTOMATICOS]
AS
SELECT
	det.NRO_REGISTRO,
	det.JTS_DEBITO,
	det.ID_CABEZAL,
	det.ID_LINEA,
	cab.CONVENIO,
	det.TIPO_ORDEN 
FROM 
	REC_CAB_DEBITOSAUTOMATICOS AS cab WITH (NOLOCK)
INNER JOIN REC_DET_DEBITOSAUTOMATICOS AS det WITH (NOLOCK) ON 
	cab.ID=det.ID_CABEZAL 
	AND cab.ESTADO IN (''V'',''Z'') 
	AND cab.FECHACORTE>= (	SELECT fechaproceso 
							FROM PARAMETROS WITH (NOLOCK))
	/*JMB SE FILTRAN REGISTROS DEL MISMO 
	AÑO Y MES QUE LA FECHA DE PROCESO*/
	AND datediff(yy,cab.FECHACORTE,(SELECT fechaproceso FROM PARAMETROS WITH (NOLOCK))) = 0
	AND datediff(mm,cab.FECHACORTE,(SELECT fechaproceso FROM PARAMETROS WITH (NOLOCK))) = 0
	AND det.ESTADO=''V'' 
   	AND (det.FECHA_NOVEDAD IS NULL 
   		OR det.FECHA_NOVEDAD <=(	SELECT fechaproceso 
									FROM PARAMETROS WITH (NOLOCK)) )
	AND det.TZ_LOCK=0 
WHERE
	cab.TZ_LOCK=0
----
')