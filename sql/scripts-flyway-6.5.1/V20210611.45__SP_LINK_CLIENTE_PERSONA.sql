EXECUTE('DROP PROCEDURE IF EXISTS dbo.SP_LINK_TRK_CLIENTE_PERSONA;')
EXECUTE('
CREATE PROCEDURE dbo.SP_LINK_TRK_CLIENTE_PERSONA @NRO_TARJETA VARCHAR(19), @NRO_DOC VARCHAR(20), @TIPO_PROC VARCHAR(1), @NRO_CLIENTE NUMERIC(12) OUTPUT, @NRO_PERSONA NUMERIC(12) OUTPUT
AS
BEGIN
	SET @NRO_DOC = CAST(@NRO_DOC AS NUMERIC);
	SET @NRO_DOC = CAST(@NRO_DOC AS VARCHAR);
	
	IF @TIPO_PROC = ''R''
	  BEGIN 
        SET @NRO_CLIENTE = ISNULL((SELECT COD_CLIENTE FROM TJD_SOLICITUD_LINK WHERE AUTORIZADA = 1 AND TZ_LOCK = 0 AND TIPO_SOLICITUD = ''120005'' AND NRO_TARJETA_BASE = CAST(@NRO_TARJETA AS NUMERIC)), 0);
        SET @NRO_PERSONA = ISNULL((SELECT NRO_PERSONA FROM TJD_SOLICITUD_LINK WHERE AUTORIZADA = 1 AND TZ_LOCK = 0 AND TIPO_SOLICITUD = ''120005'' AND NRO_TARJETA_BASE = CAST(@NRO_TARJETA AS NUMERIC)), 0);
      END 
    ELSE
      BEGIN
       	SET @NRO_CLIENTE = ISNULL((SELECT c.[CODIGOCLIENTE] FROM CLI_ClientePersona AS c, CLI_DocumentosPFPJ AS d WHERE d.NUMERODOCUMENTO = @NRO_DOC AND d.NUMEROPERSONAFJ = c.NUMEROPERSONA AND c.TITULARIDAD=''T'' AND d.TZ_LOCK = 0 AND c.TZ_LOCK = 0), 0);
       	SET @NRO_PERSONA = ISNULL((SELECT c.NUMEROPERSONA FROM CLI_ClientePersona AS c, CLI_DocumentosPFPJ AS d WHERE  d.NUMERODOCUMENTO = @NRO_DOC AND d.NUMEROPERSONAFJ = c.NUMEROPERSONA AND c.TITULARIDAD=''T'' AND d.TZ_LOCK = 0 AND c.TZ_LOCK = 0), 0);
      END   
    
    --PRINT(CAST(@NRO_CLIENTE AS VARCHAR));
    --PRINT(CAST(@NRO_PERSONA AS VARCHAR));
    
END;')


