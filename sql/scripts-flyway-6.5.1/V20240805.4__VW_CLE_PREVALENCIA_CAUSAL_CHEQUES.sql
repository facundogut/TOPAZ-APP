EXECUTE('
IF OBJECT_ID (''dbo.VW_CLE_PREVALENCIA_CAUSAL_CHEQUES'') IS NOT NULL
	DROP VIEW dbo.VW_CLE_PREVALENCIA_CAUSAL_CHEQUES
')
EXECUTE('
CREATE VIEW VW_CLE_PREVALENCIA_CAUSAL_CHEQUES
AS
SELECT
	P.ID_PREVALENCIA,
	P.CAUSAL_DEPOSITARIA,
	T.DESCRIPCION AS DESCRIPCION_CAUSAL_DEP,
	P.CAUSAL_GIRADA,
	T2.DESCRIPCION AS DESCRIPCION_CAUSAL_GIRADA,
	P.CAUSAL_PREVALECIENTE
FROM CLE_PREVALENCIA_CAUSAL AS P WITH (nolock)
INNER JOIN CLE_TIPO_CAUSAL AS T WITH (nolock) ON
	T.CODIGO_DE_CAUSAL = (
		SELECT TOP 1
			CODIGO_DE_CAUSAL
		FROM CLE_TIPO_CAUSAL
		WHERE
			P.CAUSAL_DEPOSITARIA = 
				CASE WHEN CODIGO_NACHA < 10 THEN
					CONCAT(''R0'',CODIGO_NACHA)
				ELSE
					CONCAT(''R'',CODIGO_NACHA)
				END
			AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
				AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  
			)
	)
INNER JOIN CLE_TIPO_CAUSAL AS T2 WITH (nolock) ON
	T2.CODIGO_DE_CAUSAL = (
		SELECT TOP 1
			CODIGO_DE_CAUSAL
		FROM CLE_TIPO_CAUSAL
		WHERE
			P.CAUSAL_GIRADA =
				CASE WHEN CODIGO_NACHA < 10 THEN
					CONCAT(''R0'',CODIGO_NACHA)
				ELSE
					CONCAT(''R'',CODIGO_NACHA)
				END
			AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
				AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  
			)
	)
WHERE
	P.FUNCIONALIDAD = ''CH''
	AND ((P.TZ_LOCK < 100000000000000 OR P.TZ_LOCK >= 200000000000000)
		AND (P.TZ_LOCK < 300000000000000 OR P.TZ_LOCK >= 400000000000000)  
	)
')