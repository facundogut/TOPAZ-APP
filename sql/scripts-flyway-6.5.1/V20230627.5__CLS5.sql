Execute('
create or alter procedure [dbo].[SP_LAUNCH_SESION_PRESENTADOS_PROPIOS_FINAL]
@P_ID_PROCESO float(53),   /* Identificador de proceso */
@P_DT_PROCESO  datetime2(0),  /* Fecha de proceso */
@P_RET_PROCESO float(53)  OUTPUT,  /* Estado de ejecucion SQL( 1:Correcto, 2: Error ) */
@P_MSG_PROCESO varchar(max)  OUTPUT  /*Mensaje de salida*/
as
begin
	--ITF_COELSA_CHEQUES_PROPIOS
	insert into [dbo].[ITF_COELSA_CHEQUES_PROPIOS] (ID_TICKET, ID_PROCESO, FECHAPROCESO, CODIGO_TRANSACCION, ENTIDAD_DEBITAR, CUENTA_DEBITAR, IMPORTE, CODIGO_POSTAL, FECHA_PRESENTADO, FECHA_VENCIMIENTO, NRO_CHEQUE, PUNTO_INTERCAMBIO, TRACE_NUMBER, ESTADO, TIPO, INFO_ADICIONAL)
	select ID_TICKET, ID_PROCESO, FECHAPROCESO, CODIGO_TRANSACCION, ENTIDAD_DEBITAR, CUENTA_DEBITAR, IMPORTE, CODIGO_POSTAL, FECHA_PRESENTADO, FECHA_VENCIMIENTO, NRO_CHEQUE, PUNTO_INTERCAMBIO, TRACE_NUMBER, ESTADO, TIPO, INFO_ADICIONAL
	from [dbo].[ITF_COELSA_CHEQUES_PROPIOS_AUX];
	
	--ITF_COELSA_IMAGENES_CHEQUES_PROPIOS
	insert into [dbo].[ITF_COELSA_IMAGENES_CHEQUES_PROPIOS] (ID_TICKET, ID_PROCESO, FECHA_PROCESO, ESTADO, ID_REGISTRO, BANCO_DEPOSITARIO, BANCO_GIRADO, SUCURSAL_GIRADA, CODIGO_POSTAL, NRO_CHEQUE, NRO_CUENTA, FECHA_PRESENTACION, FECHA_COMPENSACION, ESTADO_TRAN, NOMBRE_IMAGEN)
	select ID_TICKET, ID_PROCESO, FECHA_PROCESO, ESTADO, ID_REGISTRO, BANCO_DEPOSITARIO, BANCO_GIRADO, SUCURSAL_GIRADA, CODIGO_POSTAL, NRO_CHEQUE, NRO_CUENTA, FECHA_PRESENTACION, FECHA_COMPENSACION, ESTADO_TRAN, NOMBRE_IMAGEN
	from [dbo].[ITF_COELSA_IMAGENES_CHEQUES_PROPIOS_AUX];
	
	--CLE_IMG_CHEQUES
	merge [dbo].[CLE_IMG_CHEQUES] as tgt
	using [dbo].[CLE_IMG_CHEQUES_AUX] as src
	on (tgt.CMC7 = src.CMC7)
	when matched then
		update set tgt.FECHAALTA = src.FECHAALTA, tgt.TIPO = src.TIPO, tgt.IMGFRENTEDORSO = src.IMGFRENTEDORSO, tgt.IMGIMPORTE = src.IMGIMPORTE, tgt.IMGFECHA = src.IMGFECHA, tgt.IMGORDENANTE = src.IMGORDENANTE, tgt.ASIENTO = src.ASIENTO, tgt.SUCURSAL = src.SUCURSAL, tgt.FECHAPROCESO = src.FECHAPROCESO, tgt.ENPXWDOC = src.ENPXWDOC, tgt.ORIGENIMAGEN = src.ORIGENIMAGEN
	when not matched then
		insert values (src.CMC7, src.FECHAALTA, src.TIPO, src.IMGFRENTEDORSO, src.IMGIMPORTE, src.IMGFECHA, src.IMGORDENANTE, src.ASIENTO, src.SUCURSAL, src.FECHAPROCESO, src.ENPXWDOC, src.ORIGENIMAGEN)
	;

	truncate table [dbo].[ITF_COELSA_CHEQUES_PROPIOS_AUX];
	truncate table [dbo].[ITF_COELSA_IMAGENES_CHEQUES_PROPIOS_AUX];
	truncate table [dbo].[CLE_IMG_CHEQUES_AUX];

	--Salida
	SET @p_msg_proceso = ''Importacion Correcta'';
	SET @p_ret_proceso = 1;
end;')
Execute('
create or alter procedure [dbo].[SP_LAUNCH_SESION_PRESENTADOS_PROPIOS_ITF]
@P_ID_PROCESO float(53),   /* Identificador de proceso */
@P_DT_PROCESO  datetime2(0),  /* Fecha de proceso */
@P_RET_PROCESO float(53)  OUTPUT,  /* Estado de ejecucion SQL( 1:Correcto, 2: Error ) */
@P_MSG_PROCESO varchar(max)  OUTPUT  /*Mensaje de salida*/
as
begin
	truncate table [dbo].[ITF_COELSA_CHEQUES_PROPIOS_AUX];
	truncate table [dbo].[ITF_COELSA_IMAGENES_CHEQUES_PROPIOS_AUX];
	truncate table [dbo].[CLE_IMG_CHEQUES_AUX];

	SET @p_msg_proceso = ''Tablas auxiliares Limpiadas correctamente'';
	SET @p_ret_proceso = 1;
end;')