execute('
IF OBJECT_ID (''dbo.VW_CLIENTES_PERSONAS'') IS NOT NULL
    DROP VIEW dbo.VW_CLIENTES_PERSONAS')
EXECUTE('
CREATE OR ALTER VIEW [dbo].[VW_CLIENTES_PERSONAS] (
									   TIPODOC, 
									   NUMERODOC, 
									   NUMEROPERSONA, 
									   TIPOPERSONA, 
									   NOMBRE, 
									   APE_NOMBRE,
									   TITULARIDAD, 
									   CODIGOCLIENTE, 
									   NOMBRECLIENTE,
									   ESTADOCLIENTE,
									   ESTADOPERSONA)
AS 
SELECT 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    V.TIPOPERSONA, 
    ISNULL(U.PRIMERNOMBRE, '''') + '' '' + ISNULL(U.APELLIDOPATERNO, '''')  AS NOMBRE, 
    ISNULL(U.APELLIDOPATERNO, '''') + '' '' + ISNULL(U.PRIMERNOMBRE, '''') AS APE_NOMBRE,
    T.TITULARIDAD, 
    R.CODIGOCLIENTE, 
    R.NOMBRECLIENTE,
    r.ESTADO,
    u.estado
FROM 
    dbo.CLI_CLIENTES  AS R WITH(NOLOCK), 
    dbo.CLI_CLIENTEPERSONA  AS T WITH(NOLOCK), 
    dbo.CLI_PERSONASFISICAS  AS U WITH(NOLOCK), 
    dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK)
WHERE 
    (R.CODIGOCLIENTE = T.CODIGOCLIENTE) AND 
    (U.NUMEROPERSONAFISICA = T.NUMEROPERSONA AND U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ) AND 
    (	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
	AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) AND 
    (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
	AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) AND 
    (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
	AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)) AND 
    (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
	AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
UNION ALL
SELECT 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    V.TIPOPERSONA, 
    S.RAZONSOCIAL AS NOMBRE, 
    S.RAZONSOCIAL AS APE_NOMBRE,
    T.TITULARIDAD, 
    R.CODIGOCLIENTE, 
    R.NOMBRECLIENTE,
    R.ESTADO,
    S.ESTADO
FROM 
    dbo.CLI_CLIENTES  AS R WITH(NOLOCK), 
    dbo.CLI_PERSONASJURIDICAS  AS S WITH(NOLOCK), 
    dbo.CLI_CLIENTEPERSONA  AS T WITH(NOLOCK), 
    dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK)
WHERE 
    (R.CODIGOCLIENTE = T.CODIGOCLIENTE) AND 
    (S.NUMEROPERSONAJURIDICA = T.NUMEROPERSONA AND S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ) AND 
    (	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
	AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) AND 
    (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
	AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) AND 
    (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
	AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)) AND 
    (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
	AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))

')
