EXECUTE('
IF OBJECT_ID (''dbo.VW_SOL_CRED_OC_LEASING'') IS NOT NULL
	DROP VIEW dbo.VW_SOL_CRED_OC_LEASING
')
EXECUTE('
CREATE     VIEW [dbo].[VW_SOL_CRED_OC_LEASING] 
AS 

SELECT TOP 9223372036854775807 WITH TIES 
      S.SUCURSAL AS "Sucursal",
      SUC.NOMBRESUCURSAL AS "Nombre de Sucursal",
      S.PRODUCTO AS "Producto",
      P.C6251 AS "Nombre de Producto",
      S.OPERACION AS "Numero de Operación",
      S.ORDINAL AS "Desglose",
      S.CUENTA AS "Cuenta",
      B.NUMERO_BIEN AS "Número de Contrato",          
      MON.C6401 AS Moneda,
      b.OPCION_COMPRA AS "Opción a Compra",
      concat(
      CASE WHEN s.C1773<10 THEN concat(''0'',convert(varchar(20),S.C1773))
      	   ELSE convert(VARCHAR(2),s.C1773) END,''/'',
      CASE WHEN (month(DATEADD(month, 1, S.C1627)))<10 THEN concat(0,month(DATEADD(month, 1, S.C1627))) 
       	   ELSE (convert(VARCHAR(2),month(DATEADD(month, 1, S.C1627)))) 
      END, ''/'',
      year(convert(varchar(20), DATEADD(month, 1, S.C1627), 23))
      ) AS "Vto Opción a Compra",
      S.JTS_OID AS "JTS OID",
	  S.C1803 AS Cliente
FROM SALDOS  AS S	WITH(NOLOCK) 
INNER JOIN SUCURSALES AS SUC WITH(NOLOCK) ON S.SUCURSAL=SUC.SUCURSAL
INNER JOIN CRE_BIENES_LEASING AS B WITH(NOLOCK) ON S.JTS_OID=B.SALDOS_JTS_OID
INNER JOIN CLI_CLIENTES  AS C	WITH(NOLOCK)ON S.C1803 = C.CODIGOCLIENTE
												AND c.TZ_LOCK = 0
												AND S.TZ_LOCK = 0
INNER JOIN VW_CLI_X_DOC DOC ON DOC.CODIGOCLIENTE=S.C1803												
INNER JOIN MONEDAS AS MON	WITH(NOLOCK)ON s.MONEDA = MON.C6399 AND MON.TZ_LOCK = 0 
INNER JOIN PRODUCTOS AS P WITH(NOLOCK) ON p.C6250=S.PRODUCTO AND P.C6800=''L'' AND P.TZ_LOCK=0									
WHERE S.TZ_LOCK=0 AND B.NUMERO_BIEN NOT IN (SELECT NUMERO_BIEN FROM CRE_SOLICITUDCREDITO WHERE NUMERO_BIEN IS NOT NULL AND TZ_LOCK=0)
ORDER BY B.NUMERO_BIEN DESC

')