EXECUTE('
IF OBJECT_ID (''dbo.VW_SOLICITUD_CUENTAS_LINK'') IS NOT NULL
	DROP VIEW dbo.VW_SOLICITUD_CUENTAS_LINK
')
EXECUTE('
CREATE VIEW [dbo].[VW_SOLICITUD_CUENTAS_LINK] 
AS
	SELECT  
		DISTINCT
		TC.ID_SOLICITUD AS [Id Solicitud],
		SL.NRO_TARJETA_BASE AS [Tarjeta Base],
		SL.NRO_TARJETA_COMPLETA AS [Tarjeta Completa],
		TC.NRO_CUENTA AS [Cuenta],
		VS.NOMBRE_CUENTA AS [Denominación Cuenta], 
		TC.TIPO_CUENTA AS [Tipo Cuenta PBF],
		TC.NUMERO_CUENTA_PBF AS [Número cuenta PBF],
		ET.DESCRIPCION AS [Estado] 
	FROM 
		TJD_SOLICITUD_CUENTAS_LINK AS TC WITH (nolock) 
	INNER JOIN TJD_SOLICITUD_LINK AS SL WITH (nolock) ON 
		SL.ID_SOLICITUD = TC.ID_SOLICITUD
		AND SL.TZ_LOCK = 0
	INNER JOIN VTA_SALDOS AS VS WITH (nolock) ON 
		VS.CTA_REDLINK = TC.NUMERO_CUENTA_PBF
		AND VS.TZ_LOCK = 0
	INNER JOIN TJD_ESTADO_TARJETA_CUENTA AS ET WITH (nolock) ON 
		ET.ESTADO = TC.ESTADO_CUENTA
		AND ET.TZ_LOCK = 0
	WHERE
		TC.TZ_LOCK = 0
')


