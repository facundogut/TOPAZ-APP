EXECUTE('
CREATE OR ALTER VIEW VW_ASIENTOS_SIN_CIERRE
AS
SELECT y.ASIENTO, y.SUCURSAL, y.FECHAPROCESO, y.MONEDA, y.GRUPO_BALANCE, y.DEBITO, y.CREDITO 
FROM (SELECT x.ASIENTO, x.SUCURSAL, x.FECHAPROCESO, x.MONEDA, x.GRUPO_BALANCE, sum(x.DEBITO) AS DEBITO, sum(x.CREDITO) AS CREDITO 
		FROM (SELECT a.ASIENTO AS ASIENTO, 
				   a.SUCURSAL AS SUCURSAL, 
				   a.FECHAPROCESO AS FECHAPROCESO, 
				   m.MONEDA AS MONEDA,
					(CASE WHEN p.C6304=''6'' THEN ''ORDEN'' 
						  WHEN p.C6304=''7'' THEN ''ORDEN''
						  WHEN p.C6304=''4'' THEN ''CONTINGENCIAS''  
						  WHEN p.C6304=''5'' THEN ''CONTINGENCIAS''
						ELSE ''OTRAS'' END) AS GRUPO_BALANCE,
					(CASE WHEN m.DEBITOCREDITO=''D'' THEN m.CAPITALREALIZADO 
						  ELSE 0 END) AS DEBITO,
					(CASE WHEN m.DEBITOCREDITO=''C'' THEN m.CAPITALREALIZADO 
						  ELSE 0 END) AS CREDITO
			FROM MOVIMIENTOS_CONTABLES m WITH(NOLOCK), ASIENTOS a WITH(NOLOCK), PLANCTAS p WITH(NOLOCK)
			WHERE  a.ASIENTO = m.ASIENTO 
				AND a.SUCURSAL = m.SUCURSAL
				AND a.FECHAPROCESO = m.FECHAPROCESO
				AND m.RUBROCONTABLE = p.C6326 
				AND a.ESTADO = 77
				--AND m.RUBROCONTABLE NOT LIKE ''6%'' 
				--AND p.C6304=0 --borrar
		) x
		GROUP BY x.ASIENTO, x.SUCURSAL, x.FECHAPROCESO, x.MONEDA, x.GRUPO_BALANCE
	) y WHERE y.DEBITO<>y.CREDITO
')