EXECUTE('
CREATE OR ALTER PROCEDURE SP_MA_DEPURAR_BANDEJA_ENTRADA
   @P_ID_PROCESO float(53), /* Identificador de proceso*/
   @P_DT_PROCESO datetime2(0), /* Fecha de proceso*/

   @P_RET_PROCESO float(53) OUTPUT, /* Estado de ejecucion del PL/SQL(1:Correcto, 2: Error)*/
   @P_MSG_PROCESO varchar(max) OUTPUT

AS 
BEGIN
	SET @P_RET_PROCESO = NULL
	SET @P_MSG_PROCESO = NULL
	
	DECLARE @P_CANTIDAD NUMERIC(15) = NULL
	
	BEGIN TRY
		BEGIN
			BEGIN
				SELECT @P_CANTIDAD =COUNT(*) FROM MA_BANDEJA_ENTRADA WHERE ESTADO=''P'' AND TZ_LOCK=0
			END
			
			BEGIN
				DELETE FROM MA_BANDEJA_ENTRADA
			 	WHERE ESTADO=''P'' AND TZ_LOCK=0
			END
			
			BEGIN
				SET @P_RET_PROCESO=1
			    SET @P_MSG_PROCESO=CONCAT(''OK, Se depuraron: '',@P_CANTIDAD,'' registros de la bandeja de entrada.'')
				
	            DECLARE
	               @PKG_CONSTANTES$C_LOG_TIPO_INFORMACION$5 varchar(8000)
				
				SET @PKG_CONSTANTES$C_LOG_TIPO_INFORMACION$5 = ''I''
				
				EXECUTE PKG_LOG_PROCESO$PROC_INS_LOG_PROCESO
					@P_ID_PROCESO = @P_ID_PROCESO,
					@P_FCH_PROCESO = @P_DT_PROCESO,
					@P_NOM_PACKAGE = ''MA_BANDEJA_ENTRADA'',
					@P_COD_ERROR = @P_RET_PROCESO,
					@P_MSG_ERROR = @P_MSG_PROCESO,
					@P_TIPO_ERROR = @PKG_CONSTANTES$C_LOG_TIPO_INFORMACION$5
			END
		END
	END TRY

	BEGIN CATCH
		BEGIN
		  	SET @P_RET_PROCESO = 2
		  	SET @P_MSG_PROCESO = ''SP_MA_DEPURAR_BANDEJA_ENTRADA Err''

			DECLARE
				@PKG_CONSTANTES$C_LOG_TIPO_INFORMACION$4 varchar(8000)

			SET @PKG_CONSTANTES$C_LOG_TIPO_INFORMACION$4 = ''E''

			EXECUTE dbo.PKG_LOG_PROCESO$PROC_INS_LOG_PROCESO
				@P_ID_PROCESO = @P_ID_PROCESO,
				@P_FCH_PROCESO = @P_DT_PROCESO,
				@P_NOM_PACKAGE = ''SP_MA_DEPURAR_BANDEJA_ENTRADA - Error'',
				@P_COD_ERROR = @P_RET_PROCESO,
				@P_MSG_ERROR = @P_MSG_PROCESO,
				@P_TIPO_ERROR = @PKG_CONSTANTES$C_LOG_TIPO_INFORMACION$4
		END
	END CATCH
END
')

