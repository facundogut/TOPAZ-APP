EXECUTE('
IF OBJECT_ID (''VW_RRII_BALANCE_SALDOS'') IS NOT NULL
	DROP VIEW VW_RRII_BALANCE_SALDOS
')
EXECUTE('
CREATE   VIEW [dbo].[VW_RRII_BALANCE_SALDOS]
as
SELECT DISTINCT
	LEFT(CONVERT(VARCHAR,CBR.CODIGO_INTERNO) + REPLICATE(''0'',6), 6) AS CUENTA,
	--LEFT(CONVERT(VARCHAR,CBR.CODIGO_INTERNO) + REPLICATE(''0'',6), 6) AS CUENTA,	
	CASE WHEN P.FECHA=CBR.FECHA AND M.C6403=''N'' THEN ROUND(ROUND(SUM(CBR.SALDOFINMESMO),0) * H.TIPO_CAMBIO_OFICIAL,0)*-1
		 ELSE ROUND(ROUND(SUM(CBR.SALDOFINMESMO),0) * (SELECT H.TIPO_CAMBIO_OFICIAL WHERE H.FECHA_COTIZACION=CBR.FECHA AND H.MONEDA=CBR.MONEDA),0)*-1 
	END IMPORTE,	
 	CBR.FECHA  	
	FROM CO_BALANCE_RESULTADOS CBR WITH (NOLOCK)
	JOIN HISTORICOTIPOSCAMBIO H WITH (NOLOCK) ON CBR.MONEDA=H.MONEDA 
								AND CBR.FECHA=H.FECHA_COTIZACION	
	JOIN MONEDAS M WITH (NOLOCK) ON CBR.MONEDA = M.C6399,
	PARAMETROSGENERALES P WITH (NOLOCK)
	GROUP BY CBR.SALDOFINMESMO,
			CBR.CODIGO_INTERNO,
			CBR.MONEDA, 
			P.FECHA,CBR.FECHA,
			H.FECHA_COTIZACION,
			H.MONEDA, 
			P.CODIGO, 
			H.TIPO_CAMBIO_OFICIAL, 
			M.C6403 
');



