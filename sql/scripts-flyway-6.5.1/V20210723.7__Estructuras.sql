EXECUTE('IF OBJECT_ID (''SP_LISTA_CHEQUES'') IS NOT NULL
	DROP PROCEDURE SP_LISTA_CHEQUES')

EXECUTE('CREATE PROCEDURE dbo.SP_LISTA_CHEQUES
   @LISTA NUMERIC(12,0)
AS 
   BEGIN      
	
	DELETE FROM CRE_CAB_LISTA_DOCUMENTOS WHERE NUMERO_LISTA = @LISTA
	
	DELETE FROM CLE_CHEQUES_LISTA_DESCUENTO WHERE NUMERO_DEPOSITO = @LISTA

   END')


EXECUTE('IF OBJECT_ID (''JBPM_TZKEY_INGRESOLISTALOTE'') IS NOT NULL
	DROP TABLE JBPM_TZKEY_INGRESOLISTALOTE
')


EXECUTE('CREATE TABLE JBPM_TZKEY_INGRESOLISTALOTE
	(
	PROCESSINSTANCE_ID NUMERIC (19) NOT NULL,
	VERSION            VARCHAR (50) NULL,
	NUMERO_LISTA       NUMERIC (10) NULL,
	CONSTRAINT PK_JBPM_TZKEY_INGRESOLISTALOTE PRIMARY KEY (PROCESSINSTANCE_ID)
	)
')

EXECUTE('CREATE UNIQUE NONCLUSTERED INDEX IDX_JBPM_TZKEY_INGRESOLISTALOTE
	ON dbo.JBPM_TZKEY_INGRESOLISTALOTE (NUMERO_LISTA)
')


EXECUTE('IF OBJECT_ID (''VW_JMPM_PROCESS_INSTANCE_LISTA'') IS NOT NULL
	DROP VIEW VW_JMPM_PROCESS_INSTANCE_LISTA')


EXECUTE('CREATE VIEW VW_JMPM_PROCESS_INSTANCE_LISTA (NUMERO_LISTA, PROCESS_INSTANCE, TZ_LOCK)
AS 
   SELECT L.NUMERO_LISTA, L.PROCESSINSTANCE_ID AS PROCESS_INSTANCE, 0 AS TZ_LOCK
   FROM CRE_CAB_LISTA_DOCUMENTOS  AS C, JBPM_TZKEY_INGRESOLISTALOTE  AS L
   WHERE C.NUMERO_LISTA = L.NUMERO_LISTA
   ')


