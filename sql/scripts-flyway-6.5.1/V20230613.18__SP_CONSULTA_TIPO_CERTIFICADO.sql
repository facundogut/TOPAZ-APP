
EXECUTE('
CREATE OR ALTER PROCEDURE SP_CONSULTA_TIPO_CERTIFICADO
   @NUM_PERSONA  NUMERIC(12),
   @TIPO_CARGO_IMPOSITIVO NUMERIC(4),
   @P_TIPO_CERTIFICADO	    VARCHAR(1) OUTPUT
   
AS 

   BEGIN
   
   DECLARE
      
      	@V_CANTIDAD_CERT_PER NUMERIC(4),
      	@V_CANTIDAD_CERT_TEM NUMERIC(4)
       
       IF @TIPO_CARGO_IMPOSITIVO = 1 
         BEGIN 
           SET @TIPO_CARGO_IMPOSITIVO = 2 	
         END
   
       SELECT @V_CANTIDAD_CERT_PER=COUNT(*) FROM CON_BITACORA_IMPUESTOS
		WHERE id_persona = @NUM_PERSONA		                             
		  AND TIPO_CARGO_IMPOSITIVO = @TIPO_CARGO_IMPOSITIVO
		  AND FECHA_FIN IS NULL
		  AND TABLA_CARGOS_IMPUESTOS IS NULL
		  AND FECHA_INICIO >= (SELECT FECHA_PROCESO FROM PARAMETROS)
		  AND TZ_LOCK = 0
		  
	    SELECT @V_CANTIDAD_CERT_TEM=COUNT(*) FROM CON_BITACORA_IMPUESTOS
		WHERE id_persona =  @NUM_PERSONA
		  AND TIPO_CARGO_IMPOSITIVO = @TIPO_CARGO_IMPOSITIVO
		  AND TABLA_CARGOS_IMPUESTOS IS NULL
		  AND FECHA_INICIO >= (SELECT FECHA_PROCESO FROM PARAMETROS) AND FECHA_FIN <= (SELECT FECHA_PROCESO FROM PARAMETROS)
		  AND TZ_LOCK = 0
	  
     IF @V_CANTIDAD_CERT_PER >0
      BEGIN 
       SET @P_TIPO_CERTIFICADO=''P''
      END
      
     
     IF @V_CANTIDAD_CERT_TEM >0
      BEGIN
       SET @P_TIPO_CERTIFICADO=''T''
      END
     
     
     IF @V_CANTIDAD_CERT_PER=0 AND @V_CANTIDAD_CERT_TEM =0
      BEGIN 
       SET @P_TIPO_CERTIFICADO=''X''
      END   
     
     
     IF @V_CANTIDAD_CERT_PER >0 AND @V_CANTIDAD_CERT_TEM >0
      BEGIN
       SET @P_TIPO_CERTIFICADO=''Z''
      END
    
   END
')