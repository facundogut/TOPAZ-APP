EXECUTE('
--Borro VISTA
DROP VIEW VW_AYUDA_CONVENIOS

')

EXECUTE('

CREATE VIEW [VW_AYUDA_CONVENIOS]
AS
SELECT	con.Id_ConvRec AS [Numero convenio],
		con.NomConvRec AS [Nombre del convenio],
		con.RecConBD AS Padron,
		est.ID_REFERENCIA AS [Id Formulario],
		est.ID_CODIGO_BARRAS AS [Id Codigo de barras],
		est.LARGO AS [Largo]
FROM CONV_CONVENIOS_REC con WITH (NOLOCK)
INNER JOIN CONV_CB_ESTRUCTURA est WITH (NOLOCK) ON con.Id_ConvRec=est.ID_CONVENIO
												AND (est.LARGO=0 OR (est.LARGO>0 AND con.RecConBD =''S'')) 
												AND con.Canal = 1 
												AND est.TZ_LOCK= 0 
												AND con.TZ_LOCK = 0;
	')
execute ('	
												
CREATE   VIEW [VW_CLI_X_DOC_CONV] (
										   TIPODOC, 
										   NUMERODOC,
										   PAISDOCUMENTO,
										   [CODIGOCLIENTE], 
										   NOMBRECLIENTE,
										   NUMEROPERSONA,
										   TIPOPERSONA,
										   ESTADO,
										   NIVELAPERTURA,
										   CODIGOACTAFIP)
AS 
SELECT 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    v.PAISDOCUMENTO,
    R.[CODIGOCLIENTE],
    R.NOMBRECLIENTE,
    V.NUMEROPERSONAFJ AS NUMEROPERSONA,
	''F'' AS TIPOPERSONA,
	U.ESTADO AS ESTADO,
	U.NIVEL_APERTURA AS NIVELAPERTURA,
	A.CODIGO_ACTIVIDAD AS CODIGOACTAFIP
FROM 
    CLI_CLIENTES  AS R with (nolock) 
    inner join CLI_CLIENTEPERSONA  AS T with (nolock) on R.[CODIGOCLIENTE] = T.[CODIGOCLIENTE]
															AND t.TITULARIDAD=''T''
															AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
																AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000))
    inner join CLI_PERSONASFISICAS  AS U with (nolock) on U.NUMEROPERSONAFISICA = T.NUMEROPERSONA
															AND (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
																AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000))
    inner join CLI_DOCUMENTOSPFPJ  AS V with (nolock) on U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
															AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
																AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
	INNER JOIN CLI_ACTIVIDAD_ECONOMICA AS A WITH (nolock) ON U.NUMEROPERSONAFISICA = A.CODIGO_PERSONA_CLIENTE 
															AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
																AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))	 
																																
WHERE (	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
		AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) 
UNION ALL
SELECT 
		V.TIPODOCUMENTO AS TIPODOC, 
		V.NUMERODOCUMENTO AS NUMERODOC, 
		v.PAISDOCUMENTO,
		R.[CODIGOCLIENTE],
		R.NOMBRECLIENTE,
		V.NUMEROPERSONAFJ AS NUMEROPERSONA,
		''J'' AS TIPOPERSONA,
		S.ESTADO AS ESTADO,
		S.NIVEL_APERTURA AS NIVELAPERTURA,
		A.CODIGO_ACTIVIDAD AS CODIGOACTAFIP
FROM 
    CLI_CLIENTES  AS R with (nolock) 
	inner join CLI_CLIENTEPERSONA  AS T with (nolock) on R.[CODIGOCLIENTE] = T.[CODIGOCLIENTE]
															AND t.TITULARIDAD=''T''
															AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
																AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000))
    inner join CLI_PERSONASJURIDICAS  AS S with (nolock) on S.NUMEROPERSONAJURIDICA = T.NUMEROPERSONA 
															AND (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
																AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))
    inner join CLI_DOCUMENTOSPFPJ  AS V with (nolock) on  S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
															AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
																AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
	INNER JOIN CLI_ACTIVIDAD_ECONOMICA AS A WITH (nolock) ON S.NUMEROPERSONAJURIDICA = A.CODIGO_PERSONA_CLIENTE 
															AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
																AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))	 
																
WHERE (	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
		AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000));
		
		')
		EXECUTE ('

--TABLAS - Campo nuevo												
ALTER TABLE REC_DET_RECAUDOS_CANAL ADD FECHA_COBRANZA DATETIME
')

execute ('

--TABLA NUEVA REC_EXT_RECAUDOS_CANALES
IF OBJECT_ID (''REC_EXT_RECAUDOS_CANAL'') IS NOT NULL
	DROP TABLE REC_EXT_RECAUDOS_CANAL

CREATE TABLE REC_EXT_RECAUDOS_CANAL
	(
	FORMATO     VARCHAR (15) DEFAULT ('' '') NOT NULL,
	FECHA       DATETIME NOT NULL,
	CORRELATIVO NUMERIC (15) DEFAULT ((0)) NOT NULL,
	CADENA_01   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_02   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_03   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_04   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_05   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_06   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_07   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_08   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_09   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_10   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_11   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_12   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_13   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_14   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_15   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_16   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_17   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_18   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_19   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_20   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_21   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_22   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_23   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_24   VARCHAR (100) DEFAULT ('' '') NULL,
	CADENA_25   VARCHAR (100) DEFAULT ('' '') NULL,
	NRO_01      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_02      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_03      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_04      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_05      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_06      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_07      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_08      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_09      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_10      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_11      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_12      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_13      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_14      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	NRO_15      NUMERIC (15, 2) DEFAULT ((0)) NULL,
	FECHA_01    DATETIME NULL,
	FECHA_02    DATETIME NULL,
	FECHA_03    DATETIME NULL,
	FECHA_04    DATETIME NULL,
	FECHA_05    DATETIME NULL,
	TZ_LOCK     NUMERIC (15) DEFAULT ((0)) NOT NULL,
	CONSTRAINT PK_REC_EXT_RECAUDOS_CANAL_01 PRIMARY KEY (FORMATO, FECHA, CORRELATIVO)
	)

')