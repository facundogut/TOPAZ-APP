EXECUTE('
----
IF OBJECT_ID (''VW_DEBITO_AUTOMATICO'') IS NOT NULL
	DROP VIEW VW_DEBITO_AUTOMATICO
----
')
EXECUTE('
----
CREATE   VIEW VW_DEBITO_AUTOMATICO
AS
SELECT L.ID_LIQUIDACION AS ''ID_LIQUIDACION'', 
		L.ESTADO AS ''ESTADO'', 
		L.CONVENIO AS ''CONVENIO'', 
		C.NomConvRec AS ''NOMBRE_CONVENIO'', 
		L.CONVENIO_PADRE AS ''CONVENIO_PADRE'',
		C.Cuit AS ''CUIT'', 
		CLI.NOMBRECLIENTE AS ''NOMBRE_CLIENTE'', 
		L.FECHA AS ''FECHA_LIQUIDACION'', 
		C.Acreditacion AS ''PLAZO_ACRED'',
		L.MONEDA AS ''MONEDA'',
		L.TOTALREGISTROS AS ''TOTAL_REGISTROS'', 
		L.TOTALIMPORTE AS ''TOTAL_IMPORTE'',	
		L.COMISION_LIQUIDADA AS ''COMISION_LIQUIDADA'', 
		L.IMPORTE_COMISION AS ''IMPORTE_COMISION'',
		L.TOTAL_CARGO_ESPECIFICO AS ''TOTAL_CARGO_ESPECIFICO'' 
FROM REC_LIQUIDACION L WITH (NOLOCK)
JOIN CONV_CONVENIOS_REC C WITH (NOLOCK) ON (L.CONVENIO = C.Id_ConvRec
                                            OR c.id_convPadre =L.CONVENIO)
										AND C.Id_TpoConv IN(2) AND
										C.ESTADO = ''A'' AND 
										L.ESTADO = ''L'' AND										 
   	(SELECT FECHAPROCESO FROM PARAMETROS) = (CASE WHEN C.Acreditacion = ''24H'' 
     										THEN dbo.diaHabil(DATEADD(day,1,L.FECHA),''A'')
   											WHEN C.Acreditacion = ''48H''
		 									THEN dbo.diaHabil(DATEADD(day,2,L.FECHA),''A'') END)	

																		
JOIN CLI_CLIENTES CLI  WITH (NOLOCK) ON C.Cliente = CLI.CODIGOCLIENTE 
WHERE 
(C.tz_lock < 300000000000000 OR C.tz_lock >= 400000000000000) AND (C.tz_lock < 100000000000000 OR C.tz_lock >= 200000000000000) AND
(CLI.tz_lock < 300000000000000 OR CLI.tz_lock >= 400000000000000) AND (CLI.tz_lock < 100000000000000 OR CLI.tz_lock >= 200000000000000) AND
(L.tz_lock < 300000000000000 OR L.tz_lock >= 400000000000000) AND (L.tz_lock < 100000000000000 OR L.tz_lock >= 200000000000000)

----
')