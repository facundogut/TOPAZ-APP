EXEC sys.sp_dropextendedproperty @name=N'MS_SSMA_SOURCE' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'VW_COFRES_CONTRATOS'
GO

/****** Object:  View [dbo].[VW_COFRES_CONTRATOS]    Script Date: 24/02/2021 15:18:07 ******/
DROP VIEW [dbo].[VW_COFRES_CONTRATOS]
GO

/****** Object:  View [dbo].[VW_COFRES_CONTRATOS]    Script Date: 24/02/2021 15:18:07 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

   
 CREATE VIEW [dbo].[VW_COFRES_CONTRATOS] ( TZ_LOCK,
											SECTOR,
											NUMERO_COFRE,
											CODIGO_COFRE,
											ESTADO_COFRE,
											CODIGO_CONTRATO,
											ESTADO,
											CLIENTE,
											NOMBRE_CLIENTE,
											FECHA_INICIO,
											FECHA_VENCIMIENTO,
											MONEDA,
											IMPORTE,
											CANT_VISITAS_CORTESIA,
											CANT_VISITAS_EFECTUADAS,
											FORMA_PAGO,
											CUENTA_DEBITO,
											BONIFICACION,
											ACTUACION_AUTORIZADOS,
											RETIENE_CORRESPONDENCIA,
											DIRECCION_CORRESPONDENCIA,
											OBSERVACIONES,
											ACTUACION_TITULARES,
											CONTRATO_MIGRADO,
											SUCURSAL_DEBITO,
											PRODUCTO_DEBITO,
											OPERACION_DEBITO,
											ORDINAL_DEBITO,
											MONEDA_DEBITO,
											DEPENDENCIA,
											NOMBRE_DEPENDENCIA,
											TIPODOCUMENTO,
											NUMERODOCUMENTO
											) AS
					SELECT
						0 AS TZ_LOCK,
						C.SECTOR,
						C.NUMERO_COFRE,
						CC.[CODIGO_COFRE],
						C.ESTADO AS ESTADO_COFRE,
						CC.[CODIGO] AS CODIGO_CONTRATO,
						CC.ESTADO,
						CC.CLIENTE,
						CL.NOMBRECLIENTE AS NOMBRE_CLIENTE,
						CC.FECHA_INICIO,
						CC.FECHA_VENCIMIENTO,
						CC.MONEDA,
						CC.IMPORTE,
						CC.CANT_VISITAS_CORTESIA,
						CC.CANT_VISITAS_EFECTUADAS,
						CC.FORMA_PAGO,
						CC.CUENTA_DEBITO,
						CC.BONIFICACION,
						CC.ACTUACION_AUTORIZADOS,
						CC.RETIENE_CORRESPONDENCIA,
						CC.DIRECCION_CORRESPONDENCIA,
						CC.OBSERVACIONES,
						CC.ACTUACION_TITULARES,
						CC.CONTRATO_MIGRADO,
						CC.SUCURSAL_DEBITO,
						CC.PRODUCTO_DEBITO,
						CC.OPERACION_DEBITO,
						CC.ORDINAL_DEBITO,
						CC.MONEDA_DEBITO,
						C.DEPENDENCIA,
						S.NOMBRESUCURSAL AS NOMBRE_DEPENDENCIA,
						D.TIPODOCUMENTO,
						D.NUMERODOCUMENTO
					FROM
						COF_COFRES_CONTRATOS AS CC WITH (NOLOCK)
					INNER JOIN COF_COFRES AS C WITH (NOLOCK) ON
						CC.[CODIGO_COFRE] = C.[CODIGO]
					INNER JOIN SUCURSALES AS S WITH (NOLOCK) ON
						C.DEPENDENCIA = S.SUCURSAL
					INNER JOIN CLI_CLIENTES AS CL WITH (NOLOCK) ON
						CC.CLIENTE = CL.[CODIGOCLIENTE]
					INNER JOIN CLI_CLIENTEPERSONA AS CP WITH (NOLOCK) ON
						CL.[CODIGOCLIENTE] = CP.[CODIGOCLIENTE] 
					INNER JOIN CLI_DOCUMENTOSPFPJ AS D WITH (NOLOCK) ON 
						CP.NUMEROPERSONA = D.NUMEROPERSONAFJ 
					WHERE
						CC.TZ_LOCK = 0
						AND CP.TITULARIDAD = 'T' 
						AND CP.TZ_LOCK = 0
						AND D.TZ_LOCK = 0
						AND CL.TZ_LOCK = 0
						AND S.TZ_LOCK = 0
						AND C.TZ_LOCK = 0
GO

EXEC sys.sp_addextendedproperty @name=N'MS_SSMA_SOURCE', @value=N'BANKPROD.VW_COFRES_CONTRATOS' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'VW_COFRES_CONTRATOS'
GO


