EXECUTE('
IF OBJECT_ID (''dbo.VW_EXCLUSIONES_ASISTENCIAS'') IS NOT NULL
	DROP VIEW dbo.VW_EXCLUSIONES_ASISTENCIAS
')

EXECUTE('
CREATE VIEW VW_EXCLUSIONES_ASISTENCIAS AS ( 
SELECT 
VA.SUCURSAL AS ''Sucursal'',
VA.NOMBRESUCURSAL AS ''Nombre Sucursal'',
VA.PRODUCTO AS ''Producto'',
VA.NOMBREPRODUCTO ''Nombre Producto'',
VA.CUENTA AS ''Cuenta'',
VA.OPERACION AS ''Operación'',
VA.ORDINAL AS ''Ordinal'',
VA.MONEDA AS ''Moneda'',
VA.MONTOORIGEN AS ''Monto'',
VA.CLIENTE AS ''Cliente'',
VA.JTS_OID AS ''JTS OID'',
TE.DETALLE AS ''Motivo Exclusión Graduación'',
TE.ID_EXCLUSION AS ''Identificador Exclusión''
FROM VW_ASISTENCIAS VA WITH(NOLOCK) 
INNER JOIN CRE_EXCLUSIONES_ASISTENCIAS EA WITH(NOLOCK) 
ON EA.ASISTENCIA_JTS_OID=VA.JTS_OID
INNER JOIN CRE_TIPO_EXCLUSION TE WITH(NOLOCK) ON EA.GRADUACION=TE.ID_EXCLUSION 
WHERE EA.TZ_LOCK=0
)
')

EXECUTE('
UPDATE dbo.AYUDAS
SET CAMPOSVISTA = ''Sucursal;Nombre Sucursal;Producto;Nombre Producto;Cuenta;Operación;Moneda;Monto;Cliente;JTS OID;Ordinal;Identificador Exclusión;Motivo Exclusión Graduación;''
WHERE NUMERODEAYUDA = 49350
')

EXECUTE('
IF OBJECT_ID (''dbo.VW_EXCLUSIONES_PRODUCTOS'') IS NOT NULL
	DROP VIEW dbo.VW_EXCLUSIONES_PRODUCTOS
')

EXECUTE('
CREATE VIEW dbo.VW_EXCLUSIONES_PRODUCTOS AS (
SELECT 
EP.TIPO AS ''Tipo'',
O.DESCRIPCION AS ''Descripción Tipo'',
EP.ITEM AS ''Item'',  
CASE WHEN EP.TIPO=''F'' THEN F.DESCRIPCION    
     WHEN EP.TIPO=''P'' THEN P.C6251
    ELSE ''Sin Descripción'' END AS ''Descripción Item'',
TP.DETALLE AS ''Motivo Exclusión Graduación'',
EP.GRADUACION AS ''Identificador Exclusión''
FROM CRE_EXCLUSIONES_PRODUCTOS AS EP WITH(NOLOCK)
INNER JOIN CRE_TIPO_EXCLUSION TP WITH (NOLOCK)
ON EP.GRADUACION=TP.ID_EXCLUSION
LEFT JOIN PRODUCTOS AS P WITH(NOLOCK) ON EP.ITEM=P.C6250
LEFT JOIN CRE_FAMILIAS AS F WITH(NOLOCK) ON EP.ITEM=F.FAMILIAPROD
LEFT JOIN OPCIONES AS O WITH(NOLOCK) ON O.NUMERODECAMPO=44033 AND O.OPCIONINTERNA=EP.TIPO
WHERE EP.TZ_LOCK=0
)
')

EXECUTE('
UPDATE dbo.AYUDAS
SET CAMPOSVISTA = ''Tipo;Item;Descripción Tipo;Descripción Item;Motivo Exclusión Graduación;Identificador Exclusión;''
WHERE NUMERODEAYUDA = 49300
')

EXECUTE('
IF OBJECT_ID (''dbo.VW_EXCLUSIONES_CLIENTES'') IS NOT NULL
	DROP VIEW dbo.VW_EXCLUSIONES_CLIENTES
')

EXECUTE('
CREATE   VIEW [dbo].[VW_EXCLUSIONES_CLIENTES]
							([Código de Cliente],
							Nombre,
							[Motivo Exclusión Graduación],
							[Identificador Exclusión]
							)
AS
SELECT C.CODIGOCLIENTE,
D.NOMBRECLIENTE,
TE.DETALLE AS GRADUACION,
TE.ID_EXCLUSION
FROM CRE_EXCLUSIONES_CLIENTES C WITH(NOLOCK)
INNER JOIN CRE_TIPO_EXCLUSION TE WITH (NOLOCK) ON C.GRADUACION=TE.ID_EXCLUSION
INNER JOIN VW_CLI_X_DOC D WITH(NOLOCK) ON C.CODIGOCLIENTE = D.CODIGOCLIENTE
WHERE C.TZ_LOCK = 0
')

EXECUTE('
UPDATE dbo.AYUDAS
SET CAMPOSVISTA = ''Código de Cliente;Nombre;Identificador Exclusión;Motivo Exclusión Graduación;''
WHERE NUMERODEAYUDA = 4367
')

EXECUTE('
IF OBJECT_ID (''dbo.VW_EXCLUSIONES_TIPOSGARANTIAS'') IS NOT NULL
	DROP VIEW dbo.VW_EXCLUSIONES_TIPOSGARANTIAS
')

EXECUTE('
CREATE   VIEW VW_EXCLUSIONES_TIPOSGARANTIAS AS
SELECT TG.TIPO_GARANTIA AS''Tipo Garantia'',  
G.DSC_TIPO_GARANTIA AS ''Descripción'',
TE.DETALLE AS ''Motivo Exclusión Graduación'',
TE.ID_EXCLUSION AS ''Identificador Exclusión''
FROM CRE_EXCLUSIONES_TIPOSGARANTIAS TG WITH(NOLOCK)
INNER JOIN CRE_TIPOSGARANTIAS G ON G.TIPO_GARANTIA=TG.TIPO_GARANTIA
INNER JOIN CRE_TIPO_EXCLUSION TE ON TG.GRADUACION=TE.ID_EXCLUSION
WHERE TG.TZ_LOCK = 0
')

EXECUTE('
UPDATE dbo.AYUDAS
SET CAMPOSVISTA = ''Tipo Garantia;Descripción;Motivo Exclusión Graduación;Identificador Exclusión;''
WHERE NUMERODEAYUDA = 49460
')