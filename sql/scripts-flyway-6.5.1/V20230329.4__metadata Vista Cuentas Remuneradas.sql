EXECUTE('
IF OBJECT_ID (''VW_VTA_CUENTASVISTAS_REMUNERADAS'') IS NOT NULL
	DROP VIEW VW_VTA_CUENTASVISTAS_REMUNERADAS
')

EXECUTE('
CREATE VIEW [VW_VTA_CUENTASVISTAS_REMUNERADAS] (
											   JTS_OID, 
											   REMUNERADA
											   )
AS 
SELECT S.JTS_OID, 
(CASE 
	WHEN D.MODALIDADPAGO IS NOT NULL THEN ''S''
	ELSE ''N''
END) AS REMUNERADA
FROM SALDOS AS S WITH(NOLOCK)
LEFT JOIN VTA_DEFINICION_VISTA AS D WITH(NOLOCK) ON
	S.PRODUCTO = D.PRODUCTO
	AND S.MONEDA = D.MONEDA
	AND ((D.GRUPO = 0 AND D.SALDO_JTS_OID = S.JTS_OID) OR (D.GRUPO = S.C1772))
	AND ((D.TZ_LOCK < 300000000000000 OR D.TZ_LOCK >= 400000000000000) 
	AND (D.TZ_LOCK < 100000000000000 OR D.TZ_LOCK >= 200000000000000))
WHERE 
	S.C1785 IN (2, 3)
	AND ((S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
	AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))
')


