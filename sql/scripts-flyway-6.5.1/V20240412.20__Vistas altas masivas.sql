EXECUTE('
----
IF OBJECT_ID (''dbo.VW_MA_ACCIONES_X_CONVENIOS'') IS NOT NULL
	DROP VIEW dbo.VW_MA_ACCIONES_X_CONVENIOS
--
IF OBJECT_ID (''dbo.VW_MA_CLI_SALDOS'') IS NOT NULL
	DROP VIEW dbo.VW_MA_CLI_SALDOS
--
IF OBJECT_ID (''dbo.VW_MA_CLIENTES'') IS NOT NULL
	DROP VIEW dbo.VW_MA_CLIENTES
--
IF OBJECT_ID (''dbo.VW_MA_NOMBRE_CAMPOS'') IS NOT NULL
	DROP VIEW dbo.VW_MA_NOMBRE_CAMPOS
--
IF OBJECT_ID (''dbo.VW_MA_NUMERO_TABLAS'') IS NOT NULL
	DROP VIEW dbo.VW_MA_NUMERO_TABLAS
--
IF OBJECT_ID (''dbo.VW_MA_OPCIONES_CAMPOS'') IS NOT NULL
	DROP VIEW dbo.VW_MA_OPCIONES_CAMPOS
--
IF OBJECT_ID (''dbo.VW_MA_PODERES'') IS NOT NULL
	DROP VIEW dbo.VW_MA_PODERES
--
IF OBJECT_ID (''dbo.VW_MA_PROCESO_ALTAS_MASIVAS'') IS NOT NULL
	DROP VIEW dbo.VW_MA_PROCESO_ALTAS_MASIVAS
----
')
EXECUTE('
----
CREATE VIEW [dbo].[VW_MA_ACCIONES_X_CONVENIOS] 
AS
SELECT
	m.ConvenioPago,
	p.NomConvPago,
	m.TipoConvenio,
	t.DscTpoConv,
	m.Dominio,
	m.Subdominio,
	d.DESCRIPCION AS Descripcion_Dominio,
	OO.DESCRIPCION AS Origen,
	OA.DESCRIPCION AS Accion,
	pr.C6250 AS Producto,
	pr.C6251 AS Descripcion_Producto,
	m.Moneda,
	mo.C6400 AS Descripcion_Moneda,
	orc.DESCRIPCION AS Reutiliza_Cuenta,
	oar.DESCRIPCION AS Adhesion_Resumen,
	oee.DESCRIPCION AS Es_Empleado,
	m.Codigo_Afip,
	a.DESCRIPCION AS Descripcion_Cod_Afip,
	m.Cod_Profesion,
	ps.DESCRIPCION AS Descripcion_Profesion,
	om.DESCRIPCION AS Motivo_Vinc,
	m.Segmento,
	s.DESCRIPCION_SEGMENTO,
	m.Subsegmento,
	ss.DESCRIPCION_SUBSEGMENTO,
	m.Clase_TJD,
	c.Descripcion AS Descripcion_ClaseTJD,
	m.Tipo_TJD,
	TJD.DESCRIPCION AS Descripcion_TipoTJD,
	m.Producto_TJD
FROM MA_ACCIONES_X_CONVENIOS m WITH(nolock)
INNER JOIN CONV_CONVENIOS_PAG p WITH(nolock) ON
	p.ID_ConvPago = m.ConvenioPago
	AND p.Id_TpoConv=m.TipoConvenio
	AND p.TZ_LOCK=0
INNER JOIN CONV_TIPOS t WITH(nolock) ON
	t.Id_TpoConv = m.TipoConvenio
	AND p.TZ_LOCK=0
LEFT JOIN CONV_DOMINIOS d WITH(nolock) ON
	d.ID_CONVENIO=m.ConvenioPago
	AND d.ID_DOMINIO=M.Dominio
	AND d.SUB_DOMINIO=m.Subdominio
	AND d.TZ_LOCK=0
INNER JOIN OPCIONES AS OO WITH (nolock) ON
	OO.NUMERODECAMPO = 40080
	AND OO.IDIOMA = ''E''
	AND OO.OPCIONINTERNA = M.Origen
INNER JOIN OPCIONES AS OA WITH (nolock) ON
	OA.NUMERODECAMPO = 40081
	AND OA.IDIOMA = ''E''
	AND OA.OPCIONINTERNA = M.Accion
INNER JOIN PRODUCTOS pr WITH(nolock) ON
	pr.C6250 = m.Producto
	AND pr.TZ_LOCK=0
INNER JOIN MONEDAS mo WITH(nolock) ON
	mo.C6399 = m.Moneda
	AND mo.TZ_LOCK=0
INNER JOIN OPCIONES AS ORC WITH (nolock) ON
	ORC.NUMERODECAMPO = 40083
	AND ORC.IDIOMA = ''E''
	AND ORC.OPCIONINTERNA = M.Reutiliza_Cuenta
INNER JOIN OPCIONES AS OAR WITH (nolock) ON
	OAR.NUMERODECAMPO = 40084
	AND OAR.IDIOMA = ''E''
	AND OAR.OPCIONINTERNA = M.Adhesion_Resumen
INNER JOIN OPCIONES AS OEE WITH (nolock) ON
	OEE.NUMERODECAMPO = 40085
	AND OEE.IDIOMA = ''E''
	AND OEE.OPCIONINTERNA = M.Es_Empleado
INNER JOIN Cli_Cod_Act_Afip a WITH (nolock) ON
	a.CODIGO_ACT_AFIP=m.Codigo_Afip
	AND a.TZ_LOCK=0
INNER JOIN CLI_PROFESIONES ps WITH (nolock) ON
	ps.PROFESION=m.Cod_Profesion
	AND ps.TZ_LOCK=0
INNER JOIN OPCIONES AS OM WITH (nolock) ON
	OM.NUMERODECAMPO = 40089
	AND OM.IDIOMA = ''E''
	AND OM.OPCIONINTERNA = M.Motivo_Vinc
INNER JOIN cli_segmentos s WITH (nolock) ON
	s.COD_SEGMENTO =m.Segmento
	AND s.TZ_LOCK=0
INNER JOIN cli_subsegmentos ss WITH (nolock) ON
	ss.COD_SUBSEGMENTO =m.Subsegmento
	AND ss.TZ_LOCK=0
INNER JOIN TJD_CLASE  C WITH (nolock) ON
	c.Clave =m.Clase_TJD
	AND c.TZ_LOCK=0
INNER JOIN TJD_TIPO_TARJETA TJD WITH (nolock) ON
	TJD.TIPO_TARJETA=M.Tipo_TJD
	AND TJD.TZ_LOCK=0
WHERE 
	( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000)
		AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )
----
')
EXECUTE('
CREATE VIEW [dbo].[VW_MA_CLI_SALDOS] (
	NUMEROPERSONA,
	TIPODOC, 
	NUMERODOC, 
	NIVELAPERTURA_PER,
	CODIGOCLIENTE,
	NOMBRECLIENTE,
	SECTOR,
	SEGMENTOCLIENTE,
	SUBSEGMENTOCLIENTE,
	NIVELAPERTURA_CLI,
	ESTADO_PER,
	ESTADO_CLI,
	PRODUCTO,
	BLOQUEO_SAL,
	INMOV_SAL,
	CANCEL_SAL,
	SALDO_JTS_OID,
	MONEDA,
	CUENTA)
AS 
SELECT 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    U.NIVEL_APERTURA AS NIVELAPERTURA_PER,
    R.CODIGOCLIENTE, 
    R.NOMBRECLIENTE,
    R.SUBDIVISION1 AS SECTOR,
    R.SEGMENTOCLIENTE AS SEGMENTOCLIENTE,
    R.SUBSEGMENTOCLIENTE AS SUBSEGMENTOCLIENTE,
    R.NIVEL_APERTURA AS NIVELAPERTURA_CLI,
    U.ESTADO AS ESTADO_PER,
    R.ESTADO AS ESTADO_CLI,
    S.PRODUCTO AS PRODUCTO,
    s.C1679 AS BLOQUEO_SAL,
    S.C1728 AS INMOV_SAL,
    S.C1651 AS CANCEL_SAL,
    S.JTS_OID AS SALDO_JTS_OID,
    S.MONEDA AS MONEDA,
    S.CUENTA AS CUENTA
FROM CLI_CLIENTES  AS R WITH(NOLOCK) 
INNER JOIN CLI_CLIENTEPERSONA  AS T WITH(NOLOCK) ON
	R.CODIGOCLIENTE = T.CODIGOCLIENTE 
INNER JOIN CLI_PERSONASFISICAS  AS U WITH(NOLOCK) ON
	T.NUMEROPERSONA = U.NUMEROPERSONAFISICA 
INNER JOIN CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK) ON
	V.NUMEROPERSONAFJ = U.NUMEROPERSONAFISICA
INNER JOIN SALDOS AS s WITH(NOLOCK) ON
	s.C1803 = r.CODIGOCLIENTE
WHERE 
    R.CODIGOCLIENTE = T.CODIGOCLIENTE
    AND R.TIPO=''F''
    AND U.NUMEROPERSONAFISICA = T.NUMEROPERSONA
    AND U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
    AND T.titularidad=''T''
    AND (	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
		AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)
	) AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
		AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)
	) AND (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
		AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)
	) AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
		AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)
	) AND (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
		AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)
	)
----
')
EXECUTE('
CREATE VIEW [dbo].[VW_MA_CLIENTES] (
	NUMEROPERSONA,
	TIPODOC, 
	NUMERODOC, 
	FECHANACIMIENTO, 
	NOMBRE, 
	APELLIDO,
	NIVELAPERTURA_PER,
	CODIGOCLIENTE,
	TITULARIDAD, 
	NOMBRECLIENTE,
	SECTOR,
	SEGMENTOCLIENTE,
	SUBSEGMENTOCLIENTE,
	NIVELAPERTURA_CLI,
	ESTADO_PER,
	ESTADO_CLI)
AS 
SELECT 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    U.FECHANACIMIENTO AS FECHANACIMIENTO, 
    ISNULL(U.PRIMERNOMBRE, '''') + '' '' + ISNULL(U.APELLIDOPATERNO, '''')  AS NOMBRE, 
    ISNULL(U.APELLIDOPATERNO, '''') + '' '' + ISNULL(U.PRIMERNOMBRE, '''') AS APELLIDO,
    U.NIVEL_APERTURA AS NIVELAPERTURA_PER,
    R.CODIGOCLIENTE, 
    T.TITULARIDAD,
    R.NOMBRECLIENTE,
    R.SUBDIVISION1 AS SECTOR,
    R.SEGMENTOCLIENTE AS SEGMENTOCLIENTE,
    R.SUBSEGMENTOCLIENTE AS SUBSEGMENTOCLIENTE,
    R.NIVEL_APERTURA AS NIVELAPERTURA_CLI,
    U.ESTADO AS ESTADO_PER,
    R.ESTADO AS ESTADO_CLI
FROM CLI_CLIENTES AS R WITH(NOLOCK) 
INNER JOIN CLI_CLIENTEPERSONA AS T WITH(NOLOCK) ON
	R.CODIGOCLIENTE=T.CODIGOCLIENTE 
INNER JOIN CLI_PERSONASFISICAS AS U WITH(NOLOCK) ON
	T.NUMEROPERSONA=U.NUMEROPERSONAFISICA 
INNER JOIN CLI_DOCUMENTOSPFPJ AS V WITH(NOLOCK) ON
	V.NUMEROPERSONAFJ=U.NUMEROPERSONAFISICA
WHERE 
    R.CODIGOCLIENTE = T.CODIGOCLIENTE
    AND R.TIPO=''F''
    AND U.NUMEROPERSONAFISICA = T.NUMEROPERSONA
    AND U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
    AND T.titularidad=''T''
    AND (	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
		AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)
	) AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
		AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)
	) AND (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
		AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)
	) AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
		AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)
	)
----
')
EXECUTE('
CREATE  VIEW [dbo].[VW_MA_NUMERO_TABLAS] 
AS
SELECT 
	TITULO, 
	IDENTIFICACION, 
	NOMBREFISICO, 
	DESCRIPCION 
FROM DESCRIPTORES WITH(nolock)
WHERE 
	TITULO IN (10, 35, 24, 550)
----
')
EXECUTE('
CREATE VIEW [VW_MA_NOMBRE_CAMPOS] 
AS
SELECT 
	d.CAMPO, 
	d.DESCRIPCION, 
	d.NUMERODECAMPO, 
	d.TABLA,
	d.OPCIONES,
	d.TIPODECAMPO
FROM DICCIONARIO d WITH(nolock) 
INNER JOIN VW_MA_NUMERO_TABLAS n WITH(nolock) ON
	n.IDENTIFICACION = d.tabla
	AND n.IDENTIFICACION <> 0
----
')
EXECUTE('
CREATE VIEW [dbo].[VW_MA_OPCIONES_CAMPOS]
AS
SELECT 
	o.NUMERODECAMPO, 
	o.DESCRIPCION, 
	o.OPCIONINTERNA
FROM OPCIONES o WITH(nolock)
INNER JOIN VW_MA_NOMBRE_CAMPOS v WITH(nolock) ON
	v.NUMERODECAMPO=o.NUMERODECAMPO
	AND v.OPCIONES=1
WHERE 
	o.IDIOMA =''E''
----
')
EXECUTE('
CREATE VIEW [dbo].[VW_MA_PODERES] (
		TIPO_ENTIDAD,
		DESC_ENTIDAD,
		CODAPODERAMIENTO,
		DESC_APODERAMIENTO,
		CODPODER,
		DESC_PODER,
		TIENE_FORMULAS,
		TIENE_MONTOS,
		PRODUCTO,
		TITULAR_APODERADO,
		TIPO_CLIENTE
		)
AS
SELECT DISTINCT
	p.TIPO_ENTIDAD,
	te.DESCRIPCION AS DESC_ENTIDAD,
	a.CODAPODERAMIENTO,
	tp.DESCRIPCION AS DESC_APODERAMIENTO,
	a.CODPODER,
	pp.DESCRIPCION AS DESC_PODER,
	pp.TIENE_FORMULAS,
	pp.TIENE_MONTOS,
	pr.PRODUCTO,
	pr.TITULAR_APODERADO,
	pr.TIPO_CLIENTE
FROM PYF_APODERAMIENTO a WITH(NOLOCK) 
INNER JOIN PYF_TIPOPODER_X_TIPOENTIDAD p WITH(NOLOCK) ON
	p.TIPO_PODER=a.CODPODER 
INNER JOIN PYF_TIPOAPODERAMIENTO tp WITH(NOLOCK) ON
	tp.CODAPODERAMIENTO=a.CODAPODERAMIENTO
	AND tp.TZ_LOCK=0
INNER JOIN PYF_TIPOPODERES pp WITH(NOLOCK) ON
	pp.TIPO_PODER=a.CODPODER
	AND pp.TZ_LOCK=0
INNER JOIN PYF_TIPOENTIDAD te WITH(NOLOCK) ON
	te.TIPO_ENTIDAD=p.TIPO_ENTIDAD
	AND te.TZ_LOCK=0
INNER JOIN PROD_RELCLIENTE pr WITH(NOLOCK) ON
	pr.APODERAMIENTO=a.CODAPODERAMIENTO
	AND pr.TZ_LOCK=0
WHERE
	(A.TZ_LOCK < 100000000000000 OR A.TZ_LOCK >= 200000000000000)
		AND (A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000)  
	AND (P.TZ_LOCK < 100000000000000 OR P.TZ_LOCK >= 200000000000000)
		AND (P.TZ_LOCK < 300000000000000 OR P.TZ_LOCK >= 400000000000000)
	AND (TP.TZ_LOCK < 100000000000000 OR TP.TZ_LOCK >= 200000000000000)
	   	AND (TP.TZ_LOCK < 300000000000000 OR TP.TZ_LOCK >= 400000000000000)
	AND (PP.TZ_LOCK < 100000000000000 OR PP.TZ_LOCK >= 200000000000000)
	   	AND (PP.TZ_LOCK < 300000000000000 OR PP.TZ_LOCK >= 400000000000000)
	AND (TE.TZ_LOCK < 100000000000000 OR TE.TZ_LOCK >= 200000000000000)
	   	AND (TE.TZ_LOCK < 300000000000000 OR TE.TZ_LOCK >= 400000000000000)
	AND (PR.TZ_LOCK < 100000000000000 OR PR.TZ_LOCK >= 200000000000000)
		AND (PR.TZ_LOCK < 300000000000000 OR PR.TZ_LOCK >= 400000000000000)
----
')
EXECUTE('
CREATE VIEW VW_MA_PROCESO_ALTAS_MASIVAS
AS
SELECT 
	B.Nro_Lote,
    CAST(COUNT(*) AS NUMERIC(12)) AS Cantidad_Registros      
FROM MA_BANDEJA_ENTRADA B
WHERE 
	B.Estado=''I''
	AND (B.tz_lock < 300000000000000 OR B.tz_lock >= 400000000000000) 
	AND (B.tz_lock < 100000000000000 OR B.tz_lock >= 200000000000000)  
GROUP BY Nro_Lote;
----
')