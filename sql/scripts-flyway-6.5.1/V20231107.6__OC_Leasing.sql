EXECUTE('
INSERT INTO dbo.OPERACIONES (TITULO, IDENTIFICACION, NOMBRE, DESCRIPCION, MNEMOTECNICO, AUTORIZACION, FORMULARIOPRINCIPAL, PROXOPERACION, ESTADO, TZ_LOCK, COPIAS, SUBOPERACION, PERMITEBAJA, COMPORTAMIENTOENCIERRE, REQUIERECONTRASENA, PERMITECONCURRENTE, PERMITEESTADODIFERIDO, ICONO_TITULO, ESTILO)
VALUES (6810, 6126, ''Ejecucion de Opcion de Compra (Contingencia)'', ''Ejecucion de Opcion de Compra (Contingencia)'', ''6126'', ''N'', 500, NULL, ''P'', 0, NULL, 0, ''S'', ''N'', ''N'', ''S'', ''S'', NULL, 0)

INSERT INTO dbo.CODIGO_TRANSACCIONES (CODIGO_OPERACION, CODIGO_INTERNO_MOV, CODIGO_TRANSACCION, TZ_LOCK)
VALUES (6126, 1, 3004, 0)

INSERT INTO dbo.AYUDAS (NUMERODEARCHIVO, NUMERODEAYUDA, DESCRIPCION, FILTRO, MOSTRARTODOS, CAMPOS, CAMPOSVISTA, BASEVISTA, NOMBREVISTA, AYUDAGRANDE)
VALUES (0, 9338, ''Ayuda OC Leasing'', '''', 0, ''1057R;804;38;42;48I;'', ''Número de Contrato;Moneda;Opción a Compra;Vto Opción a Compra;Cliente;'', ''top/clientes'', ''VW_SOL_CRED_OC_LEASING'', 0)

INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (44060, NULL, 0, ''Ayuda OC Leasing'', ''Ayuda'', 12, ''N'', 0, NULL, 0, 0, 0, 0, 0, 9338, 0, 0, ''C44060'', 0, NULL)
')

EXECUTE('
IF OBJECT_ID (''dbo.VW_SOL_CRED_OC_LEASING'') IS NOT NULL
	DROP VIEW dbo.VW_SOL_CRED_OC_LEASING
')

EXECUTE('
CREATE     VIEW [dbo].[VW_SOL_CRED_OC_LEASING] (
												   "Número de Contrato",   
												   Moneda,
												   "Opción a Compra",
												   "Vto Opción a Compra",
												   Cliente)
AS 

SELECT TOP 9223372036854775807 WITH TIES 
      B.NUMERO_BIEN AS "Número de Contrato",         
      MON.C6401 AS Moneda,
      b.OPCION_COMPRA AS "Opción a Compra",
      concat(
      CASE WHEN s.C1773<10 THEN concat(''0'',convert(varchar(20),S.C1773))
      	   ELSE convert(VARCHAR(2),s.C1773) END,''/'',
      CASE WHEN (month(DATEADD(month, 1, S.C1627)))<10 THEN concat(0,month(DATEADD(month, 1, S.C1627))) 
       	   ELSE (convert(VARCHAR(2),month(DATEADD(month, 1, S.C1627)))) 
      END, ''/'',
      year(convert(varchar(20), DATEADD(month, 1, S.C1627), 23))
      ) AS "Vto Opción a Compra",
	  S.C1803 AS Cliente
FROM SALDOS  AS S	WITH(NOLOCK)
INNER JOIN CRE_BIENES_LEASING B ON S.JTS_OID=B.SALDOS_JTS_OID
INNER JOIN CLI_CLIENTES  AS C	WITH(NOLOCK)ON S.C1803 = C.CODIGOCLIENTE
												AND c.TZ_LOCK = 0
												AND S.TZ_LOCK = 0
INNER JOIN VW_CLI_X_DOC DOC ON DOC.CODIGOCLIENTE=S.C1803												
INNER JOIN MONEDAS AS MON	WITH(NOLOCK)ON s.MONEDA = MON.C6399 AND MON.TZ_LOCK = 0 
INNER JOIN PRODUCTOS AS P WITH(NOLOCK) ON p.C6250=S.PRODUCTO AND P.C6800=''L'' AND P.TZ_LOCK=0									
WHERE S.TZ_LOCK=0 AND B.NUMERO_BIEN NOT IN (SELECT NUMERO_BIEN FROM CRE_SOLICITUDCREDITO WHERE NUMERO_BIEN IS NOT NULL AND TZ_LOCK=0)
ORDER BY B.NUMERO_BIEN DESC
')

