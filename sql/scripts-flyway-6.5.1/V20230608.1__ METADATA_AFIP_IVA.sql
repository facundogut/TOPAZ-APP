Execute('
DROP TABLE IF EXISTS ITF_AFIP_IVA_RG18
')
Execute('
CREATE TABLE dbo.ITF_AFIP_IVA_RG18
	(
	ID                     INT IDENTITY NOT NULL,
	CUIT                   NUMERIC (11) NOT NULL,
	RAZON_SOCIAL           VARCHAR (80),
	PERIODO_DESDE          DATETIME,
	PERIODO_HASTA          DATETIME,
	INCISO_RESOLUCION_GRAL VARCHAR (10),
	CONSTRAINT PK_AFIP_IVA PRIMARY KEY (ID)
	)
')

Execute('
DROP TABLE IF EXISTS ITF_AFIP_RG18_INCONSISTENCIAS 
')

Execute('
CREATE TABLE dbo.ITF_AFIP_RG18_INCONSISTENCIAS
	(
	ID               INT IDENTITY NOT NULL,
	COD_CLIENTE      NUMERIC (11),
	NRO_PERSONA      NUMERIC (11),
	CUIT             NUMERIC (11) NOT NULL,
	RAZON_SOCIAL     VARCHAR (80),
	CONDICION_IVA    VARCHAR (2),
	TIPO_CERTIFICADO VARCHAR (5),
	PORCENTAJE       INT,
	FECHA_DESDE      DATETIME,
	FECHA_HASTA      DATETIME,
	CONSTRAINT PK_AFIP_INCONSIS PRIMARY KEY (ID)
	)
')

Execute('
DROP TABLE IF EXISTS ITF_LOG_CARGOS_IMPUESTOS
')

Execute('
CREATE TABLE dbo.ITF_LOG_CARGOS_IMPUESTOS
	(
	ID              INT IDENTITY NOT NULL,
	COD_IMPUESTO    VARCHAR (2),
	PERIODO_DESDE   VARCHAR (8),
	PERIODO_HASTA   VARCHAR (8),
	COD_CLIENTE     NUMERIC (12),
	ID_PERSONA      NUMERIC (12),
	FECHA_PROCESO   VARCHAR (8),
	FECHA_EJECUCION VARCHAR (8),
	CONDICION       VARCHAR (2),
	ALICUOTA        NUMERIC (11, 7),
	CONSTRAINT PK_LOG_CARG_IMP PRIMARY KEY (ID)
	)
')

Execute('
DROP VIEW IF EXISTS VW_CARGOS_IMPUESTOS
')

Execute('
CREATE VIEW dbo.[VW_CARGOS_IMPUESTOS]
AS
SELECT 
TIPOCARGO,
cct.SEGMENTO,
ID_CARGO,
DESCRIPCION,
TASA,
MONEDA 
FROM CI_CARGOS_TARIFAS CCT
JOIN 
	(
	  SELECT Id_cargo AS idCargo, DESCRIPCION,TIPO_CARGO_IMPOSITIVO AS TipoCargo,MONEDA_IMPORTE
	  FROM CI_CARGOS
	  WHERE TIPO_CARGO_IMPOSITIVO IN (2,3)
	  	UNION
	  SELECT ID_IMPUESTO AS idCargo, DESCRIPCION,TIPO_IMPUESTO AS TipoCargo,MONEDA_IMPORTE
	  FROM CI_IMPUESTOS
	  WHERE TIPO_IMPUESTO IN (2,3)
	) AS CargoImpuesto
ON CCT.Id_Cargo = CargoImpuesto.idCargo
WHERE (TipoCargo = 2 AND SEGMENTO = ''AC'' OR TipoCargo = 3 AND SEGMENTO = ''0'') AND id_cliente = 0 AND TZ_LOCK = 0
')

Execute('
DELETE FROM ITF_MASTER WHERE ID = 130;
')

Execute('
INSERT INTO dbo.ITF_MASTER (TZ_LOCK, ID, DESCRIPCION, OBJ_KETTLE, P0_MODO, P0_TIPO, P0_CAPTION, P0_CONSTANTE, P1_MODO, P1_TIPO, P1_CAPTION, P1_CONSTANTE, P2_MODO, P2_TIPO, P2_CAPTION, P2_CONSTANTE, P3_MODO, P3_TIPO, P3_CAPTION, P3_CONSTANTE, P4_MODO, P4_TIPO, P4_CAPTION, P4_CONSTANTE, P5_MODO, P5_TIPO, P5_CAPTION, P5_CONSTANTE, P6_MODO, P6_TIPO, P6_CAPTION, P6_CONSTANTE, P7_MODO, P7_TIPO, P7_CAPTION, P7_CONSTANTE, P8_MODO, P8_TIPO, P8_CONSTANTE, P8_CAPTION, P9_MODO, P9_TIPO, P9_CAPTION, P9_CONSTANTE, TIPO_OBJ, COMENTARIO, ID_REPORTE, MODO_EJECUCION)
VALUES (0, 130, ''AFIP IVA RG18 Padron 2.1.7'', ''ITF_AFIP_IVARG18.kjb'', '''', '''', '''', '' '', '''', '''', '''', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', '' '', ''J'', '' '', 0, ''M'')
')
