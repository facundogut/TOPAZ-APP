EXECUTE('DROP PROCEDURE IF EXISTS dbo.SP_NOSIS_CALCULOCDA;')
EXECUTE('CREATE PROCEDURE dbo.SP_NOSIS_CALCULOCDA
/*

Desarrollador: Luis Etchebarne

Descripci√≥n: Este SP tiene la finalidad de ingresar los datos del CalculoCDA obtenidos desde el ws de NOSIS

*/

@SCO_CLAVE VARCHAR(20),
@SCO_DETALLE   VARCHAR(50),
@SCO_NRO   NUMERIC(3),
@SCO_DESCRIPCION   VARCHAR(50),
@SCO_VALOR   VARCHAR(2),

@NSE_CLAVE VARCHAR(20),
@NSE_DETALLE   VARCHAR(50),
@NSE_NRO   NUMERIC(3),
@NSE_DESCRIPCION   VARCHAR(50),
@NSE_VALOR   VARCHAR(2),

@AF_CLAVE VARCHAR(20),
@AF_DETALLE   VARCHAR(50),
@AF_NRO   NUMERIC(3),
@AF_DESCRIPCION   VARCHAR(50),
@AF_VALOR   VARCHAR(2),

@CUIT   VARCHAR(11),
@FECHA_PROCESO   DATETIME

AS
BEGIN
	-- Manejo del ordinal de la tabla.
	DECLARE @cont INT;
	SET @cont = 1;
	
	-- Se limpian las tablas de nosis.
	DELETE FROM SL_NOSIS_CALCULOCDA WHERE CUIT = @CUIT AND FECHA_PROCESO = @FECHA_PROCESO;
	DELETE FROM SL_NOSIS_ULTIMOINFORME WHERE CUIT = @CUIT AND FECHA_PROCESO = @FECHA_PROCESO;
	
	IF @SCO_CLAVE <> ''''
    BEGIN
    	
		INSERT INTO dbo.SL_NOSIS_CALCULOCDA (CLAVE, DETALLE, NRO, DESCRIPCION, VALOR, TIPO, CUIT, FECHA_PROCESO, ORDINAL) VALUES (@SCO_CLAVE, @SCO_DETALLE, @SCO_NRO, @SCO_DESCRIPCION, @SCO_VALOR, 1, @CUIT, @FECHA_PROCESO, @cont);
		SET @cont = @cont + 1;
				
	END
    	
    IF @NSE_CLAVE <> ''''
    BEGIN
    
    	INSERT INTO dbo.SL_NOSIS_CALCULOCDA (CLAVE, DETALLE, NRO, DESCRIPCION, VALOR, TIPO, CUIT, FECHA_PROCESO, ORDINAL) VALUES (@NSE_CLAVE, @NSE_DETALLE, @NSE_NRO, @NSE_DESCRIPCION, @NSE_VALOR, 2, @CUIT, @FECHA_PROCESO, @cont);
		SET @cont = @cont + 1;
		
    END
    
    IF @AF_CLAVE <> ''''
    BEGIN
		
    	INSERT INTO dbo.SL_NOSIS_CALCULOCDA (CLAVE, DETALLE, NRO, DESCRIPCION, VALOR, TIPO, CUIT, FECHA_PROCESO, ORDINAL) VALUES (@AF_CLAVE, @AF_DETALLE, @AF_NRO, @AF_DESCRIPCION, @AF_VALOR, 3, @CUIT, @FECHA_PROCESO, @cont);
		SET @cont = @cont + 1;
		
    END   
END;')


