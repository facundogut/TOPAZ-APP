EXECUTE('
ALTER TABLE COF_COFRES_EVENTOS ADD IVA_MORA NUMERIC(15, 2)
')

EXECUTE('
------------------------------------------
--VISTA DE EVENTOS DE CAJAS DE SEGURIDAD--
------------------------------------------
CREATE VIEW VW_COF_EVENTOS(
						NUMERO_EVENTO,
						TIPO_EVENTO,
						FECHA_EVENTO,
						CODIGO_CONTRATO,
						ESTADO,
						FECHA_PAGO,
						IMPORTE,
						MORA,
						IMPUESTOS,
						IMPORTE_TOTAL) AS
SELECT
	C.NUMERO_EVENTO,
	OT.DESCRIPCION,
	C.FECHA_EVENTO,
	C.CODIGO_CONTRATO,
	OE.DESCRIPCION,
	C.FECHA_PAGO,
	isnull(C.IMPORTE,0) AS IMPORTE,
	isnull(C.MORA,0) AS MORA,
	(isnull(C.IVA,0) + isnull(C.IVA_MORA,0)) AS IMPUESTOS,
	(isnull(C.IMPORTE,0) + isnull(C.MORA,0) + isnull(C.IVA,0)) AS TOTAL
FROM 
	COF_COFRES_EVENTOS AS C WITH (nolock)
LEFT JOIN OPCIONES AS OT WITH (nolock) ON
	OT.NUMERODECAMPO = 8072
	AND OT.IDIOMA = ''E''
	AND OT.OPCIONINTERNA = C.TIPO_EVENTO
LEFT JOIN OPCIONES AS OE WITH (nolock) ON
	OE.NUMERODECAMPO = 8987
	AND OE.IDIOMA = ''E''
	AND OE.OPCIONINTERNA = C.ESTADO
WHERE 	
	C.TZ_LOCK = 0
	AND C.TIPO_EVENTO IN (''N'', ''B'', ''R'')	
----
')