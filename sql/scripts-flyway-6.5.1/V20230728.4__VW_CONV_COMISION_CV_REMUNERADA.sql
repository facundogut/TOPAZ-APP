
EXECUTE('
IF OBJECT_ID (''dbo.VW_CONV_COMISION_CV_REMUNERADA'') IS NOT NULL
	DROP VIEW dbo.VW_CONV_COMISION_CV_REMUNERADA
')

EXECUTE('
CREATE VIEW VW_CONV_COMISION_CV_REMUNERADA (
		JTS_OID_SALDOS,
		SALDO_ACTUAL,
		SUCURSAL,
		PRODUCTO,
		CUENTA,
		MONEDA,
		OPERACION,
		ORDINAL,
		GRUPO)
AS
    SELECT DISTINCT * FROM
( 
	SELECT distinct
		S.JTS_OID AS JTS_OID_SALDOS,
		S.C1604 AS SALDO_ACTUAL,
		S.SUCURSAL,
		S.PRODUCTO,
		S.CUENTA,
		S.MONEDA,
		S.OPERACION,
		S.ORDINAL,
		S.C1772 AS GRUPO		
	FROM CONV_CONVENIOS_REC AS C WITH (nolock) 
	INNER JOIN SALDOS AS S WITH (nolock) ON
		C.CuentaCom = S.JTS_OID
		AND C.TZ_LOCK = 0
	INNER JOIN CLI_CLIENTES AS L WITH (nolock) ON
		S.C1803 = L.CODIGOCLIENTE
		AND L.TZ_LOCK = 0
	WHERE
		C.TZ_LOCK = 0
		AND c.Estado =''A''
	   	AND (SELECT FECHAPROCESO FROM PARAMETROS) = 
	   	   	(SELECT dbo.ULTIMODIAHABIL((SELECT FECHAPROCESO FROM PARAMETROS)))
	
	UNION ALL
	
	SELECT distinct
		S.JTS_OID AS JTS_OID_SALDOS,
		s.C1604 SALDO_ACTUAL,
		S.SUCURSAL,
		S.PRODUCTO,
		S.CUENTA,
		S.MONEDA,
		S.OPERACION,
		S.ORDINAL,
		S.C1772 AS GRUPO		 
	FROM CONV_CONVENIOS_PAG AS C WITH (nolock)
	INNER JOIN SALDOS AS S WITH (nolock) ON
		C.CuentaDeb = S.JTS_OID
		AND C.TZ_LOCK = 0
	INNER JOIN CLI_CLIENTES AS L WITH (nolock) ON
		S.C1803 = L.CODIGOCLIENTE
		AND L.TZ_LOCK = 0
	WHERE
		C.TZ_LOCK = 0
		AND c.Estado =''A''
	   	AND (SELECT FECHAPROCESO FROM PARAMETROS) = 
		  	(SELECT dbo.ULTIMODIAHABIL((SELECT FECHAPROCESO FROM PARAMETROS)))
		  )X 
')
