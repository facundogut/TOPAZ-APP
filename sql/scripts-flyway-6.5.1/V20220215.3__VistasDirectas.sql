execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ESQUEMAS_CONTABLES_CARGOS'')
	DROP view [dbo].[VW_ESQUEMAS_CONTABLES_CARGOS]; ')
execute(' CREATE  or alter   VIEW [dbo].[VW_ESQUEMAS_CONTABLES_CARGOS] (
																CAMPO, 
																DESCRIPCION, 
																MONEDA, 
																RUBROENTRADA, 
																RUBROSALIDA, 
																PORDEBITO, 
																PORCREDITO, 
																TRANSACCION)
AS 
SELECT 
    ESQUEMACONTABLE.CAMPO, 
    ESQUEMACONTABLE.DESCRIPCION, 
    ESQUEMACONTABLE.MONEDA, 
    ESQUEMACONTABLE.RUBRO AS RUBROENTRADA, 
    ESQUEMACONTABLE.RUBROSALIDA, 
    ESQUEMACONTABLE.D_DC AS PORDEBITO, 
    ESQUEMACONTABLE.C_DC AS PORCREDITO, 
    ESQUEMACONTABLE.TRANSACCION
FROM dbo.ESQUEMACONTABLE WITH (NOLOCK)
WHERE 
    ESQUEMACONTABLE.PROCESO = 0  
    AND ESQUEMACONTABLE.CAMPO <> 0  
    AND ESQUEMACONTABLE.LINEA <> 0  
    AND ESQUEMACONTABLE.CAMPO NOT IN ( 	29, 
										30, 
										200, 
										201, 
										202, 
										203 ); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_FACTURALINEA'')
	DROP view [dbo].[VW_FACTURALINEA]; ')
execute(' CREATE or alter VIEW [dbo].[VW_FACTURALINEA] (
											   SUCURSAL_ASIENTO, 
											   ASIENTO, 
											   FECHA_PROCESO_ASIENTO, 
											   ORDINAL_MOVIMIENTO, 
											   TR_VIRTUAL, 
											   TR_REAL, 
											   TR_TIPO, 
											   ID_CARGO, 
											   ID_IMPUESTO, 
											   CONCEPTO_COBRO, 
											   MONTO_FACTURABLE)
AS 
SELECT 
    CI_FACTURA_LINEA.SUCURSAL_ASIENTO, 
    CI_FACTURA_LINEA.ASIENTO, 
    CI_FACTURA_LINEA.FECHA_PROCESO_ASIENTO, 
    CI_FACTURA_LINEA.ORDINAL_MOVIMIENTO, 
    CI_FACTURA_LINEA.TR_VIRTUAL, 
    CI_FACTURA_LINEA.TR_REAL, 
    CI_FACTURA_LINEA.TR_TIPO, 
    CI_FACTURA_LINEA.ID_CARGO, 
    CI_FACTURA_LINEA.ID_IMPUESTO, 
    CI_FACTURA_LINEA.CONCEPTO_COBRO, 
    sum(CI_FACTURA_LINEA.MONTO_FACTURABLE) AS MONTO_FACTURABLE
FROM dbo.CI_FACTURA_LINEA WITH (NOLOCK)
WHERE	(CI_FACTURA_LINEA.TZ_LOCK < 300000000000000 OR CI_FACTURA_LINEA.TZ_LOCK >= 400000000000000)
	AND (CI_FACTURA_LINEA.TZ_LOCK < 100000000000000 OR CI_FACTURA_LINEA.TZ_LOCK >= 200000000000000)
GROUP BY 
    CI_FACTURA_LINEA.SUCURSAL_ASIENTO, 
    CI_FACTURA_LINEA.ASIENTO, 
    CI_FACTURA_LINEA.FECHA_PROCESO_ASIENTO, 
    CI_FACTURA_LINEA.ORDINAL_MOVIMIENTO, 
    CI_FACTURA_LINEA.TR_VIRTUAL, 
    CI_FACTURA_LINEA.TR_REAL, 
    CI_FACTURA_LINEA.TR_TIPO, 
    CI_FACTURA_LINEA.ID_CARGO, 
    CI_FACTURA_LINEA.ID_IMPUESTO, 
    CI_FACTURA_LINEA.CONCEPTO_COBRO; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''REM_SUCURYTRANSP'')
	DROP view [dbo].[REM_SUCURYTRANSP]; ')
execute(' CREATE or alter VIEW [dbo].[REM_SUCURYTRANSP]
AS 

SELECT	nro_cliente AS Número, 
		nombre_cli AS Nombre , 
		''T'' AS Tipo 
FROM REM_TRANSPORTADORAS WITH (NOLOCK)
 WHERE TZ_LOCK < 31000000000000
UNION
SELECT	sucursal AS Número, 
		nombresucursal AS Nombre, 
		''S'' AS Tipo 
FROM SUCURSALES WITH (NOLOCK)
WHERE TZ_LOCK < 31000000000000; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_GRP_ECONO_CLIENTE'')
	DROP view [dbo].[VW_GRP_ECONO_CLIENTE]; ')
execute(' CREATE or alter VIEW [dbo].[VW_GRP_ECONO_CLIENTE] (CODIGOGRUPOECONOMICO, 
													NOMBRE, 
													CODIGOCLIENTE)
AS 
SELECT TOP 9223372036854775807 WITH TIES GEC.CODIGOGRUPOECONOMICO, 
		GRP.NOMBRE, 
		GEC.CODIGOCLIENTE
FROM dbo.CLI_GRUPOSECONOMICOSCLIENTE  AS GEC WITH(NOLOCK) 
INNER JOIN dbo.CLI_GRUPOSECONOMICOS  AS GRP  WITH(NOLOCK)ON  GEC.CODIGOGRUPOECONOMICO = GRP.CODIGOGRUPOECONOMICO AND
    (		(GEC.TZ_LOCK < 300000000000000 OR GEC.TZ_LOCK >= 400000000000000) 
		AND (GEC.TZ_LOCK < 100000000000000 OR GEC.TZ_LOCK >= 200000000000000)) AND 
    (		(GRP.TZ_LOCK < 300000000000000 OR GRP.TZ_LOCK >= 400000000000000) 
		AND (GRP.TZ_LOCK < 100000000000000 OR GRP.TZ_LOCK >= 200000000000000))  
    
ORDER BY GEC.CODIGOGRUPOECONOMICO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_GRUPO_ECONOMICO_CLIENTE'')
	DROP view [dbo].[VW_GRUPO_ECONOMICO_CLIENTE]; ')
execute(' CREATE or alter VIEW [dbo].[VW_GRUPO_ECONOMICO_CLIENTE] (
														   CÓDIGOGRUPOECONÓMICO, 
														   NOMBRE, 
														   CÓDIGOCLIENTE, 
														   NOMBRECLIENTE, 
														   CALIFICACIÓNGRUPO, 
														   ACTIVIDAD)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
    V.CODIGOGRUPOECONOMICO AS CÓDIGOGRUPOECONÓMICO, 
    V.NOMBRE, 
    U.CODIGOCLIENTE AS CÓDIGOCLIENTE, 
    U.NOMBRECLIENTE, 
    W.CALIFICACIONGRUPO AS CALIFICACIÓNGRUPO, 
    W.ACTIVIDAD
FROM dbo.CLI_CLIENTES  AS U WITH(NOLOCK)
INNER JOIN dbo.CLI_GRUPOSECONOMICOSCLIENTE  AS W WITH(NOLOCK)ON U.CODIGOCLIENTE = W.CODIGOCLIENTE
																AND U.TZ_LOCK =0
INNER JOIN dbo.CLI_GRUPOSECONOMICOS  AS V WITH(NOLOCK) ON V.CODIGOGRUPOECONOMICO = W.CODIGOGRUPOECONOMICO
														AND V.TZ_LOCK =0
WHERE W.TZ_LOCK = 0
ORDER BY CÓDIGOGRUPOECONÓMICO; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_GRUPO_USUARIOS'')
	DROP view [dbo].[VW_GRUPO_USUARIOS]; ')
execute(' CREATE or alter VIEW [dbo].[VW_GRUPO_USUARIOS] (USUARIO, GRUPO)
AS 
   SELECT	USUARIOS.INICIALES AS USUARIO, 
			USUARIOS.GRUPO
   FROM dbo.USUARIOS WITH (NOLOCK);')
execute(' IF  EXISTS (select * from sys.views where  name = ''BALANCETXT'')
	DROP view [dbo].[BALANCETXT]; ')
execute(' CREATE OR ALTER     VIEW [dbo].[BALANCETXT] 
AS 

SELECT (round(sum(saldo_ajustado/1000),2,0)) AS saldoajustado, 
		RUBROCONTABLE 
FROM GRL_SALDOS_DIARIOS WITH (NOLOCK)
GROUP BY RUBROCONTABLE ; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_GTIA_CLIENTE'')
	DROP view [dbo].[VW_GTIA_CLIENTE]; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_GTIA_CLIENTE] (
											   COD_CLIENTE, 
											   NUM_GARANTIA, 
											   CARACTER_GARANTIA, 
											   PAIS_GARANTIA, 
											   SUBTIPOGARANTIA, 
											   TIPOGARANTIA, 
											   COD_SUBCLAGARANTIA)
AS 
SELECT 
    GC.COD_CLIENTE, 
    GR.NUM_GARANTIA, 
    GR.CARACTER_GARANTIA, 
    GR.PAIS_GARANTIA, 
    GR.SUBTIPOGARANTIA, 
    GR.TIPOGARANTIA, 
    GR.COD_SUBCLAGARANTIA
FROM dbo.CRE_GARANTIASRECIBIDAS  AS GR WITH (NOLOCK) 
INNER JOIN dbo.CRE_GARANTIACLIENTES  AS GC WITH (NOLOCK) ON GR.NUM_GARANTIA = GC.NUM_GARANTIA
											AND GR.ESTADO_GARANTIA = ''AA''
AND 
    (	(GR.TZ_LOCK < 300000000000000 OR GR.TZ_LOCK >= 400000000000000) 
	AND (GR.TZ_LOCK < 100000000000000 OR GR.TZ_LOCK >= 200000000000000)) 
AND 
    (	(GC.TZ_LOCK < 300000000000000 OR GC.TZ_LOCK >= 400000000000000) 
	AND (GC.TZ_LOCK < 100000000000000 OR GC.TZ_LOCK >= 200000000000000)); ') 
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CUENTAS'')
	DROP view [dbo].[VW_CUENTAS]; ')
execute(' CREATE OR ALTER VIEW [dbo].[VW_CUENTAS](
											CUENTA,
											NOMBRE,
											PRODUCTO,
											DESCRIPCION,
											MONEDA,
											DESCRIPCION_MONEDA,
											SUCURSAL,
											ORDINAL,
											OPERACION,
											CLIENTE,
											TIPO_DOCUMENTO,
											DOCUMENTO,
											TIPOPROD,
											BLOQUEO,
											C1728,
											TIPO_SALDO_FONDO,
											RUBRO,
											C1651,
											SALDO_ACTUAL,
											C1601,
											JTS_OID,
											VISUALIZABLE,
											NOMBRE_RUBRO
) AS 
SELECT	S.CUENTA, 
		VS.NOMBRE_CUENTA, 
		S.PRODUCTO, 
		P.C6251, 
		S.MONEDA,
		M.C6400,
		S.SUCURSAL, 
		S.ORDINAL, 
		S.OPERACION, 
		S.C1803, 
		D.TIPODOC, 
		D.NUMERODOC , 
		S.C1785, 
   		CASE WHEN S.C1679=''1'' THEN ''Si'' ELSE ''No'' END AS BLOQUEO, 
		S.C1728, 
		S.TIPO_SALDO_FONDO, 
		S.C1730, 
		S.C1651, 
		(S.C1604 + S.C1605 + S.C1683),
		S.C1601, 
		S.JTS_OID, 
		S.C1694, 
		PL.C6300
FROM SALDOS AS S with (nolock)
INNER JOIN VTA_SALDOS AS VS with (nolock) ON 
	S.JTS_OID = VS.JTS_OID_SALDO
	AND VS.TZ_LOCK = 0
INNER JOIN PRODUCTOS AS P with (nolock) ON 
	S.PRODUCTO = P.C6250 
	AND S.C1785 = P.C6252
	AND P.TZ_LOCK = 0 
INNER JOIN VW_CLI_X_DOC AS D with (nolock) ON 
	S.C1803 = D.[CODIGOCLIENTE] 
INNER JOIN PLANCTAS PL with (nolock) ON 
	S.C1730 = PL.C6301
	AND PL.TZ_LOCK = 0
INNER JOIN MONEDAS M with (nolock) ON 
	S.MONEDA = M.C6399
	AND M.TZ_LOCK = 0
WHERE 
	S.TZ_LOCK = 0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SOLICITUD_BAJA_ASIENTO'')
	DROP view [dbo].[VW_SOLICITUD_BAJA_ASIENTO]; ')
execute(' CREATE OR ALTER    VIEW [dbo].[VW_SOLICITUD_BAJA_ASIENTO] 
AS

SELECT 
	s.ASIENTO AS ''Asiento'',
	a.DESCRIPCION AS ''Descripción Asiento'',
	s.SUCURSAL AS ''Sucursal'',
	s.FECHAPROCESO AS ''Fecha'',
	a.OPERACION AS ''Operación'',
	o.NOMBRE AS ''Nombre Operación'',
	s.ESTADO AS ''Estado'',
	s.USUARIO AS ''Usuario''
FROM CAJ_SOLICITUD_BAJA_ASIENTO s WITH(NOLOCK)
LEFT JOIN ASIENTOS a  WITH(NOLOCK)ON s.ASIENTO=a.ASIENTO 
								AND s.SUCURSAL=a.SUCURSAL 
								AND s.FECHAPROCESO=a.FECHAPROCESO
LEFT JOIN OPERACIONES o  WITH(NOLOCK)ON a.OPERACION=o.IDENTIFICACION
WHERE (	(s.TZ_LOCK < 300000000000000 OR s.TZ_LOCK >= 400000000000000) 
	AND (s.TZ_LOCK < 100000000000000 OR s.TZ_LOCK >= 200000000000000));')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_INFO_FINAN_IMP_MENORES'')
	DROP view [dbo].[VW_INFO_FINAN_IMP_MENORES]; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_INFO_FINAN_IMP_MENORES] (
								   PERSONA_JURIDICA, 
								   NRODOCUMENTO, 
								   TIPODOCUMENTO, 
								   FECHA, 
								   INFO_FINANCIERA, 
								   TIPO_EMPRESA, 
								   FECHA_BALANCE, 
								   MONEDA, 
								   AJUSTADO_INFLACION, 
								   ACTIVO, 
								   ACTIVO_CORRIENTE, 
								   ACT_DISPONIBILIDAD, 
								   ACT_INVERSIONES, 
								   ACT_CREDITOS_VENTAS, 
								   ACT_OTROS_CREDITOS, 
								   ACT_CRED_DIR_SOCIOS, 
								   ACT_OTROS_CRED_IVA_RETEN, 
								   ACT_BIENES_CAMBIO, 
								   ACTIVO_NO_CORRIENTE, 
								   CRE_LARG_PLAZO_DIR_SOCIOS, 
								   PASIVO, 
								   PASIVO_CORRIENTE, 
								   PAS_DEUDAS_COMERCIALES, 
								   PAS_ACREEDORES_FINAN, 
								   PAS_DEUDAS_DIVERSAS, 
								   PAS_DEUDA_DIR_SOCIO, 
								   PAS_OTRAS_DEUDAS_DIVERSAS, 
								   PASIVO_NO_CORRIENTE, 
								   DEUDAS_COMERCIALES, 
								   ACREEDORES_FINANCIEROS, 
								   DEUDAS_DIVERSAS, 
								   DEUDAS_DIV_EMPR_VINC, 
								   DEUDAS_DIV_DIR_SOCIOS, 
								   OTRAS_DEUDAS_DIVERSAS, 
								   PATRIMONIO_NETO, 
								   CAPITAL, 
								   RESERVAS, 
								   RESULTADOS_ACUMULADOS, 
								   VENTAS, 
								   COSTOS_VENTAS, 
								   COSTOS_VENTAS_FIJOS, 
								   COSTOS_VTA_VARIABLES, 
								   RESULTADO_BRUTO, 
								   GASTOS_ADMINISTRACION, 
								   RESULTADO_OPERATIVO, 
								   INGRESOS_PERDIDOS, 
								   INTERESES_GANADOS, 
								   GASTOS_FINANCIEROS, 
								   OTROS_RESULT_FINAN_GANADOS, 
								   OTROS_RESULT_FINAN_PERDIDOS, 
								   DIF_CONV_PERDIDA, 
								   DIF_CONV_GANADA, 
								   RESULT_DESVA_MONETARIA, 
								   DESCUENTOS_OBTENIDOS, 
								   RESULTADOS_FINANCIEROS, 
								   BENEFICIOS_IMPUESTOS, 
								   IMPUESTOS, 
								   BENEFICIO_NETO, 
								   PAGOS_AMORT_CREDITOS, 
								   BENEFICIOS_AMORTIZACIONES, 
								   BENEFICIOS_DISP_BALANCE)
AS 
   SELECT TOP 9223372036854775807 WITH TIES 
      I.PERSONA_JURIDICA, 
      D.NUMERODOCUMENTO, 
      D.TIPODOCUMENTO, 
      I.FECHA, 
      I.INFO_FINANCIERA, 
      I.TIPO_EMPRESA, 
      I.FECHA_BALANCE, 
      I.MONEDA, 
      I.AJUSTADO_INFLACION, 
      I.ACTIVO, 
      I.ACTIVO_CORRIENTE, 
      I.ACT_DISPONIBILIDAD, 
      I.ACT_INVERSIONES, 
      I.ACT_CREDITOS_VENTAS, 
      I.ACT_OTROS_CREDITOS, 
      I.ACT_CRED_DIR_SOCIOS, 
      I.ACT_OTROS_CRED_IVA_RETEN, 
      I.ACT_BIENES_CAMBIO, 
      I.ACTIVO_NO_CORRIENTE, 
      I.CRE_LARG_PLAZO_DIR_SOCIOS, 
      I.PASIVO, 
      I.PASIVO_CORRIENTE, 
      I.PAS_DEUDAS_COMERCIALES, 
      I.PAS_ACREEDORES_FINAN, 
      I.PAS_DEUDAS_DIVERSAS, 
      I.PAS_DEUDA_DIR_SOCIO, 
      I.PAS_OTRAS_DEUDAS_DIVERSAS, 
      I.PASIVO_NO_CORRIENTE, 
      I.DEUDAS_COMERCIALES, 
      I.ACREEDORES_FINANCIEROS, 
      I.DEUDAS_DIVERSAS, 
      I.DEUDAS_DIV_EMPR_VINC, 
      I.DEUDAS_DIV_DIR_SOCIOS, 
      I.OTRAS_DEUDAS_DIVERSAS, 
      I.PATRIMONIO_NETO, 
      I.CAPITAL, 
      I.RESERVAS, 
      I.RESULTADOS_ACUMULADOS, 
      I.VENTAS, 
      I.COSTOS_VENTAS, 
      I.COSTOS_VENTAS_FIJOS, 
      I.COSTOS_VTA_VARIABLES, 
      I.RESULTADO_BRUTO, 
      I.GASTOS_ADMINISTRACION, 
      I.RESULTADO_OPERATIVO, 
      I.INGRESOS_PERDIDOS, 
      I.INTERESES_GANADOS, 
      I.GASTOS_FINANCIEROS, 
      I.OTROS_RESULT_FINAN_GANADOS, 
      I.OTROS_RESULT_FINAN_PERDIDOS, 
      I.DIF_CONV_PERDIDA, 
      I.DIF_CONV_GANADA, 
      I.RESULT_DESVA_MONETARIA, 
      I.DESCUENTOS_OBTENIDOS, 
      I.RESULTADOS_FINANCIEROS, 
      I.BENEFICIOS_IMPUESTOS, 
      I.IMPUESTOS, 
      I.BENEFICIO_NETO, 
      I.PAGOS_AMORT_CREDITOS, 
      I.BENEFICIOS_AMORTIZACIONES, 
      I.BENEFICIOS_DISP_BALANCE
   FROM 
      dbo.CRE_INFO_FINANCIERA  AS I WITH(NOLOCK)
         LEFT OUTER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS D WITH(NOLOCK)
										ON I.PERSONA_JURIDICA = D.NUMEROPERSONAFJ 
											AND D.TIPODOCUMENTO = ''RUC''
   WHERE (		(I.TZ_LOCK < 300000000000000 OR I.TZ_LOCK >= 400000000000000) 
			AND (I.TZ_LOCK < 100000000000000 OR I.TZ_LOCK >= 200000000000000))
		AND I.INFO_FINANCIERA = ''I''
   ORDER BY I.PERSONA_JURIDICA, 
			I.FECHA_BALANCE DESC; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_INFO_FINAN_SIN_CONT_SUF'')
	DROP view [dbo].[VW_INFO_FINAN_SIN_CONT_SUF]; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_INFO_FINAN_SIN_CONT_SUF] (
														   PERSONA_JURIDICA, 
														   NRODOCUMENTO, 
														   TIPODOCUMENTO, 
														   FECHA, 
														   INFO_FINANCIERA, 
														   TIPO_EMPRESA, 
														   FECHA_INICIO, 
														   FECHA_BALANCE, 
														   MONEDA, 
														   AJUSTADO_INFLACION, 
														   PASIVO_CORRIENTE, 
														   PAS_DEUDAS_COMERCIALES, 
														   PAS_DEDUAS_COM_EMP_VINCU, 
														   PAS_DEUDAS_COM_RESTO, 
														   PAS_ACREEDORES_FINAN, 
														   PAS_DEUDAS_DIVERSAS, 
														   PAS_DEUDAS_EMPR_VINCU, 
														   PAS_DEUDA_DIR_SOCIO, 
														   PAS_OTRAS_DEUDAS_DIVERSAS, 
														   PASIVO_NO_CORRIENTE, 
														   DEUDAS_COMERCIALES, 
														   ACREEDORES_FINANCIEROS, 
														   VENTAS, 
														   VENTAS_LOCALES, 
														   VTAS_PENULTIMO_PERIODO, 
														   FECHA_POST_CIERRE, 
														   VTAS_POST_CIERRE)
AS 
   SELECT TOP 9223372036854775807 WITH TIES 
      I.PERSONA_JURIDICA, 
      D.NUMERODOCUMENTO, 
      D.TIPODOCUMENTO, 
      I.FECHA, 
      I.INFO_FINANCIERA, 
      I.TIPO_EMPRESA, 
      I.FECHA_INICIO, 
      I.FECHA_BALANCE, 
      I.MONEDA, 
      I.AJUSTADO_INFLACION, 
      I.PASIVO_CORRIENTE, 
      I.PAS_DEUDAS_COMERCIALES, 
      I.PAS_DEDUAS_COM_EMP_VINCU, 
      I.PAS_DEUDAS_COM_RESTO, 
      I.PAS_ACREEDORES_FINAN, 
      I.PAS_DEUDAS_DIVERSAS, 
      I.PAS_DEUDAS_EMPR_VINCU, 
      I.PAS_DEUDA_DIR_SOCIO, 
      I.PAS_OTRAS_DEUDAS_DIVERSAS, 
      I.PASIVO_NO_CORRIENTE, 
      I.DEUDAS_COMERCIALES, 
      I.ACREEDORES_FINANCIEROS, 
      I.VENTAS, 
      I.VENTAS_LOCALES, 
      I.VTAS_PENULTIMO_PERIODO, 
      I.FECHA_POST_CIERRE, 
      I.VTAS_POST_CIERRE
   FROM 
      dbo.CRE_INFO_FINANCIERA  AS I WITH(NOLOCK)
         LEFT OUTER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS D WITH(NOLOCK) 
													 ON I.PERSONA_JURIDICA = D.NUMEROPERSONAFJ 
														AND D.TIPODOCUMENTO = ''RUC''
														AND I.INFO_FINANCIERA = ''C''
   WHERE (	(I.TZ_LOCK < 300000000000000 OR I.TZ_LOCK >= 400000000000000) 
		AND (I.TZ_LOCK < 100000000000000 OR I.TZ_LOCK >= 200000000000000)) 	
   ORDER BY I.PERSONA_JURIDICA, 
			I.FECHA_BALANCE DESC; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CLI_PERSONAS_FIRMAS'')
	DROP view [dbo].[VW_CLI_PERSONAS_FIRMAS]; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_CLI_PERSONAS_FIRMAS]
													(TIPO_DOC,
													NRO_DOC,
													NRO_PERSONA,
													NOMBRE_APELLIDO,
													NRO_FIRMA,
													VENCIMIENTO,
													AUTORIZADOR,
													TIENE_FIRMA)
AS 
SELECT	D.TIPODOCUMENTO, 
		D.NUMERODOCUMENTO, 
		F.NUMEROPERSONAFISICA, 
		CONCAT(P.PRIMERNOMBRE+'' '',
		P.APELLIDOPATERNO),
		F.NUMERO_FIRMA, 
		F.VENCIMIENTO, 
		F.AUTORIZADOR,
		CASE 
			WHEN (F.FIRMA IS NULL OR F.FIRMA = '''') THEN 0
			ELSE 1
		END
FROM CLI_PERSONAS_FIRMAS AS F WITH (NOLOCK)
LEFT JOIN CLI_DOCUMENTOSPFPJ AS D WITH (NOLOCK) ON F.NUMEROPERSONAFISICA = D.NUMEROPERSONAFJ 
													AND D.TZ_LOCK = 0
LEFT JOIN CLI_PERSONASFISICAS AS P WITH (NOLOCK) ON F.NUMEROPERSONAFISICA = P.NUMEROPERSONAFISICA 
													AND P.TZ_LOCK = 0
WHERE F.TZ_LOCK = 0 ;')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_INFO_FTE_ACT_RIESGO'')
	DROP view [dbo].[VW_INFO_FTE_ACT_RIESGO]; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_INFO_FTE_ACT_RIESGO] (
													   NUMERO_INFORME, 
													   CLIENTE, 
													   NOMBRECLIENTE, 
													   FECHA_INFORME, 
													   TIPO_INFORME, 
													   FINALIZADO)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
    INFO.NUMERO_INFORME AS NUMERO_INFORME, 
    INFO.NUMERO_CLIENTE AS CLIENTE, 
    C.NOMBRECLIENTE, 
    INFO.FECHA_INFORME AS FECHA_INFORME, 
    INFO.TIPO_INFORME, 
    INFO.FINALIZADO
FROM dbo.CRE_INFORMES_FTE_ACT  AS INFO WITH (NOLOCK)
INNER JOIN  dbo.CLI_CLIENTES  AS C WITH (NOLOCK) ON INFO.NUMERO_CLIENTE = C.CODIGOCLIENTE
WHERE 
    (		(INFO.TZ_LOCK < 300000000000000 OR INFO.TZ_LOCK >= 400000000000000) 
	AND	(INFO.TZ_LOCK < 100000000000000 OR INFO.TZ_LOCK >= 200000000000000)) 
AND 
    (		(C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000) 
	AND (C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)) 
  
ORDER BY NUMERO_INFORME; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CLI_PERSONAS_SECTOR'')
	DROP view [dbo].[VW_CLI_PERSONAS_SECTOR]; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_CLI_PERSONAS_SECTOR] (
													   TIPODOC, 
													   NUMERODOC,
													   PAISDOCUMENTO,
													   CODIGOCLIENTE, 
													   NOMBRECLIENTE,
													   NUMEROPERSONA,
													   SECTOR)
AS 
SELECT 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    v.PAISDOCUMENTO,
    R.CODIGOCLIENTE,
    R.NOMBRECLIENTE,
    V.NUMEROPERSONAFJ AS NUMEROPERSONA,
    U.SECTOR
FROM 
    dbo.CLI_CLIENTES  AS R WITH (NOLOCK) 
    INNER JOIN dbo.CLI_CLIENTEPERSONA  AS T WITH (NOLOCK) ON R.CODIGOCLIENTE = T.CODIGOCLIENTE 
															AND t.TITULARIDAD=''T''
    INNER JOIN dbo.CLI_PERSONASFISICAS  AS U WITH (NOLOCK) ON U.NUMEROPERSONAFISICA = T.NUMEROPERSONA
    INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK) ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
    INNER JOIN CLI_SECTORES N WITH (NOLOCK) ON N.SECTOR= U.SECTOR
WHERE 
    ((R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) AND 
    ((T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) AND 
    ((U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)) AND 
    ((V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
UNION ALL
SELECT 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    v.PAISDOCUMENTO,
    R.CODIGOCLIENTE,
    R.NOMBRECLIENTE,
    V.NUMEROPERSONAFJ AS NUMEROPERSONA,
    S.SECTOR
FROM 
    dbo.CLI_CLIENTES  AS R WITH (NOLOCK) 
    INNER JOIN dbo.CLI_CLIENTEPERSONA  AS T WITH (NOLOCK) ON R.CODIGOCLIENTE = T.CODIGOCLIENTE
															AND t.TITULARIDAD=''T''
	INNER JOIN dbo.CLI_PERSONASJURIDICAS  AS S WITH (NOLOCK)ON S.NUMEROPERSONAJURIDICA = T.NUMEROPERSONA
    INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
    INNER JOIN CLI_SECTORES N WITH (NOLOCK)ON N.SECTOR= s.SECTOR
WHERE 
    ((R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) AND 
    ((T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) AND 
    ((S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)) AND 
    ((V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_INTEGRANTES_PJ'')
	DROP view [dbo].[VW_INTEGRANTES_PJ]; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_INTEGRANTES_PJ] (
												   PAISDOC, 
												   TIPODOC, 
												   NUMERODOC, 
												   NOMBRE, 
												   NUMEROPJURIDICA, 
												   NUMEROPFISICA)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
		DOC.PAISDOCUMENTO AS PAISDOC, 
		DOC.TIPODOCUMENTO AS TIPODOC, 
		DOC.NUMERODOCUMENTO AS NUMERODOC, 
		PJ.RAZONSOCIAL AS NOMBRE, 
		CLI.NUMEROPERSONAJURIDICA AS NUMEROPJURIDICA, 
		CLI.NUMEROPERSONAFISICA AS NUMEROPFISICA
FROM dbo.CLI_DOCUMENTOSPFPJ  AS DOC WITH (NOLOCK)
INNER JOIN dbo.CLI_PERSONASJURIDICAS  AS PJ WITH (NOLOCK) ON  PJ.NUMEROPERSONAJURIDICA = DOC.NUMEROPERSONAFJ
INNER JOIN dbo.CLI_INTEGRANTESPJ  AS CLI WITH (NOLOCK) ON CLI.NUMEROPERSONAJURIDICA = DOC.NUMEROPERSONAFJ
														AND CLI.NUMEROPERSONAJURIDICA = PJ.NUMEROPERSONAJURIDICA    
ORDER BY TIPODOC; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_JMPM_PROCESS_INSTANCE_LISTA'')
	DROP view [dbo].[VW_JMPM_PROCESS_INSTANCE_LISTA]; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_JMPM_PROCESS_INSTANCE_LISTA] (NUMERO_LISTA, 
															PROCESS_INSTANCE, 
															TZ_LOCK)
AS 

SELECT	L.NUMERO_LISTA, 
		L.PROCESSINSTANCE_ID AS PROCESS_INSTANCE, 
		0 AS TZ_LOCK
FROM CRE_CAB_LISTA_DOCUMENTOS  AS C WITH(NOLOCK)
INNER JOIN JBPM_TZKEY_INGRESOLISTALOTE  AS L WITH(NOLOCK) 
									ON C.NUMERO_LISTA = L.NUMERO_LISTA; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''EST_SIT_PASIVO'')
	DROP view [dbo].[EST_SIT_PASIVO]; ')
execute(' CREATE OR ALTER    VIEW [dbo].[EST_SIT_PASIVO] AS
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK)WHERE informe=''ESTADO_SIT'' and CODIGO = ''0201000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0201010000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0201020000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0201030000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0202000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0203000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0204000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0205000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0206000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0207000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0208000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0209000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0210000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WHERE informe=''ESTADO_SIT'' and CODIGO = ''0211000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0212000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 FROM RRII_ESTADO WITH (NOLOCK) WHERE informe=''ESTADO_SIT'' and CODIGO = ''0200000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_INTERDICTOSCODNBC'')
	DROP view [dbo].[VW_INTERDICTOSCODNBC]; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_INTERDICTOSCODNBC] (
											CODIGOBCO, 
											CODINTERNACIONAL, 
											SERIEINTERDICTO, 
											LAMINADESDE, 
											LAMINAHASTA, 
											DESCRIPCION, 
											FECHAMODIFICACION, 
											USUARIO, 
											FECHAINTERDICCION, 
											ESTADO, 
											NUMERADOR, 
											CODTITULO)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
		T.CODIGOBCO, 
		T.CODINTERNACIONAL, 
		I.SERIEINTERDICTO, 
		I.LAMINADESDE, 
		I.LAMINAHASTA, 
		I.DESCRIPCION, 
		I.FECHAMODIFICACION, 
		I.USUARIO, 
		I.FECHAINTERDICCION, 
		I.ESTADO, 
		I.NUMERADOR, 
		I.CODTITULO
FROM dbo.VAL_TITULOS  AS T WITH(NOLOCK) 
INNER JOIN dbo.VAL_TITULOSINTERDICTOS  AS I WITH(NOLOCK) ON T.CODTITULO = I.CODTITULO
	AND(	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
		AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
	AND(	(I.TZ_LOCK < 300000000000000 OR I.TZ_LOCK >= 400000000000000) 
		AND (I.TZ_LOCK < 100000000000000 OR I.TZ_LOCK >= 200000000000000))
ORDER BY T.CODIGOBCO; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CLI_ACT_ECONOM'')
	DROP view [dbo].VW_CLI_ACT_ECONOM; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_CLI_ACT_ECONOM] ( 
												   CODIGOCLIENTE,
												   CODIGO_ACTIVIDAD,
												   ORDINAL_ACTIVIDAD,
												   EMPRESA,
												   CARGO,
												   FUENTE_INGRESO,
												   TIPO_CLIENTE, 
												   NUMEROPERSONA, 
												   TIPOPERSONA, 
												   TITULARIDAD, 
												   NOMBRECLIENTE)
AS 
SELECT 
   	R.CODIGOCLIENTE,
   	a.CODIGO_ACTIVIDAD,
   	a.ORDINAL_ACTIVIDAD,
   	a.EMPRESA,
   	a.CARGO,
   	a.FUENTE_INGRESO,
   	r.tipo AS TIPO_CLIENTE,
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    V.TIPOPERSONA, 
    T.TITULARIDAD, 
    R.NOMBRECLIENTE
FROM 
    dbo.CLI_CLIENTES  AS R WITH(NOLOCK)
    INNER JOIN dbo.CLI_CLIENTEPERSONA  AS T WITH (NOLOCK) ON R.CODIGOCLIENTE = T.CODIGOCLIENTE
														AND T.TITULARIDAD=''T''
    INNER JOIN dbo.CLI_PERSONASFISICAS  AS U WITH (NOLOCK)ON U.NUMEROPERSONAFISICA = T.NUMEROPERSONA 
    INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
    INNER JOIN dbo.CLI_ACTIVIDAD_ECONOMICA A WITH (NOLOCK)ON T.NUMEROPERSONA=A.CODIGO_PERSONA_CLIENTE
WHERE 
    ((R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) AND 
    ((T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) AND 
    ((U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)) AND 
    ((V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)) AND
    ((A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000) AND (A.TZ_LOCK < 100000000000000 OR A.TZ_LOCK >= 200000000000000))
UNION ALL
SELECT 
    R.CODIGOCLIENTE, 
    a.CODIGO_ACTIVIDAD,
   	a.ORDINAL_ACTIVIDAD,
   	a.EMPRESA,
   	a.CARGO,
   	a.FUENTE_INGRESO,
   	r.tipo AS TIPO_CLIENTE,
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    V.TIPOPERSONA, 
    T.TITULARIDAD, 
    R.NOMBRECLIENTE
FROM 
    dbo.CLI_CLIENTES  AS R WITH (NOLOCK) 
	INNER JOIN dbo.CLI_CLIENTEPERSONA  AS T WITH (NOLOCK) ON R.CODIGOCLIENTE = T.CODIGOCLIENTE
														AND T.TITULARIDAD=''T''
    INNER JOIN dbo.CLI_PERSONASJURIDICAS  AS S WITH (NOLOCK) ON S.NUMEROPERSONAJURIDICA = T.NUMEROPERSONA
    INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK) ON S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
    INNER JOIN dbo.CLI_ACTIVIDAD_ECONOMICA A WITH (NOLOCK) ON T.NUMEROPERSONA=A.CODIGO_PERSONA_CLIENTE
WHERE 
    ((R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) AND 
    ((T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) AND 
    ((S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)) AND 
    ((V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)) AND
    ((A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000) AND (A.TZ_LOCK < 100000000000000 OR A.TZ_LOCK >= 200000000000000)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''EST_SIT_PATRIMONIO'')
	DROP view [dbo].EST_SIT_PATRIMONIO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[EST_SIT_PATRIMONIO] 
AS
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301020000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301030000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301040000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301050000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301060000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301070000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301000000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0302000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0300000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VTA_COMERCIALIZADORAS'')
	DROP view [dbo].VTA_COMERCIALIZADORAS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VTA_COMERCIALIZADORAS] (
													ID,
													DESCRIPCION)
AS
SELECT 
	NUMERICO, 
	ALFA 
FROM PARAMETROSGENERALES WITH (NOLOCK)
WHERE CODIGO = 728
UNION
SELECT
	P.ID_ConvPago,
	P.NomConvPago
FROM CONV_CONVENIOS_PAG P WITH (NOLOCK)
INNER JOIN CONV_TIPOS T ON T.Id_TpoConv = P.Id_TpoConv 
						AND T.TpoProducto = ''M''
						AND T.TZ_LOCK = 0 
						AND P.TZ_LOCK = 0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_CENTROCOSTOS'')
	DROP view [dbo].VW_ITF_CENTROCOSTOS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_ITF_CENTROCOSTOS] 
												(CENTROCOSTO, 
												DESCRIPCION)
AS 

SELECT	CON_CENTROCOSTO.CENTROCOSTO, 
		CON_CENTROCOSTO.DESCRIPCION
FROM dbo.CON_CENTROCOSTO WITH (NOLOCK); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RRII_TRAMOS_EFECTIVO_MINIMO'')
	DROP view [dbo].VW_RRII_TRAMOS_EFECTIVO_MINIMO; ')
execute(' CREATE OR ALTER VIEW [dbo].[VW_RRII_TRAMOS_EFECTIVO_MINIMO]
AS 
SELECT 
	CAST(G.FECHA AS DATETIME) AS FechadeInforme,
	CAST(EOMONTH(G.FECHA) AS DATETIME) AS FechadeInformacion,
	CAST(SA.C1620 AS DATETIME) AS FechaValor , 
	CAST(SA.C1627 AS DATETIME) AS FechaVto,  
	CAST(MS.CODIGO_SISCEN AS VARCHAR(5)) AS Moneda,
	CAST(dbo.restaDias(SA.C1627) AS NUMERIC(11)) AS ResidualDiasEnt,	
	CAST(SA.PRODUCTO AS VARCHAR(5)) AS TipoDeDeposito, 
	CAST(SU.CAT_BCRA AS NUMERIC(1)) AS Categoría,
	CAST(sum(G.SALDO_AL_CORTE) AS NUMERIC(11,2)) AS Saldo
FROM 
	GRL_SALDOS_DIARIOS G WITH (NOLOCK)
	INNER JOIN SALDOS SA WITH (NOLOCK) ON SA.JTS_OID = G.SALDOS_JTS_OID AND SA.C1604 <> 0
	INNER JOIN PRODUCTOS P WITH (NOLOCK) ON P.C6250 = SA.PRODUCTO AND P.C6252 = 4 
	INNER JOIN SUCURSALES SU WITH (NOLOCK) ON SU.SUCURSAL = G.SUCURSAL
	INNER JOIN RRII_MONEDAS_SISCEN MS WITH (NOLOCK) ON G.MONEDA = MS.CODIGO_MONEDA_TOP
WHERE G.TZ_LOCK=0
	
GROUP BY G.FECHA, 
		SA.C1620, 
		SA.C1627,
		MS.CODIGO_SISCEN, 
		SA.PRODUCTO, 
		SU.CAT_BCRA ; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_FISICAS_JURIDICAS'')
	DROP view [dbo].VW_FISICAS_JURIDICAS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_FISICAS_JURIDICAS] (
													   TIPODOC, 
													   NUMERODOC, 
													   NUMEROPERSONA, 
													   NIVELAPERTURA, 
													   TIPOPERSONA, 
													   NOMBRE, 
													   ESTADO,
													   MOTIVO_INHABILITADO)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    CASE U.NIVEL_APERTURA
        WHEN 0 THEN ''REGISTRO''
        WHEN 1 THEN ''BÁSICO''
        WHEN 3 THEN ''ACTIVOS''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    (U.PRIMERNOMBRE + '' '' +U.SEGUNDONOMBRE+'' '' +U.APELLIDOPATERNO+'' ''+U.APELLIDOMATERNO) AS NOMBRE,
    CASE U.ESTADO
      	WHEN 0 THEN ''HABILITADO''
        WHEN 1 THEN ''INHABILITADO''
    END AS ESTADO,   
    CASE U.MOTIVO_INHABILITADO
      	WHEN 1 THEN ''INHABILITADO POR EL BCRA''
        WHEN 2 THEN ''INHABILITADO POR FALLECIMIENTO''
        WHEN 3 THEN ''INHABILITADO UIF''
        WHEN 4 THEN ''INHABILITADO TERRORISMO''
        WHEN 5 THEN ''INHABILITACION ADMINISTRATIVA''
    END AS MOTIVO_INHABILITADO
FROM dbo.CLI_PERSONASFISICAS  AS U WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ  
														AND V.TIPOPERSONA = ''F''
														AND U.TZ_LOCK=0
														AND V.TZ_LOCK=0
ORDER BY NUMEROPERSONA
UNION ALL
SELECT TOP 9223372036854775807 WITH TIES 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    CASE T.NIVEL_APERTURA
        WHEN 1 THEN ''BÁSICO''
        WHEN 3 THEN ''ACTIVOS''
        WHEN 4 THEN ''INST.FINANCIERA''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    T.RAZONSOCIAL AS NOMBRE,  
    CASE T.ESTADO
      	WHEN 0 THEN ''HABILITADO''
        WHEN 1 THEN ''INHABILITADO''
    END AS ESTADO,   
    CASE T.MOTIVO_INHABILITADO
      	WHEN 1 THEN ''INHABILITADO POR EL BCRA''
        WHEN 3 THEN ''INHABILITADO UIF''
        WHEN 4 THEN ''INHABILITADO TERRORISMO''
        WHEN 5 THEN ''INHABILITACION ADMINISTRATIVA''
        WHEN 6 THEN ''P/LIQ TOTAL DE LA SOCIEDAD''
    END AS MOTIVO_INHABILITADO
FROM dbo.CLI_PERSONASJURIDICAS  AS T WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK) ON 
								T.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ 
								AND (V.TIPOPERSONA = ''J'' OR V.TIPOPERSONA = ''I'')
								AND T.TZ_LOCK = 0 
								AND V.TZ_LOCK = 0
ORDER BY NUMEROPERSONA; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_COBRANZA3OS'')
	DROP view [dbo].VW_ITF_COBRANZA3OS; ')
execute(' CREATE OR ALTER VIEW [dbo].[VW_ITF_COBRANZA3OS] (
												   TZ_LOCK, 
												   JTS_OID, 
												   JTS_OID_RECAUDACION, 
												   ID_CONVENIO, 
												   SERVICIO_REFERENCIA, 
												   IMPORTE_FACTURA, 
												   FECHA_COBRADO, 
												   IMPORTE_COBRADO, 
												   REFERENCIA, 
												   SUCURSAL, 
												   CAJERO)
AS 
SELECT 
    RCT_COBRANZACTA3OS.TZ_LOCK, 
    RCT_COBRANZACTA3OS.JTS_OID, 
    RCT_COBRANZACTA3OS.JTS_OID_RECAUDACION, 
    RCT_COBRANZACTA3OS.ID_CONVENIO, 
    RCT_COBRANZACTA3OS.SERVICIO_REFERENCIA, 
    RCT_COBRANZACTA3OS.IMPORTE_FACTURA, 
    RCT_COBRANZACTA3OS.FECHA_COBRADO, 
    RCT_COBRANZACTA3OS.IMPORTE_COBRADO, 
    RCT_COBRANZACTA3OS.REFERENCIA, 
    RCT_COBRANZACTA3OS.SUCURSAL, 
    RCT_COBRANZACTA3OS.CAJERO
FROM dbo.RCT_COBRANZACTA3OS WITH(NOLOCK) ;')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_CHOZAS_SOLICITUD'')
	DROP view [dbo].VW_ITF_CHOZAS_SOLICITUD; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_ITF_CHOZAS_SOLICITUD] AS

SELECT 	''311'' AS NROBANCO,

		(CASE WHEN CH.TIPOCHEQUES = ''C'' AND CH.TIPOCHEQUERA = ''C'' THEN ''01''  
				WHEN CH.TIPOCHEQUES = ''D'' AND CH.TIPOCHEQUERA = ''T'' THEN ''02''
				WHEN CH.TIPOCHEQUES = ''C'' AND CH.TIPOCHEQUERA = ''T'' THEN ''03''
				WHEN CH.TIPOCHEQUES = ''D'' AND CH.TIPOCHEQUERA = ''C'' THEN ''04''					  		
		ELSE ''08'' 
		END) AS TIPOFORMULARIO,
		RIGHT(''000''+CAST(SUCURSAL AS VARCHAR(3)),3) AS NRO_SUCURSAL,
		RIGHT(''00000000000''+CAST(CUENTA AS VARCHAR(11)),11) AS NRO_CUENTA,
		RIGHT(''000''+CAST(CANTIDAD AS VARCHAR(3)),3) AS CANTIDAD_LIBRETAS,
		RIGHT(''00000''+CAST( PaquetesDe  AS VARCHAR(5)),5) AS TIPO_LIBRETA,
		CH.ESTADO,									
		(SELECT DOMICILIO FROM (
		SELECT TOP 1 CAST((rtrim(ltrim(concat(D.CALLE , '' - '' , 
				D.NUMERO , '' - '' , 
				D.LOCALIDAD , '' - '' , 
				D.CPA_NUEVO , '' - '' , 
				D.PROVINCIA)))) AS VARCHAR(60)) AS DOMICILIO,
				(CASE 	  WHEN D.TIPODIRECCION = ''E''  THEN 1  
							WHEN D.TIPODIRECCION = ''L''  THEN 2 
							WHEN D.TIPODIRECCION = ''PR'' THEN 3
							WHEN D.TIPODIRECCION = ''F''  THEN 4 					  		
							ELSE 0 END ) AS ORDENDIR 
		FROM VW_CLI_DIRECCIONES D WITH (NOLOCK)			  
		WHERE D.CODIGOCLIENTE=CH.CLIENTE 
			AND D.FORMATO IN (''PF'',''PJ'') 
			AND D.TIPODIRECCION IN (''E'',''L'',''PR'',''F'') 
		ORDER BY ORDENDIR ASC 
		) AS DOMICILIO) AS DOMICILIO,
				
		LEFT((	SELECT MAX (FORMAT(C1621,''MMyy'')) 
				FROM SALDOS S WITH (NOLOCK) 
				WHERE S.CUENTA = CH.CUENTA 
					AND TZ_LOCK = 0),4)  AS FECHA_APERTURA,
				
		CONCAT(dbo.NCADENAS(CAST(CH.NROSOLICITUD_SUCURSAL_CUENTA AS VARCHAR(10)),10,''0'',''P''),
		dbo.NCADENAS(CAST(CH.NROSOLICITUD AS VARCHAR(10)),10,''0'',''P'')) AS NRO_PEDIDO,
		SUBSTRING(LETRA_NUMERO_IMPRENTA, 1, 1) AS LETRA,
		RIGHT(''0000000000''+ CAST(SUBSTRING(LETRA_NUMERO_IMPRENTA, 2, 10) AS VARCHAR(10)),10) AS NROCHEQUERA,								
		CH.CLIENTE AS CODCLIENTE
FROM CHE_CHEQUESIMPRENTA CH  WITH (NOLOCK)
WHERE CH.TZ_LOCK = 0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PFPJ_DOCUMENTOS'')
	DROP view [dbo].VW_PFPJ_DOCUMENTOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PFPJ_DOCUMENTOS] (
												   TIPODOC, 
												   NUMERODOC, 
												   NUMEROPERSONA, 
												   NIVELAPERTURA, 
												   TIPOPERSONA, 
												   NOMBRE, 
												   ESTADO,
												   MOTIVO_INHABILITADO)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    CASE U.NIVEL_APERTURA
        WHEN 0 THEN ''REGISTRO''
        WHEN 1 THEN ''BÁSICO''
        WHEN 3 THEN ''ACTIVOS''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    (U.APELLIDOPATERNO+ '' '' +U.PRIMERNOMBRE) AS NOMBRE,
    CASE U.ESTADO
      	WHEN 0 THEN ''HABILITADO''
        WHEN 1 THEN ''INHABILITADO''
    END AS ESTADO,   
    CASE U.MOTIVO_INHABILITADO
      	WHEN 1 THEN ''INHABILITADO POR EL BCRA''
        WHEN 2 THEN ''INHABILITADO POR FALLECIMIENTO''
        WHEN 3 THEN ''INHABILITADO UIF''
        WHEN 4 THEN ''INHABILITADO TERRORISMO''
        WHEN 5 THEN ''INHABILITACION ADMINISTRATIVA''
    END AS MOTIVO_INHABILITADO
FROM dbo.CLI_PERSONASFISICAS  AS U WITH(NOLOCK)
INNER JOIN  dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK) 
										ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
										AND ((U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000))
										AND V.TIPOPERSONA = ''F''
										AND ((V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
ORDER BY NUMEROPERSONA
UNION ALL
SELECT TOP 9223372036854775807 WITH TIES 
		V.TIPODOCUMENTO AS TIPODOC, 
		V.NUMERODOCUMENTO AS NUMERODOC, 
		V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
		CASE T.NIVEL_APERTURA
			WHEN 1 THEN ''BÁSICO''
			WHEN 3 THEN ''ACTIVOS''
			WHEN 4 THEN ''INST.FINANCIERA''
		END AS NIVELAPERTURA, 
		V.TIPOPERSONA, 
		T.RAZONSOCIAL AS NOMBRE,  
		CASE T.ESTADO
      		WHEN 0 THEN ''HABILITADO''
			WHEN 1 THEN ''INHABILITADO''
		END AS ESTADO,   
		CASE T.MOTIVO_INHABILITADO
      		WHEN 1 THEN ''INHABILITADO POR EL BCRA''
			WHEN 3 THEN ''INHABILITADO UIF''
			WHEN 4 THEN ''INHABILITADO TERRORISMO''
			WHEN 5 THEN ''INHABILITACION ADMINISTRATIVA''
			WHEN 6 THEN ''P/LIQ TOTAL DE LA SOCIEDAD''
		END AS MOTIVO_INHABILITADO
FROM dbo.CLI_PERSONASJURIDICAS  AS T WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK) 
									ON T.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ 
									AND (V.TIPOPERSONA = ''J'' OR V.TIPOPERSONA = ''I'')
									AND ((T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000))
									AND ((V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
ORDER BY NUMEROPERSONA; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_REM_SOLICITUDREMESA'')
	DROP view [dbo].VW_REM_SOLICITUDREMESA; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_REM_SOLICITUDREMESA] AS

SELECT 
	NRO_SOLICITUD AS ''Nro. Solicitud'',
	MONEDA AS ''Moneda'',
	M.C6400 AS ''Descripción Moneda'',
	IMPORTE AS ''Importe'',
	ENVIO_RECIBO AS ''Enviar / Recibir'',
	TIPODESTINO AS ''Tipo de Destino'',
(	SELECT DESCRIPCION 
	FROM OPCIONES WITH (NOLOCK) 
	WHERE NUMERODECAMPO=2606 
		AND IDIOMA=''E'' 
		AND OPCIONDEPANTALLA=S.TIPODESTINO) AS ''Descripción Tipo Destino'',
	DESTINO AS ''Destino'',
	S.TIPOORIGEN,
	S.ORIGEN,
	S.ESTADO
FROM REM_SOLICITUDREMESA S WITH (NOLOCK) 
LEFT JOIN MONEDAS M  WITH (NOLOCK) ON S.MONEDA=M.C6399
								AND (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
									AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))
								AND(	(M.TZ_LOCK < 300000000000000 OR M.TZ_LOCK >= 400000000000000) 
									AND (M.TZ_LOCK < 100000000000000 OR M.TZ_LOCK >= 200000000000000)); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VWEST_RESULTADOS'')
	DROP view [dbo].VWEST_RESULTADOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VWEST_RESULTADOS] 
AS
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0501010010'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0501010020'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0501010099'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0501020010'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0501020020'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0501020099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0502010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0502050000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0502100000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0502150000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0502200000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0502000099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0503010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0503050000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0503100000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0503150000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0503000099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0504000000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0504000099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0504010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0504010099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0505010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0505050000''
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0500000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0600000001'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
	and CODIGO = ''0600000002''; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PF_HAB_DOCUMENTOS'')
	DROP view [dbo].VW_PF_HAB_DOCUMENTOS; ')
execute(' CREATE OR ALTER       VIEW [dbo].[VW_PF_HAB_DOCUMENTOS] (
												   "Tipo Documento Identificativo", 
												   "Número Documento Identificativo",
												   "Tipo Documento Físico",
												   "Número de Documento Físico",
												   "Apellidos y Nombres",
												   "Tipo de Persona", 
												   "Nivel de Apertura",
												   "Estado de la Persona",
												   "Motivo Inhabilitado",
												   "Número de Persona")
AS 
SELECT TOP 9223372036854775807 WITH TIES 
    V.TIPODOCUMENTO , 
    V.NUMERODOCUMENTO ,
    V.TIPO_DOC_FISICO ,
    V.NUM_DOC_FISICO ,
    (U.APELLIDOPATERNO +'' ''+U.PRIMERNOMBRE) AS NOMBRES,
    V.TIPOPERSONA ,  
    (	SELECT DESCRIPCION 
	FROM OPCIONES O WITH(NOLOCK)
	WHERE O.IDIOMA=''E'' 
	AND O.OPCIONINTERNA=U.NIVEL_APERTURA 
	AND O.NUMERODECAMPO = 2203) AS NIVEL_APERTURA,
    (	SELECT DESCRIPCION 
	FROM OPCIONES O WITH(NOLOCK)
	WHERE O.IDIOMA=''E'' 
	AND O.OPCIONINTERNA=U.ESTADO
	AND O.NUMERODECAMPO = 33366) AS ESTADO,   
	(	SELECT DESCRIPCION 
	FROM OPCIONES O  WITH(NOLOCK)
	WHERE O.IDIOMA=''E'' 
	AND O.OPCIONINTERNA=U.MOTIVO_INHABILITADO 
	AND O.NUMERODECAMPO = 33368) AS  MOTIVO_INHABILITADO,
    V.NUMEROPERSONAFJ 
       
FROM dbo.CLI_PERSONASFISICAS  AS U WITH(NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK)ON 
													U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ 
													AND V.TIPOPERSONA = ''F'' 
													AND U.TZ_LOCK =0
													AND V.TZ_LOCK =0
ORDER BY NUMEROPERSONAFJ; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_OTROS_BIENES'')
	DROP view [dbo].VW_OTROS_BIENES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_OTROS_BIENES] (
										Bien, 
										TipoDocumento,
										NumeroDocumento,
										Categoria, 
										DescripcionCategoria, 
										TipoCesion, 
										DescripcionCesion, 
										Persona)
AS 
SELECT b.NUMERO_BIEN AS Bien, 
		b.TIPODOCUMENTO AS TipoDocumento, 
		b.NUMERODOCUMENTO AS NumeroDocumento, 
		b.TIPO AS Categoria, 
		t.DESCRIPCION AS DescripcionCategoria, 
		b.TIPO_CESION AS TipoCesion, 
		tc.DESCRIPCION AS DescripcionCesion, 
		b.NUM_PERSONA AS Persona
FROM BIE_OTROS b WITH (NOLOCK)
INNER JOIN OPCIONES t WITH (NOLOCK) ON t.NUMERODECAMPO = 4969 
									AND t.OPCIONINTERNA = b.TIPO
									AND b.TZ_LOCK = 0
LEFT JOIN OPCIONES tc WITH(NOLOCK) ON tc.NUMERODECAMPO = 4970 
									AND tc.OPCIONINTERNA = b.TIPO_CESION; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_EST_RESULTADOS'')
	DROP view [dbo].VW_EST_RESULTADOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_EST_RESULTADOS] 
AS
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0501010010'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0501010020'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0501010099'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0501020010'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0501020020'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0501020099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0502010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0502050000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0502100000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0502150000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0502200000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0502000099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0503010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0503050000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0503100000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0503150000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0503000099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0504000000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0504000099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0504010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0504010099''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0505010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0505050000''
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0500000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4, NULL AS columna5
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0600000001'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4, columna5 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_RES'' 
and CODIGO = ''0600000002''; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_PLANCTAS'')
	DROP view [dbo].VW_ITF_PLANCTAS; ')
execute(' CREATE OR ALTER VIEW [dbo].[VW_ITF_PLANCTAS] (
											   NOMBRE_RUBRO, 
											   RUBRO_BANCO_CENTRAL, 
											   MONEDA_RUBRO, 
											   TITULO_RUBRO, 
											   GRUPO_BALANCE, 
											   SIGNO_RUBRO, 
											   TIPO_RUBRO, 
											   INTERMEDIACION_FINANCIERA, 
											   RESIDENCIA_RUBRO, 
											   PLAZO_RUBRO, 
											   SUBDIVISION_1, 
											   SUBDIVISION_2, 
											   SUBDIVISION_3, 
											   CLASIFICACION_1, 
											   CLASIFICACION_2, 
											   CLASIFICACION_3, 
											   APERTURA_SALDO_BATCH, 
											   COD_DEPURACION, 
											   RUBRO_CONTABLE, 
											   CONTROL_SOBREGIROS, 
											   CUENTA_CONTABLE, 
											   CUENTA_CASA_MATRIZ, 
											   RUBRO_ANTERIOR, 
											   RUBRO_OPERATIVO, 
											   PRODUCTO, 
											   RUBRO_PERDIDA_VAL, 
											   RUBRO_GANANCIA_VAL, 
											   DEVENGAMIENTO_INTERESES, 
											   DEV_TASA_MORA, 
											   CALIFICA, 
											   DIADEVENGA, 
											   PREVISIONA)
AS 
SELECT 
    PLANCTAS.C6300 AS NOMBRE_RUBRO, 
    PLANCTAS.C6301 AS RUBRO_BANCO_CENTRAL, 
    PLANCTAS.C6302 AS MONEDA_RUBRO, 
    PLANCTAS.C6303 AS TITULO_RUBRO, 
    PLANCTAS.C6304 AS GRUPO_BALANCE, 
    PLANCTAS.C6305 AS SIGNO_RUBRO, 
    PLANCTAS.C6306 AS TIPO_RUBRO, 
    PLANCTAS.C6307 AS INTERMEDIACION_FINANCIERA, 
    PLANCTAS.C6308 AS RESIDENCIA_RUBRO, 
    PLANCTAS.C6309 AS PLAZO_RUBRO, 
    PLANCTAS.C6310 AS SUBDIVISION_1, 
    PLANCTAS.C6311 AS SUBDIVISION_2, 
    PLANCTAS.C6312 AS SUBDIVISION_3, 
    PLANCTAS.C6313 AS CLASIFICACION_1, 
    PLANCTAS.C6314 AS CLASIFICACION_2, 
    PLANCTAS.C6315 AS CLASIFICACION_3, 
    PLANCTAS.C6316 AS APERTURA_SALDO_BATCH, 
    PLANCTAS.C6317 AS COD_DEPURACION, 
    PLANCTAS.C6326 AS RUBRO_CONTABLE, 
    PLANCTAS.C6327 AS CONTROL_SOBREGIROS, 
    PLANCTAS.C6329 AS CUENTA_CONTABLE, 
    PLANCTAS.C6330 AS CUENTA_CASA_MATRIZ, 
    PLANCTAS.C6331 AS RUBRO_ANTERIOR, 
    PLANCTAS.C6340 AS RUBRO_OPERATIVO, 
    PLANCTAS.C6341 AS PRODUCTO, 
    PLANCTAS.RUBRO_PERDIDA_VAL, 
    PLANCTAS.RUBRO_GANANCIA_VAL, 
    PLANCTAS.C6318 AS DEVENGAMIENTO_INTERESES, 
    PLANCTAS.DEV_TASA_MORA, 
    PLANCTAS.CALIFICA, 
    PLANCTAS.DIADEVENGA, 
    PLANCTAS.PREVISIONA
FROM dbo.PLANCTAS WITH (NOLOCK); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_REM_MINIFILIALES'')
	DROP view [dbo].VW_REM_MINIFILIALES; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_REM_MINIFILIALES] 
AS
SELECT	rs.NRO_SOLICITUD ''Nro. Solicitud'', 
		rs.MONEDA Moneda, 
		rs.IMPORTE Importe, 
		rs.TIPODESTINO ''Tipo Destino'', 
		o.DESCRIPCION ''Descripción'', 
		rs.CAJA_DESTINO ''Caja Destino'', 
		vwc.MINIFILIAL ''Minifilial Destino'', 
		rs.SUCURSAL Sucursal, 
		rs.ESTADO Estado, 
		rs.CAJA_ORIGEN ''Caja Origen'' 
FROM REM_SOLICITUDREMESA rs WITH (NOLOCK) 
INNER JOIN OPCIONES o  WITH (NOLOCK) ON o.OPCIONINTERNA = rs.TIPODESTINO
									AND o.NUMERODECAMPO = 2599
									AND o.IDIOMA = ''E''
									AND rs.TIPODESTINO = 11
									AND rs.TIPOORIGEN = 11

INNER JOIN VW_CAJ_CAJAS vwc  WITH (NOLOCK)ON vwc.NRO_CAJA = rs.CAJA_DESTINO
											AND vwc.SUCURSAL = CAST(rs.DESTINO AS int) 
											AND vwc.MINIFILIAL > 0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_EST_SIT_PASIVO'')
	DROP view [dbo].VW_EST_SIT_PASIVO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_EST_SIT_PASIVO] 
AS

SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0201000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0201010000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0201020000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0201030000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0202000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0203000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0204000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0205000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT''
and [CODIGO]= ''0206000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0207000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0208000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0209000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0210000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0211000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0212000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and [CODIGO]= ''0200000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_REL_CLIENTE_PERSONA'')
	DROP view [dbo].VW_ITF_REL_CLIENTE_PERSONA; ')
execute(' CREATE OR ALTER       VIEW [dbo].[VW_ITF_REL_CLIENTE_PERSONA] (	[CODIGOCLIENTE], 
															NUMEROPERSONA)
AS 

SELECT CLI_CLIENTEPERSONA.[CODIGOCLIENTE], 
		CLI_CLIENTEPERSONA.NUMEROPERSONA
FROM dbo.CLI_CLIENTEPERSONA WITH (NOLOCK); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_EST_SIT_PATRIMONIO'')
	DROP view [dbo].VW_EST_SIT_PATRIMONIO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_EST_SIT_PATRIMONIO] 
AS

SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH (NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301020000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301030000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301040000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301050000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301060000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH (NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301070000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH (NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0301000000''
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0302000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH (NOLOCK)
WHERE informe=''ESTADO_SIT'' 
	and CODIGO = ''0300000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_USUARIOS'')
	DROP view [dbo].VW_ITF_USUARIOS; ')
execute(' CREATE OR ALTER       VIEW [dbo].[VW_ITF_USUARIOS] (
											   NOMBRE, 
											   CLAVE, 
											   INICIALES, 
											   GRUPO, 
											   NROSUCURSAL)
AS 
		
SELECT TOP 9223372036854775807 WITH TIES 
    USUARIOS.NOMBRE, 
    USUARIOS.CLAVE, 
    USUARIOS.INICIALES, 
    USUARIOS.GRUPO, 
    USUARIOS.NROSUCURSAL
FROM dbo.USUARIOS WITH (NOLOCK)
ORDER BY USUARIOS.NOMBRE; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ChequesRechazadosDenunciados'')
	DROP view [dbo].VW_ChequesRechazadosDenunciados; ')
execute(' CREATE OR ALTER   view [dbo].[VW_ChequesRechazadosDenunciados] as
SELECT 
--1
replicate(''0'', 5 - len(COD_ENTIDAD)) + cast (COD_ENTIDAD as varchar) as [CodigoEntidad],
--2
replicate(''0'', 3 - len(NRO_SUCURSAL)) + cast (NRO_SUCURSAL as varchar) as NumeroSucursal,
--3
replicate(''0'', 11 - len(CUENTA)) + cast (CUENTA as varchar) as NumeroCuentaCorriente,
--4
replicate(''0'', 8 - len(NRO_CHEQUE)) + cast (NRO_CHEQUE as varchar) as NumeroCheque,
--5
(Select Right(Cast(Year(FECHA_RECHAZO_O_PRES_COBRO) As Char(4)),2)) as AvisoAnio, -- Se usa campo FECHA_NOTIF_O_DENUNCIA
replicate(''0'', 6 - len(AVISO)) + cast (AVISO as varchar)as AvisoNumero,
--6
COD_MOVIMIENTO as [CodigoMovimiento],
--7
CLASE_REGISTRO as ClaseRegistro,
--8
Cast(Year(FECHA_RECHAZO_O_PRES_COBRO) As Char(4)) as FechaNotificacionDenuncia_Anio, -- Se usa campo FECHA_NOTIF_O_DENUNCIA
replicate(''0'', 2 - len(Cast(MONTH(FECHA_RECHAZO_O_PRES_COBRO) AS varchar))) + CAST(MONTH(FECHA_RECHAZO_O_PRES_COBRO) AS varchar) as FechaNotificacionDenuncia_Mes, -- Se usa campo FECHA_NOTIF_O_DENUNCIA
replicate(''0'', 2 - len(Cast(DAY(FECHA_RECHAZO_O_PRES_COBRO) AS varchar))) + CAST(DAY(FECHA_RECHAZO_O_PRES_COBRO) AS varchar) as FechaNotificacionDenuncia_Dia, -- Se usa campo FECHA_NOTIF_O_DENUNCIA
--9
CAUSAL as Causal,
--10
replicate(''0'', 2 - len(MONEDA)) + cast (MONEDA as varchar) as [CodigoMoneda],
--11
replicate(''0'', 15 - len(cast (FLOOR((IMPORTE*100)) as varchar))) + cast (FLOOR((IMPORTE*100)) as varchar) as Importe, --solucionar cantidad digitos son 15
--12
Cast(Year(FECHA_RECHAZO_O_PRES_COBRO) As Char(4)) as FechaRechazo_Anio,
replicate(''0'', 2 - len(Cast(MONTH(FECHA_RECHAZO_O_PRES_COBRO) AS varchar))) + CAST(MONTH(FECHA_RECHAZO_O_PRES_COBRO) AS varchar) as FechaRechazo_Mes, 
replicate(''0'', 2 - len(Cast(DAY(FECHA_RECHAZO_O_PRES_COBRO) AS varchar))) + CAST(DAY(FECHA_RECHAZO_O_PRES_COBRO) AS varchar) as FechaRechazo_Dia, 
--13
Cast(Year(FECHA_RECHAZO_O_PRES_COBRO) As Char(4)) as FechaRegistracion_Anio, -- Se usa campo FECHA_REGISTRACION
replicate(''0'', 2 - len(Cast(MONTH(FECHA_RECHAZO_O_PRES_COBRO) AS varchar))) + CAST(MONTH(FECHA_RECHAZO_O_PRES_COBRO) AS varchar) as FechaRegistracion_Mes, -- Se usa campo FECHA_REGISTRACION
replicate(''0'', 2 - len(Cast(DAY(FECHA_RECHAZO_O_PRES_COBRO) AS varchar))) + CAST(DAY(FECHA_RECHAZO_O_PRES_COBRO) AS varchar) as FechaRegistracion_Dia, -- Se usa campo FECHA_REGISTRACION
--14
replicate(''0'', 3 - len(PLAZO_DIFERIMIENTO)) + cast (PLAZO_DIFERIMIENTO as varchar) as PlazoDifirimiento,
--15
Cast(Year(FECHA_RECHAZO_O_PRES_COBRO) As Char(4)) as [FechaPagoCheque_Anio], -- Se usa campo [FECHA_PAGO_CHEQUE]
replicate(''0'', 2 - len(Cast(MONTH(FECHA_RECHAZO_O_PRES_COBRO) AS varchar))) + CAST(MONTH(FECHA_RECHAZO_O_PRES_COBRO) AS varchar) as [FechaPagoCheque_Mes], -- Se usa campo [FECHA_PAGO_CHEQUE]
replicate(''0'', 2 - len(Cast(DAY(FECHA_RECHAZO_O_PRES_COBRO) AS varchar))) + CAST(DAY(FECHA_RECHAZO_O_PRES_COBRO) AS varchar) as [FechaPagoCheque_Dia], -- Se usa campo [FECHA_PAGO_CHEQUE]
--16
''00000000'' as SinUso,
--17
Cast(Year(FECHA_RECHAZO_O_PRES_COBRO) As Char(4)) as [FechaPagoMulta_Anio],
replicate(''0'', 2 - len(Cast(MONTH([FECHA_PAGO_MULTA]) AS varchar))) + CAST(MONTH([FECHA_PAGO_MULTA]) AS varchar) as [FechaPagoMulta_Mes], 
replicate(''0'', 2 - len(Cast(DAY([FECHA_PAGO_MULTA]) AS varchar))) + CAST(DAY([FECHA_PAGO_MULTA]) AS varchar) as [FechaPagoMulta_Dia], 
--18
Cast(Year(FECHA_RECHAZO_O_PRES_COBRO) As Char(4)) as FechaCierreCuenta_Anio, -- Se usa campo FECHA_CIERRE_CTA
replicate(''0'', 2 - len(Cast(MONTH([FECHA_PAGO_MULTA]) AS varchar))) + CAST(MONTH([FECHA_PAGO_MULTA]) AS varchar) as FechaCierreCuenta_Mes, -- Se usa campo FECHA_CIERRE_CTA
replicate(''0'', 2 - len(Cast(DAY([FECHA_PAGO_MULTA]) AS varchar))) + CAST(DAY([FECHA_PAGO_MULTA]) AS varchar) as FechaCierreCuenta_Dia, -- Se usa campo FECHA_CIERRE_CTA
--19
replicate(''0'', 11 - len(PRIMER_NRO_IDENTIFICATORIO)) + cast (PRIMER_NRO_IDENTIFICATORIO as varchar) as PrimerNumeroIdentificatorio,
--20
replicate(''0'', 11 - len(SEGUNDO_NRO_IDENTIFICATORIO)) + cast (SEGUNDO_NRO_IDENTIFICATORIO as varchar) as SegundoNumeroIdentificatorio,
--21
replicate(''0'', 11 - len(TERCER_NRO_IDENTIFICATORIO)) + cast (TERCER_NRO_IDENTIFICATORIO as varchar) as TercerNumeroIdentificatorio,
--22
replicate(''0'', 11 - len(CUARTO_NRO_IDENTIFICATORIO)) + cast (CUARTO_NRO_IDENTIFICATORIO as varchar) as CuartoNumeroIdentificatorio,
--23
replicate(''0'', 11 - len(QUINTO_NRO_IDENTIFICATORIO)) + cast (QUINTO_NRO_IDENTIFICATORIO as varchar) as QuintoNumeroIdentificatorio,
--24
replicate(''0'', 11 - len(SEXTO_NRO_IDENTIFICATORIO)) + cast (SEXTO_NRO_IDENTIFICATORIO as varchar) as SextoNumeroIdentificatorio,
--25
replicate(''0'', 11 - len(SEPTIMO_NRO_IDENTIFICATORIO)) + cast (SEPTIMO_NRO_IDENTIFICATORIO as varchar) as SeptimoNumeroIdentificatorio,
--26
replicate(''0'', 11 - len(OCTAVO_NRO_IDENTIFICATORIO)) + cast (OCTAVO_NRO_IDENTIFICATORIO as varchar) as OctavoNumeroIdentificatorio,
--27
replicate(''0'', 11 - len(NOVENO_NRO_IDENTIFICATORIO)) + cast (NOVENO_NRO_IDENTIFICATORIO as varchar) as NovenoNumeroIdentificatorio,
--28
replicate(''0'', 11 - len(DECIMO_NRO_IDENTIFICATORIO)) + cast (DECIMO_NRO_IDENTIFICATORIO as varchar) as DecimooNumeroIdentificatorio
FROM RRII_CHE_RECHAZADOS WITH (NOLOCK); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_DOCUMENTOS_PJ'')
	DROP view [dbo].[VW_DOCUMENTOS_PJ]; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_DOCUMENTOS_PJ] (
												[Tipo Documento Identificativo], 
												[Número de Documento Identificativo], 
												[Razón Social],
												[Tipo Persona],  
												[Nivel de Apertura], 
												[Estado de la Persona],
												[Motivo Inhabilitado], 
												[Número de la Persona])
AS 
SELECT TOP 9223372036854775807 WITH TIES 
	V.TIPODOCUMENTO, 
	V.NUMERODOCUMENTO, 
	T.RAZONSOCIAL, 
	V.TIPOPERSONA, 
	CASE T.NIVEL_APERTURA
		WHEN 0 THEN ''REGISTRO''
		WHEN 1 THEN ''BÁSICO''
		WHEN 2 THEN ''PASIVOS''
		WHEN 3 THEN ''ACTIVOS''
		WHEN 4 THEN ''INST.FINANCIERA''
	END AS NIVELAPERTURA,       
	CASE T.ESTADO
		WHEN 0 THEN ''HABILITADO''
		WHEN 1 THEN ''INHABILITADO''
	END AS ESTADO,        	
	(SELECT DESCRIPCION 
	FROM OPCIONES WITH (NOLOCK)
	WHERE NUMERODECAMPO=33369 
		AND OPCIONINTERNA=T.MOTIVO_INHABILITADO) AS MOTIVO_INHABILITADO,
	V.NUMEROPERSONAFJ
FROM dbo.CLI_PERSONASJURIDICAS  AS T WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON  T.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ 
													AND V.TIPOPERSONA = ''J'' 
													AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
														AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
													AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
														AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
ORDER BY NUMEROPERSONAFJ; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CAJ_CAJAS'')
	DROP view [dbo].VW_CAJ_CAJAS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_CAJ_CAJAS] 
AS

SELECT 
	c.NRO_CAJA ''NRO_CAJA'', 
	u.CLAVE ''USUARIO'',
	u.INICIALES ''INICIALES'',
	u.NOMBRE ''NOMBRE'', 
	(CASE 
		WHEN c.ESTADO = ''A'' THEN ''Abierta''
		ELSE ''Cerrada''
	END) AS ESTADO,
	c.SUCURSAL,
	(CASE WHEN cc.Mini_Filial IS NULL THEN ''0''
	ELSE CONVERT(varchar(3),cc.Mini_Filial)
	END) AS ''MINIFILIAL'',
	cc.Descripcion AS ''DESCRIPCION''
FROM TABLA_CAJAS c WITH(NOLOCK)
INNER JOIN USUARIOS u WITH(NOLOCK) ON c.NRO_CAJA = u.NRODECAJA 
						AND c.SUCURSAL=u.NROSUCURSAL 
						AND
							(	(c.TZ_LOCK < 300000000000000 OR c.TZ_LOCK >= 400000000000000) 	
							AND (c.TZ_LOCK < 100000000000000 OR c.TZ_LOCK >= 200000000000000)) 
						AND(	(u.TZ_LOCK < 300000000000000 OR u.TZ_LOCK >= 400000000000000) 	
						AND		(u.TZ_LOCK < 100000000000000 OR u.TZ_LOCK >= 200000000000000))
LEFT JOIN CAJ_MiniFiliales cc WITH(NOLOCK) ON cc.SUCURSAL = c.SUCURSAL 
								AND cc.Mini_Filial IN(	SELECT cm.Mini_Filial 
														from CAJ_Cajas_MiniFiliales cm WITH(NOLOCK)
														WHERE cm.Mini_Filial = cc.Mini_Filial 
															AND cm.NRO_CAJA = c.NRO_CAJA 
															AND (	(cm.TZ_LOCK < 300000000000000 OR cm.TZ_LOCK >= 400000000000000) 
																AND (cm.TZ_LOCK < 100000000000000 OR cm.TZ_LOCK >= 200000000000000))
														); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RRII_ANEXO_12'')
	DROP view [dbo].VW_RRII_ANEXO_12; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_RRII_ANEXO_12] 
AS

-- 1)
SELECT 1 AS RENGLON,
	COUNT(DISTINCT VR1.Cliente_NroPersona) AS COLUMNA1,
	datefromparts(1900, 01, 01) AS FECHA,
	''N'' AS TIENE_FECHA
FROM VW_RRII_ANEXO_12_RENGLON1 VR1 WITH(NOLOCK)
		
UNION ALL
-- 2) clientes que estan cubiertos por la garantia de depositos
SELECT 2 AS RENGLON,
	COUNT(DISTINCT VR2.Cliente_NroPersona) AS COLUMNA1,
	datefromparts(1900, 01, 01) AS FECHA,
	''N'' AS TIENE_FECHA
FROM VW_RRII_ANEXO_12_RENGLON2 VR2 WITH(NOLOCK)

--3) 
UNION ALL

SELECT 3 AS RENGLON, NULL AS COLUMNA1,
datefromparts(1900, 01, 01) AS FECHA,
	''N'' AS TIENE_FECHA

UNION ALL
--4) SACAR DE VISTA SUMA ANEXO12 por NRO_CAMPO = 4 Y FECHA
SELECT	4 AS RENGLON, 
		SUM_CONT AS COLUMNA1, 
		FECHA, ''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK) 
WHERE NRO_CAMPO = 4

UNION ALL

--5) IDEM ANTERIOR SOLO QUE NRO_CAMPO = 5 
SELECT	5 AS RENGLON, 
		SUM_CONT AS COLUMNA1, 
		FECHA, ''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK) 
WHERE NRO_CAMPO = 5
--6) y 7) PENDIENTES
UNION ALL

SELECT 6 AS RENGLON, NULL AS COLUMNA1,
datefromparts(1900, 01, 01) AS FECHA,
	''N'' AS TIENE_FECHA
UNION ALL
SELECT 7 AS RENGLON, NULL AS COLUMNA1,
datefromparts(1900, 01, 01) AS FECHA,
	''N'' AS TIENE_FECHA

UNION ALL
-- 8) VISTA SUMA_ANEXO12 NRO_CAMPO = 8
SELECT	8 AS RENGLON, 
		SUM_CONT AS COLUMNA1, 
		FECHA, 
		''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK) 
WHERE NRO_CAMPO = 8
--9) SE HACE CON FORMULA EN PLANTILLA EXCEL
UNION ALL
SELECT 9 AS RENGLON, NULL AS COLUMNA1,
datefromparts(1900, 01, 01) AS FECHA,
	''N'' AS TIENE_FECHA

UNION ALL
--10) VISTA SUMA_ANEXO12 NRO_CAMPO = 10
SELECT	10 AS RENGLON, 
		SUM_CONT AS COLUMNA1, 
		FECHA, ''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK) 
WHERE NRO_CAMPO = 10
UNION ALL
--11) IDEM ANTERIOR NRO_CAMPO = 11
SELECT 11 AS RENGLON,
		SUM_CONT AS COLUMNA1, 
		FECHA, ''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK)
WHERE NRO_CAMPO = 11
UNION ALL


--12) Cantidad de Operaciones por Préstamos Prendarios en Pesos.
--13) lo mismo que anterior pero con hipotecarios

SELECT 13 AS RENGLON,
	COUNT(*), GS.FECHA, ''S'' AS TIENE_FECHA
FROM
	GRL_SALDOS_DIARIOS GS  WITH(NOLOCK)
INNER JOIN SALDOS S  WITH(NOLOCK) ON
									GS.SALDOS_JTS_OID = S.JTS_OID
INNER JOIN MONEDAS M  WITH(NOLOCK) ON
									GS.MONEDA = M.C6399,
 									CO_BALANCE_ESTRUCTURA CBE --CODIGOAGRUPADOR C

WHERE CBE.CODIGO_INTERNO = ''0103100700''
AND CBE.ID_BCE = 2
AND M.C6403 = ''N''
AND S.C1785 = 5
AND SUBSTRING(CAST(GS.RUBROCONTABLE AS VARCHAR(11)),1,LEN(CBE.RUBRO_CONTABLE)) = CBE.RUBRO_CONTABLE --cbe.rubrocontable
GROUP BY GS.FECHA

UNION ALL

--14) Cantidad de Operaciones por Otros Préstamos en Pesos.

SELECT 14 AS RENGLON,
	COUNT(*), GS.FECHA, ''S'' AS TIENE_FECHA
FROM
	GRL_SALDOS_DIARIOS GS  WITH(NOLOCK)
INNER JOIN SALDOS S  WITH(NOLOCK) ON
	GS.SALDOS_JTS_OID = S.JTS_OID
INNER JOIN MONEDAS M  WITH(NOLOCK) ON
	GS.MONEDA = M.C6399,
CO_BALANCE_ESTRUCTURA CBE

WHERE CBE.CODIGO_INTERNO IN (''0103100700'',''0103100800'')
AND CBE.ID_BCE = 2
AND M.C6403 = ''N''
AND S.C1785 = 5
AND SUBSTRING(CAST(GS.RUBROCONTABLE AS VARCHAR(11)),1,LEN(CBE.RUBRO_CONTABLE)) <> CBE.RUBRO_CONTABLE 
GROUP BY GS.FECHA

UNION ALL
--15) Cantidad de Operaciones por Préstamos Prendarios en Moneda Extranjera.

SELECT 15 AS RENGLON,
	COUNT(*), GS.FECHA, ''S'' AS TIENE_FECHA
FROM
	GRL_SALDOS_DIARIOS GS  WITH(NOLOCK)
INNER JOIN SALDOS S  WITH(NOLOCK) ON
									GS.SALDOS_JTS_OID = S.JTS_OID
INNER JOIN MONEDAS M  WITH(NOLOCK) ON
									GS.MONEDA = M.C6399,
CO_BALANCE_ESTRUCTURA CBE
WHERE CBE.CODIGO_INTERNO = ''0103100800'' -- CBR.CODIGO_INTERNO = ''0103100800''
AND CBE.ID_BCE = 2
AND M.C6403 = ''E''
AND S.C1785 = 5
AND SUBSTRING(CAST(GS.RUBROCONTABLE AS VARCHAR(11)),1,LEN(CBE.RUBRO_CONTABLE)) <> CBE.RUBRO_CONTABLE 
GROUP BY GS.FECHA

UNION ALL

--16) Cantidad de Operaciones por Préstamos Hipotecarios en Mon. Extranjera.
SELECT 16 AS RENGLON,
	COUNT(*), GS.FECHA, ''S'' AS TIENE_FECHA
FROM
	GRL_SALDOS_DIARIOS GS  WITH(NOLOCK)
INNER JOIN SALDOS S  WITH(NOLOCK) ON
	GS.SALDOS_JTS_OID = S.JTS_OID
INNER JOIN MONEDAS M  WITH(NOLOCK) ON
	GS.MONEDA = M.C6399,
CO_BALANCE_ESTRUCTURA CBE

WHERE CBE.CODIGO_INTERNO = ''0103100700''
AND CBE.ID_BCE = 2
AND M.C6403 = ''E''
AND S.C1785 = 5
AND SUBSTRING(CAST(GS.RUBROCONTABLE AS VARCHAR(11)),1,LEN(CBE.RUBRO_CONTABLE)) <> CBE.RUBRO_CONTABLE 
GROUP BY GS.FECHA

UNION ALL
--17) Cantidad de Operaciones por otros Préstamos en Moneda Extranjera.
SELECT 17 AS RENGLON,
	COUNT(*), GS.FECHA, ''S'' AS TIENE_FECHA
FROM
	GRL_SALDOS_DIARIOS GS  WITH(NOLOCK)
INNER JOIN SALDOS S  WITH(NOLOCK) ON
									GS.SALDOS_JTS_OID = S.JTS_OID
INNER JOIN MONEDAS M  WITH(NOLOCK) ON
									GS.MONEDA = M.C6399,
CO_BALANCE_ESTRUCTURA CBE

WHERE CBE.CODIGO_INTERNO IN (''0103100700'',''0103100800'')
AND CBE.ID_BCE = 2
AND M.C6403 = ''E''
AND S.C1785 = 5
AND SUBSTRING(CAST(GS.RUBROCONTABLE AS VARCHAR(11)),1,LEN(CBE.RUBRO_CONTABLE)) <> CBE.RUBRO_CONTABLE 
GROUP BY GS.FECHA

UNION ALL
--18) VISTA SUMA_ANEXO12 NRO_CAMPO = 18
SELECT 18 AS RENGLON, 
		SUM_CONT AS COLUMNA1, 
		FECHA, ''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK)
WHERE NRO_CAMPO = 18
UNION ALL
--19) IDEM ANTERIOR NRO_CAMPO = 19
SELECT	19 AS RENGLON, 
		SUM_CONT AS COLUMNA1, 
		FECHA, 
		''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK)
WHERE NRO_CAMPO = 19
UNION ALL
--20) PENDIENTE DE TARJETA DE CREDITO

--21) SE HACE CON FORMULA EN PLANTILLA EXCEL

--22) VISTA SUMA_ANEXO12 NRO_CAMPO = 22
SELECT	22 AS RENGLON, 
		SUM_CONT AS COLUMNA1, 
		FECHA, ''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK) 
WHERE NRO_CAMPO = 22
UNION ALL
--23) VISTA SUMA_ANEXO12 NRO_CAMPO =23, PERO FALTA PARAMETRIAS DE TIPOS DE CAJA DE AHORRO

--24) VISTA SUMA_ANEXO12 NRO_CAMPO = 24
SELECT	24 AS RENGLON, 
		SUM_CONT AS COLUMNA1, 
		FECHA, 
		''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK) 
WHERE NRO_CAMPO = 24
-- CAMPOS 25) Y 26) SE INSERTAN DE FORMA MANUAL
UNION ALL
SELECT 25 AS RENGLON, NULL AS COLUMNA1,
datefromparts(1900, 01, 01) AS FECHA,
	''N'' AS TIENE_FECHA
UNION ALL
SELECT 26 AS RENGLON, NULL AS COLUMNA1,
datefromparts(1900, 01, 01) AS FECHA,
	''N'' AS TIENE_FECHA

	UNION ALL

--27) VISTA SUMA_ANEXO12 NRO_CAMPO 27 Y HACER COUNT(TIPO_PERS) WHERE TIPO_PERS = 1
SELECT 27 AS RENGLON, COUNT(SUM_CONT) AS COLUMNA1, FECHA, ''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK)
WHERE	NRO_CAMPO = 27 
		AND SUM_CONT = 1 
GROUP BY FECHA
UNION ALL

--28) IDEM ANTERIOR SOLO QUE TIPO_PERS = 2
SELECT	28 AS RENGLON, 
		COUNT(SUM_CONT) AS COLUMNA1, 
		FECHA, ''S'' AS TIENE_FECHA 
FROM VW_RRII_TOTALES_ANEXO_12  WITH(NOLOCK) 
WHERE NRO_CAMPO = 27 
	AND SUM_CONT = 2 
GROUP BY FECHA; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''USUARIOSBPM'')
	DROP view [dbo].USUARIOSBPM; ')
execute(' CREATE OR ALTER   VIEW [dbo].[USUARIOSBPM]
AS (
select clave, nombre, grupo 
from usuarios WITH (NOLOCK)
UNION
select	''Administrator'' as clave , 
		''Administrator'' as nombre, 
		''Administrators'' as grupo); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PARTIDA_TIPO'')
	DROP view [dbo].VW_PARTIDA_TIPO; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_PARTIDA_TIPO]
AS
SELECT PARTIDA, TIPO 
FROM PARTIDATIPO WITH (NOLOCK)
WHERE TZ_LOCK=0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''Certificado_clientes'')
	DROP view [dbo].Certificado_clientes; ')
execute(' CREATE OR ALTER   VIEW [dbo].[Certificado_clientes]
												(CODCLIENTE,
												DOCUMENTO,
												NOMBRE)
AS
SELECT 
	C.CODIGOCLIENTE AS CODCLIENTE,
	D.TIPODOC + '' '' + D.NUMERODOC AS DOCUMENTO,
	C.NOMBRECLIENTE AS NOMBRE
FROM CLI_CLIENTES C WITH (NOLOCK)
INNER JOIN CLI_ClientePersona P  WITH (NOLOCK)ON C.CODIGOCLIENTE = P.CODIGOCLIENTE
INNER JOIN VW_CLI_X_DOC D  WITH (NOLOCK)ON C.CODIGOCLIENTE = D.CODIGOCLIENTE; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_GARANTIASPRESTAMOS'')
	DROP view [dbo].VW_GARANTIASPRESTAMOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_GARANTIASPRESTAMOS] (
														Operacion,
														Linea,
														"Nombre Linea",
														Familia,
														Garantia, 
														Tipo_Garantia,
														SubClass_Garantia,
														Descripcion,
														Moneda, 
														Monto, 
														Monto_Utilizado,
														Vencimiento,
														JTS_OID)
AS 
SELECT 	
	s.OPERACION AS Operacion,
	s.PRODUCTO AS Linea,
	p.C6251 AS Nombre_Linea,
	p.C6283 AS Familia,
	gc.NUM_GARANTIA AS Garantia, 
	g.TIPOGARANTIA AS Tipo_Garantia,
	g.COD_SUBCLAGARANTIA AS SubClass_Garantia,
	c.DSC_CLASIFICACION AS Descripcion,
	m.C6401 AS Moneda, 
	g.IMPORTE_REAL AS Monto, 
	(	SELECT isnull(sum(MONTO_GARANTIZADO_MG),0) 
		FROM CRE_HISTORICO_DEUDA_GARANTIAS WITH (NOLOCK)
		WHERE NRO_GARANTIA = g.NUM_GARANTIA 
				AND SALDO_JTS_OID=s.JTS_OID 
				AND FECHA_PROCESO = (	SELECT FECHAPROCESOANTERIOR 
										FROM PARAMETROS WITH (NOLOCK))) AS MontoUtilizado,
	g.FCHVTO_GARANTIA AS Vencimiento,
	s.JTS_OID AS JTS_OID
FROM CRE_GARANTIACREDITO gc WITH (NOLOCK)
INNER JOIN CRE_GARANTIASRECIBIDAS g WITH (NOLOCK)ON gc.NUM_GARANTIA = g.NUM_GARANTIA AND g.TZ_LOCK = 0
INNER JOIN MONEDAS m WITH (NOLOCK)ON g.MONEDA_GARANTIA = m.C6399 AND m.TZ_LOCK = 0
INNER JOIN CRE_CLASGARANTIAS c WITH (NOLOCK)ON g.TIPOGARANTIA = c.TIPOGARANTIA AND c.TZ_LOCK = 0
INNER JOIN SALDOS s WITH (NOLOCK)ON gc.JTSOID_SALDO = s.JTS_OID AND s.TZ_LOCK = 0
INNER JOIN PRODUCTOS p WITH (NOLOCK)ON s.PRODUCTO = p.C6250 AND p.TZ_LOCK = 0
WHERE gc.DESVINCULADO = ''N'' 
	AND gc.TZ_LOCK = 0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_AOJ_CUENTAS'')
	DROP view [dbo].VW_ITF_AOJ_CUENTAS; ')
execute(' CREATE OR ALTER VIEW [dbo].[VW_ITF_AOJ_CUENTAS] 
AS

SELECT DISTINCT
		RIGHT(REPLICATE(''0'', 50)+ CAST(CP.NUMEROPERSONA AS VARCHAR(50)), 50) AS ID_CLIENTE, 
		dbo.NCADENAS(concat(
							RIGHT(REPLICATE(''0'', 4)+ CAST(S.SUCURSAL AS VARCHAR(5)), 4), 
							''-'',
							RIGHT(REPLICATE(''0'', 5)+ CAST(S.PRODUCTO AS VARCHAR(5)), 5), 
							''-'',
							RIGHT(REPLICATE(''0'', 9)+ CAST(S.CUENTA AS VARCHAR(12)), 9), 
							''-'',
							RIGHT(REPLICATE(''0'', 4)+ CAST(S.MONEDA AS VARCHAR(4)), 4) ,  
							''-'',
							RIGHT(REPLICATE(''0'', 8)+ CAST(S.OPERACION AS VARCHAR(12)), 8), 
							''-'',
							RIGHT(REPLICATE(''0'', 6)+ CAST(S.ORDINAL AS VARCHAR(6)), 6)
					),50,''0'',''P'') AS NUMERO_CUENTA,
		RIGHT(concat(''00000'',  (SELECT CAST(IMPORTE_1 AS  NUMERIC(15)) 
								FROM ITF_MASTER_PARAMETROS WITH (NOLOCK)
								WHERE [CODIGO_INTERFACE] = 7 
									AND NUMERICO_1 = S.PRODUCTO 
									AND NUMERICO_2 = S.MONEDA AND TZ_LOCK = 0)), 5) AS ''Tipo de Cuenta'',
		RIGHT(concat(''000000'', S.SUCURSAL), 6) AS ''Codigo Sucursal'',
		LEFT(concat((''Producto ''+ CAST(P.C6250 AS VARCHAR(7))+'': ''+ P.C6251), replicate('' '', 200)), 200) AS ''Observacion'',
		(CASE
			WHEN p.C6252 = 1 OR p.C6252 = 2 OR p.C6252 = 3 AND s.C1651=1 THEN ''C''
			WHEN p.C6252 = 2 OR p.C6252 = 3 AND s.C1651<>1 THEN ''V''
			WHEN p.C6252 = 4 OR p.C6252 = 5 AND s.C1604=0 THEN ''C''
			WHEN p.C6252 = 4 OR p.C6252 = 5 AND s.C1604<>0 THEN ''V''
			ELSE ''V''
		END) AS EST_PRODUCTO,
		REPLACE(concat(''#{Top.Output}AOJ/ofjudiciales_cuentas_'',CONVERT(CHAR(8),FECHAPROCESO,112)) , ''#{'', ''${'') AS NOM_ARCHIVO
FROM PARAMETROS, CLI_CLIENTES c WITH (NOLOCK)
JOIN CLI_ClientePersona cp  WITH (NOLOCK)ON cp.[CODIGOCLIENTE]=c.[CODIGOCLIENTE]
JOIN SALDOS s  WITH (NOLOCK)ON c.[CODIGOCLIENTE]=s.C1803
JOIN PRODUCTOS p  WITH (NOLOCK)ON p.C6250 = s.PRODUCTO
WHERE ((C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000) AND (C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)) AND 
      ((CP.TZ_LOCK < 300000000000000 OR CP.TZ_LOCK >= 400000000000000) AND (CP.TZ_LOCK < 100000000000000 OR CP.TZ_LOCK >= 200000000000000)) AND 
      ((P.TZ_LOCK < 300000000000000 OR P.TZ_LOCK >= 400000000000000) AND (P.TZ_LOCK < 100000000000000 OR P.TZ_LOCK >= 200000000000000)) AND 
      ((S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))
UNION ALL
SELECT 
	RIGHT(REPLICATE(''0'', 50)+ CAST(CP.NUMEROPERSONA AS VARCHAR(50)), 50) AS ID_CLIENTE,
	dbo.NCADENAS(cc.[CODIGO_COFRE],50,''0'',''P'') AS NUMERO_CUENTA,
	''00008'' AS ''Tipo de Cuenta'',
	dbo.NCADENAS(cc.SUCURSAL_DEBITO,6,''0'',''P'') AS ''Codigo Sucursal'',
	''Caja de Seguridad'' AS ''Observacion'',
	''V'' AS EST_PRODUCTO,
	REPLACE(concat(''#{Top.Output}AOJ/ofjudiciales_cuentas_'',CONVERT(CHAR(8),(	SELECT FECHAPROCESO 
																				FROM PARAMETROS WITH(NOLOCK)),112)) , ''#{'', ''${'') AS NOM_ARCHIVO
FROM COF_COFRES_CONTRATOS cc  WITH (NOLOCK)  
INNER JOIN CLI_CLIENTES c  WITH (NOLOCK)ON cc.CLIENTE=c.[CODIGOCLIENTE]
										AND cc.TZ_LOCK=0
INNER JOIN CLI_ClientePersona cp WITH (NOLOCK) ON cp.[CODIGOCLIENTE]=c.[CODIGOCLIENTE] 
												AND cp.TITULARIDAD=''T''; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ACT_ECO'')
	DROP view [dbo].VW_ACT_ECO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_ACT_ECO] 
AS
SELECT
		COD_ACTIVIDAD,
		DESCRIPCION,
		PERIODO_ACTIVIDAD,
		TIPO_ACTIVIDAD,
		VERIFICADO_AFIP,
		FECHA_VERIFICADO,
		CODIGO_PERSONA,
		TIPO_DOCUMENTO,
		NUMERO_DOCUMENTO,
		ORDINAL,
		ORDEN_AFIP
FROM
	(     
	SELECT
		c.CODIGO_ACTIVIDAD AS COD_ACTIVIDAD,
		a.DESCRIPCION,
		c.INICIO_ACTIVIDAD AS PERIODO_ACTIVIDAD,
		(CASE 
			WHEN c.ORDEN_AFIP=1 THEN ''Primaria''
			WHEN ((	SELECT COUNT(*) 
					FROM CLI_ACTIVIDAD_ECONOMICA a WITH(NOLOCK)
					WHERE a.CODIGO_PERSONA_CLIENTE= d.NUMEROPERSONAFJ 
						AND a.ORDEN_AFIP = 99 
						AND (	(a.TZ_LOCK < 300000000000000 OR a.TZ_LOCK >= 400000000000000) 
							AND (a.TZ_LOCK < 100000000000000 OR a.TZ_LOCK >= 200000000000000))
					) = (	SELECT COUNT(*) 
							FROM CLI_ACTIVIDAD_ECONOMICA a WITH (NOLOCK)
							WHERE a.CODIGO_PERSONA_CLIENTE= d.NUMEROPERSONAFJ 
								AND (	(a.TZ_LOCK < 300000000000000 OR a.TZ_LOCK >= 400000000000000) 
									AND (a.TZ_LOCK < 100000000000000 OR a.TZ_LOCK >= 200000000000000))) 
									AND (	SELECT MIN(a.ORDINAL_ACTIVIDAD) 
											FROM CLI_ACTIVIDAD_ECONOMICA a WITH (NOLOCK) 
											WHERE a.CODIGO_PERSONA_CLIENTE = d.NUMEROPERSONAFJ 
												AND (	(a.TZ_LOCK < 300000000000000 OR a.TZ_LOCK >= 400000000000000) 
													AND (a.TZ_LOCK < 100000000000000 OR a.TZ_LOCK >= 200000000000000))
										) =  c.ORDINAL_ACTIVIDAD ) THEN ''Primaria''
		ELSE ''Secundaria''
		END) AS TIPO_ACTIVIDAD,
		c.VERIFICADO_AFIP AS VERIFICADO_AFIP,
		c.FECHA_VERIFICADO,
		c.CODIGO_PERSONA_CLIENTE AS CODIGO_PERSONA,
		d.TIPODOCUMENTO AS TIPO_DOCUMENTO,
		d.NUMERODOCUMENTO AS NUMERO_DOCUMENTO,
		c.ORDINAL_ACTIVIDAD AS ORDINAL,
		c.ORDEN_AFIP
	FROM CLI_ACTIVIDAD_ECONOMICA c WITH(NOLOCK)
	INNER JOIN CLI_Cod_Act_AFIP a  WITH(NOLOCK)ON c.CODIGO_ACTIVIDAD=a.CODIGO_ACT_AFIP 
												AND (	(c.TZ_LOCK < 300000000000000 OR c.TZ_LOCK >= 400000000000000) 
													AND (c.TZ_LOCK < 100000000000000 OR c.TZ_LOCK >= 200000000000000))
	LEFT JOIN CLI_DocumentosPFPJ d WITH(NOLOCK)ON d.NUMEROPERSONAFJ=c.CODIGO_PERSONA_CLIENTE 
									AND (	(d.TZ_LOCK < 300000000000000 OR d.TZ_LOCK >= 400000000000000) 
										AND (d.TZ_LOCK < 100000000000000 OR d.TZ_LOCK >= 200000000000000))

	) X 
ORDER BY	ORDEN_AFIP, 
			ORDINAL OFFSET 0 ROWS; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_LAMINASCODNBC'')
	DROP view [dbo].VW_LAMINASCODNBC; ')
execute(' CREATE OR ALTER       VIEW [dbo].[VW_LAMINASCODNBC] (
													   CODIGOBCO, 
													   CODINTERNACIONAL, 
													   SERIELAMINA, 
													   DESDE, 
													   HASTA, 
													   IMPORTE, 
													   CODTITULO)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
    T.CODIGOBCO, 
    T.CODINTERNACIONAL, 
    L.SERIELAMINA, 
    L.DESDE, 
    L.HASTA, 
    L.IMPORTE, 
    T.CODTITULO
FROM dbo.VAL_TITULOS  AS T WITH(NOLOCK)
INNER JOIN dbo.VAL_LAMINAS  AS L WITH(NOLOCK) ON 
											T.CODTITULO = L.CODTITULO AND 
											(	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
											AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
										AND 
											(	(L.TZ_LOCK < 300000000000000 OR L.TZ_LOCK >= 400000000000000) 
											AND (L.TZ_LOCK < 100000000000000 OR L.TZ_LOCK >= 200000000000000))
ORDER BY T.CODIGOBCO; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CLI_CORREOS'')
	DROP view [dbo].VW_CLI_CORREOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_CLI_CORREOS]  (
											TIPODOCUMENTO,
											NUMERODOCUMENTO,
											TIPO_DOC_FISICO,
 											NUM_DOC_FISICO,
											NOMBRE,
											FORMATO,
											DESC_FORMATO,
											TIPO,
											DESC_TIPO,
											ORDINAL,
											EMAIL,
											TIPO_CLIENTE,
											NOMBRECLIENTE,
											CODIGOCLIENTE,
											NUMEROPERSONA,
											TIPOPERSONA
										)
AS
SELECT 
 	  v.TIPODOCUMENTO,
 	  v.NUMERODOCUMENTO,
 	  v.TIPO_DOC_FISICO,
 	  v.NUM_DOC_FISICO,
 	  concat(u.APELLIDOPATERNO,'' '',u.PRIMERNOMBRE) AS NOMBRE,
   	  a.FORMATO,
   	  (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH(NOLOCK)
		WHERE O.IDIOMA = ''E'' 
			AND O.NUMERODECAMPO = 33460 
			AND O.OPCIONINTERNA= a.FORMATO) AS DESC_FORMATO,
   	  a.TIPO,
   	  (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH(NOLOCK)
		WHERE O.IDIOMA = ''E'' 
			AND O.NUMERODECAMPO = 33494 
			AND O.OPCIONINTERNA= a.TIPO) AS DESC_TIPO,
  	  a.ORDINAL,
   	  a.EMAIL,
   	  (	SELECT DESCRIPCION 
		FROM OPCIONES WITH(NOLOCK) 
		WHERE IDIOMA = ''E'' 
			AND NUMERODECAMPO = 1040 
			AND OPCIONINTERNA = r.tipo) AS TIPO_CLIENTE,
   	  R.NOMBRECLIENTE,
   	  R.CODIGOCLIENTE,  
      V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
      (	SELECT DESCRIPCION 
		FROM OPCIONES WITH(NOLOCK) 
		WHERE IDIOMA = ''E'' 
			AND NUMERODECAMPO = 1861 
			AND OPCIONINTERNA = V.TIPOPERSONA) AS TIPOPERSONA        
FROM 
    dbo.CLI_CLIENTES  AS R  WITH(NOLOCK)
INNER JOIN dbo.CLI_CLIENTEPERSONA  AS T WITH (NOLOCK)ON R.CODIGOCLIENTE = T.CODIGOCLIENTE
													AND T.TITULARIDAD=''T''
													AND (	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
														AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000))
													AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
														AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_PERSONASFISICAS  AS U WITH (NOLOCK) ON U.NUMEROPERSONAFISICA = T.NUMEROPERSONA
														AND (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
															AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK) ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
														AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
															AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)) 
INNER JOIN dbo.CLI_EMAILS AS A WITH (NOLOCK) ON  T.NUMEROPERSONA=A.ID
											AND A.FORMATO = ''PF''  
											AND a.ID=t.NUMEROPERSONA
											AND (	(A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000) 
												AND (A.TZ_LOCK < 100000000000000 OR A.TZ_LOCK >= 200000000000000))
UNION ALL
SELECT 
      v.TIPODOCUMENTO,
 	  v.NUMERODOCUMENTO,
 	  v.TIPO_DOC_FISICO,
 	  v.NUM_DOC_FISICO,
 	  s.RAZONSOCIAL,
 	  a.FORMATO,
   	  (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA = ''E'' 
			AND O.NUMERODECAMPO = 33460 
			AND O.OPCIONINTERNA= a.FORMATO) AS DESC_FORMATO,
   	  a.TIPO,
   	  (	SELECT DESCRIPCION 
		FROM OPCIONES O  WITH (NOLOCK)
		WHERE O.IDIOMA = ''E'' 
			AND O.NUMERODECAMPO = 33494 
			AND O.OPCIONINTERNA= a.TIPO) AS DESC_TIPO,
   	  a.ORDINAL,
   	  a.EMAIL,
   	  (	SELECT DESCRIPCION 
	  FROM OPCIONES  WITH (NOLOCK)
	  WHERE IDIOMA = ''E'' 
		AND NUMERODECAMPO = 1040 
		AND OPCIONINTERNA = r.tipo) AS TIPO_CLIENTE,
   	  R.NOMBRECLIENTE,
   	  R.CODIGOCLIENTE,  
      V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
      (	SELECT DESCRIPCION 
		FROM OPCIONES  WITH (NOLOCK)
		WHERE IDIOMA = ''E'' 
			AND NUMERODECAMPO = 1861 
			AND OPCIONINTERNA = V.TIPOPERSONA) AS TIPOPERSONA     
FROM dbo.CLI_CLIENTES  AS R WITH (NOLOCK) 
INNER JOIN dbo.CLI_CLIENTEPERSONA  AS T WITH (NOLOCK)ON R.CODIGOCLIENTE = T.CODIGOCLIENTE
													AND (	(R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) 
														AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000))
													AND T.TITULARIDAD=''T''
													AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
														AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
INNER JOIN dbo.CLI_PERSONASJURIDICAS  AS S WITH (NOLOCK)ON S.NUMEROPERSONAJURIDICA = T.NUMEROPERSONA
														AND (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
															AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
													AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
														AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_EMAILS AS A WITH (NOLOCK)ON A.FORMATO = ''PJ''
											AND T.NUMEROPERSONA=A.ID
											AND (a.ID=s.NUMEROPERSONAJURIDICA) 
											AND (	(A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000) 
												AND (A.TZ_LOCK < 100000000000000 OR A.TZ_LOCK >= 200000000000000)); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_LCI'')
	DROP view [dbo].VW_LCI; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_LCI] (
										NROLC, 
										ORDINALNEGOCIA, 
										IMPORTELC, 
										MONEDALC, 
										FECHAVTO, 
										CLIENTE, 
										NOMBRECLIENTE, 
										PAGACLIENTE)
AS 
SELECT 
    C.NROLC, 
    C.ORDINALNEGOCIA, 
    C.IMPORTELC, 
    C.MONEDALC, 
    C.FECHAVTO, 
    C.CLIENTE, 
    CL.NOMBRECLIENTE, 
    C.PAGACLIENTE
FROM dbo.CARTASCREDITO  AS C WITH (NOLOCK) 
INNER JOIN dbo.CLI_CLIENTES  AS CL  WITH (NOLOCK)ON C.CLIENTE = CL.CODIGOCLIENTE
												AND C.SOLPROCESADA <> ''P''
												AND (	(C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000) 
													AND (C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)) 
												AND (	(CL.TZ_LOCK < 300000000000000 OR CL.TZ_LOCK >= 400000000000000) 
													AND (CL.TZ_LOCK < 100000000000000 OR CL.TZ_LOCK >= 200000000000000)); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''CLI_PFCONYUGE'')
	DROP view [dbo].CLI_PFCONYUGE; ')
execute(' CREATE OR ALTER   VIEW [dbo].[CLI_PFCONYUGE] (
												TZ_LOCK,
												NUMEROPERSONAFISICA,
												NUMEROPERSONAFISICACONY,
												TIPORELACION,
												DESCRIPCION,
												FECHA)
AS
SELECT
	  TZ_LOCK,
	  PERSONA_VINCULANTE AS "NUMEROPERSONAFISICA",
	  PERSONA_VINCULADA AS "NUMEROPERSONAFISICACONY",
	  CASE ROL  WHEN 71 THEN ''C'' 
  				WHEN 72 THEN ''U'' ELSE '' '' 
	  END AS TIPORELACION,
	  CAST(NULL AS VARCHAR(60)) AS DESCRIPCION,
	  CAST(NULL AS DATETIME) AS FECHA 
FROM dbo.CLI_VINCULACIONES WITH(NOLOCK)
WHERE
  TIPO_PERSONA_VINCULANTE = ''F''
  AND TIPO_PERSONA_VINCULADA = ''F''
  AND ROL IN (71,72)
  AND FECHA_FIN IS NULL
  AND (TZ_LOCK < 300000000000000 or TZ_LOCK >= 400000000000000) 
  and (TZ_LOCK < 100000000000000 or TZ_LOCK >= 200000000000000); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CUENTAS_CANCELADAS'')
	DROP view [dbo].VW_CUENTAS_CANCELADAS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_CUENTAS_CANCELADAS](
													Cuenta,
													Nombre,
													Producto,
													Descripcion,
													Moneda,
													Sucursal,
													Cliente,
													[Codigo Motivo],
													Motivo,
													Fecha,
													JTS_OID) 
AS 
SELECT C.CUENTA, 
		C.NOMBRE, 
		C.PRODUCTO, 
		C.DESCRIPCION, 
		C.MONEDA, 
		C.SUCURSAL, 
		C.CLIENTE,
		V.CODIGO_MOTIVO, 
		M.DESCRIPCION, 
		V.FECHA_CANCELACION, 
		C.JTS_OID
FROM VW_CUENTAS C WITH (NOLOCK)
INNER JOIN CV_CANCELACION_CUENTAS V WITH (NOLOCK) ON C.JTS_OID = V.SALDO_JTS_OID
													AND V.TZ_LOCK = 0
INNER JOIN CV_MOTIVOS_CANCELACION M WITH (NOLOCK) ON V.CODIGO_MOTIVO = M.CODIGO_MOTIVO
													AND M.TZ_LOCK = 0
WHERE   C.C1651 = ''1''; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_GARANTIASCREDITOS'')
	DROP view [dbo].VW_GARANTIASCREDITOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_GARANTIASCREDITOS] (
													   Cliente, 
													   Garantia,
													   Credito_Usuario,
													   Desvinculado,
													   JTS_OID)
AS 
SELECT gc.COD_CLIENTE AS Cliente, 
		gc.NUM_GARANTIA AS Garantia, 
		CASE WHEN s.C1785 = 5 THEN s.OPERACION 
		ELSE s.CUENTA 
		END AS Credito_Usuario, 
		gc.DESVINCULADO AS Desvinculado, 
		s.JTS_OID 
FROM CRE_GARANTIACREDITO gc WITH (NOLOCK)
INNER JOIN SALDOS s  WITH (NOLOCK)ON gc.JTSOID_SALDO = s.JTS_OID 
									AND s.TZ_LOCK = 0
INNER JOIN CRE_GARANTIASRECIBIDAS g  WITH (NOLOCK)ON gc.NUM_GARANTIA = g.NUM_GARANTIA 
													AND gc.TZ_LOCK = 0
WHERE gc.DESVINCULADO = ''N'' 
		AND gc.TZ_LOCK = 0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RRII_ANEXO_12_RENGLON1'')
	DROP view [dbo].VW_RRII_ANEXO_12_RENGLON1; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_RRII_ANEXO_12_RENGLON1] 
AS
SELECT DISTINCT 
	(CP.NUMEROPERSONA) AS Cliente_NroPersona,
	S.C1785 AS Producto
FROM
	CLI_CLIENTEPERSONA CP WITH(NOLOCK)
INNER JOIN SALDOS S WITH(NOLOCK) ON
									CP.CODIGOCLIENTE = S.C1803
INNER JOIN VTA_SALDOS VS WITH(NOLOCK)ON
									S.JTS_OID = VS.JTS_OID_SALDO
WHERE
	S.C1785 IN (2, 3, 4)
	AND VS.FONDOGARANTIA = ''S''
	
UNION ALL

SELECT DISTINCT 
	(CP.NUMEROPERSONA) AS Cliente_NroPersona,
	S.C1785 AS Producto
FROM
	CLI_CLIENTEPERSONA CP WITH(NOLOCK)
INNER JOIN SALDOS S WITH(NOLOCK) ON
									CP.CODIGOCLIENTE = S.C1803
INNER JOIN PZO_SALDOS PS  WITH(NOLOCK)ON
							S.JTS_OID = PS.JTS_OID_SALDO
							AND PS.FONDOGARANTIA = ''S''
WHERE S.C1785 IN (2, 3, 4); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RRII_ANEXO_12_RENGLON2'')
	DROP view [dbo].VW_RRII_ANEXO_12_RENGLON2; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_RRII_ANEXO_12_RENGLON2] 
AS
SELECT DISTINCT 
	(CP.NUMEROPERSONA) AS Cliente_NroPersona,
	S.C1785 AS Producto
FROM
	CLI_CLIENTEPERSONA CP WITH(nolock)
INNER JOIN SALDOS S WITH(nolock) ON
									CP.CODIGOCLIENTE = S.C1803
INNER JOIN VTA_SALDOS VS WITH(nolock) ON
									S.JTS_OID = VS.JTS_OID_SALDO
									AND VS.FONDOGARANTIA = ''S''
WHERE
	S.C1785 IN (2, 3, 4); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_INTEGRANTES_PJ_PIF'')
	DROP view [dbo].VW_INTEGRANTES_PJ_PIF; ')
execute(' CREATE OR ALTER    VIEW [dbo].[VW_INTEGRANTES_PJ_PIF] (
														[Tipo Documento Identificativo],
														[Número Documento Identificativo],
														[Razón Social],
														[Nivel Apertura],
														[Estado],
														[Tipo Documento Identificativo PH/PJ],
														[Número Documento Identificativo PH/PJ],
														[Nombre],
														[Nivel Apertura PH/PJ],
														[Estado PH/PJ],
														[Cargo],
														[Tipo persona],
														[Numero PJ],
														[Numero PH/PJ])
AS
SELECT 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    T.RAZONSOCIAL, 
    CASE WHEN T.NIVEL_APERTURA=1 THEN ''BASICO'' ELSE 
    CASE WHEN T.NIVEL_APERTURA=3 THEN ''ACTIVO'' ELSE 
    CASE WHEN T.NIVEL_APERTURA=4 THEN ''INSTITUCION FINANCIERA'' END END END AS NIVEL_APERTURA,
    CASE WHEN T.ESTADO=0 THEN ''HABILITADO'' ELSE ''INHABILITADO'' END AS ESTADO,
    ID.TIPODOC AS TIPODOCINTEGRANTE, 
    ID.NUMERODOC AS NRODOCINTEGRANTE,
    CASE 
        WHEN (IJ.TIPO_PERSONA = ''J'') THEN 
        (
            SELECT JJ.RAZONSOCIAL
            FROM dbo.CLI_PERSONASJURIDICAS  AS JJ WITH (NOLOCK)
            WHERE JJ.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAFISICA
        )
        ELSE 
        (
            SELECT ISNULL(PF.APELLIDOPATERNO, '''') + '' '' + ISNULL(PF.PRIMERNOMBRE, '''') AS expr
            FROM dbo.CLI_PERSONASFISICAS  AS PF WITH (NOLOCK)
            WHERE PF.NUMEROPERSONAFISICA = IJ.NUMEROPERSONAFISICA
        )
    END AS NOMBRE,   
    CASE 
        WHEN (IJ.TIPO_PERSONA = ''J'') THEN 
        (SELECT CASE WHEN JJ.NIVEL_APERTURA=1 THEN ''BASICO'' ELSE 
      	CASE WHEN JJ.NIVEL_APERTURA=3 THEN ''ACTIVO'' ELSE 
      	CASE WHEN JJ.NIVEL_APERTURA=4 THEN ''INSTITUCION FINANCIERA'' END END END AS NIVEL_APERTURA
            FROM dbo.CLI_PERSONASJURIDICAS  AS JJ WITH (NOLOCK)
            WHERE JJ.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAFISICA)
        ELSE 
        CASE WHEN (ij.tipo_persona=''f'') then 
        (SELECT CASE WHEN PF.NIVEL_APERTURA=1 THEN ''BASICO'' ELSE 
      	CASE WHEN PF.NIVEL_APERTURA=3 THEN ''ACTIVO'' ELSE 
      	CASE WHEN PF.NIVEL_APERTURA=4 THEN ''INSTITUCION FINANCIERA'' END END END AS NIVEL_APERTURA
            FROM dbo.CLI_PERSONASFISICAS  AS PF WITH (NOLOCK)
            WHERE PF.NUMEROPERSONAFISICA = IJ.NUMEROPERSONAFISICA)
        END END AS NIVEL_APERTURA_INTEGRANTE,  
        CASE 
        WHEN (IJ.TIPO_PERSONA = ''J'') THEN 
        (SELECT CASE WHEN jj.ESTADO=0 THEN ''HABILITADO'' ELSE ''INHABILITADO'' END AS ESTADO
            FROM dbo.CLI_PERSONASJURIDICAS  AS JJ WITH (NOLOCK)
            WHERE JJ.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAFISICA)
        ELSE 
        CASE WHEN (ij.tipo_persona=''f'') then 
        (SELECT CASE WHEN PF.ESTADO=0 THEN ''HABILITADO'' ELSE ''INHABILITADO'' END AS ESTADO
            FROM dbo.CLI_PERSONASFISICAS  AS PF WITH (NOLOCK)
            WHERE PF.NUMEROPERSONAFISICA = IJ.NUMEROPERSONAFISICA)
        END END AS ESTADO_INTEGRANTE,    
    CASE 
    WHEN CP.CARGO IS NOT NULL THEN CP.CARGO
    ELSE A.Descripcion
    END AS CARGO, 
    IJ.TIPO_PERSONA AS TIPOPERSONA, 
    T.NUMEROPERSONAJURIDICA AS NUMEROPERSONA, 
    IJ.NUMEROPERSONAFISICA AS NUMEROPINTEGRANTE    
FROM dbo.CLI_PERSONASJURIDICAS  AS T WITH (NOLOCK)
INNER JOIN dbo.CLI_INTEGRANTESPJ  AS IJ WITH (NOLOCK)
      												ON T.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAJURIDICA
													AND IJ.TZ_LOCK = 0
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)
      								ON T.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
									AND V.TIPOPERSONA = ''J''
									AND V.TZ_LOCK = 0
INNER JOIN dbo.VW_PFPJ_DOCUMENTOS AS ID WITH (NOLOCK)
									ON IJ.NUMEROPERSONAFISICA = ID.NUMEROPERSONA
LEFT JOIN dbo.CLI_CARGOS_PERSONAS  AS CP WITH (NOLOCK)
      								ON IJ.CODIGOCARGO = CP.CODIGO -- AND (CP.TZ_LOCK = 0)
LEFT JOIN DJ_ACTORES A WITH (NOLOCK)
      								ON A.Id = IJ.CODIGOCARGO_DJ
WHERE
	(	(t.TZ_LOCK < 300000000000000 OR t.TZ_LOCK >= 400000000000000) 
	AND (t.TZ_LOCK < 100000000000000 OR t.TZ_LOCK >= 200000000000000)); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_INTEGRANTES_PJ_VISTA'')
	DROP view [dbo].VW_INTEGRANTES_PJ_VISTA; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_INTEGRANTES_PJ_VISTA] (
														TIPODOC, 
														NUMERODOC, 
														NUMEROPERSONA, 
														NUMEROPFISICA,
														TIPODOCINTEGRANTE,
														NRODOCINTEGRANTE, 
														NOMBRE, 
														CARGO, 
														TIPOPERSONA, 
														RAZONSOCIAL, 
														NOMBREFANTASIA)
AS
SELECT 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    T.NUMEROPERSONAJURIDICA AS NUMEROPERSONA, 
    IJ.NUMEROPERSONAFISICA AS NUMEROPFISICA, 
    ID.TIPODOC AS TIPODOCINTEGRANTE, 
    ID.NUMERODOC AS NRODOCINTEGRANTE, 
    CASE 
        WHEN (IJ.TIPO_PERSONA = ''J'') THEN 
        (
            SELECT JJ.RAZONSOCIAL
            FROM dbo.CLI_PERSONASJURIDICAS  AS JJ WITH(NOLOCK)
            WHERE JJ.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAFISICA
        )
        ELSE 
        (
            SELECT ISNULL(PF.PRIMERNOMBRE, '''') + '' '' + ISNULL(PF.APELLIDOPATERNO, '''') + '' '' + ISNULL(PF.APELLIDOMATERNO, '''') AS expr
            FROM dbo.CLI_PERSONASFISICAS  AS PF WITH(NOLOCK)
            WHERE PF.NUMEROPERSONAFISICA = IJ.NUMEROPERSONAFISICA
        )
    END AS NOMBRE,   
    CASE 
    WHEN CP.CARGO IS NOT NULL THEN CP.CARGO
    ELSE A.Descripcion
    END AS CARGO, 
    IJ.TIPO_PERSONA AS TIPOPERSONA, 
    T.RAZONSOCIAL, 
    T.NOMBREFANTASIA
FROM dbo.CLI_PERSONASJURIDICAS  AS T  WITH(NOLOCK)
INNER JOIN dbo.CLI_INTEGRANTESPJ  AS IJ  WITH(NOLOCK)
      								ON T.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAJURIDICA
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK)
      								ON T.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
									AND V.TZ_LOCK = 0
									AND V.TIPOPERSONA = ''J''
INNER JOIN dbo.VW_PFPJ_DOCUMENTOS AS ID WITH(NOLOCK) 
									ON IJ.NUMEROPERSONAFISICA = ID.NUMEROPERSONA
									AND IJ.TZ_LOCK = 0
LEFT JOIN dbo.CLI_CARGOS_PERSONAS  AS CP WITH(NOLOCK)
      								ON IJ.CODIGOCARGO = CP.CODIGO 
									AND (CP.TZ_LOCK = 0)
LEFT JOIN DJ_ACTORES A WITH(NOLOCK)
      								ON A.Id = IJ.CODIGOCARGO_DJ
WHERE T.TZ_LOCK = 0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CAJ_CAJAS_MINIFILIALES'')
	DROP view [dbo].VW_CAJ_CAJAS_MINIFILIALES; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_CAJ_CAJAS_MINIFILIALES] as
SELECT 
	cm.Mini_Filial AS Minifilial, 
	cm.NRO_CAJA AS ''Número de Caja'',
		(SELECT DESCRIPCION 
		FROM OPCIONES WITH (NOLOCK)
		WHERE NUMERODECAMPO = 5586 
			AND OPCIONINTERNA = cm.EsTesoro) as ''Es Tesoro''
from CAJ_Cajas_Minifiliales cm WITH (NOLOCK)
where cm.TZ_LOCK = 0 ;')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_AYUDA_CONVENIOS'')
	DROP view [dbo].VW_AYUDA_CONVENIOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_AYUDA_CONVENIOS]
AS
SELECT	con.Id_ConvRec AS [Numero convenio],
		con.NomConvRec AS [Nombre del convenio],
		con.RecConBD AS Padron,
		est.ID_REFERENCIA AS [Id Formulario],
		est.ID_CODIGO_BARRAS AS [Id Codigo de barras],
		est.LARGO AS [Largo]
FROM CONV_CONVENIOS_REC con WITH (NOLOCK)
INNER JOIN CONV_CB_ESTRUCTURA est WITH (NOLOCK) ON con.Id_ConvRec=est.ID_CONVENIO
												AND (est.LARGO=0 OR (est.LARGO>0 AND con.RecConBD =''S'')) 
												AND con.Canal = 1 
												AND est.TZ_LOCK= 0 
												AND con.TZ_LOCK = 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CUENTAS_CLIENTES'')
	DROP view [dbo].VW_CUENTAS_CLIENTES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_CUENTAS_CLIENTES] (
												   SUCURSAL, 
												   OPERACION, 
												   PRODUCTO, 
												   MONEDA, 
												   CUENTA, 
												   ORDINAL, 
												   NRO_CLIENTE, 
												   NOMBRECLIENTE)
AS 
SELECT 
    S.SUCURSAL, 
    S.OPERACION, 
    S.PRODUCTO, 
    S.MONEDA, 
    S.CUENTA, 
    S.ORDINAL, 
    S.C1803 AS NRO_CLIENTE, 
    C.NOMBRECLIENTE
FROM dbo.SALDOS  AS S WITH (NOLOCK)
INNER JOIN  dbo.CLI_CLIENTES  AS C WITH (NOLOCK) ON S.C1803 = C.CODIGOCLIENTE 
								AND	(	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
									AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))  
								AND	(	(C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000) 
									AND (C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000))  
								AND  (S.C1785 = 2 OR S.C1785 = 3) 
								AND S.C1651 = '' ''; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_CLI_CLIENTES'')
	DROP view [dbo].VW_ITF_CLI_CLIENTES; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_ITF_CLI_CLIENTES] (CODIGOCLIENTE, 
											TIPO)
AS 
SELECT	CLI_CLIENTES.CODIGOCLIENTE, 
		CLI_CLIENTES.TIPO
FROM dbo.CLI_CLIENTES WITH (NOLOCK); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_LIMITE_GRUPO'')
	DROP view [dbo].VW_LIMITE_GRUPO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_LIMITE_GRUPO] (
										GRUPO, 
										NOMBRE, 
										MONTO, 
										MONEDA, 
										DESC_MONEDA, 
										PLAZO, 
										ESTADO)
AS 
SELECT 
    L.GRUPO, 
    G.NOMBRE, 
    L.MONTO, 
    L.MONEDA, 
    M.C6400 AS DESC_MONEDA, 
    L.PLAZO, 
    L.ESTADO
FROM dbo.CRE_LIMITEGRUPO  AS L WITH (NOLOCK)
INNER JOIN dbo.CLI_GRUPOSECONOMICOS  AS G WITH (NOLOCK)ON L.GRUPO = G.CODIGOGRUPOECONOMICO
														AND (	(L.TZ_LOCK < 300000000000000 OR L.TZ_LOCK >= 400000000000000) 
															AND (L.TZ_LOCK < 100000000000000 OR L.TZ_LOCK >= 200000000000000))
														AND (	(G.TZ_LOCK < 300000000000000 OR G.TZ_LOCK >= 400000000000000) 
															AND (G.TZ_LOCK < 100000000000000 OR G.TZ_LOCK >= 200000000000000)) 
INNER JOIN dbo.MONEDAS  AS M WITH (NOLOCK)ON L.MONEDA = M.C6399
											AND (	(M.TZ_LOCK < 300000000000000 OR M.TZ_LOCK >= 400000000000000) 
												AND (M.TZ_LOCK < 100000000000000 OR M.TZ_LOCK >= 200000000000000)); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_VINCULACIONES'')
	DROP view [dbo].VW_VINCULACIONES; ')
execute(' CREATE OR ALTER   view [dbo].[VW_VINCULACIONES] 
as
select
	vi.ID,
	vi.TIPO_PERSONA_VINCULANTE as TP_VINCULANTE,
	d1.TIPODOCUMENTO as TD_VINCULANTE,
	d1.NUMERODOCUMENTO as DOC_VINCULANTE,
	case vi.TIPO_PERSONA_VINCULANTE
    when ''F'' then
		(select
			concat(f.APELLIDOPATERNO, '' '', f.PRIMERNOMBRE)
		from
			CLI_PERSONASFISICAS f WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(f.TZ_LOCK < 300000000000000 or f.TZ_LOCK >= 400000000000000) 
			and	(f.TZ_LOCK < 100000000000000 or f.TZ_LOCK >= 200000000000000)
			and	f.NUMEROPERSONAFISICA = vi.PERSONA_VINCULANTE)
    else
		(select
			j.RAZONSOCIAL
		from
			CLI_PERSONASJURIDICAS j WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
			and	(j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
			and	j.NUMEROPERSONAJURIDICA = vi.PERSONA_VINCULANTE)
	end VINCULANTE,
	vi.TIPO_PERSONA_VINCULADA as TP_VINCULADO,
	d2.TIPODOCUMENTO as TD_VINCULADO,
	d2.NUMERODOCUMENTO as DOC_VINCULADO,
	case vi.TIPO_PERSONA_VINCULADA
    when ''F'' then
		(select
			concat(f.APELLIDOPATERNO, '' '', f.PRIMERNOMBRE)
		from
			CLI_PERSONASFISICAS f WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(f.TZ_LOCK < 300000000000000 or f.TZ_LOCK >= 400000000000000) 
			and	(f.TZ_LOCK < 100000000000000 or f.TZ_LOCK >= 200000000000000)
			and	f.NUMEROPERSONAFISICA = vi.PERSONA_VINCULADA)
    else
		(select
			j.RAZONSOCIAL
		from
			CLI_PERSONASJURIDICAS j WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
			and	(j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
			and	j.NUMEROPERSONAJURIDICA = vi.PERSONA_VINCULADA)
	end VINCULADO,
	vi.ROL,
	vi.VINCULO,
	vs.MODALIDAD,
	vi.GRUPO_PRIMARIO
from CLI_VINCULACIONES vi WITH (NOLOCK)
inner join CLI_DOCUMENTOSPFPJ d1 WITH (NOLOCK) on d1.NUMEROPERSONAFJ = vi.PERSONA_VINCULANTE
												and (d1.TZ_LOCK < 300000000000000 or d1.TZ_LOCK >= 400000000000000) 
												and (d1.TZ_LOCK < 100000000000000 or d1.TZ_LOCK >= 200000000000000)
												AND (vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
												and (vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
												and vi.REGISTRO = ''C''
inner join CLI_DOCUMENTOSPFPJ d2 WITH (NOLOCK) on d2.NUMEROPERSONAFJ = vi.PERSONA_VINCULADA
												and (d2.TZ_LOCK < 300000000000000 or d2.TZ_LOCK >= 400000000000000) 
												and (d2.TZ_LOCK < 100000000000000 or d2.TZ_LOCK >= 200000000000000)
inner join CLI_VINCULOS vc WITH (NOLOCK) on vc.ID = vi.VINCULO
										and (vc.TZ_LOCK < 300000000000000 or vc.TZ_LOCK >= 400000000000000) 
										and (vc.TZ_LOCK < 100000000000000 or vc.TZ_LOCK >= 200000000000000)

inner join CLI_VINCULOS_SECUNDARIOS vs WITH (NOLOCK) on vs.ID = vc.VINCULO_SECUNDARIO
													and (vs.TZ_LOCK < 300000000000000 or vs.TZ_LOCK >= 400000000000000) 
													and (vs.TZ_LOCK < 100000000000000 or vs.TZ_LOCK >= 200000000000000)
union all
select
	vi.ID,
	vi.TIPO_PERSONA_VINCULANTE as TP_VINCULANTE,
	d1.TIPODOCUMENTO as TD_VINCULANTE,
	d1.NUMERODOCUMENTO as DOC_VINCULANTE,
	case vi.TIPO_PERSONA_VINCULANTE
    when ''F'' then
		(select
			concat(f.APELLIDOPATERNO, '' '', f.PRIMERNOMBRE)
		from
			CLI_PERSONASFISICAS f WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(f.TZ_LOCK < 300000000000000 or f.TZ_LOCK >= 400000000000000) 
			and	(f.TZ_LOCK < 100000000000000 or f.TZ_LOCK >= 200000000000000)
			and	f.NUMEROPERSONAFISICA = vi.PERSONA_VINCULANTE)
    else
		(select
			j.RAZONSOCIAL
		from
			CLI_PERSONASJURIDICAS j  WITH (NOLOCK)
		where
				(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
			and	(vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
			and	(j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
			and	(j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
			and	j.NUMEROPERSONAJURIDICA = vi.PERSONA_VINCULANTE)
	end VINCULANTE,
	vi.TIPO_PERSONA_VINCULADA as TP_VINCULADO,
	d2.TIPODOCUMENTO as TD_VINCULADO,
	d2.NUMERODOCUMENTO as DOC_VINCULADO,
	d2.RAZONSOCIAL as VINCULADO,
	vi.ROL,
	vi.VINCULO,
	vs.MODALIDAD,
	vi.GRUPO_PRIMARIO
from CLI_VINCULACIONES vi  WITH (NOLOCK)
inner join CLI_DOCUMENTOSPFPJ d1  WITH (NOLOCK)on d1.NUMEROPERSONAFJ = vi.PERSONA_VINCULANTE
											AND	(vi.TZ_LOCK < 300000000000000 or vi.TZ_LOCK >= 400000000000000) 
											and (vi.TZ_LOCK < 100000000000000 or vi.TZ_LOCK >= 200000000000000)
											and (d1.TZ_LOCK < 300000000000000 or d1.TZ_LOCK >= 400000000000000) 
											and (d1.TZ_LOCK < 100000000000000 or d1.TZ_LOCK >= 200000000000000)
											and vi.REGISTRO = ''V''
inner join CLI_VINCULADOSJURIDICOS d2  WITH (NOLOCK) on d2.NUMEROPERSONAJURIDICA = vi.PERSONA_VINCULADA
													and (d2.TZ_LOCK < 300000000000000 or d2.TZ_LOCK >= 400000000000000) 
													and (d2.TZ_LOCK < 100000000000000 or d2.TZ_LOCK >= 200000000000000)
inner join CLI_VINCULOS vc  WITH (NOLOCK)on vc.ID = vi.VINCULO
												and (vc.TZ_LOCK < 300000000000000 or vc.TZ_LOCK >= 400000000000000) 
												and (vc.TZ_LOCK < 100000000000000 or vc.TZ_LOCK >= 200000000000000)
inner join CLI_VINCULOS_SECUNDARIOS vs  WITH (NOLOCK)on vs.ID = vc.VINCULO_SECUNDARIO
														and (vs.TZ_LOCK < 300000000000000 or vs.TZ_LOCK >= 400000000000000) 
														and (vs.TZ_LOCK < 100000000000000 or vs.TZ_LOCK >= 200000000000000); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SOLICITUDLIMITE'')
	DROP view [dbo].VW_SOLICITUDLIMITE; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_SOLICITUDLIMITE] (
													CLIENTE, 
													NIVEL, 
													IDLIMITE, 
													RIESGO, 
													NOMBRERIESGO, 
													FAMILIA, 
													PRODUCTO, 
													MONEDA, 
													IMPORTE, 
													VENCIMIENTO)
AS 

SELECT TOP 9223372036854775807 WITH TIES CLIENTE, 
		NIVEL, 
		IDLIMITE, 
		RIESGO, 
		NOMBRERIESGO, 
		FAMILIA, 
		PRODUCTO, 
		MONEDA, 
		IMPORTE, 
		VENCIMIENTO
FROM(			
	SELECT	l.CLIENTE, ''1 - Cliente'' AS NIVEL, 
			l.NROSOLICITUD AS IDLIMITE, 
			0 AS RIESGO, '''' AS NOMBRERIESGO, 
			0 AS FAMILIA, 
			0 AS PRODUCTO, 
			m.C6401 AS MONEDA, 
			l.IMPORTEMAXIMO AS IMPORTE, 
			l.FECHAVIGENCIA AS VENCIMIENTO
	FROM CRE_SOLLICCLIENTE l WITH(NOLOCK)
	INNER JOIN MONEDAS m WITH(NOLOCK) ON l.MONEDA_LIMITE = m.C6399 
									AND m.TZ_LOCK = 0
									AND l.TZ_LOCK = 0 
									AND l.ESTADO = 1
	UNION
	SELECT	l.CLIENTE, 
			''2 - Riesgo'' AS NIVEL, 
			r.IDLIMITE AS IDLIMITE, 
			r.CODIGO_RIESGO AS RIESGO, 
			t.DESCRIPCION AS NOMBRERIESGO, 
			0 AS FAMILIA, 
			0 AS PRODUCTO, 
			m.C6401 AS MONEDA, 
			r.MONTO AS IMPORTE, 
			r.FECHA_VENCIMIENTO AS VENCIMIENTO
	FROM CRE_SOLLICCLIENTE l  WITH(NOLOCK)
	INNER JOIN MONEDAS m  WITH(NOLOCK)ON l.MONEDA_LIMITE = m.C6399 
										AND m.TZ_LOCK = 0
										AND l.TZ_LOCK = 0
										AND l.ESTADO = 1
	INNER JOIN CRE_RIESGOLIC r  WITH(NOLOCK)ON l.NROSOLICITUD = r.IDLIMITE 
											AND r.TZ_LOCK = 0
	INNER JOIN CRE_TIPOS_RIESGOS t WITH(NOLOCK) ON r.CODIGO_RIESGO = t.CODIGO_RIESGO 
											AND t.TZ_LOCK = 0  
	UNION
	SELECT	l.CLIENTE, 
			''3 - Familia'' AS NIVEL, 
			f.IDLIMITE AS IDLIMITE, 
			r.CODIGO_RIESGO AS RIESGO, 
			t.DESCRIPCION AS NOMBRERIESGO, 
			f.FAMILIA AS FAMILIA, 
			0 AS PRODUCTO, 
			m.C6401 AS MONEDA, 
			f.MONTO AS IMPORTE, 
			f.FECHA_VENCIMIENTO AS VENCIMIENTO
	FROM CRE_SOLLICCLIENTE l  WITH(NOLOCK)
	INNER JOIN MONEDAS m  WITH(NOLOCK) ON l.MONEDA_LIMITE = m.C6399 
										AND m.TZ_LOCK = 0
										AND l.TZ_LOCK = 0 
										AND l.ESTADO = 1
	INNER JOIN CRE_RIESGOLIC r  WITH(NOLOCK) ON l.NROSOLICITUD = r.IDLIMITE 
										AND r.TZ_LOCK = 0
	INNER JOIN CRE_TIPOS_RIESGOS t  WITH(NOLOCK) ON r.CODIGO_RIESGO = t.CODIGO_RIESGO 
												AND t.TZ_LOCK = 0
	INNER JOIN CRE_FAMILIALIC f  WITH(NOLOCK) ON r.IDLIMITE = f.IDLIMITE 
											AND r.CODIGO_RIESGO = f.CODIGO_RIESGO 
											AND f.TZ_LOCK = 0 
	UNION
	SELECT	l.CLIENTE, 
			''4 - Producto'' AS NIVEL, 
			p.IDLIMITE AS IDLIMITE, 
			r.CODIGO_RIESGO AS RIESGO, 
			t.DESCRIPCION AS NOMBRERIESGO, 
			f.FAMILIA AS FAMILIA, 
			p.PRODUCTO AS PRODUCTO, 
			m.C6401 AS MONEDA, 
			p.MONTO AS IMPORTE, 
			p.FECHA_VENCIMIENTO AS VENCIMIENTO
	FROM CRE_SOLLICCLIENTE l WITH(NOLOCK)
	INNER JOIN MONEDAS m  WITH(NOLOCK) ON l.MONEDA_LIMITE = m.C6399 
										AND m.TZ_LOCK = 0
										AND l.TZ_LOCK = 0 
										AND l.ESTADO = 1
	INNER JOIN CRE_RIESGOLIC r  WITH(NOLOCK) ON l.NROSOLICITUD = r.IDLIMITE 
											AND r.TZ_LOCK = 0
	INNER JOIN CRE_TIPOS_RIESGOS t  WITH(NOLOCK) ON r.CODIGO_RIESGO = t.CODIGO_RIESGO 
												AND t.TZ_LOCK = 0
	INNER JOIN CRE_FAMILIALIC f  WITH(NOLOCK) ON r.IDLIMITE = f.IDLIMITE 
											AND r.CODIGO_RIESGO = f.CODIGO_RIESGO 
											AND f.TZ_LOCK = 0
	INNER JOIN CRE_PRODUCTOLIC p  WITH(NOLOCK) ON f.IDLIMITE = p.IDLIMITE 
											AND f.CODIGO_RIESGO = p.CODIGO_RIESGO 
											AND f.FAMILIA = p.FAMILIA 
											AND p.TZ_LOCK = 0) o
ORDER BY	CLIENTE, 
			IDLIMITE, 
			RIESGO, 
			FAMILIA, 
			PRODUCTO; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SDO_BLOQUEO_FECHA'')
	DROP view [dbo].VW_SDO_BLOQUEO_FECHA; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_SDO_BLOQUEO_FECHA] 
AS
SELECT	SALDO_JTS_OID AS JTS_OID_SALDOS, 
		COD_BLOQUEO AS CODBLOQUEO, 
		max(FECHA_GRABADA) AS FECHABLOQUEO
FROM GRL_BLOQUEOS WITH(NOLOCK)
WHERE (		(tz_lock < 300000000000000 OR tz_lock >= 4000000000000000) 
		AND (tz_lock < 1000000000000000 OR tz_lock >= 2000000000000000)) 
		AND ESTADO = 1
GROUP BY	SALDO_JTS_OID, 
			COD_BLOQUEO; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_MAQ_LIBRES_SUC'')
	DROP view [dbo].VW_MAQ_LIBRES_SUC; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_MAQ_LIBRES_SUC] (NUMERODEMAQUINA, 
												DESCRIPCION, 
												NROSUCURSAL)
AS 
SELECT TOP 9223372036854775807 WITH TIES M.NUMERODEMAQUINA, 
		M.DESCRIPCION, 
		M.NROSUCURSAL
FROM dbo.NETMAP  AS M WITH (NOLOCK)
WHERE M.NUMERODEMAQUINA NOT IN 
								(	SELECT USUARIOS.NUMERODEMAQUINA
									FROM dbo.USUARIOS WITH (NOLOCK)
									WHERE USUARIOS.NROSUCURSAL = M.NROSUCURSAL)
ORDER BY M.NUMERODEMAQUINA ;')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PERSONAS_CLIENTE'')
	DROP view [dbo].VW_PERSONAS_CLIENTE; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_PERSONAS_CLIENTE] (
												   TipoDocIdent, 
												   NroDocIdent, 
												   TipoDocFisico,
												   NumDocFisico,
												   NOMBRE,
												   NIVELAPERTURA, 
												   TIPOPERSONA, 
												   NUMEROPERSONA,
												   Titularidad,
												   Cliente)
AS 
SELECT  
    V.TIPODOCUMENTO AS TipoDocIdent, 
    V.NUMERODOCUMENTO AS NroDocIdent, 
    V.TIPO_DOC_FISICO AS TIPO_DOC_FISICO,
    V.NUM_DOC_FISICO AS NUM_DOC_FISICO,
    ISNULL(U.PRIMERNOMBRE, '''') + '' '' + ISNULL(U.APELLIDOPATERNO, '''') + '' '' + ISNULL(U.APELLIDOMATERNO, '''') AS NOMBRE,
    CASE U.NIVEL_APERTURA
        WHEN 0 THEN ''REGISTRO''
        WHEN 1 THEN ''BÁSICO''
        -- WHEN 2 THEN ''PASIVOS''
        WHEN 3 THEN ''ACTIVOS''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA,
    P.TITULARIDAD,
    P.CODIGOCLIENTE
FROM dbo.CLI_PERSONASFISICAS  AS U WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
											AND V.TZ_LOCK = 0
											AND U.TZ_LOCK = 0 
INNER JOIN dbo.CLI_ClientePersona AS P WITH (NOLOCK)ON P.NUMEROPERSONA = U.NUMEROPERSONAFISICA
														AND P.TZ_LOCK = 0
UNION ALL
SELECT  
    V.TIPODOCUMENTO AS TipoDocIdent, 
    V.NUMERODOCUMENTO AS NroDocIdent, 
    V.TIPO_DOC_FISICO AS TIPO_DOC_FISICO,
    V.NUM_DOC_FISICO AS NUM_DOC_FISICO,
    S.RAZONSOCIAL AS NOMBRE,
    CASE S.NIVEL_APERTURA
        WHEN 0 THEN ''REGISTRO''
        WHEN 1 THEN ''BÁSICO''
        -- WHEN 2 THEN ''PASIVOS''
        WHEN 3 THEN ''ACTIVOS''
        WHEN 4 THEN ''INST. FINANCIERA''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA,
    P.TITULARIDAD,
    P.CODIGOCLIENTE
FROM dbo.CLI_PERSONASJURIDICAS  AS S WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
													AND V.TZ_LOCK = 0 
													AND  S.TZ_LOCK = 0 
INNER JOIN dbo.CLI_ClientePersona AS P WITH (NOLOCK)ON P.NUMEROPERSONA = S.NUMEROPERSONAJURIDICA
													AND  S.TZ_LOCK = 0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PF_CONYUGE_DOC'')
	DROP view [dbo].VW_PF_CONYUGE_DOC; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PF_CONYUGE_DOC] (
											   TIPODOC, 
											   NÚMERODOC, 
											   NÚMEROPERSONA, 
											   NOMBRE, 
											   TIPODOCCÓNYUGE, 
											   NÚMERODOCCÓNYUGE, 
											   NÚMEROCÓNYUGE, 
											   NOMBRECÓNYUGE, 
											   TIPORELACIÓN, 
											   FECHA, 
											   DESCRIPCIÓN)
AS 
SELECT	TOP 9223372036854775807 WITH TIES 
			V.TIPODOCUMENTO AS TIPODOC, 
			V.NUMERODOCUMENTO AS NÚMERODOC, 
			U.NUMEROPERSONAFISICA AS NÚMEROPERSONA, 
			ISNULL(X.PRIMERNOMBRE, '''') + '' '' + ISNULL(X.APELLIDOPATERNO, '''') AS NOMBRE, 
			W.TIPODOCUMENTO AS TIPODOCCÓNYUGE, 
			W.NUMERODOCUMENTO AS NÚMERODOCCÓNYUGE, 
			U.NUMEROPERSONAFISICACONY AS NÚMEROCÓNYUGE, 
			ISNULL(Z.PRIMERNOMBRE, '''') + '' '' + ISNULL(Z.APELLIDOPATERNO, '''') AS NOMBRECÓNYUGE, 
			U.TIPORELACION AS TIPORELACIÓN, 
			U.FECHA, 
			U.DESCRIPCION AS DESCRIPCIÓN
FROM 
			dbo.CLI_PFCONYUGE  AS U WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK) ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
										AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
											AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS W WITH (NOLOCK) ON U.NUMEROPERSONAFISICACONY = W.NUMEROPERSONAFJ 
										AND (	(W.TZ_LOCK < 300000000000000 OR W.TZ_LOCK >= 400000000000000) 
											AND (W.TZ_LOCK < 100000000000000 OR W.TZ_LOCK >= 200000000000000))
INNER JOIN dbo.CLI_PERSONASFISICAS  AS X WITH (NOLOCK) ON U.NUMEROPERSONAFISICA = X.NUMEROPERSONAFISICA
INNER JOIN dbo.CLI_PERSONASFISICAS  AS Z WITH (NOLOCK) ON U.NUMEROPERSONAFISICACONY = Z.NUMEROPERSONAFISICA
WHERE
      (		(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
		AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000))  
ORDER BY NÚMEROPERSONA; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_DPF_TASAS'')
	DROP view [dbo].VW_DPF_TASAS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_DPF_TASAS] (
										   TARIFA,
										   MONEDA,
										   DESCRIPCIONMONEDA,
										   PRODUCTO,
										   DESCRIPCIONPRODUCTO,
										   TIPOTASAINT,
										   PUNTOS,
										   VIGENCIADESDE,
										   VIGENCIAHASTA,
										   CLIENTE,
										   PLAZO,
										   IMPORTE)
AS 
SELECT	T.TARIFA, 
		T.MONEDA, 
		M.C6400 AS DESCRIPCIONMONEDA, 
		T.PRODUCTO, 
		P.C6251 AS DESCRIPCIONPRODUCTO,
		T.TIPOTASAINT, 
		T.PUNTOS, 
		T.VIGENCIADESDE, 
		T.VIGENCIAHASTA, 
		T.CLIENTE, 
		T.PLAZO, 
		T.IMPORTE
FROM Tasas T with (nolock)
inner join PRODUCTOS P with (nolock) on T.PRODUCTO = P.C6250
									AND P.TZ_LOCK = 0
									AND T.TZ_LOCK = 0
inner join MONEDAS M with (nolock) on T.MONEDA = M.C6399
									AND T.TZ_LOCK = 0
									AND M.TZ_LOCK = 0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_MAXFCHINFORME'')
	DROP view [dbo].[VW_MAXFCHINFORME]; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_MAXFCHINFORME] (	COD_CLIENTE, 
												FCH_MAX, 
												DSC_INFORME)
AS 

SELECT	PP.COD_CLIENTE, 
		max(PP.FCH_INFORME) AS FCH_MAX, 
		'' '' AS DSC_INFORME
FROM dbo.CRE_INFORLISTAVIGILANCIA  AS PP WITH(NOLOCK)
WHERE PP.TZ_LOCK = 0
GROUP BY PP.COD_CLIENTE; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_MAXFCHINFORMEVIGILANCIA'')
	DROP view [dbo].[VW_MAXFCHINFORMEVIGILANCIA]; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_MAXFCHINFORMEVIGILANCIA] (COD_CLIENTE, 
															COD_INFORME, 
															ESTADO_INFORME)
AS 

SELECT	PP.COD_CLIENTE, 
		max(PP.COD_INFORME) AS COD_INFORME, 
		PP.ESTADO_INFORME
FROM dbo.CRE_INFORLISTAVIGILANCIA  AS PP WITH (NOLOCK)
WHERE PP.ESTADO_INFORME = ''P''
GROUP BY PP.COD_CLIENTE, 
		PP.ESTADO_INFORME; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PYF_APODERAMIENTO_PODER'')
	DROP view [dbo].[VW_PYF_APODERAMIENTO_PODER] ;')

execute(' CREATE OR ALTER   VIEW [dbo].[VW_PYF_APODERAMIENTO_PODER] (
														   [Código_Apoderado], 
														   [Descripción_Apoderado], 
														   [Código_Poder], 
														   [Descripción_Poder])
AS 
SELECT T.CODAPODERAMIENTO, 
		T.DESCRIPCION, 
		P.TIPO_PODER, 
		P.DESCRIPCION
FROM PYF_APODERAMIENTO AS A with (nolock) 
inner join PYF_TIPOPODERES AS P with (nolock)on A.CODPODER = P.TIPO_PODER 
												AND P.TZ_LOCK = 0 
inner join PYF_TIPOAPODERAMIENTO AS T with (nolock) on T.CODAPODERAMIENTO = A.CODAPODERAMIENTO
														AND T.TZ_LOCK = 0
WHERE  
	A.TZ_LOCK = 0 ; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PYF_APODERAMIENTO_PODER'')
	DROP view [dbo].VW_PYF_APODERAMIENTO_PODER; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PYF_APODERAMIENTO_PODER] (
														   [Código_Apoderado], 
														   [Descripción_Apoderado], 
														   [Código_Poder], 
														   [Descripción_Poder])
AS 
SELECT T.CODAPODERAMIENTO, 
		T.DESCRIPCION, 
		P.TIPO_PODER, 
		P.DESCRIPCION
FROM PYF_APODERAMIENTO AS A with (nolock) 
inner join PYF_TIPOPODERES AS P with (nolock)on A.CODPODER = P.TIPO_PODER 
												AND P.TZ_LOCK = 0 
inner join PYF_TIPOAPODERAMIENTO AS T with (nolock) on T.CODAPODERAMIENTO = A.CODAPODERAMIENTO
														AND T.TZ_LOCK = 0
WHERE  
	A.TZ_LOCK = 0 ; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_NETMAP'')
	DROP view [dbo].VW_NETMAP; ')
execute(' CREATE OR ALTER     view [dbo].[VW_NETMAP] 
AS

Select	a.NUMERODEMAQUINA, 
		a.DESCRIPCION, 
		a.NROSUCURSAL 
from netmap a WITH (NOLOCK)
WHERE	(a.USUARIO IS NULL OR a.USUARIO = '''') 
		AND a.NUMERODEMAQUINA NOT IN(	select distinct b.NUMERODEMAQUINA 
										from USUARIOS b  WITH (NOLOCK) 
										where a.NROSUCURSAL = b.NROSUCURSAL); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_MOVIMIENTOS_CRUZADOS'')
	DROP view [dbo].VW_MOVIMIENTOS_CRUZADOS; ')
execute(' CREATE OR ALTER VIEW [dbo].[VW_MOVIMIENTOS_CRUZADOS] (
														JTS, 
														SALDOACTUAL, 
														MONEDA, 
														TIPOPRODUCTO, 
														TRANSACCION, 
														SEGMENTO, 
														MONTO)
AS 

SELECT 
    S.JTS_OID AS JTS, 
    S.C1604 AS SALDOACTUAL, 
    S.MONEDA AS MONEDA, 
    S.C1785 AS TIPOPRODUCTO, 
    H.CODIGO_TRANSACCION AS TRANSACCION, 
    ISNULL(RIGHT(''00000'' + ISNULL(CAST(S.C1770 AS varchar(4000)), ''''), 5), '''') + ISNULL(RIGHT(''00000'' + ISNULL(CAST(S.C1771 AS varchar(4000)), ''''), 5), '''') AS SEGMENTO, 
    sum(H.MONTO) AS MONTO
FROM dbo.SALDOS  AS S WITH (NOLOCK) 
INNER JOIN dbo.HISTORIA_VISTA  AS H WITH (NOLOCK)ON S.JTS_OID = H.SALDO_JTS_OID
											AND H.FECHA_PROCESADO = 
																	(SELECT PARAMETROS.FECHAPROCESO
																	FROM dbo.PARAMETROS WITH (NOLOCK))
INNER JOIN dbo.SUCURSALES  AS U WITH (NOLOCK) ON S.SUCURSAL = U.SUCURSAL
INNER JOIN dbo.SUCURSALES  AS C WITH (NOLOCK) ON H.SUCURSAL_INGRESO = C.SUCURSAL
INNER JOIN dbo.ZONAS_SUCURSALES  AS Z WITH (NOLOCK)ON C.ZONACOBRO = Z.ZONA_COBRO
WHERE 
    S.C1785 IN ( 2, 3 )  
    AND H.CODIGO_TRANSACCION IN ( 10, 11, 12, 13 )  
    AND ((S.TZ_LOCK < 3000000000000000 OR S.TZ_LOCK >= 4000000000000000) AND (S.TZ_LOCK < 1000000000000000 OR S.TZ_LOCK >= 2000000000000000))  
    AND ((U.TZ_LOCK < 3000000000000000 OR U.TZ_LOCK >= 4000000000000000) AND (U.TZ_LOCK < 1000000000000000 OR U.TZ_LOCK >= 2000000000000000))  
    AND ((Z.TZ_LOCK < 3000000000000000 OR Z.TZ_LOCK >= 4000000000000000) AND (Z.TZ_LOCK < 1000000000000000 OR Z.TZ_LOCK >= 2000000000000000))  
    AND ((U.ZONACOBRO <> C.ZONACOBRO) OR (U.ZONACOBRO = C.ZONACOBRO AND H.SUCURSAL_INGRESO <> S.SUCURSAL AND Z.ANALIZA_SUCURSAL = ''S''))
GROUP BY 
    S.JTS_OID, 
    S.C1604, 
    S.MONEDA, 
    S.C1785, 
    H.CODIGO_TRANSACCION, 
    ISNULL(RIGHT(''00000'' + ISNULL(CAST(S.C1770 AS varchar(4000)), ''''), 5), '''') + ISNULL(RIGHT(''00000'' + ISNULL(CAST(S.C1771 AS varchar(4000)), ''''), 5), '''') ;')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ASISTENCIAS'')
	DROP view [dbo].VW_ASISTENCIAS; ')
execute(' CREATE OR ALTER VIEW [dbo].[VW_ASISTENCIAS] (
									SUCURSAL,    
									NOMBRESUCURSAL, 
									PRODUCTO, 
									NOMBREPRODUCTO, 
									CUENTA, 
									OPERACION,
									DESGLOSE, 
									MONEDA, 
									MONTOORIGEN,
									SALDO,
									VENCIMIENTO,
									CLIENTE,
									TIPO,
									JTS_OID,
									ORDINAL,
									PORCENTAJE_PAGO,
									TASA,
									GARANTIA_DESEMBOLSO,
									SITUACION,
									FAMILIA,
									CLASIFICACION,
									ESTADO)
AS
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		s.PRODUCTO AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		s.OPERACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		s.C1601 AS MONTOORIGEN, 
		CASE WHEN C1785 = 1 THEN s.C1604 ELSE s.C1604*-1 END AS SALDO, 
		s.C1627 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		0 AS ORDINAL,
		CASE WHEN s.C1644 > 0 AND s.C1785 = 5 THEN round(s.C1645 * 100 / s.C1644,2) ELSE NULL END AS PORCENTAJE_PAGO,
		s.C1632 AS TASA,
		ext.GARANTIA_DESEMBOLSO,
		c.CATEGORIARESULTANTE AS SITUACION,
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		CASE WHEN s.C1728 = ''Z'' THEN ''Cedido'' WHEN s.C1728 = ''C'' THEN ''Castigado'' ELSE ''Normal'' END AS ESTADO
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND p.TZ_LOCK = 0
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND f.TZ_LOCK = 0						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND m.TZ_LOCK = 0
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND suc.TZ_LOCK = 0
LEFT JOIN CRE_SALDOS ext WITH(NOLOCK) ON s.JTS_OID = ext.SALDOS_JTS_OID AND ext.TZ_LOCK = 0							
INNER JOIN CLI_CLIENTES c WITH(NOLOCK) ON s.C1803 = c.CODIGOCLIENTE AND c.TZ_LOCK = 0
WHERE (s.C1785 IN (5,6) OR (s.C1785 = 1 AND p.C6800 = ''GO'')) AND s.TZ_LOCK = 0
UNION
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		v.NROLINEA AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		v.NRO_AUTORIZACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		v.IMPORTE AS MONTOORIGEN, 
		v.IMPORTE - v.IMPORTE_CONSUMIDO AS SALDO, 
		v.FECHA_VENCIMIENTO AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		1 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		v.ORDINAL AS ORDINAL,
		NULL AS PORCENTAJE_PAGO,
		NULL AS TASA,
		NULL AS GARANTIA_DESEMBOLSO,
		NULL AS SITUACION,
		NULL AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		''Normal'' AS ESTADO
FROM VTA_SOBREGIROS v WITH(NOLOCK)
INNER JOIN SALDOS s WITH(NOLOCK) ON v.JTS_OID_SALDO = s.JTS_OID 
					AND s.TZ_LOCK = 0
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON v.NROLINEA = p.C6250 
						AND p.TZ_LOCK = 0						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
					AND m.TZ_LOCK = 0
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON v.SUCURSAL_ACUERDO = suc.SUCURSAL 
						AND suc.TZ_LOCK = 0
WHERE v.ESTADO = 1 AND v.TZ_LOCK = 0
UNION
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		s.PRODUCTO AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		s.OPERACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		s.C1832 AS MONTOORIGEN, 
		s.C1832 AS SALDO, 
		s.C1761 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		0 AS ORDINAL,
		NULL AS PORCENTAJE_PAGO,
		NULL AS TASA,
		NULL AS GARANTIA_DESEMBOLSO,
		NULL AS SITUACION,
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		''Normal'' AS ESTADO
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND p.TZ_LOCK = 0
						AND p.C6800 = ''T'' 
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND f.TZ_LOCK = 0						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND m.TZ_LOCK = 0
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND suc.TZ_LOCK = 0						
INNER JOIN CLI_CLIENTES c WITH(NOLOCK) ON s.C1803 = c.CODIGOCLIENTE AND c.TZ_LOCK = 0
WHERE s.C1785 = 1 
	AND s.TZ_LOCK = 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SOLICITUD_CUENTAS_LINK'')
	DROP view [dbo].VW_SOLICITUD_CUENTAS_LINK; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_SOLICITUD_CUENTAS_LINK] 
AS
SELECT 
		TC.ID_SOLICITUD Id_Solicitud,
		TC.NRO_TARJETA Nro_Tarjeta,
		TC.NRO_CUENTA Nro_Cuenta,
		VS.NOMBRE_CUENTA Nombre_Cuenta, 
		TC.NUMERO_CUENTA_PBF Nro_Cuenta_PBF 
FROM TJD_SOLICITUD_CUENTAS_LINK TC WITH(nolock) 
INNER JOIN VTA_SALDOS VS WITH(nolock) ON TC.NUMERO_CUENTA_PBF = VS.CTA_REDLINK ; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_MULTIPLES_CLIENTES'')
	DROP view [dbo].VW_MULTIPLES_CLIENTES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_MULTIPLES_CLIENTES] (
														CLIENTE, 
														NOMBRE, 
														MONEDA, 
														JTS_OID)
AS 
SELECT	M.CLIENTE AS CLIENTE, 
		C.NOMBRECLIENTE AS NOMBRE, 
		M.MONEDA AS MONEDA, 
		M.SALJTS AS JTS_OID
FROM dbo.VAL_MULTIPLES_MONEDAS  AS M WITH(NOLOCK) 
INNER JOIN dbo.CLI_CLIENTES  AS C WITH(NOLOCK) ON M.CLIENTE = C.CODIGOCLIENTE
WHERE (	(M.TZ_LOCK < 300000000000000 OR M.TZ_LOCK >= 400000000000000) 
	AND (M.TZ_LOCK < 100000000000000 OR M.TZ_LOCK >= 200000000000000)) ;')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PJ_HAB_DOCUMENTOS'')
	DROP view [dbo].VW_PJ_HAB_DOCUMENTOS; ')
execute(' CREATE  VIEW [dbo].[VW_PJ_HAB_DOCUMENTOS] (
											"Tipo Documento Identificativo", 
											"Número Documento Identificativo",
											"Tipo Documento Físico",
											"Número de Documento Físico",
											"Razón Social",
											"Tipo de Persona", 
											"Nivel de Apertura",
											"Estado de la Persona",
											"Motivo Inhabilitado",
											"Número de Persona")
AS 
SELECT TOP 9223372036854775807 WITH TIES 
    V.TIPODOCUMENTO , 
    V.NUMERODOCUMENTO ,
    V.TIPO_DOC_FISICO ,
    V.NUM_DOC_FISICO ,
    (U.RAZONSOCIAL) AS RAZONSOCIAL,
    V.TIPOPERSONA ,  
    (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH(NOLOCK) 
		WHERE O.IDIOMA=''E'' 
			AND O.OPCIONINTERNA=U.NIVEL_APERTURA 
			AND O.NUMERODECAMPO = 2045) AS NIVEL_APERTURA,
    (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH(NOLOCK) 
		WHERE O.IDIOMA=''E'' 
			AND O.OPCIONINTERNA=U.ESTADO 
			AND O.NUMERODECAMPO = 33367) AS ESTADO,   
	(	SELECT DESCRIPCION 
		FROM OPCIONES O WITH(NOLOCK) 
		WHERE O.IDIOMA=''E'' 
			AND O.OPCIONINTERNA=U.MOTIVO_INHABILITADO 
			AND O.NUMERODECAMPO = 33369) AS  MOTIVO_INHABILITADO,
    V.NUMEROPERSONAFJ 
FROM dbo.CLI_PERSONASJURIDICAS  AS U WITH(NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK) ON U.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
													AND V.TIPOPERSONA = ''J'' 
													AND U.TZ_LOCK =0 
													AND V.TZ_LOCK =0
ORDER BY NUMEROPERSONAFJ; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''V_BITACORA_DJ'')
	DROP view [dbo].V_BITACORA_DJ; ')
execute(' CREATE OR ALTER   VIEW [dbo].[V_BITACORA_DJ]
AS
SELECT HM.NRO_CAUSA, 
       HM.FECHA, --56
       HM.ORDINAL, --9209
       O.DESCRIPCION, --4968
       HM.VALOR_ANTERIOR, --4990
       HM.VALOR_NUEVO --4991
FROM DJ_HISTORICO_MOD HM WITH(NOLOCK)
JOIN OPCIONES O WITH(NOLOCK) ON O.NUMERODECAMPO=33166 
								AND O.OPCIONINTERNA=HM.MOTIVO_MOD 
								AND O.IDIOMA=''E''
								AND HM.TZ_LOCK=0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PAQUETE_BENEFICIO'')
	DROP view [dbo].VW_PAQUETE_BENEFICIO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PAQUETE_BENEFICIO] (
												   COD_PAQUETE, 
												   DESCRIPCION_PAQUETE, 
												   COD_BENEFICIO, 
												   DESCRIPCION_BENEFICIO, 
												   ACTIVO)
AS 
SELECT 
    pb.COD_PAQUETE, 
    p.DESCRIPCION_PAQUETE, 
    pb.COD_BENEFICIO, 
    b.DESCRIPCION_BENEFICIO, 
    pb.ACTIVO
FROM dbo.CLI_PAQUETE_BENEFICIOS  AS pb WITH(NOLOCK)
INNER JOIN dbo.CLI_PAQUETES  AS p  WITH(NOLOCK) ON pb.COD_PAQUETE = p.COD_PAQUETE
									AND (	(p.TZ_LOCK < 300000000000000 OR p.TZ_LOCK >= 400000000000000) 
										AND (p.TZ_LOCK < 100000000000000 OR p.TZ_LOCK >= 200000000000000)) 
INNER JOIN dbo.CLI_BENEFICIOS  AS b WITH(NOLOCK) ON pb.COD_BENEFICIO = b.COD_BENEFICIO
									AND (	(b.TZ_LOCK < 300000000000000 OR b.TZ_LOCK >= 400000000000000) 
										AND (b.TZ_LOCK < 100000000000000 OR b.TZ_LOCK >= 200000000000000))
WHERE 
    (	(pb.TZ_LOCK < 300000000000000 OR pb.TZ_LOCK >= 400000000000000) 
	AND (pb.TZ_LOCK < 100000000000000 OR pb.TZ_LOCK >= 200000000000000)) ;')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_OPERACIONES_REESTRUCTURA'')
	DROP view [dbo].VW_OPERACIONES_REESTRUCTURA; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_OPERACIONES_REESTRUCTURA] (
															SUCURSAL, 
															PRODUCTO, 
															CUENTA, 
															MONEDA, 
															OPERACION, 
															ORDINAL, 
															NUMERO_SOLICITUD, 
															NUMERO_CLIENTE, 
															CANCELO)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
		S.SUCURSAL, 
		S.PRODUCTO, 
		S.CUENTA, 
		S.MONEDA, 
		S.OPERACION, 
		S.ORDINAL, 
		C.NUMERO_SOLICITUD, 
		C.NUMERO_CLIENTE, 
		D.CANCELO
FROM dbo.SALDOS  AS S WITH (NOLOCK)
INNER JOIN dbo.CRE_DET_REESTRUCTURA  AS D WITH (NOLOCK)ON S.JTS_OID = D.JTS_OID_REESTRUCTURADA
														AND (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
															AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))
														AND (	(D.TZ_LOCK < 300000000000000 OR D.TZ_LOCK >= 400000000000000) 
															AND (D.TZ_LOCK < 100000000000000 OR D.TZ_LOCK >= 200000000000000)) 
INNER JOIN dbo.CRE_CAB_REESTRUCTURAS  AS C WITH (NOLOCK)ON D.NUMERO_SOLICITUD = C.NUMERO_SOLICITUD
														AND (	(C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000) 
															AND (C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000))
   
ORDER BY D.OP_REESTRUCTURADA; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ORDENESCODNBC'')
	DROP view [dbo].VW_ORDENESCODNBC; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_ORDENESCODNBC] (
													CODIGOBCO, 
													NOMBREPAPEL, 
													NROORDEN, 
													CODCLIENTE, 
													NOMBRECLIENTE, 
													VALORNOMINAL, 
													CODTITULO, 
													TIPOORDEN, 
													ESTADOORDEN, 
													TIPOFE)
AS 
SELECT DISTINCT TOP 9223372036854775807 WITH TIES 
				T.CODIGOBCO, 
				T.NOMBREPAPEL, 
				O.NROORDEN, 
				O.CODCLIENTE, 
				C.NOMBRECLIENTE, 
				O.VALORNOMINAL, 
				O.CODTITULO, 
				O.TIPOORDEN, 
				O.ESTADOORDEN, 
				O.TIPOFE
FROM dbo.VAL_ORDENES  AS O  WITH (NOLOCK)
INNER JOIN dbo.VAL_TITULOS  AS T WITH (NOLOCK)
							ON O.CODTITULO = T.CODTITULO 
INNER JOIN dbo.CLI_CLIENTES  AS C  WITH (NOLOCK)
							ON O.CODCLIENTE = C.CODIGOCLIENTE
WHERE (		(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
		AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
	AND (	(O.TZ_LOCK < 300000000000000 OR O.TZ_LOCK >= 400000000000000) 
		AND (O.TZ_LOCK < 100000000000000 OR O.TZ_LOCK >= 200000000000000))
ORDER BY T.CODIGOBCO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ORDENESPENDIENTESCODNBC'')
	DROP view [dbo].VW_ORDENESPENDIENTESCODNBC; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_ORDENESPENDIENTESCODNBC] (
												CODIGOBCO, 
												CODINTERNACIONAL, 
												NROORDEN, 
												DESTINATARIO_REMITENTE, 
												CODTITULO, 
												VALORNOMINAL, 
												MONEDA, 
												ESTADOORDEN, 
												FECHALIQUIDACION)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
    T.CODIGOBCO, 
    T.CODINTERNACIONAL, 
    O.NROORDEN, 
    O.DESTINATARIO_REMITENTE, 
    O.CODTITULO, 
    O.VALORNOMINAL, 
    O.MONEDA, 
    O.ESTADOORDEN, 
    O.FECHALIQUIDACION
FROM dbo.VAL_TITULOS  AS T WITH(NOLOCK)
INNER JOIN dbo.VAL_ORDENES  AS O WITH(NOLOCK) ON T.CODTITULO = O.CODTITULO 
											AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
												AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
											AND ( (O.TZ_LOCK < 300000000000000 OR O.TZ_LOCK >= 400000000000000) 
												AND (O.TZ_LOCK < 100000000000000 OR O.TZ_LOCK >= 200000000000000))
ORDER BY T.CODIGOBCO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PRODUCTOS_CONVENIOS_AH'')
	DROP view [dbo].VW_PRODUCTOS_CONVENIOS_AH; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PRODUCTOS_CONVENIOS_AH] (
														Producto, 
														NombreProducto, 
														Convenio,
														NombreConvenio,
														SucursalCuenta,
														NombreSucursal,
														Cuenta,
														EstadoCuenta,
														ContratoMarco,
														Beneficio,
														TipoContrato,
														pf,
														JTS_OID,
														MontoCalculado,
														CantidadSueldo,
														Jurisdiccion,
														TipoScoring,
														Afectacion,
														Canal,
														CapacidadPago,
														AfectacionCanal,
														Cliente,
														TipoConvenio
)
AS
SELECT 
		pc.PRODUCTO AS Producto, 
		p.C6251 AS NombreProducto, 
		vc.ID_CONVENIO AS Convenio,
		c.NomConvPago AS NombreConvenio,
		s.SUCURSAL AS SucursalCuenta,
		suc.NOMBRESUCURSAL AS NombreSucursal, 
		s.CUENTA AS Cuenta,
		CASE WHEN s.C1651 = ''1'' THEN ''Cuenta Cerrada'' 
		ELSE ''Cuenta Activa'' 
		END AS EstadoCuenta,
		''Sin Firmar'' AS ContratoMarco,
		vc.ID_BENEFICIO AS Beneficio,
		t.TpoContrato AS TipoContrato,
		id_persona AS pf,
		s.JTS_OID,
		isnull(ca.MONTO_CALCULADO,0) AS MontoCalculado,
		pc.CANT_SUELDO AS CantidadSueldo,
		vc.ID_JURISDICCION AS Jurisdiccion,
		tp.TIPO_SCORING AS TipoScoring,
		pc.PORC_AFECTACION AS Afectacion,
		can.CANAL,
		isnull(ca.CAPACIDAD_PAGO,0) AS CapacidadPago,
		can.PORCENTAJE_AFECTACION AS AfectacionCanal,
		s.C1803 AS Cliente,
		c.Id_TpoConv AS TipoConvenio
FROM CRE_VINCULACIONES_CONVENIOS vc WITH (NOLOCK)
INNER JOIN SALDOS s WITH (NOLOCK) ON vc.JTS_CV = s.JTS_OID 
									AND s.TZ_LOCK = 0 
									AND s.C1785 IN (2,3)
INNER JOIN SUCURSALES suc WITH (NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
										AND suc.TZ_LOCK = 0
INNER JOIN CRE_PROD_CONVENIOS pc WITH (NOLOCK) ON vc.ID_CONVENIO = pc.DATO_TIPO 
											AND pc.TIPO = ''C'' 
											AND pc.HABILITADO = ''S'' 
											AND pc.TZ_LOCK = 0
INNER JOIN CONV_CONVENIOS_PAG c WITH (NOLOCK) ON pc.DATO_TIPO = c.ID_ConvPago
INNER JOIN CONV_TIPOS t WITH (NOLOCK) ON c.Id_TpoConv = t.Id_TpoConv 
										AND t.TZ_LOCK = 0
INNER JOIN PRODUCTOS p WITH (NOLOCK) ON pc.PRODUCTO = p.C6250 
									AND p.TZ_LOCK = 0 
									AND p.C6800 = ''AH''
INNER JOIN TOPESPRODUCTO tp WITH (NOLOCK) ON p.C6250 = tp.CODPRODUCTO 
										AND tp.MONEDA = 1 
										AND tp.TZ_LOCK = 0
INNER JOIN CRE_PRODUCTOSCANALDIGITAL can WITH (NOLOCK) ON p.C6250 = can.PRODUCTO 
														AND can.CANAL_PRESENCIAL = ''S'' 
														AND can.HABILITADO = ''S'' 
														AND can.TZ_LOCK = 0
LEFT JOIN CRE_AUX_SOL_CALCULO_ADELANTO ca WITH (NOLOCK) ON p.C6250 = ca.PRODUCTO 
														AND c.ID_ConvPago = ca.CONVENIO 
														AND s.C1803 = ca.CLIENTE 
														AND vc.ID_JURISDICCION = ca.ID_JURIDICCION 
														AND can.CANAL = ca.CANAL
WHERE vc.TZ_LOCK = 0
UNION
SELECT
	pc.PRODUCTO AS Producto, 
	p.C6251 AS NombreProducto, 
	vc.ID_CONVENIO AS Convenio,
	c.NomConvPago AS NombreConvenio,
	s.SUCURSAL AS SucursalCuenta,
	suc.NOMBRESUCURSAL AS NombreSucursal, 
	s.CUENTA AS Cuenta,
	CASE WHEN s.C1651 = ''1'' THEN ''Cuenta Cerrada'' 
	ELSE ''Cuenta Activa'' 
	END AS EstadoCuenta,
	''Sin Firmar'' AS ContratoMarco,
	vc.ID_BENEFICIO AS Beneficio,
	t.TpoContrato AS TipoContrato,
	id_persona AS pf,
	s.JTS_OID,
	isnull(ca.MONTO_CALCULADO,0) AS MontoCalculado,
	pc.CANT_SUELDO AS CantidadSueldo,
	vc.ID_JURISDICCION AS Jurisdiccion,
	tp.TIPO_SCORING AS TipoScoring,
	pc.PORC_AFECTACION AS Afectacion,
	can.CANAL,
	isnull(ca.CAPACIDAD_PAGO,0) AS CapacidadPago,
	can.PORCENTAJE_AFECTACION AS AfectacionCanal,
	s.C1803 AS Cliente,
	c.Id_TpoConv AS TipoConvenio
FROM CRE_VINCULACIONES_CONVENIOS vc  WITH (NOLOCK)
INNER JOIN SALDOS s  WITH (NOLOCK)ON vc.JTS_CV = s.JTS_OID 
								AND s.TZ_LOCK = 0 
								AND s.C1785 IN (2,3)
INNER JOIN SUCURSALES suc  WITH (NOLOCK)ON s.SUCURSAL = suc.SUCURSAL 
										AND suc.TZ_LOCK = 0
INNER JOIN CONV_CONVENIOS_PAG c WITH (NOLOCK) ON vc.ID_CONVENIO = c.ID_ConvPago
INNER JOIN CONV_TIPOS t ON c.Id_TpoConv = t.Id_TpoConv 
						AND t.TZ_LOCK = 0
INNER JOIN CRE_PROD_CONVENIOS pc WITH (NOLOCK) ON t.TpoContrato = pc.DATO_TIPO 
											AND pc.TIPO = ''G'' 
											AND pc.HABILITADO = ''S'' 
											AND pc.TZ_LOCK = 0
INNER JOIN PRODUCTOS p WITH (NOLOCK) ON pc.PRODUCTO = p.C6250 
						AND p.TZ_LOCK = 0 
						AND p.C6800 = ''AH''
INNER JOIN TOPESPRODUCTO tp WITH (NOLOCK) ON p.C6250 = tp.CODPRODUCTO 
											AND tp.MONEDA = 1 
											AND tp.TZ_LOCK = 0
INNER JOIN  CRE_PRODUCTOSCANALDIGITAL can WITH (NOLOCK) ON p.C6250 = can.PRODUCTO 
								AND can.CANAL_PRESENCIAL = ''S'' 
								AND can.HABILITADO = ''S'' 
								AND can.TZ_LOCK = 0
LEFT JOIN CRE_AUX_SOL_CALCULO_ADELANTO ca WITH (NOLOCK) ON p.C6250 = ca.PRODUCTO 
														AND c.ID_ConvPago = ca.CONVENIO 
														AND s.C1803 = ca.CLIENTE 
														AND vc.ID_JURISDICCION = ca.ID_JURIDICCION 
														AND can.CANAL = ca.CANAL; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''AUTORIREMOTAS'')
	DROP view [dbo].AUTORIREMOTAS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[AUTORIREMOTAS] (TZ_LOCK, 
											SUCURSALASIENTO, 
											DESCRIPCION)
AS 

SELECT	DISTINCT AUTORIZACIONESREMOTAS.TZ_LOCK, 
		AUTORIZACIONESREMOTAS.SUCURSAL * 10000000 + AUTORIZACIONESREMOTAS.ASIENTO AS SUCURSALASIENTO, 
		AUTORIZACIONESREMOTAS.DESCRIPCION
FROM dbo.AUTORIZACIONESREMOTAS WITH (NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_EMERIX_PRESTAMOS'')
	DROP view [dbo].VW_ITF_EMERIX_PRESTAMOS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_ITF_EMERIX_PRESTAMOS] AS 
SELECT 
	JTS_OID,
	c1803 AS cod_cli,
	dbo.NCADENAS(concat(dbo.NCADENAS(SUCURSAL,4,''0'',''P''),
	dbo.NCADENAS(OPERACION,12,''0'',''P''),
	dbo.NCADENAS(ORDINAL,6,''0'',''P'')),45,'' '',''P'') AS inptm_clave,
	dbo.NCADENAS(concat(''PR'',dbo.NCADENAS(SUCURSAL,4,''0'',''P''),
	dbo.NCADENAS(OPERACION,12,''0'',''P''),
	dbo.NCADENAS(ORDINAL,6,''0'',''P'')),45,'' '',''P'') AS inptm_cta_clave,
	dbo.NCADENAS(floor(c1601*1000000),20,''0'',''P'') AS inptm_capital_inicial,
	dbo.NCADENAS(CONVERT (CHAR(8),c1627,112),8,'' '',''P'') AS inptm_fecha_fin,
	dbo.NCADENAS(cuenta,10,'' '',''P'') AS inptm_cta_debito,
	dbo.NCADENAS('''',255,'' '',''P'') AS inptm_obs,
	dbo.NCADENAS('''',255,'' '',''P'') AS inptm_filler,
	dbo.NCADENAS('''',10,'' '',''P'') AS inptm_error,
	dbo.NCADENAS('''',29,'' '',''P'') AS inptm_error_campo,
	''*'' AS fin_linea
FROM SALDOS WITH(NOLOCK)
WHERE C1785=5 
	AND TZ_LOCK=0; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PAGO_PROV_NEGOCIADOS'')
	DROP view [dbo].VW_PAGO_PROV_NEGOCIADOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PAGO_PROV_NEGOCIADOS] (
												ID_CONVENIO, 
												CLIENTE, 
												ORDENANTE, 
												LOTE, 
												ORDINAL, 
												ESTADO, 
												VENCIMIENTO, 
												MONEDA, 
												IMPORTE, 
												MEDIOPAGO, 
												BENEFICIARIO, 
												JTS_OID_DESCUENTO, 
												CUENTA_DEB_PAGO, 
												PAGO_COMISION, 
												SALDO, 
												FECHA_NEGOCIADA, 
												RUT_BENEFICIARIO)
AS 

SELECT 
		  CP.ID_CONVENIO, 
		  CP.CLIENTE, 
		  CL.NOMBRECLIENTE AS ORDENANTE, 
		  A.LOTE, 
		  A.ORDINAL, 
		  A.ESTADO, 
		  A.VENCIMIENTO, 
		  SA.MONEDA, 
		  A.IMPORTE, 
		  A.MEDIOPAGO, 
		  A.BENEFICIARIO, 
		  A.JTS_OID_DESCUENTO, 
		  CS.PAGO_JTS_OID AS CUENTA_DEB_PAGO, 
		  A.PAGO_COMISION, 
		  SA.C1604 AS SALDO, 
		  A.FECHA_NEGOCIADA, 
		  A.RUT_BENEFICIARIO
FROM 
      (
         SELECT 
            CC.ID_CONVENIO AS ID_CONVENIO, 
            CC.LOTE AS LOTE, 
            DC.ORDINAL AS ORDINAL, 
            CC.ESTADO AS ESTADO, 
            CC.FECHA_ACREDITACION AS VENCIMIENTO, 
            DC.IMPORTE AS IMPORTE, 
            CC.MEDIODEPAGO AS MEDIOPAGO, 
            C.NOMBRECLIENTE AS BENEFICIARIO, 
            DC.JTS_OID_DESCUENTO, 
            DC.FECHA_PAGO_COMISION AS PAGO_COMISION, 
            S.C1604 AS SALDO, 
            DC.FECHA_NEGOCIADA, 
            DC.RUT_BENEFICIARIO
         FROM 
         dbo.SCL_CABEZAL_CREDITOS  AS CC WITH (NOLOCK)
         INNER JOIN dbo.SCL_DETALLE_CREDITOS  AS DC WITH (NOLOCK)ON CC.LOTE = DC.LOTE
																	AND DC.ESTADO = 0
         INNER JOIN dbo.SALDOS  AS S WITH (NOLOCK)ON DC.SALDO_JTS_OID = S.JTS_OID
         INNER JOIN dbo.CLI_CLIENTES  AS C WITH (NOLOCK)ON S.C1803 = C.CODIGOCLIENTE
         WHERE 
             CC.MEDIODEPAGO = ''CUENTA''
             AND  CC.ESTADO = 0
		 UNION
         SELECT 
            CC$2.ID_CONVENIO AS ID_CONVENIO, 
            CC$2.LOTE AS LOTE, 
            DC$2.ORDINAL AS ORDINAL, 
            CC$2.ESTADO AS ESTADO, 
            CC$2.FECHA_ACREDITACION AS VENCIMIENTO, 
            DC$2.IMPORTE AS IMPORTE, 
            CC$2.MEDIODEPAGO AS MEDIOPAGO, 
            DC$2.BENEFICIARIO AS BENEFICIARIO, 
            DC$2.JTS_OID_DESCUENTO, 
            DC$2.FECHA_PAGO_COMISION AS PAGO_COMISION, 
            S$2.C1604 AS SALDO, 
            DC$2.FECHA_NEGOCIADA, 
            DC$2.RUT_BENEFICIARIO
         FROM dbo.SCL_CABEZAL_CREDITOS  AS CC$2 WITH(NOLOCK)
		 INNER JOIN dbo.SCL_DETALLE_CREDITOS  AS DC$2 WITH(NOLOCK) ON  CC$2.LOTE = DC$2.LOTE
																	AND DC$2.ESTADO = 0
		 INNER JOIN dbo.SALDOS  AS S$2 WITH(NOLOCK) ON DC$2.JTS_OID_DESCUENTO = S$2.JTS_OID
         WHERE 
            CC$2.MEDIODEPAGO = ''LETRA'' AND 
            CC$2.ESTADO = 0  
      )  AS A 
INNER JOIN dbo.PCT_CONVENIOS_PAGOS  AS CP WITH (NOLOCK) ON  A.ID_CONVENIO = CP.ID_CONVENIO
													AND CP.TIPO_CONVENIO = 2
													AND CP.DESCUENTA_FACTURA = ''S''
INNER JOIN dbo.PCT_CONVENIOS_SALDOS  AS CS WITH (NOLOCK) ON CP.ID_CONVENIO = CS.ID_CONVENIO
INNER JOIN dbo.SALDOS  AS SA WITH (NOLOCK)ON A.JTS_OID_DESCUENTO = SA.JTS_OID
INNER JOIN dbo.CLI_CLIENTES  AS CL WITH (NOLOCK)ON SA.C1803 = CL.CODIGOCLIENTE
WHERE 
      A.IMPORTE <> 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PRODUCTOS_CONVENIOS_PP'')
	DROP view [dbo].VW_PRODUCTOS_CONVENIOS_PP; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PRODUCTOS_CONVENIOS_PP] (
														Producto, 
														NombreProducto, 
														Convenio,
														NombreConvenio,
														SucursalCuenta,
														NombreSucursal,
														Cuenta,
														EstadoCuenta,
														Beneficio,
														TipoContrato,
														pf,
														JTS_OID,
														Cliente,
														TipoConvenio,
														Jurisdiccion
)
AS
SELECT 
	pc.PRODUCTO AS Producto, 
	p.C6251 AS NombreProducto, 
	vc.ID_CONVENIO AS Convenio,
	c.NomConvPago AS NombreConvenio,
	s.SUCURSAL AS SucursalCuenta,
	suc.NOMBRESUCURSAL AS NombreSucursal, 
	s.CUENTA AS Cuenta,
	CASE WHEN s.C1651 = ''1'' THEN ''Cuenta Cerrada'' 
		ELSE ''Cuenta Activa'' 
	END AS EstadoCuenta,
	vc.ID_BENEFICIO AS Beneficio,
	t.TpoContrato AS TipoContrato,
	id_persona AS pf,
	s.JTS_OID,
	s.C1803 AS Cliente,
	c.Id_TpoConv AS TipoConvenio,
	vc.ID_JURISDICCION AS Jurisdiccion
FROM CRE_VINCULACIONES_CONVENIOS vc WITH (NOLOCK)
INNER JOIN SALDOS s WITH (NOLOCK) ON vc.JTS_CV = s.JTS_OID 
					AND s.TZ_LOCK = 0 
					AND s.C1785 IN (2,3)
INNER JOIN SUCURSALES suc  WITH (NOLOCK)ON s.SUCURSAL = suc.SUCURSAL 
							AND suc.TZ_LOCK = 0
INNER JOIN CRE_PROD_CONVENIOS pc WITH (NOLOCK) ON vc.ID_CONVENIO = pc.DATO_TIPO 
								AND pc.TIPO = ''C'' 
								AND pc.HABILITADO = ''S'' 
								AND pc.TZ_LOCK = 0
INNER JOIN CONV_CONVENIOS_PAG c WITH (NOLOCK) ON pc.DATO_TIPO = c.ID_ConvPago
INNER JOIN CONV_TIPOS t WITH (NOLOCK) ON c.Id_TpoConv = t.Id_TpoConv 
						AND t.TZ_LOCK = 0
INNER JOIN PRODUCTOS p WITH (NOLOCK) ON pc.PRODUCTO = p.C6250 
						AND p.TZ_LOCK = 0 
						AND p.C6800 = ''PP''
WHERE vc.TZ_LOCK = 0
UNION
SELECT
	pc.PRODUCTO AS Producto, 
	p.C6251 AS NombreProducto, 
	vc.ID_CONVENIO AS Convenio,
	c.NomConvPago AS NombreConvenio,
	s.SUCURSAL AS SucursalCuenta,
	suc.NOMBRESUCURSAL AS NombreSucursal, 
	s.CUENTA AS Cuenta,
	CASE WHEN s.C1651 = ''1'' THEN ''Cuenta Cerrada'' 
	ELSE ''Cuenta Activa'' 
	END AS EstadoCuenta,
	vc.ID_BENEFICIO AS Beneficio,
	t.TpoContrato AS TipoContrato,
	id_persona AS pf,
	s.JTS_OID,
	s.C1803 AS Cliente,
	c.Id_TpoConv AS TipoConvenio,
	vc.ID_JURISDICCION AS Jurisdiccion
FROM CRE_VINCULACIONES_CONVENIOS vc WITH (NOLOCK)
INNER JOIN SALDOS s WITH (NOLOCK) ON vc.JTS_CV = s.JTS_OID 
					AND s.TZ_LOCK = 0 
					AND s.C1785 IN (2,3)
INNER JOIN SUCURSALES suc WITH (NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
						AND suc.TZ_LOCK = 0
INNER JOIN CONV_CONVENIOS_PAG c WITH (NOLOCK) ON vc.ID_CONVENIO = c.ID_ConvPago
INNER JOIN CONV_TIPOS t WITH (NOLOCK) ON c.Id_TpoConv = t.Id_TpoConv 
						AND t.TZ_LOCK = 0
INNER JOIN CRE_PROD_CONVENIOS pc WITH (NOLOCK) ON t.TpoContrato = pc.DATO_TIPO 
								AND pc.TIPO = ''G'' 
								AND pc.HABILITADO = ''S'' 
								AND pc.TZ_LOCK = 0
INNER JOIN PRODUCTOS p WITH (NOLOCK) ON pc.PRODUCTO = p.C6250 
						AND p.TZ_LOCK = 0 
						AND p.C6800 = ''PP''; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''CLE_VDEPOSITO'')
	DROP view [dbo].CLE_VDEPOSITO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[CLE_VDEPOSITO] (
										   SALDO_JTS_OID, 
										   NUMERO_DEPOSITO, 
										   FECHA, 
										   IMPORTE, 
										   CANT_CHEQUES_DEPOSITADOS, 
										   CANT_CHEQUES_ACREDITADOS, 
										   CONCEPTO, 
										   TZ_LOCK)
AS 

   SELECT 
      CLE_DEPOSITOS.SALDO_JTS_OID, 
      CLE_DEPOSITOS.NUMERO_DEPOSITO, 
      CLE_DEPOSITOS.FECHA, 
      CLE_DEPOSITOS.IMPORTE, 
      CLE_DEPOSITOS.CANT_CHEQUES_DEPOSITADOS, 
      CLE_DEPOSITOS.CANT_CHEQUES_ACREDITADOS, 
      CLE_DEPOSITOS.CONCEPTO, 
      CLE_DEPOSITOS.TZ_LOCK
   FROM dbo.CLE_DEPOSITOS WITH (NOLOCK)
   WHERE CLE_DEPOSITOS.NUMERO_DEPOSITO IN 
										  (	 SELECT DISTINCT CLE_CHEQUES_SALIENTE.NUMERO_DEPOSITO
											 FROM dbo.CLE_CHEQUES_SALIENTE WITH (NOLOCK)
											 WHERE CLE_CHEQUES_SALIENTE.FECHA_ACREDITACION <= (SELECT PARAMETROS.FECHAPROCESO
																								FROM dbo.PARAMETROS WITH (NOLOCK))
												 AND (CLE_CHEQUES_SALIENTE.ACREDITADO = 0)
											); ')execute(' CREATE OR ALTER   VIEW [dbo].[VW_RRII_IERIC_MENSUAL] AS

SELECT
	VS.CTA_CBU,
	HV.EQUIVALENTEMN AS CAPITALREALIZADO,
	D.NUMERODOCUMENTO AS CUIL_EMPLEADO,
	AE.RUC_INDEPENDIENTE AS CUIT_EMPLEADOR,
	HV.FECHA_VALOR
FROM CLI_DocumentosPFPJ D WITH (nolock)
INNER JOIN CLI_CLIENTEPERSONA CP WITH (nolock)ON D.NUMEROPERSONAFJ = CP.NUMEROPERSONA
											AND CP.TITULARIDAD = ''T''
INNER JOIN CLI_ACTIVIDAD_ECONOMICA AE WITH (nolock)ON AE.CODIGO_PERSONA_CLIENTE = D.NUMEROPERSONAFJ 
													AND AE.FUENTE_INGRESO = ''D''
	--MC para traer datos del empleado
INNER JOIN SALDOS S_EMPLEADO WITH (nolock) ON CP.CODIGOCLIENTE = S_EMPLEADO.C1803
INNER JOIN HISTORIA_VISTA HV WITH (nolock)ON HV.SALDO_JTS_OID = S_EMPLEADO.JTS_OID
											AND YEAR(HV.FECHA_VALOR) = (SELECT YEAR(P.FECHAPROCESO) FROM PARAMETROS P WITH(nolock)) 
											AND HV.DEBITO_CREDITO = ''C''
INNER JOIN ASIENTOS A WITH (nolock) ON HV.ASIENTO = A.ASIENTO
										AND HV.SUCURSAL = A.SUCURSAL
										AND HV.FECHA_PROCESADO = A.FECHAPROCESO
										AND A.ESTADO = 77
	--En este join de saldos traigo los datos del empleado, es decir, en la cuenta en la cual afectó el saldo
INNER JOIN VTA_SALDOS VS WITH (nolock) ON HV.SALDO_JTS_OID = VS.JTS_OID_SALDO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PAQUETE_CAMPANIA'')
	DROP view [dbo].VW_PAQUETE_CAMPANIA; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PAQUETE_CAMPANIA] (
													CAMPANIA, 
													DESCRIPCION, 
													SEGMENTO, 
													SUBSEGMENTO, 
													RESIDENCIA, 
													CANAL, 
													PAQUETE, 
													DEPENDENCIA, 
													PRODUCTO, 
													MONEDA, 
													UTILIZACION)
AS 
   SELECT 
      CAMP.COD_CAMPANIA AS CAMPANIA, 
      CAMP.DESCRIPCION_CAMPANIA AS DESCRIPCION, 
      CAMP.SEGMENTO, 
      CAMP.SUBSEGMENTO, 
      CAMP.RESIDENCIA, 
      CAMP.CANAL, 
      CAMP.PAQUETE, 
      CAMP.DEPENDENCIA, 
      CAMP.PRODUCTO, 
      CAMP.MONEDA, 
      CAMP.UTILIZACION
   FROM dbo.CLI_CLIENTES  AS CLI WITH(NOLOCK)
   INNER JOIN dbo.CLI_CLIENTES_PAQUETES  AS PAQ WITH(NOLOCK) ON PAQ.COD_CLIENTE = CLI.CODIGOCLIENTE
															AND PAQ.ACTIVO = 1
															AND (	(PAQ.TZ_LOCK < 300000000000000 OR PAQ.TZ_LOCK >= 400000000000000) 
																AND (PAQ.TZ_LOCK < 100000000000000 OR PAQ.TZ_LOCK >= 200000000000000))
   INNER JOIN dbo.CLI_CAMPANIAS  AS CAMP WITH(NOLOCK)ON CAMP.PAQUETE_PRE_EXISTENTE = PAQ.COD_PAQUETE
													AND CAMP.PAQUETE_PRE_EXISTENTE > 0
													AND (	(CAMP.TZ_LOCK < 300000000000000 OR CAMP.TZ_LOCK >= 400000000000000) 
														AND (CAMP.TZ_LOCK < 100000000000000 OR CAMP.TZ_LOCK >= 200000000000000))
   WHERE  
      (	(CLI.TZ_LOCK < 300000000000000 OR CLI.TZ_LOCK >= 400000000000000) 
		AND (CLI.TZ_LOCK < 100000000000000 OR CLI.TZ_LOCK >= 200000000000000))  
      
    UNION
   SELECT 
      CAMP.COD_CAMPANIA AS CAMPANIA, 
      CAMP.DESCRIPCION_CAMPANIA AS DESCRIPCION, 
      CAMP.SEGMENTO, 
      CAMP.SUBSEGMENTO, 
      CAMP.RESIDENCIA, 
      CAMP.CANAL, 
      CAMP.PAQUETE, 
      CAMP.DEPENDENCIA, 
      CAMP.PRODUCTO, 
      CAMP.MONEDA, 
      CAMP.UTILIZACION
   FROM dbo.CLI_CLIENTES  AS CLI WITH(NOLOCK)
   INNER JOIN dbo.SALDOS  AS SAL WITH(NOLOCK) ON SAL.C1803 = CLI.CODIGOCLIENTE
												AND (	(SAL.TZ_LOCK < 300000000000000 OR SAL.TZ_LOCK >= 400000000000000) 
													AND (SAL.TZ_LOCK < 100000000000000 OR SAL.TZ_LOCK >= 200000000000000))
   INNER JOIN dbo.CLI_CAMPANIAS  AS CAMP WITH(NOLOCK)ON CAMP.PRODUCTO_PRE_EXISTENTE = SAL.PRODUCTO
													AND CAMP.PRODUCTO_PRE_EXISTENTE > 0 
													AND (	(CAMP.TZ_LOCK < 300000000000000 OR CAMP.TZ_LOCK >= 400000000000000) 
														AND (CAMP.TZ_LOCK < 100000000000000 OR CAMP.TZ_LOCK >= 200000000000000))
   WHERE 
      (		(CLI.TZ_LOCK < 300000000000000 OR CLI.TZ_LOCK >= 400000000000000) 
		AND (CLI.TZ_LOCK < 100000000000000 OR CLI.TZ_LOCK >= 200000000000000)) 
      
    UNION
   SELECT 
      CAMP.COD_CAMPANIA AS CAMPANIA, 
      CAMP.DESCRIPCION_CAMPANIA AS DESCRIPCION, 
      CAMP.SEGMENTO, 
      CAMP.SUBSEGMENTO, 
      CAMP.RESIDENCIA, 
      CAMP.CANAL, 
      CAMP.PAQUETE, 
      CAMP.DEPENDENCIA, 
      CAMP.PRODUCTO, 
      CAMP.MONEDA, 
      CAMP.UTILIZACION
   FROM dbo.CLI_CAMPANIAS  AS CAMP WITH(NOLOCK)
   WHERE 
      CAMP.PAQUETE_PRE_EXISTENTE = -1 
	  AND CAMP.PRODUCTO_PRE_EXISTENTE = -1 
	  AND CAMP.COD_CAMPANIA <> 0 
	  AND (	(CAMP.TZ_LOCK < 300000000000000 OR CAMP.TZ_LOCK >= 400000000000000) 
		AND (CAMP.TZ_LOCK < 100000000000000 OR CAMP.TZ_LOCK >= 200000000000000))
    UNION
   SELECT 
      CAMP.COD_CAMPANIA AS CAMPANIA, 
      CAMP.DESCRIPCION_CAMPANIA AS DESCRIPCION, 
      CAMP.SEGMENTO, 
      CAMP.SUBSEGMENTO, 
      CAMP.RESIDENCIA, 
      CAMP.CANAL, 
      CAMP.PAQUETE, 
      CAMP.DEPENDENCIA, 
      CAMP.PRODUCTO, 
      CAMP.MONEDA, 
      '' '' AS UTILIZACION
   FROM dbo.CLI_CAMPANIAS  AS CAMP WITH(NOLOCK)
   WHERE CAMP.COD_CAMPANIA = 0 
	AND (	(CAMP.TZ_LOCK < 300000000000000 OR CAMP.TZ_LOCK >= 400000000000000) 
		AND (CAMP.TZ_LOCK < 100000000000000 OR CAMP.TZ_LOCK >= 200000000000000)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''CLE_VNRO_DEPOSITO'')
	DROP view [dbo].CLE_VNRO_DEPOSITO; ')
execute(' CREATE OR ALTER   VIEW [dbo].[CLE_VNRO_DEPOSITO] ([Nro Deposito], 
												[Código Cliente], 
												Moneda)
AS 

SELECT CLE_CHEQUES_LISTA_DESCUENTO.NUMERO_DEPOSITO AS [Nro Deposito], 
		CLE_CHEQUES_LISTA_DESCUENTO.CODIGO_CLIENTE AS [Código Cliente], 
		CLE_CHEQUES_LISTA_DESCUENTO.MONEDA AS Moneda
FROM dbo.CLE_CHEQUES_LISTA_DESCUENTO WITH (NOLOCK)
WHERE	CLE_CHEQUES_LISTA_DESCUENTO.ESTADO = 1 
		AND CLE_CHEQUES_LISTA_DESCUENTO.TZ_LOCK = 0
GROUP BY 
    CLE_CHEQUES_LISTA_DESCUENTO.NUMERO_DEPOSITO, 
    CLE_CHEQUES_LISTA_DESCUENTO.CODIGO_CLIENTE, 
    CLE_CHEQUES_LISTA_DESCUENTO.MONEDA; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RRII_IERIC_ANUAL'')
	DROP view [dbo].VW_RRII_IERIC_ANUAL; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_RRII_IERIC_ANUAL] AS
WITH AUX AS
(
SELECT
	VS.CTA_CBU AS CBU,
	SUM(HV.MONTO) AS MONTO_UVA,
	SUM(HV.EQUIVALENTEMN) AS MONTO_MN,
	D.NUMERODOCUMENTO AS CUIL_EMPLEADO,
	AE.RUC_INDEPENDIENTE AS CUIT_EMPLEADOR,
	HV.SALDO_JTS_OID
FROM
	HISTORIA_VISTA HV WITH (NOLOCK)
INNER JOIN SALDOS S WITH (NOLOCK) ON HV.SALDO_JTS_OID = S.JTS_OID 
INNER JOIN VTA_SALDOS VS WITH (NOLOCK) ON HV.SALDO_JTS_OID = VS.JTS_OID_SALDO
INNER JOIN CLI_CLIENTEPERSONA CP WITH (NOLOCK)ON CP.CODIGOCLIENTE = S.C1803
												AND CP.TITULARIDAD = ''T''
INNER JOIN CLI_DocumentosPFPJ D  WITH (NOLOCK)ON D.NUMEROPERSONAFJ = CP.NUMEROPERSONA
INNER JOIN CLI_ACTIVIDAD_ECONOMICA AE WITH (NOLOCK)ON AE.CODIGO_PERSONA_CLIENTE = D.NUMEROPERSONAFJ
													AND AE.FUENTE_INGRESO = ''D''
WHERE
	HV.DEBITO_CREDITO = ''C''
	AND HV.FECHA_VALOR NOT BETWEEN DATEADD(MONTH, -12, (SELECT FECHAPROCESO 
														FROM  PARAMETROS P  WITH (NOLOCK))) 
													AND (SELECT FECHAPROCESO 
														FROM  PARAMETROS P  WITH (NOLOCK))
	AND S.PRODUCTO IN (	SELECT PRODUCTOS.C6250 
						FROM PRODUCTOS WITH (NOLOCK) 
						WHERE C6252 IN (2,3) 
							AND TIPO_CUENTA_VISTA = 6)
GROUP BY
	HV.SALDO_JTS_OID,	
	D.NUMERODOCUMENTO,
	AE.RUC_INDEPENDIENTE,
	VS.CTA_CBU
)
SELECT
	A.CBU,
	A.CUIL_EMPLEADO,
	A.CUIT_EMPLEADOR,
	MAX(HV.FECHA_VALOR) AS FECHACONTABLE,
	A.MONTO_MN AS SALDO_CUENTA
FROM
	HISTORIA_VISTA HV WITH (NOLOCK) 
	INNER JOIN ASIENTOS ASIE WITH (NOLOCK)ON hv.ASIENTO = ASIE.ASIENTO 
										AND hv.SUCURSAL = ASIE.SUCURSAL 
										AND hv.FECHA_PROCESADO = ASIE.FECHAPROCESO 
										AND ASIE.ESTADO = 77
	INNER JOIN AUX A WITH (NOLOCK)ON HV.SALDO_JTS_OID = A.SALDO_JTS_OID
WHERE
	HV.FECHA_VALOR NOT BETWEEN DATEADD(MONTH, -12, (SELECT FECHAPROCESO 
													FROM  PARAMETROS P  WITH (NOLOCK))) 
													AND (SELECT FECHAPROCESO 
														FROM  PARAMETROS P  WITH (NOLOCK))
GROUP BY
	HV.SALDO_JTS_OID,
	A.MONTO_MN,
	A.CUIL_EMPLEADO,
	A.CUIT_EMPLEADOR,
	A.CBU; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PARAMETROSTOPAZ'')
	DROP view [dbo].VW_PARAMETROSTOPAZ; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PARAMETROSTOPAZ] (
											NOMBRE1, 
											NOMBRE2, 
											FECHAPROCESO, 
											FECHAPROCESOANTERIOR, 
											FECHAPROXIMOPROCESO, 
											DIASVALIDOS, 
											REINTENTOS, 
											TIPORED, 
											AUTOLOGIN, 
											SIGLO, 
											CORTESIGLO, 
											LENGUAJEDEFECTO, 
											COMUNICACIONES, 
											AMBIENTE, 
											TIEMPOCORTE, 
											INICIODELDIA, 
											FINDELDIA, 
											NUMSUCURSAL, 
											MONNAC, 
											MOVIMIENTOSCAJA, 
											TIPOPLAZO, 
											INICIODESARROLLO, 
											PWDLARGOMIN, 
											PWDCANTMINCAR, 
											PWDCANTMINNUM, 
											PWDCANTMAXREP, 
											PWDCARMAXREP, 
											PWDPOSMAXREP, 
											VERSIONDESARROLLO, 
											COMPLEMENTOGRUPO, 
											PWDLARGOMAX, 
											PWDCANTCARMAXREP, 
											CLVLARGOMAX)
AS 
   
SELECT 
    PARAMETROS.NOMBRE1, 
    PARAMETROS.NOMBRE2, 
    PARAMETROS.FECHAPROCESO, 
    PARAMETROS.FECHAPROCESOANTERIOR, 
    PARAMETROS.FECHAPROXIMOPROCESO, 
    PARAMETROS.DIASVALIDOS, 
    PARAMETROS.REINTENTOS, 
    PARAMETROS.TIPORED, 
    PARAMETROS.AUTOLOGIN, 
    PARAMETROS.SIGLO, 
    PARAMETROS.CORTESIGLO, 
    PARAMETROS.LENGUAJEDEFECTO, 
    PARAMETROS.COMUNICACIONES, 
    PARAMETROS.AMBIENTE, 
    PARAMETROS.TIEMPOCORTE, 
    PARAMETROS.INICIODELDIA, 
    PARAMETROS.FINDELDIA, 
    PARAMETROS.NUMSUCURSAL, 
    PARAMETROS.MONNAC, 
    PARAMETROS.MOVIMIENTOSCAJA, 
    PARAMETROS.TIPOPLAZO, 
    PARAMETROS.INICIODESARROLLO, 
    PARAMETROS.PWDLARGOMIN, 
    PARAMETROS.PWDCANTMINCAR, 
    PARAMETROS.PWDCANTMINNUM, 
    PARAMETROS.PWDCANTMAXREP, 
    PARAMETROS.PWDCARMAXREP, 
    PARAMETROS.PWDPOSMAXREP, 
    PARAMETROS.VERSIONDESARROLLO, 
    PARAMETROS.COMPLEMENTOGRUPO, 
    PARAMETROS.PWDLARGOMAX, 
    PARAMETROS.PWDCANTCARMAXREP, 
    PARAMETROS.CLVLARGOMAX
FROM dbo.PARAMETROS WITH(NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VVAL_SALDOSPOSICIONCLIENTE'')
	DROP view [dbo].VVAL_SALDOSPOSICIONCLIENTE; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VVAL_SALDOSPOSICIONCLIENTE] (
														   COD, 
														   OPERACION, 
														   FECHAVENCIMIENTO, 
														   RUBRO, 
														   VALORNOMINAL, 
														   MONEDA, 
														   ORDINAL, 
														   CLIENTE, 
														   JTS_OID)
AS 
  
   SELECT 
      VVAL_SALDOSRUBROSESQUEMAS.COD, 
      VVAL_SALDOSRUBROSESQUEMAS.OPERACION, 
      VVAL_SALDOSRUBROSESQUEMAS.C1627 AS FECHAVENCIMIENTO, 
      VVAL_SALDOSRUBROSESQUEMAS.C1804 AS RUBRO, 
      CASE 
         WHEN VVAL_SALDOSRUBROSESQUEMAS.COD IN ( 1, 2, 3 ) THEN SALDOS.C6674 * (-1)
         ELSE SALDOS.C6674
      END AS VALORNOMINAL, 
      SALDOS.MONEDA, 
      SALDOS.ORDINAL, 
      SALDOS.C1803 AS CLIENTE, 
      SALDOS.JTS_OID
   FROM 
      dbo.VVAL_SALDOSRUBROSESQUEMAS WITH(NOLOCK)
         INNER JOIN dbo.SALDOS WITH(NOLOCK) 
         ON 
            VVAL_SALDOSRUBROSESQUEMAS.OPERACION = SALDOS.OPERACION  
            AND VVAL_SALDOSRUBROSESQUEMAS.C1804 = SALDOS.C1804 
			AND 
            CASE 
               WHEN (VVAL_SALDOSRUBROSESQUEMAS.C1627 IS NULL) THEN CONVERT(datetime2, ''01/01/1900'', 103)
               ELSE VVAL_SALDOSRUBROSESQUEMAS.C1627
            END = 
            CASE 
               WHEN (SALDOS.C1627 IS NULL) THEN CONVERT(datetime2, ''01/01/1900'', 103)
               ELSE SALDOS.C1627
            END AND 
            VVAL_SALDOSRUBROSESQUEMAS.COD <> 8 AND 
            (
            (SALDOS.TZ_LOCK < 3000000000000000 OR SALDOS.TZ_LOCK >= 4000000000000000) AND 
            (SALDOS.TZ_LOCK < 1000000000000000 OR SALDOS.TZ_LOCK >= 2000000000000000) AND 
            SALDOS.C1604 <> 0); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PERSONAS_F_Y_J'')
	DROP view [dbo].VW_PERSONAS_F_Y_J; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PERSONAS_F_Y_J] (
												  NUMEROPERSONA,
												  TipoDocIdent, 
												  NroDocIdent, 
												  TipoDocFisico,
												  NumDocFisico,
												  NIVELAPERTURA, 
												  TIPOPERSONA, 
												  NOMBRE)
AS
/*
 * Identificador del cambio:  #001
 * Propietario del Cambio:    ALVAROC (Álvaro Correa - Topaz)
 * Fecha (dd/mm/yyyy):        12/10/2020
 * Nro. Caso:                 NBCHSEG-234
 * Código Jira:               NBCHSEG-234
 * Descripción breve: Se cambia el campo "NOMBRE" para que en caso de persona
 *                    física/humana se devuelva en formato 
 *                    "Apellido/s, Nombre/s".
 *                    También se agrega la descripción del tipo de persona.
*/
SELECT  V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
        V.TIPODOCUMENTO   AS TipoDocIdent, 
        V.NUMERODOCUMENTO AS NroDocIdent, 
        V.TIPO_DOC_FISICO AS TIPO_DOC_FISICO,
        V.NUM_DOC_FISICO  AS NUM_DOC_FISICO,
        (
          CASE U.NIVEL_APERTURA
            WHEN 0 THEN ''REGISTRO''
            WHEN 1 THEN ''BÁSICO''
            WHEN 3 THEN ''ACTIVOS''
          END
        ) AS NIVELAPERTURA,
        -- INICIO #001
        (V.TIPOPERSONA + '' - '' + o.DESCRIPCION) AS TIPOPERSONA,
        (
          RTRIM(
            ISNULL(U.APELLIDOPATERNO+'' '', '''') +
              ISNULL(U.APELLIDOMATERNO+'' '', '''')
          ) + '', '' + ISNULL(U.PRIMERNOMBRE, '''') + '' '' +
            ISNULL(U.SEGUNDONOMBRE, '''')
        ) AS NOMBRE
        -- FIN #001
FROM    dbo.CLI_PERSONASFISICAS U WITH(nolock)
		INNER JOIN dbo.CLI_DOCUMENTOSPFPJ V WITH (nolock)ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
        INNER JOIN  OPCIONES o WITH (nolock) ON  o.NUMERODECAMPO = 1241 
											AND o.IDIOMA = ''E''
											AND o.OPCIONINTERNA = V.TIPOPERSONA
WHERE   
        (
          (U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000)
          AND
          (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)
        )
        AND
        (
          (V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000)
          AND
          (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)
        )
UNION ALL
--
SELECT  V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
        V.TIPODOCUMENTO   AS TipoDocIdent, 
        V.NUMERODOCUMENTO AS NroDocIdent, 
        V.TIPO_DOC_FISICO AS TIPO_DOC_FISICO,
        V.NUM_DOC_FISICO  AS NUM_DOC_FISICO,
        (
          CASE S.NIVEL_APERTURA
            WHEN 0 THEN ''REGISTRO''
            WHEN 1 THEN ''BÁSICO''
            WHEN 3 THEN ''ACTIVOS''
            WHEN 4 THEN ''INST. FINANCIERA''
          END
        ) AS NIVELAPERTURA,
        -- INICIO #001
        (V.TIPOPERSONA + '' - '' + o.DESCRIPCION) AS TIPOPERSONA,
        -- FIN #001
        S.RAZONSOCIAL AS NOMBRE
FROM    dbo.CLI_PERSONASJURIDICAS S WITH (nolock)
        INNER JOIN dbo.CLI_DOCUMENTOSPFPJ V WITH (nolock)ON S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
        INNER JOIN  DBO.OPCIONES o WITH (nolock)
												  ON  o.NUMERODECAMPO = 1241
													  AND o.IDIOMA = ''E''
													  AND o.OPCIONINTERNA = V.TIPOPERSONA
WHERE   
        (		(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000)
          AND	(S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)) 
		AND
        (		(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000)
          AND
				(V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''CUENTASCTR'')
DROP view [dbo].CUENTASCTR; ')
execute(' CREATE OR ALTER     VIEW [dbo].[CUENTASCTR] (
										   SUCURSAL, 
										   PRODUCTO, 
										   CLIENTE, 
										   NOMBRECLIENTE, 
										   MONEDA, 
										   CUENTA, 
										   OPERACION, 
										   RUBROOPERATIVO, 
										   RUBROCONTABLE, 
										   ORDINAL, 
										   SALDO_OID)
AS 

SELECT 
    A.SUCURSAL, 
    A.PRODUCTO, 
    A.C1803 AS CLIENTE, 
    B.NOMBRECLIENTE, 
    A.MONEDA, 
    A.CUENTA, 
    A.OPERACION, 
    A.C1804 AS RUBROOPERATIVO, 
    A.C1730 AS RUBROCONTABLE, 
    A.ORDINAL, 
    A.JTS_OID AS SALDO_OID
FROM dbo.SALDOS  AS A WITH (NOLOCK)
INNER JOIN dbo.CLI_CLIENTES  AS B WITH (NOLOCK) ON 
												A.C1803 = B.CODIGOCLIENTE
												AND  A.C1803 <> 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CLI_DOC_DEUDOR'')
DROP view [dbo].VW_CLI_DOC_DEUDOR; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_CLI_DOC_DEUDOR] (
											   OFICIAL, 
											   NOM_OFICIAL, 
											   CLIENTE, 
											   NOM_CLIENTE, 
											   TIPO_DEUDOR, 
											   SEGMENTO, 
											   DESC_SEGMENTO, 
											   CODIGO_DOC, 
											   DESC_DOC, 
											   FECHA_PRESENTACION, 
											   FECHA_VENCIMIENTO, 
											   REQUERIDA_EVALUACION, 
											   TIPO, 
											   FECHA_BALANCE)
AS 

SELECT 
    VW_CLI_DOC_PRESENTADO.OFICIAL, 
    VW_CLI_DOC_PRESENTADO.NOM_OFICIAL, 
    VW_CLI_DOC_PRESENTADO.CLIENTE, 
    VW_CLI_DOC_PRESENTADO.NOM_CLIENTE, 
    VW_CLI_DOC_PRESENTADO.TIPO_DEUDOR, 
    VW_CLI_DOC_PRESENTADO.SEGMENTO, 
    VW_CLI_DOC_PRESENTADO.DESC_SEGMENTO, 
    VW_CLI_DOC_PRESENTADO.CODIGO_DOC, 
    VW_CLI_DOC_PRESENTADO.DESC_DOC, 
    VW_CLI_DOC_PRESENTADO.FECHA_PRESENTACION, 
    VW_CLI_DOC_PRESENTADO.FECHA_VENCIMIENTO, 
    VW_CLI_DOC_PRESENTADO.REQUERIDA_EVALUACION, 
    VW_CLI_DOC_PRESENTADO.TIPO, 
    VW_CLI_DOC_PRESENTADO.FECHA_BALANCE
FROM dbo.VW_CLI_DOC_PRESENTADO WITH (NOLOCK)
UNION
SELECT 
    VW_CLI_DOC_FALTANTE.OFICIAL, 
    VW_CLI_DOC_FALTANTE.NOM_OFICIAL, 
    VW_CLI_DOC_FALTANTE.CLIENTE, 
    VW_CLI_DOC_FALTANTE.NOM_CLIENTE, 
    VW_CLI_DOC_FALTANTE.TIPO_DEUDOR, 
    VW_CLI_DOC_FALTANTE.SEGMENTO, 
    VW_CLI_DOC_FALTANTE.DESC_SEGMENTO, 
    VW_CLI_DOC_FALTANTE.CODIGO_DOC, 
    VW_CLI_DOC_FALTANTE.DESC_DOC, 
    VW_CLI_DOC_FALTANTE.FECHA_PRESENTACION, 
    VW_CLI_DOC_FALTANTE.FECHA_VENCIMIENTO, 
    VW_CLI_DOC_FALTANTE.REQUERIDA_EVALUACION, 
    VW_CLI_DOC_FALTANTE.TIPO, 
    VW_CLI_DOC_FALTANTE.FECHA_BALANCE
FROM dbo.VW_CLI_DOC_FALTANTE  WITH (NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PERSONAS_F_Y_J_JBANK'')
DROP view [dbo].VW_PERSONAS_F_Y_J_JBANK; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PERSONAS_F_Y_J_JBANK] (
													   TIPODOC, 
													   NUMERODOC, 
													   NUMEROPERSONA, 
													   NIVELAPERTURA, 
													   TIPOPERSONA, 
													   APELLIDOPATERNO, 
													   APELLIDOMATERNO, 
													   PRIMERNOMBRE, 
													   SEGUNDONOMBRE, 
													   EMPRESA)
AS 

   SELECT 
      V.TIPODOCUMENTO AS TIPODOC, 
      V.NUMERODOCUMENTO AS NUMERODOC, 
      V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
      CASE U.NIVEL_APERTURA
         WHEN 0 THEN ''REGISTRO''
         WHEN 1 THEN ''BÁSICO''
         WHEN 2 THEN ''PASIVOS''
         WHEN 3 THEN ''ACTIVOS''
      END AS NIVELAPERTURA, 
      V.TIPOPERSONA, 
      U.APELLIDOPATERNO, 
      U.APELLIDOMATERNO, 
      U.PRIMERNOMBRE, 
      U.SEGUNDONOMBRE, 
      NULL AS EMPRESA
   FROM dbo.CLI_PERSONASFISICAS  AS U WITH (NOLOCK)
   INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK) ON  
													  U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ 
														AND (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
															AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000))  
														AND	(	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
															AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
    UNION ALL
   SELECT 
      V.TIPODOCUMENTO AS TIPODOC, 
      V.NUMERODOCUMENTO AS NUMERODOC, 
      V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
      CASE S.NIVEL_APERTURA
         WHEN 0 THEN ''REGISTRO''
         WHEN 1 THEN ''BÁSICO''
         WHEN 2 THEN ''PASIVOS''
         WHEN 3 THEN ''ACTIVOS''
         WHEN 4 THEN ''INST. FINANCIERA''
      END AS NIVELAPERTURA, 
      V.TIPOPERSONA, 
      NULL AS APELLIDOPATERNO, 
      NULL AS APELLIDOMATERNO, 
      NULL AS PRIMERNOMBRE, 
      NULL AS SEGUNDONOMBRE, 
      S.RAZONSOCIAL AS EMPRESA
   FROM dbo.CLI_PERSONASJURIDICAS  AS S WITH (NOLOCK)
   INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V  WITH (NOLOCK) ON  
														S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ 
														AND (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
															AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)) 
														AND	(	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
															AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_EMERIX_PAISES'')
DROP view [dbo].VW_ITF_EMERIX_PAISES; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_ITF_EMERIX_PAISES] 
AS 
SELECT 
	dbo.NCADENAS(CODIGOPAIS,5,''0'',''P'') AS inpai_cod, 
	dbo.NCADENAS(NOMBREPAIS,30,'' '',''P'') AS inpai_nombre,  
	dbo.NCADENAS(CODIGOPAIS,10,''0'',''P'') AS inpai_nombre_corto,
	dbo.NCADENAS('''',100,'' '',''P'') AS inpai_obs,
	dbo.NCADENAS('''',255,'' '',''P'') AS inpai_filler,
	dbo.NCADENAS('''',10,'' '',''P'') AS inpai_error,
	dbo.NCADENAS('''',29,'' '',''P'') AS inpai_error_campo,
	''*'' AS fin_linea
FROM CLI_PAISES WITH (NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_COMISION_TJD_EXCESO_MOV'')
DROP view [dbo].VW_COMISION_TJD_EXCESO_MOV; ')
execute(' CREATE OR ALTER    VIEW [dbo].[VW_COMISION_TJD_EXCESO_MOV] (
													   SALDO_JTS_OID, 
													   SALDO_ACTUAL, 
													   MONEDA, 
													   FECHA, 
													   TIPO_TARJETA, 
													   D_EXTRACCIONES_ACUMULADAS, 
													   M_EXTRACCIONES_ACUMULADAS, 
													   D_COMPRA_12, 
													   M_COMPRA_12, 
													   D_COMPRA_15, 
													   M_COMPRA_15, 
													   D_COMPRA_16, 
													   M_COMPRA_16, 
													   D_DEPOSITO, 
													   M_DEPOSITO, 
													   D_CONSULTA, 
													   M_CONSULTA, 
													   CANT_MOV_DIA, 
													   CANT_MOV_MES, 
													   D_CONSULTA_TIPO_CAMBIO, 
													   M_CONSULTA_TIPO_CAMBIO, 
													   D_CAMBIO_PIN, 
													   M_CAMBIO_PIN, 
													   D_TRANSFERENCIA, 
													   M_TRANSFERENCIA, 
													   D_STATEMENT_PRINT, 
													   M_STATEMENT_PRINT, 
													   D_AFILIACIONES_WEB_27, 
													   M_AFILIACIONES_WEB_27, 
													   D_AFILIACIONES_WEB_82, 
													   M_AFILIACIONES_WEB_82, 
													   SEGMENTO)
AS 

SELECT 
    R.SALDO_JTS_OID, 
    R.C1604 AS SALDO_ACTUAL, 
    R.MONEDA, 
    D.FECHA, 
    T.TIPO_TARJETA, 
    sum(D.EXTRACCIONES_ACUMULADAS) AS D_EXTRACCIONES_ACUMULADAS, 
    sum(M.EXTRACCIONES_ACUMULADAS) AS M_EXTRACCIONES_ACUMULADAS, 
    sum(D.COMPRA_12) AS D_COMPRA_12, 
    sum(M.COMPRA_12) AS M_COMPRA_12, 
    sum(D.COMPRA_15) AS D_COMPRA_15, 
    sum(M.COMPRA_15) AS M_COMPRA_15, 
    sum(D.COMPRA_16) AS D_COMPRA_16, 
    sum(M.COMPRA_16) AS M_COMPRA_16, 
    sum(D.DEPOSITO) AS D_DEPOSITO, 
    sum(M.DEPOSITO) AS M_DEPOSITO, 
    sum(D.CONSULTA) AS D_CONSULTA, 
    sum(M.CONSULTA) AS M_CONSULTA, 
    /*Suma Contador Diario*/(
        sum(D.EXTRACCIONES_ACUMULADAS)
        + 
        sum(D.COMPRA_12)
        + 
        sum(D.COMPRA_15)
        + 
        sum(D.COMPRA_16)
        + 
        sum(D.DEPOSITO)
        + 
        sum(D.CONSULTA)
        + 
        sum(D.CONSULTA_TIPO_CAMBIO)
        + 
        sum(D.TRANSFERENCIA)
        + 
        sum(D.STATEMENT_PRINT)
        + 
        sum(D.AFILIACIONES_WEB_27)
        + 
        sum(D.AFILIACIONES_WEB_82)) AS CANT_MOV_DIA, 
    /*Suma Contador Mes*/(
        sum(M.EXTRACCIONES_ACUMULADAS)
        + 
        sum(M.COMPRA_12)
        + 
        sum(M.COMPRA_15)
        + 
        sum(M.COMPRA_16)
        + 
        sum(M.DEPOSITO)
        + 
        sum(M.CONSULTA)
        + 
        sum(M.CONSULTA_TIPO_CAMBIO)
        + 
        sum(M.TRANSFERENCIA)
        + 
        sum(M.STATEMENT_PRINT)
        + 
        sum(M.AFILIACIONES_WEB_27)
        + 
        sum(M.AFILIACIONES_WEB_82)) AS CANT_MOV_MES, 
    /**/sum(D.CONSULTA_TIPO_CAMBIO) AS D_CONSULTA_TIPO_CAMBIO, 
    sum(M.CONSULTA_TIPO_CAMBIO) AS M_CONSULTA_TIPO_CAMBIO, 
    sum(D.CAMBIO_PIN) AS D_CAMBIO_PIN, 
    sum(M.CAMBIO_PIN) AS M_CAMBIO_PIN, 
    sum(D.TRANSFERENCIA) AS D_TRANSFERENCIA, 
    sum(M.TRANSFERENCIA) AS M_TRANSFERENCIA, 
    sum(D.STATEMENT_PRINT) AS D_STATEMENT_PRINT, 
    sum(M.STATEMENT_PRINT) AS M_STATEMENT_PRINT, 
    sum(D.AFILIACIONES_WEB_27) AS D_AFILIACIONES_WEB_27, 
    sum(M.AFILIACIONES_WEB_27) AS M_AFILIACIONES_WEB_27, 
    sum(D.AFILIACIONES_WEB_82) AS D_AFILIACIONES_WEB_82, 
    sum(M.AFILIACIONES_WEB_82) AS M_AFILIACIONES_WEB_82, 
    CAST(ISNULL(RIGHT(''00000'' + ISNULL(CAST(T.COD_PAQUETE AS nvarchar(4000)), ''''), 5), '''') + ''00000'' AS varchar(12)) AS SEGMENTO
FROM dbo.TJD_ATM_CONTADOR_DIARIO  AS D WITH (NOLOCK)
INNER JOIN dbo.TJD_ATM_CONTADOR_MENSUAL  AS M WITH (NOLOCK) ON D.ID_TARJETA = M.ID_TARJETA
											AND M.TZ_LOCK = 0
INNER JOIN dbo.VW_CTA_COBRO_TJD  AS R WITH (NOLOCK) ON  R.ID_TARJETA = M.ID_TARJETA
INNER JOIN dbo.TJD_TARJETAS  AS T WITH (NOLOCK) ON  D.ID_TARJETA = T.ID_TARJETA
								AND T.TZ_LOCK = 0
INNER JOIN dbo.PARAMETROS  AS P WITH (NOLOCK) ON D.FECHA = P.FECHAPROCESO
WHERE 
    MONTH(P.FECHAPROCESO) = M.MES 
	AND CONVERT(varchar(4), P.FECHAPROCESO, 102) = M.ANIO 
	AND D.TZ_LOCK = 0
GROUP BY 
    R.SALDO_JTS_OID, 
    R.C1604, 
    R.MONEDA, 
    D.FECHA, 
    T.TIPO_TARJETA, 
    T.COD_PAQUETE; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_VINCULACIONES'')
DROP view [dbo].VW_VINCULACIONES; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_ITF_EMERIX_PROVINCIAS] AS 
SELECT 
	dbo.NCADENAS(CODIGOPAIS,10,''0'',''P'') AS inprv_pai,
	dbo.NCADENAS(ID_BCRA,5,''0'',''P'') AS inprv_cod,
	dbo.NCADENAS(ID_BCRA,10,''0'',''P'') AS inprv_nombre_corto,
	dbo.NCADENAS(DESCRIPCION,100,'' '',''P'') AS inprv_obs,
	dbo.NCADENAS('''',155,'' '',''P'') AS inprv_filler,
	dbo.NCADENAS('''',10,'' '',''P'') AS inprv_error,
	dbo.NCADENAS('''',29,'' '',''P'') AS inprv_error_campo,
	''*'' AS fin_linea
FROM CLI_PROVINCIAS  WITH (NOLOCK)
WHERE TZ_LOCK=0 
	AND CODIGOPAIS IN (	SELECT NUMERICO 
						FROM PARAMETROSGENERALES WITH (NOLOCK)
						WHERE CODIGO=1); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CORREOS_JUZGADOS'')
DROP view [dbo].VW_CORREOS_JUZGADOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_CORREOS_JUZGADOS]  (
													"Número de Juzgado",
 													"Nombre de Juzgado",
 													ID,
													"Formato",
													"Descripción Formato",
													"Tipo",
													"Descripción Tipo",
													"Ordinal",
													"Email"
	)
AS
SELECT 
 	j.NRO_JUZGADO AS "Número de Juzgado",
 	j.NOMBRE AS "Nombre de Juzgado",
 	e.ID,
   	e.FORMATO AS "Formato",
    (	SELECT DESCRIPCION 
	FROM OPCIONES O WITH (NOLOCK) 
	WHERE O.IDIOMA = ''E'' 
		AND O.NUMERODECAMPO = 33460 
		AND O.OPCIONINTERNA= e.FORMATO) AS DESC_FORMATO,
    e.TIPO,
   	(SELECT DESCRIPCION 
	FROM OPCIONES O WITH (NOLOCK) 
	WHERE O.IDIOMA = ''E'' 
		AND O.NUMERODECAMPO = 33494 
		AND O.OPCIONINTERNA= e.TIPO) AS DESC_TIPO,
   	e.ORDINAL,
	e.EMAIL
FROM dbo.CLI_EMAILS AS E WITH (NOLOCK)
INNER JOIN dbo.DJ_JUZGADOS  AS J WITH (NOLOCK) ON
												(J.NRO_JUZGADO = e.ID AND e.FORMATO =''J'') 
													AND (	(E.TZ_LOCK < 300000000000000 OR E.TZ_LOCK >= 400000000000000) 
													AND (E.TZ_LOCK < 100000000000000 OR E.TZ_LOCK >= 200000000000000)) 
												AND (	(J.TZ_LOCK < 300000000000000 OR J.TZ_LOCK >= 400000000000000) 
													AND (J.TZ_LOCK < 100000000000000 OR J.TZ_LOCK >= 200000000000000)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_LIMITE_CLIENTE_CALCULADO'')
DROP view [dbo].VW_LIMITE_CLIENTE_CALCULADO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_LIMITE_CLIENTE_CALCULADO] (
													CODIGOCLIENTE, 
													RIESGO, 
													SALDO_SOLICITUD, 
													IDENTIFICACION, 
													CAPITAL_MONEDA_LIMITE)
AS 

SELECT 
    CLI_CLIENTES.CODIGOCLIENTE, 
    CRE_RESULTADO_LIMITE_CLIENTE.RIESGO, 
    CRE_RESULTADO_LIMITE_CLIENTE.SALDO_SOLICITUD, 
    CRE_RESULTADO_LIMITE_CLIENTE.IDENTIFICACION, 
    CRE_RESULTADO_LIMITE_CLIENTE.CAPITAL_MONEDA_LIMITE
FROM dbo.CLI_CLIENTES WITH(NOLOCK)
INNER JOIN dbo.CRE_LIMITEINST WITH(NOLOCK) 
						ON CLI_CLIENTES.CODIGOCLIENTE = CRE_LIMITEINST.INSTITUCION 
						AND CLI_CLIENTES.TIPO = ''I'' 
LEFT OUTER JOIN dbo.CRE_RESULTADO_LIMITE_CLIENTE  WITH(NOLOCK)
							ON CRE_LIMITEINST.INSTITUCION = CRE_RESULTADO_LIMITE_CLIENTE.SOLICITUD 
							AND CRE_RESULTADO_LIMITE_CLIENTE.SOLICITUD_CLIENTE = ''C''
UNION
SELECT 
    VW_SALDOS_FUERA_LIMITE.CODIGOCLIENTE, 
    VW_SALDOS_FUERA_LIMITE.RIESGO, 
    VW_SALDOS_FUERA_LIMITE.SALDO_SOLICITUD, 
    VW_SALDOS_FUERA_LIMITE.IDENTIFICACION, 
    VW_SALDOS_FUERA_LIMITE.CAPITAL_MONEDA_LIMITE
FROM dbo.VW_SALDOS_FUERA_LIMITE WITH(NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_EMERIX_SUCURSALES'')
DROP view [dbo].VW_ITF_EMERIX_SUCURSALES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_ITF_EMERIX_SUCURSALES] AS 
SELECT 
			dbo.NCADENAS(s.SUCURSAL,10,''0'',''P'') AS insuc_nombre_corto,
			dbo.NCADENAS(s.NOMBRESUCURSAL,30,'' '',''P'') AS insuc_nombre,
			dbo.NCADENAS(''S/I'',10,'' '',''P'') AS insuc_tti1,
			dbo.NCADENAS(''S/I'',10,'' '',''P'') AS insuc_tti2,
			dbo.NCADENAS(''S/I'',10,'' '',''P'') AS insuc_tti3,
			dbo.NCADENAS(s.CODIGOPAIS,10,''0'',''P'') AS insuc_pai,
			dbo.NCADENAS(p.ID_BCRA,10,''0'',''P'') AS insuc_prv,
			dbo.NCADENAS(concat(dbo.NCADENAS(p.ID_BCRA,2,''0'',''P''),dbo.NCADENAS(cd.DEPARTAMENTO,3,''0'',''P''), dbo.NCADENAS(cd.LOCALIDAD,3,''0'',''P'')),10,''0'',''P'') AS insuc_loc,
			dbo.NCADENAS(''NBCH'',10,'' '',''P'') AS insuc_ent,
			dbo.NCADENAS(s.SUCURSAL,5,''0'',''P'') AS insuc_cod, 
			dbo.NCADENAS('''',20,'' '',''P'') AS insuc_telefono1,
			dbo.NCADENAS('''',20,'' '',''P'') AS insuc_telefono2,
			dbo.NCADENAS('''',20,'' '',''P'') AS insuc_telefono3,
			dbo.NCADENAS(cd.CALLE,40,'' '',''P'') AS insuc_calle,
			dbo.NCADENAS(cd.NUMERO,10,'' '',''P'') AS insuc_nro,
			dbo.NCADENAS(cd.PISO,10,''0'',''P'') AS insuc_piso,
			dbo.NCADENAS(cd.CPA_VIEJO,20,''0'',''P'') AS insuc_cod_postal,
			dbo.NCADENAS('''',100,'' '',''P'') AS insuc_obs,
			dbo.NCADENAS('''',255,'' '',''P'') AS insuc_filler,
			dbo.NCADENAS('''',10,'' '',''P'') AS insuc_error,
			dbo.NCADENAS('''',29,'' '',''P'') AS insuc_error_campo,
			''*'' AS fin_linea
FROM SUCURSALES s WITH (NOLOCK)
INNER JOIN CLI_DIRECCIONES cd WITH (NOLOCK) 
							ON s.SUCURSAL=cd.ID
							AND cd.TZ_LOCK=0
							AND cd.FORMATO=''S''
							AND cd.TIPODIRECCION=''R'' 
							AND s.TZ_LOCK=0 
INNER JOIN cli_provincias p WITH (NOLOCK) 
							ON p.CODIGOPAIS = s.CODIGOPAIS 
							AND cd.PROVINCIA=p.DIM1
							AND s.TZ_LOCK=0 
WHERE s.CODIGOPAIS IN (	SELECT NUMERICO 
							FROM PARAMETROSGENERALES WITH (NOLOCK) 
							WHERE CODIGO=1); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''MC_EXONERA'')
DROP view [dbo].MC_EXONERA; ')
execute(' CREATE OR ALTER     VIEW [dbo].[MC_EXONERA] (CUENTA)
AS 

SELECT DISTINCT MC_CTASEXON.CUENTA
FROM dbo.MC_CTASEXON WITH (NOLOCK)
GROUP BY MC_CTASEXON.CUENTA; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_TELEFONOS_JUZGADOS'')
DROP view [dbo].VW_TELEFONOS_JUZGADOS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_TELEFONOS_JUZGADOS]  (
													"Número de Juzgado",
 													"Nombre de Juzgado",
 													ID,
													"Formato",
													"Descripción Formato",
													"Tipo",
													"Descripción Tipo",
													"Ordinal",
													"Tipo Fijo/Celular",
													"Descripción",
													"Número"
	)
AS
    SELECT 
 	  j.NRO_JUZGADO AS "Número de Juzgado",
 	  j.NOMBRE AS "Nombre de Juzgado",
 	  t.ID,
   	  t.FORMATO AS "Formato",
		(SELECT DESCRIPCION 
		FROM OPCIONES O  WITH (NOLOCK)
		WHERE O.IDIOMA = ''E'' 
			AND O.NUMERODECAMPO = 33426 
			AND O.OPCIONINTERNA= t.FORMATO) AS DESC_FORMATO,
	  t.TIPO,
		(SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA = ''E'' 
		AND O.NUMERODECAMPO = 33427 
		AND O.OPCIONINTERNA= t.TIPO) AS DESC_TIPO,
	  t.ORDINAL,
	  t.TIPO_CEL_TEL,
		(SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA = ''E'' 
		AND O.NUMERODECAMPO = 33435 
		AND O.OPCIONINTERNA= t.TIPO_CEL_TEL) AS DESC_TIPO_CEL_TEL,
	  t.NUMERO
			
		         
   FROM  
      dbo.CLI_TELEFONOS AS t WITH (NOLOCK)
   INNER JOIN dbo.DJ_JUZGADOS  AS J  WITH (NOLOCK) ON  
	  J.NRO_JUZGADO = t.ID AND t.FORMATO =''J'' 
	AND (	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
		AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
	AND(	(J.TZ_LOCK < 300000000000000 OR J.TZ_LOCK >= 400000000000000) 
		AND (J.TZ_LOCK < 100000000000000 OR J.TZ_LOCK >= 200000000000000)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PAGO_PROV_COMISIONES'')
DROP view [dbo].VW_PAGO_PROV_COMISIONES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PAGO_PROV_COMISIONES] (
												ID_CONVENIO, 
												MONEDA, 
												LOTE, 
												ORDINAL, 
												COMISION, 
												FECHA_NEGOCIADA)
AS 
 
SELECT 
    PN.ID_CONVENIO, 
    PN.MONEDA, 
    PN.LOTE, 
    PN.ORDINAL, 
    DC.COMISION, 
    PN.FECHA_NEGOCIADA
FROM dbo.VW_PAGO_PROV_NEGOCIADOS  AS PN WITH(NOLOCK) 
INNER JOIN dbo.SCL_DETALLE_CREDITOS  AS DC WITH(NOLOCK)ON 
														PN.LOTE = DC.LOTE  
														AND PN.ORDINAL = DC.ORDINAL  
														AND DC.ESTADO = 1  
														AND PN.FECHA_NEGOCIADA IS NOT NULL  
														AND PN.PAGO_COMISION IS NULL  
														AND PN.SALDO = 0  
														AND DC.COMISION <> 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''NEXVISTAMT700RECIBIDOS'')
DROP view [dbo].NEXVISTAMT700RECIBIDOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[NEXVISTAMT700RECIBIDOS] (
													   STATUS, 
													   B2INPUTOUTPUTIDENTIFIER, 
													   B2MESSAGETYPE, 
													   BCOREMITENTE, 
													   T27_1, 
													   T27_2, 
													   T20, 
													   T50, 
													   T59_2, 
													   T32B_1, 
													   T32B_2, 
													   ID, 
													   T49)
AS 
     
SELECT 
    SWIFTMESSAGES.STATUS, 
    SWIFTMESSAGES.B2INPUTOUTPUTIDENTIFIER, 
    SWIFTMESSAGES.B2MESSAGETYPE, 
    (ISNULL(SWIFTMESSAGES.B2MIRSLTIBANKCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTICOUNTRYCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTILOCATIONCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTIBRANCHCODE, '''')) AS BCOREMITENTE, 
    MT700.T27_1, 
    MT700.T27_2, 
    MT700.T20, 
    MT700.T50, 
    MT700.T59_2, 
    MT700.T32B_1, 
    MT700.T32B_2, 
    MT700.ID, 
    MT700.T49
FROM dbo.SWIFTMESSAGES WITH (NOLOCK)
INNER JOIN dbo.MT700 WITH (NOLOCK) ON SWIFTMESSAGES.ID = MT700.ID; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PIZARRACODNBC'')
DROP view [dbo].VW_PIZARRACODNBC; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PIZARRACODNBC] (
											   CODIGOBCO, 
											   CODINTERNACIONAL, 
											   NUMERADOR, 
											   CODTITULOPIZARRA, 
											   VENCIMIENTO, 
											   RUBRO, 
											   DISPONIBILIDAD, 
											   MONTODISPONIBLEVENTA)
AS 

SELECT TOP 9223372036854775807 WITH TIES 
    T.CODIGOBCO, 
    T.CODINTERNACIONAL, 
    P.NUMERADOR, 
    P.CODTITULOPIZARRA, 
    P.VENCIMIENTO, 
    P.RUBRO, 
    P.DISPONIBILIDAD, 
    P.MONTODISPONIBLEVENTA
FROM dbo.VAL_TITULOS  AS T WITH(NOLOCK)
INNER JOIN dbo.VAL_PIZARRA  AS P WITH(NOLOCK)ON T.CODTITULO = P.CODTITULOPIZARRA  
										AND(	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
											AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
										AND(	(P.TZ_LOCK < 300000000000000 OR P.TZ_LOCK >= 400000000000000) 
											AND (P.TZ_LOCK < 100000000000000 OR P.TZ_LOCK >= 200000000000000))
ORDER BY T.CODIGOBCO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''NEXVISTAMT707RECIBIDOS'')
DROP view [dbo].NEXVISTAMT707RECIBIDOS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[NEXVISTAMT707RECIBIDOS] (
													   ID, 
													   STATUS, 
													   OSN, 
													   INPUTOUTPUT, 
													   BCOREMITENTE, 
													   TIPO, 
													   T20, 
													   T21, 
													   T59_2, 
													   CREATED, 
													   T30, 
													   T26E)
AS 

SELECT 
    SWIFTMESSAGES.ID, 
    SWIFTMESSAGES.STATUS, 
    SWIFTMESSAGES.B1SEQUENCENUMBER AS OSN, 
    SWIFTMESSAGES.B2INPUTOUTPUTIDENTIFIER AS INPUTOUTPUT, 
    (ISNULL(SWIFTMESSAGES.B2MIRSLTIBANKCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTICOUNTRYCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTILOCATIONCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTIBRANCHCODE, '''')) AS BCOREMITENTE, 
    SWIFTMESSAGES.B2MESSAGETYPE AS TIPO, 
    MT707.T20, 
    MT707.T21, 
    MT707.T59_2, 
    SWIFTMESSAGES.CREATED, 
    MT707.T30, 
    MT707.T26E
FROM dbo.SWIFTMESSAGES WITH (NOLOCK)
    INNER JOIN dbo.MT707 WITH (NOLOCK) ON SWIFTMESSAGES.ID = MT707.ID; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PJ_DOCUMENTOS'')
DROP view [dbo].VW_PJ_DOCUMENTOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PJ_DOCUMENTOS] (
										TIPODOC, 
										NUMERODOC, 
										NUMEROPERSONA, 
										NIVELAPERTURA, 
										TIPOPERSONA, 
										RAZONSOCIAL, 
										NOMBREFANTASIA, 
										NIVEL_APERTURA,
										ESTADO)
AS 

SELECT TOP 9223372036854775807 WITH TIES 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    CASE T.NIVEL_APERTURA
        WHEN 0 THEN ''REGISTRO''
        WHEN 1 THEN ''BÁSICO''
        WHEN 2 THEN ''PASIVOS''
        WHEN 3 THEN ''ACTIVOS''
        WHEN 4 THEN ''INST.FINANCIERA''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    T.RAZONSOCIAL, 
    T.NOMBREFANTASIA, 
    T.NIVEL_APERTURA,
    (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH(NOLOCK) 
		WHERE O.IDIOMA=''E'' 
		AND O.OPCIONINTERNA=T.ESTADO 
		AND O.NUMERODECAMPO = 33367) AS ESTADO
FROM dbo.CLI_PERSONASJURIDICAS  AS T WITH(NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK)ON T.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ 
													AND V.TIPOPERSONA = ''J'' 
													AND(	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
														AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
													AND(	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
														AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
ORDER BY NUMEROPERSONA; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_EMERIX_TIPOCAMBIO'')
DROP view [dbo].VW_ITF_EMERIX_TIPOCAMBIO; ')
execute(' CREATE OR ALTER     VIEW  [dbo].[VW_ITF_EMERIX_TIPOCAMBIO] 
as
SELECT 
	dbo.NCADENAS(HTC.MONEDA,10,''0'',''P'') AS intca_moneda,
	CONVERT (CHAR(8),HTC.FECHA_COTIZACION,112) AS intca_fecha,
	dbo.NCADENAS(CAST(FLOOR(HTC.TIPO_CAMBIO_VENTA*100) AS VARCHAR),20,''0'',''P'')AS intca_cotización,
	''         '' AS intca_error,
	''                             '' AS intca_error_campo,
	''*'' AS finLinea


 FROM MONEDAS MO  WITH (NOLOCK)
 INNER JOIN HISTORICOTIPOSCAMBIO HTC WITH (NOLOCK) ON MO.C6399 = HTC.MONEDA 
													AND MO.TZ_LOCK=0 
													AND HTC.MONEDA NOT IN (	SELECT MONNAC 
																			FROM PARAMETROS WITH (NOLOCK)); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''NEXVISTAMT710RECIBIDOS'')
DROP view [dbo].NEXVISTAMT710RECIBIDOS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[NEXVISTAMT710RECIBIDOS] (
													   STATUS, 
													   B2INPUTOUTPUTIDENTIFIER, 
													   B2MESSAGETYPE, 
													   BCOREMITENTE, 
													   T27_1, 
													   T27_2, 
													   T21, 
													   T50, 
													   T59_2, 
													   T32B_1, 
													   T32B_2, 
													   ID, 
													   T49)
AS 

SELECT 
    SWIFTMESSAGES.STATUS, 
    SWIFTMESSAGES.B2INPUTOUTPUTIDENTIFIER, 
    SWIFTMESSAGES.B2MESSAGETYPE, 
    (ISNULL(SWIFTMESSAGES.B2MIRSLTIBANKCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTICOUNTRYCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTILOCATIONCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTIBRANCHCODE, '''')) AS BCOREMITENTE, 
    MT710.T27_1, 
    MT710.T27_2, 
    MT710.T21, 
    MT710.T50, 
    MT710.T59_2, 
    MT710.T32B_1, 
    MT710.T32B_2, 
    MT710.ID, 
    MT710.T49
FROM dbo.SWIFTMESSAGES WITH(NOLOCK)
INNER JOIN dbo.MT710 WITH(NOLOCK) ON SWIFTMESSAGES.ID = MT710.ID; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PLANCTAS'')
DROP view [dbo].VW_PLANCTAS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PLANCTAS] (
										   NOMBRE_RUBRO, 
										   RUBRO_BANCO_CENTRAL, 
										   MONEDA_RUBRO, 
										   TITULO_RUBRO, 
										   GRUPO_BALANCE, 
										   SIGNO_RUBRO, 
										   TIPO_RUBRO, 
										   INTERMEDIACION_FINANCIERA, 
										   RESIDENCIA_RUBRO, 
										   PLAZO_RUBRO, 
										   SUBDIVISION_1, 
										   SUBDIVISION_2, 
										   SUBDIVISION_3, 
										   CLASIFICACION_1, 
										   CLASIFICACION_2, 
										   CLASIFICACION_3, 
										   APERTURA_SALDO_BATCH, 
										   COD_DEPURACION, 
										   RUBRO_CONTABLE, 
										   CONTROL_SOBREGIROS, 
										   CUENTA_CONTABLE, 
										   CUENTA_CASA_MATRIZ, 
										   RUBRO_ANTERIOR, 
										   RUBRO_OPERATIVO, 
										   PRODUCTO, 
										   RUBRO_PERDIDA_VAL, 
										   RUBRO_GANANCIA_VAL, 
										   DEVENGAMIENTO_INTERESES, 
										   DEV_TASA_MORA, 
										   CALIFICA, 
										   DIADEVENGA, 
										   PREVISIONA)
AS 
   SELECT 
      PLANCTAS.C6300 AS NOMBRE_RUBRO, 
      PLANCTAS.C6301 AS RUBRO_BANCO_CENTRAL, 
      PLANCTAS.C6302 AS MONEDA_RUBRO, 
      PLANCTAS.C6303 AS TITULO_RUBRO, 
      PLANCTAS.C6304 AS GRUPO_BALANCE, 
      PLANCTAS.C6305 AS SIGNO_RUBRO, 
      PLANCTAS.C6306 AS TIPO_RUBRO, 
      PLANCTAS.C6307 AS INTERMEDIACION_FINANCIERA, 
      PLANCTAS.C6308 AS RESIDENCIA_RUBRO, 
      PLANCTAS.C6309 AS PLAZO_RUBRO, 
      PLANCTAS.C6310 AS SUBDIVISION_1, 
      PLANCTAS.C6311 AS SUBDIVISION_2, 
      PLANCTAS.C6312 AS SUBDIVISION_3, 
      PLANCTAS.C6313 AS CLASIFICACION_1, 
      PLANCTAS.C6314 AS CLASIFICACION_2, 
      PLANCTAS.C6315 AS CLASIFICACION_3, 
      PLANCTAS.C6316 AS APERTURA_SALDO_BATCH, 
      PLANCTAS.C6317 AS COD_DEPURACION, 
      PLANCTAS.C6326 AS RUBRO_CONTABLE, 
      PLANCTAS.C6327 AS CONTROL_SOBREGIROS, 
      PLANCTAS.C6329 AS CUENTA_CONTABLE, 
      PLANCTAS.C6330 AS CUENTA_CASA_MATRIZ, 
      PLANCTAS.C6331 AS RUBRO_ANTERIOR, 
      PLANCTAS.C6340 AS RUBRO_OPERATIVO, 
      PLANCTAS.C6341 AS PRODUCTO, 
      PLANCTAS.RUBRO_PERDIDA_VAL, 
      PLANCTAS.RUBRO_GANANCIA_VAL, 
      PLANCTAS.C6318 AS DEVENGAMIENTO_INTERESES, 
      PLANCTAS.DEV_TASA_MORA, 
      PLANCTAS.CALIFICA, 
      PLANCTAS.DIADEVENGA, 
      PLANCTAS.PREVISIONA
   FROM dbo.PLANCTAS WITH(NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''NEXVISTAMT720RECIBIDOS'')
DROP view [dbo].NEXVISTAMT720RECIBIDOS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[NEXVISTAMT720RECIBIDOS] (
													   STATUS, 
													   B2INPUTOUTPUTIDENTIFIER, 
													   B2MESSAGETYPE, 
													   BCOREMITENTE, 
													   T27_1, 
													   T27_2, 
													   T21, 
													   T50, 
													   T59_2, 
													   T32B_1, 
													   T32B_2, 
													   ID, 
													   T49)
AS 
SELECT 
	SWIFTMESSAGES.STATUS, 
	SWIFTMESSAGES.B2INPUTOUTPUTIDENTIFIER, 
	SWIFTMESSAGES.B2MESSAGETYPE, 
	(ISNULL(SWIFTMESSAGES.B2MIRSLTIBANKCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTICOUNTRYCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTILOCATIONCODE, '''') + ISNULL(SWIFTMESSAGES.B2MIRSLTIBRANCHCODE, '''')) AS BCOREMITENTE, 
	MT720.T27_1, 
	MT720.T27_2, 
	MT720.T21, 
	MT720.T50, 
	MT720.T59_2, 
	MT720.T32B_1, 
	MT720.T32B_2, 
	MT720.ID, 
	MT720.T49
FROM dbo.SWIFTMESSAGES WITH (NOLOCK)
INNER JOIN dbo.MT720  WITH (NOLOCK)ON SWIFTMESSAGES.ID = MT720.ID; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PERSONAS_FYJ'')
DROP view [dbo].VW_PERSONAS_FYJ; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PERSONAS_FYJ] (
											   TipoDocIdent, 
											   NroDocIdent, 
											   TipoDocFisico,
											   NumDocFisico,
											   NOMBRE,
											   NIVELAPERTURA, 
											   TIPOPERSONA, 
											   NUMEROPERSONA)
AS 
SELECT  
    V.TIPODOCUMENTO AS TipoDocIdent, 
    V.NUMERODOCUMENTO AS NroDocIdent, 
    V.TIPO_DOC_FISICO AS TIPO_DOC_FISICO,
    V.NUM_DOC_FISICO AS NUM_DOC_FISICO,
    ISNULL(U.PRIMERNOMBRE, '''') + '' '' + ISNULL(U.APELLIDOPATERNO, '''') + '' '' + ISNULL(U.APELLIDOMATERNO, '''') AS NOMBRE,
    CASE U.NIVEL_APERTURA
        WHEN 0 THEN ''REGISTRO''
        WHEN 1 THEN ''BÁSICO''
        -- WHEN 2 THEN ''PASIVOS''
        WHEN 3 THEN ''ACTIVOS''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA
FROM dbo.CLI_PERSONASFISICAS  AS U WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
													AND(	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
														AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)) 
													AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
														AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
UNION ALL
SELECT  
    V.TIPODOCUMENTO AS TipoDocIdent, 
    V.NUMERODOCUMENTO AS NroDocIdent, 
    V.TIPO_DOC_FISICO AS TIPO_DOC_FISICO,
    V.NUM_DOC_FISICO AS NUM_DOC_FISICO,
    S.RAZONSOCIAL AS NOMBRE,
    CASE S.NIVEL_APERTURA
        WHEN 0 THEN ''REGISTRO''
        WHEN 1 THEN ''BÁSICO''
        -- WHEN 2 THEN ''PASIVOS''
        WHEN 3 THEN ''ACTIVOS''
        WHEN 4 THEN ''INST. FINANCIERA''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA
FROM dbo.CLI_PERSONASJURIDICAS  AS S WITH(NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK) ON S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ 
														AND (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
															AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)) 
														AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
															AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_LISTA_DOCUMENTOS'')
DROP view [dbo].VW_LISTA_DOCUMENTOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_LISTA_DOCUMENTOS] (
													Lista, 
													Fecha, 
													Estado, 
													Descripcion, 
													Cantidad, 
													Monto, 
													TipoDocumento, 
													NombreDocumento, 
													Producto, 
													NombreProducto, 
													ValorCobro, 
													Tipo,
													TipoLista, 
													Cliente
)
AS
SELECT	c.NUMERO_LISTA AS ''Lista'', 
		c.FECHA_LISTA AS ''Fecha'', 
		c.ESTADO AS ''Estado'', 
		o.DESCRIPCION AS ''Descripcion'', 
		c.CANTIDAD_DOCUMENTOS AS ''Cantidad'', 
		c.IMPORTE_TOTAL AS ''Monto'', 
		c.TIPO_DOCUMENTO AS ''TipoDocumento'', 
		ot.DESCRIPCION AS ''NombreDocumento'', 
		c.PRODUCTO AS ''Producto'', p.C6251 AS ''NombreProducto'', 
		c.VALOR_AL_COBRO AS ''ValorCobro'', 
		c.TIPO_LISTA AS Tipo, 
		ol.DESCRIPCION AS ''TipoLista'', 
		c.CLIENTE AS ''Cliente''
FROM CRE_CAB_LISTA_DOCUMENTOS c WITH (NOLOCK)
INNER JOIN OPCIONES o WITH (NOLOCK) ON c.ESTADO = o.OPCIONINTERNA 
										AND o.NUMERODECAMPO = 2972 
										AND o.IDIOMA = ''E''
INNER JOIN OPCIONES ot WITH (NOLOCK) ON c.TIPO_DOCUMENTO = ot.OPCIONINTERNA 
										AND ot.NUMERODECAMPO = 2975 
										AND ot.IDIOMA = ''E''
LEFT JOIN OPCIONES ol WITH (NOLOCK) ON c.TIPO_LISTA = ol.OPCIONINTERNA 
									AND ol.NUMERODECAMPO = 43782 
									AND ol.IDIOMA = ''E''
INNER JOIN PRODUCTOS p WITH (NOLOCK) ON c.PRODUCTO = p.C6250 
										AND p.TZ_LOCK = 0
WHERE c.TZ_LOCK = 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RCT_CONCEPTOS'')
DROP view [dbo].VW_RCT_CONCEPTOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_RCT_CONCEPTOS] (
												   CONCEPTO, 
												   NOMBRE_CONCEPTO, 
												   ID_CONVENIO, 
												   NOMBRE_CONVENIO)
AS 
  
SELECT TOP 9223372036854775807 WITH TIES CONC.CONCEPTO, 
	CONC.DESCRIPCION AS NOMBRE_CONCEPTO, 
	CONV.ID_CONVENIO, 
	CONV.NOMBRE_CONVENIO
FROM dbo.RCT_CONCEPTOS  AS CONC WITH (NOLOCK)
INNER JOIN dbo.RCT_CONVENIO_RECAUD AS CONV WITH (NOLOCK) ON CONC.ID_CONVENIO = CONV.ID_CONVENIO 
														AND CONC.TZ_LOCK = 0 
														AND	CONV.TZ_LOCK = 0
ORDER BY CONV.ID_CONVENIO, 
		CONC.CONCEPTO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''PERCLI_GTIAPORCENTAJE'')
DROP view [dbo].PERCLI_GTIAPORCENTAJE; ')
execute(' CREATE OR ALTER   VIEW [dbo].[PERCLI_GTIAPORCENTAJE] (NUMEROPERSONA, 
													CODIGOCLIENTE, 
													PORCENTAJE)
AS 
SELECT	CLI_CLIENTEPERSONA.NUMEROPERSONA, 
		CLI_CLIENTEPERSONA.CODIGOCLIENTE, 
		''0'' AS PORCENTAJE
FROM dbo.CLI_CLIENTEPERSONA WITH (NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_DEUDAS_EXTERNAS'')
DROP view [dbo].VW_DEUDAS_EXTERNAS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_DEUDAS_EXTERNAS] (
													Codigo, 
													Nombre, 
													TipoCuenta,
													Cuenta,
													Monto,
													Solicitud
)
AS
SELECT 
	d.CODIGO_ENTE AS Codigo, 
	e.DESCRIPCION AS Nombre,
	e.TIPO_CUENTA AS TipoCuenta, 
	e.NUMERO_CUENTA AS Cuenta, 
	d.IMPORTE AS Monto, 
	d.NUMERO_SOLICITUD AS Solicitud
FROM CRE_SOL_DEUDA_EXTERNA d WITH (NOLOCK)
INNER JOIN CRE_ENTIDADEXTERNA e WITH (NOLOCK) ON d.CODIGO_ENTE = e.CODIGO
												AND d.TZ_LOCK = 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RCT_CONTROLGESTION'')
DROP view [dbo].VW_RCT_CONTROLGESTION; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_RCT_CONTROLGESTION] (
													   ID_CONVENIO, 
													   NOMBRE_CONVENIO, 
													   ID_CONCEPTO, 
													   NOMBRE_CONCEPTO, 
													   MONEDA, 
													   GESTION, 
													   ESTADO)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
		CONV.ID_CONVENIO, 
		CONV.NOMBRE_CONVENIO, 
		CONC.CONCEPTO AS ID_CONCEPTO, 
		CONC.DESCRIPCION AS NOMBRE_CONCEPTO, 
		GEST.MONEDA, 
		GEST.GESTION, 
		GEST.ESTADO
FROM dbo.RCT_CONTROL_GESTION  AS GEST WITH (NOLOCK)
INNER JOIN dbo.RCT_CONVENIO_RECAUD  AS CONV WITH (NOLOCK)ON GEST.ID_CONVENIO = CONV.ID_CONVENIO 
														AND GEST.TZ_LOCK = 0
														AND CONV.TZ_LOCK = 0 
INNER JOIN dbo.RCT_CONCEPTOS  AS CONC WITH (NOLOCK)ON CONV.ID_CONVENIO = CONC.ID_CONVENIO 
													AND GEST.CONCEPTO = CONC.CONCEPTO 
													AND CONC.TZ_LOCK = 0
ORDER BY CONV.ID_CONVENIO, 
		CONC.CONCEPTO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''PONDERACION_RESULTANTE'')
DROP view [dbo].PONDERACION_RESULTANTE; ')
execute(' CREATE OR ALTER   VIEW [dbo].[PONDERACION_RESULTANTE] (	CALIFICACION, 
														PONDERACION)
AS 

SELECT	CRE_CALIF_OFICIAL.CALIFICACION_OFICIAL AS CALIFICACION, 
		CRE_CALIF_OFICIAL.PONDERACION
FROM dbo.CRE_CALIF_OFICIAL WITH (NOLOCK)
    UNION
SELECT	CLI_CLASUBJETIVA.CATEGORIASUB, 
		CLI_CLASUBJETIVA.PONDERACION
FROM dbo.CLI_CLASUBJETIVA WITH (NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RCT_NIVELDEUDOR'')
DROP view [dbo].VW_RCT_NIVELDEUDOR; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_RCT_NIVELDEUDOR] (
												   ID_CONVENIO, 
												   NOMBRE_CONVENIO, 
												   CODIGO, 
												   NOMBRE, 
												   ID_NIVEL, 
												   GESTION)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
	CONV.ID_CONVENIO, 
	CONV.NOMBRE_CONVENIO, 
	DEU.CODIGO, 
	DEU.NOMBRE, 
	DEU.ID_NIVEL, 
	DEU.GESTION
FROM dbo.RCT_NIVEL_DEUDOR  AS DEU WITH (NOLOCK)
INNER JOIN dbo.RCT_CONVENIO_RECAUD  AS CONV WITH (NOLOCK) ON DEU.ID_CONVENIO = CONV.ID_CONVENIO 
													AND DEU.TZ_LOCK = 0 
													AND CONV.TZ_LOCK = 0
ORDER BY CONV.ID_CONVENIO, 
		DEU.CODIGO, DEU.GESTION; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''V_BALANCE_DIARIO'')
DROP view [dbo].V_BALANCE_DIARIO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[V_BALANCE_DIARIO] (
											   NUMERADOR, 
											   CUENTA_CONTABLE, 
											   CODIGO_INTERNO, 
											   FECHA, 
											   SALDO_MN_PESOS, 
											   SALDO_ME_DOLAR, 
											   SALDO_ME_PESOS)
AS 
SELECT TOP 9223372036854775807 WITH TIES 
    I.NUMERADOR, 
    I.CODIGO_BCE AS CUENTA_CONTABLE, 
    I.CODIGO_INTERNO AS CODIGO_INTERNO, 
    fci.FECHA, 
    fci.SALDO_MN_PESOS, 
    fci.SALDO_ME_DOLAR, 
    fci.SALDO_ME_PESOS
FROM dbo.CO_BALANCE_IMPRESION  AS I WITH (NOLOCK)
INNER JOIN (
        SELECT TOP 9223372036854775807 
        R.CODIGO_INTERNO AS CODIGO, 
        R.FECHA, 
        sum(R.SALDOFINMESMO * HC.TIPO_CAMBIO_VENTA)/*CASE moneda 0 y la UI*/ AS SALDO_MN_PESOS, 
        sum(R.SALDOFINMESMO * HC.ARBITRAJE_COMPRA)/*	el resto*/ AS SALDO_ME_DOLAR, 
        sum(R.SALDOFINMESMO * HC.ARBITRAJE_COMPRA * HC.TIPO_CAMBIO_VENTA)/*, el resto*/ AS SALDO_ME_PESOS
        FROM dbo.CO_BALANCE_RESULTADOS  AS R WITH (NOLOCK)
		INNER JOIN dbo.HISTORICOTIPOSCAMBIO  AS HC WITH (NOLOCK) ON HC.MONEDA = R.MONEDA
													AND HC.FECHA_COTIZACION = R.FECHA
													AND HC.CODIGO_TIPO_CAMBIO = 1
		INNER JOIN dbo.CO_BALANCE_ESTRUCTURA  AS E WITH (NOLOCK) ON R.CODIGO_INTERNO = E.CODIGO_INTERNO
													AND E.IMPRESION = ''S'' 
													AND E.TZ_LOCK = 0
        
        GROUP BY	R.CODIGO_INTERNO, 
					R.FECHA
        ORDER BY	R.CODIGO_INTERNO
    )  AS fci
	ON fci.CODIGO = I.CODIGO_INTERNO 
	AND I.TZ_LOCK = 0
ORDER BY fci.FECHA, I.CODIGO_BCE; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PODERES_PERSONAS_X_SALDO'')
DROP view [dbo].VW_PODERES_PERSONAS_X_SALDO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_PODERES_PERSONAS_X_SALDO] 
AS
SELECT	s.jts_oid prefijo_jts_oid,
		w.id_persona numero_persona,
		v.tipodocumento tipodoc,
		v.numerodocumento numerodoc,
		CASE 
			CASE 
				WHEN w.FECHA_INI_SUSPENSION IS NULL OR w.FECHA_FIN_SUSPENSION IS NULL THEN ''Y''
			ELSE ''N''
			END
         WHEN ''Y'' THEN 
			CASE 
				CASE 
					WHEN w.FECHA_VENCIMIENTO IS NULL THEN ''Y''
				ELSE ''N''
				END
            WHEN ''Y'' THEN ''PODER HABILITADO''
            ELSE 
				CASE sign(DATEDIFF(DD, w.FECHA_VENCIMIENTO,(SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK))))
					WHEN -1 THEN ''PODER VENCIDO''
				ELSE ''PODER HABILITADO''
				END
			END
         ELSE 
			CASE 
				CASE 
					WHEN w.FECHA_VENCIMIENTO IS NULL THEN ''Y''
				ELSE ''N''
				END
            WHEN ''Y'' THEN 
							CASE sign(DATEDIFF(DD, (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK)), w.FECHA_INI_SUSPENSION))
								WHEN -1 THEN ''PODER HABILITADO''
							ELSE 
									CASE sign(DATEDIFF(DD, (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK)), w.FECHA_FIN_SUSPENSION))
										WHEN 1 THEN ''PODER HABILITADO''
									ELSE ''PODER DESHABILITADO''
									END
							END
            ELSE 
				CASE sign(DATEDIFF(DD, w.FECHA_VENCIMIENTO, (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK))))
					WHEN -1 THEN ''PODER VENCIDO''
				ELSE 
					CASE sign(DATEDIFF(DD, (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK)), w.FECHA_INI_SUSPENSION))
						WHEN -1 THEN ''PODER HABILITADO''
					ELSE 
						CASE sign(DATEDIFF(DD, (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK)), w.FECHA_FIN_SUSPENSION))
							WHEN 1 THEN ''PODER HABILITADO''
						ELSE ''PODER DESHABILITADO''
						END
					END
				END
			END
      END AS status,
  --NUEVO
  ISNULL(u.PRIMERNOMBRE, '''') + '' '' + ISNULL(u.APELLIDOPATERNO, '''') + '' '' + ISNULL(u.APELLIDOMATERNO, '''') AS NOMBRE, 
  CASE b.TITULARIDAD
         WHEN ''T'' THEN ''TITULAR''
         WHEN ''C'' THEN ''COTITULAR''
         ELSE ''AUTORIZADO''
   END AS cargo,
  v.tipopersona,
  s.cuenta,
  w.tipo_poder as poder,
  w.categoria
FROM
  saldos s WITH (NOLOCK)
  INNER JOIN cli_clientepersona b WITH (NOLOCK)ON s.c1803 = b.codigocliente
  RIGHT OUTER JOIN  pyf_apoderados w WITH (NOLOCK) ON  s.jts_oid = w.id_entidad
													AND w.id_persona = b.numeropersona
													AND ( (w.tz_lock < 300000000000000 OR w.tz_lock >= 400000000000000)
													AND (w.tz_lock < 100000000000000 OR w.tz_lock >= 200000000000000) )
  INNER JOIN cli_personasfisicas u WITH (NOLOCK)ON w.id_persona = u.numeropersonafisica
												AND ( (u.tz_lock < 300000000000000 OR u.tz_lock >= 400000000000000)
												AND (u.tz_lock < 100000000000000 OR u.tz_lock >= 200000000000000) )
  INNER JOIN cli_documentospfpj v WITH (NOLOCK)ON w.id_persona = v.numeropersonafj 
												AND v.reportaaorganismocontrol = ''S''
												AND ( (v.tz_lock < 300000000000000 OR v.tz_lock >= 400000000000000)
												AND (v.tz_lock < 100000000000000 OR v.tz_lock >= 200000000000000) ); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_DIRECCIONES_JUZGADOS'')
DROP view [dbo].VW_DIRECCIONES_JUZGADOS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_DIRECCIONES_JUZGADOS]  (
														"Número de Juzgado",
 														"Nombre de Juzgado",
 														ID,
														"Formato",
														"Desc. Formato",
														"Tipo de Dirección",
														"Desc. Tipo Dirección",
														"Ordinal",
														"País",
														"Nombre País",
														"Provincia",
														"Desc. Provincia",
														"Departamento",
														"Desc. Departamento",
														"Localidad",
														"Desc. Localidad",
														"CPA Nuevo",
														"Barrio",
														"Calle",
														"Número",
														"Piso",
														"Apartamento",
														"Manzana",
														"Parcela",
														"Casa",
														"Monoblock", 
														"Tira",
														"Chacra",
														"Normalizado",
														"Provincia Exterior",
														"Departamento Exterior",
														"Localidad Exterior"
)
AS
    SELECT 
 	  j.NRO_JUZGADO AS "Número de Juzgado",
 	  j.NOMBRE AS "Nombre de Juzgado",
 	  a.ID,
   	  a.FORMATO AS "Formato",
   	  (	SELECT DESCRIPCION 
		FROM OPCIONES O  WITH (NOLOCK)
		WHERE O.IDIOMA = ''E'' 
			AND O.NUMERODECAMPO = 33051 
			AND O.OPCIONINTERNA= a.FORMATO) AS "Desc. Formato",
   	  a.TIPODIRECCION AS "Tipo de Dirección",
   	  (	SELECT DESCRIPCION 
		FROM OPCIONES O  WITH (NOLOCK)
		WHERE O.IDIOMA = ''E'' 
			AND O.NUMERODECAMPO = 33052 
			AND O.OPCIONINTERNA= a.TIPODIRECCION) AS "Desc. Tipo Dirección",
   	  a.ORDINAL_DIR AS "Ordinal",
   	  a.PAIS AS "País",
   	  p.NOMBREPAIS AS "Nombre País",
   	  a.PROVINCIA AS "Provincia", 
   	  PP.DESCRIPCION AS "Desc. Provincia",
   	  a.DEPARTAMENTO AS "Departamento",
   	  D.NOMBREDEP AS "Desc. Departamento",
   	  a.LOCALIDAD AS "Localidad",
      L.DESCRIPCION_DIM3 AS "Desc. Localidad",
      a.CPA_NUEVO AS "CPA Nuevo",
      A.BARRIO AS "Barrio",
      A.CALLE AS "Calle",
      A.NUMERO AS "Número",
      A.PISO AS "Piso",
	  A.APARTAMENTO AS "Apartamento",
	  A.MANZANA AS "Manzana",
	  A.PARCELA AS "Parcela",
	  A.CASA AS "Casa",
      A.MONOBLOCK AS "Monoblock", 
	  A.TIRA AS "Tira",
	  A.CHACRA AS "Chacra",
	  CASE 
	  WHEN A.NORMALIZADO =''S'' THEN ''SI''
	  WHEN A.NORMALIZADO =''N'' THEN ''NO''
	  END AS "Normalizado",
      A.PROVINCIA_EXTERIOR AS "Provincia Exterior",
      A.DEPARTAMENTO_EXTERIOR AS "Departamento Exterior",
      A.LOCALIDAD_EXTERIOR AS "Localidad Exterior"
   FROM  
      dbo.CLI_DIRECCIONES AS A WITH (NOLOCK)
      LEFT JOIN dbo.CLI_PAISES AS P WITH (NOLOCK) ON P.CODIGOPAIS = A.PAIS
      LEFT JOIN dbo.CLI_PROVINCIAS AS PP WITH (NOLOCK) ON PP.DIM1 = A.PROVINCIA
      LEFT JOIN dbo.CLI_DEPARTAMENTOS AS D WITH (NOLOCK) ON (a.DEPARTAMENTO=d.DEPARTAMENTO) 
														AND (PP.DIM1=d.PROVINCIA)
      LEFT JOIN dbo.CLI_LOCALIDADES AS l WITH (NOLOCK) ON (a.LOCALIDAD=l.DIM3) 
														AND (l.DIM1=PP.DIM1) 
														AND (l.DIM2=d.DEPARTAMENTO) 
      INNER JOIN dbo.DJ_JUZGADOS  AS J  WITH (NOLOCK)ON J.NRO_JUZGADO = a.ID
														      AND (	(J.TZ_LOCK < 300000000000000 OR J.TZ_LOCK >= 400000000000000) 
																AND (J.TZ_LOCK < 100000000000000 OR J.TZ_LOCK >= 200000000000000))
   WHERE 
		A.FORMATO = ''J'' 
		AND((A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000) 
			AND (A.TZ_LOCK < 100000000000000 OR A.TZ_LOCK >= 200000000000000)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RCT_NIVELES'')
DROP view [dbo].VW_RCT_NIVELES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_RCT_NIVELES] (
											   ID_CONVENIO, 
											   NOMBRE_CONVENIO, 
											   GESTION, 
											   ID_NIVEL, 
											   ABREVIATURA, 
											   DESCRIPCION)
AS 

SELECT TOP 9223372036854775807 WITH TIES 
		CONV.ID_CONVENIO, 
		CONV.NOMBRE_CONVENIO, 
		NIV.GESTION, 
		NIV.ID_NIVEL, 
		NIV.ABREVIATURA, 
		NIV.DESCRIPCION
FROM dbo.RCT_NIVEL  AS NIV WITH (NOLOCK)
INNER JOIN dbo.RCT_CONVENIO_RECAUD  AS CONV WITH (NOLOCK) ON
													NIV.ID_CONVENIO = CONV.ID_CONVENIO 
													AND NIV.TZ_LOCK = 0 
													AND CONV.TZ_LOCK = 0
ORDER BY	CONV.ID_CONVENIO, 
			NIV.GESTION, 
			NIV.ID_NIVEL; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_LINK_UMOZ_CAUSS'')
DROP view [dbo].VW_ITF_LINK_UMOZ_CAUSS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_ITF_LINK_UMOZ_CAUSS]  
as
SELECT( RIGHT(''0000000000000000000''+ vt.CTA_REDLINK, 18)) AS ''NROCUENTA'',
		S.C1604 AS ''SALDO'',
		SPACE(23) AS ''FILLER'',
		HV.CONCEPTO AS ''CONCEPTO'',
		HV.MONTO AS ''IMPORTE'', 
		HV.FECHA_VALOR AS ''FECHA''  
FROM ITF_MOVCONFORMADOS ITF WITH (NOLOCK) 
INNER JOIN HISTORIA_VISTA HV WITH (NOLOCK) ON ITF.asiento=HV.ASIENTO  
							AND itf.fch_procesado=hv.FECHA_PROCESADO 
							AND itf.sucursal=hv.SUCURSAL
							AND itf.nro_mov=hv.NUMERO_MOVIMIENTO 
							and itf.ordinal=hv.ORDINAL 
							AND itf.ordinal=hv.ORDINAL 
							AND itf.TRTIPO=hv.TRTIPO 
							AND itf.TRVIRTUAL=hv.TRVIRTUAL 
							AND itf.jts_oid=hv.SALDO_JTS_OID
INNER JOIN saldos s WITH (NOLOCK)ON s.JTS_OID=itf.jts_oid 
						AND s.MONEDA = 80
						AND s.C1785 = 2
INNER JOIN VTA_SALDOS VT WITH (NOLOCK) ON VT.JTS_OID_SALDO=ITF.JTS_OID; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''V_CO_BALANCE_RESULTADOS'')
DROP view [dbo].V_CO_BALANCE_RESULTADOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[V_CO_BALANCE_RESULTADOS] (
													   FECHA, 
													   SUCURSAL, 
													   MONEDA, 
													   CODIGO_INTERNO, 
													   DESCRIPCION, 
													   SALDOFINMESMO, 
													   DEBITOSMO, 
													   CREDITOSMO, 
													   SALDOMESANTMN, 
													   SALDOFINMESMN, 
													   DEBITOSMN, 
													   CREDITOSMN, 
													   ID_BCE, 
													   TIPO_BALANCE)
AS 
SELECT 
	CBR.FECHA, 
	CBR.SUCURSAL, 
	CBR.MONEDA, 
	CBR.CODIGO_INTERNO, 
      
		(
		SELECT CBI.DESCRIPCION
		FROM dbo.CO_BALANCE_IMPRESION  AS CBI WITH (NOLOCK)
		WHERE CBI.ID_BCE = CBR.ID_BCE 
		AND CBI.CODIGO_INTERNO = CBR.CODIGO_INTERNO
		) AS DESCRIPCION, 
	CBR.SALDOFINMESMO, 
	CBR.DEBITOSMO, 
	CBR.CREDITOSMO, 
	CBR.SALDOMESANTMN, 
	CBR.SALDOFINMESMN, 
	CBR.DEBITOSMN, 
	CBR.CREDITOSMN, 
	CBR.ID_BCE, 
	CBR.TIPO_BALANCE
FROM dbo.CO_BALANCE_RESULTADOS  AS CBR WITH (NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RRII_TOTALES_ANEXO_12'')
DROP view [dbo].VW_RRII_TOTALES_ANEXO_12; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_RRII_TOTALES_ANEXO_12] AS
--4)
SELECT 4 AS NRO_CAMPO, 
	SUM(GS.SALDO_AJUSTADO) AS SUM_CONT, 
	GS.FECHA 
FROM GRL_SALDOS_DIARIOS GS WITH(NOLOCK) 
INNER JOIN SALDOS S WITH(NOLOCK)  ON GS.SALDOS_JTS_OID = S.JTS_OID
									AND S.C1785 = 4
INNER JOIN VTA_SALDOS VS WITH(NOLOCK)  ON S.JTS_OID = VS.JTS_OID_SALDO 
									AND VS.FONDOGARANTIA = ''N''
GROUP BY GS.FECHA
	
UNION ALL
--5)
SELECT 5 AS NRO_CAMPO, 
		SUM(GS.SALDO_AJUSTADO) AS SUM_CONT, 
		GS.FECHA 
FROM GRL_SALDOS_DIARIOS GS WITH(NOLOCK) 
INNER JOIN SALDOS S WITH(NOLOCK) ON GS.SALDOS_JTS_OID = S.JTS_OID 
INNER JOIN VTA_SALDOS VS WITH(NOLOCK) ON S.JTS_OID = VS.JTS_OID_SALDO 
WHERE S.C1785 = 4
AND VS.FONDOGARANTIA = ''S''
GROUP BY GS.FECHA

UNION ALL
--8)
SELECT
 	8 AS NRO_CAMPO,
	SUM(GS.SALDO_AJUSTADO) AS SUM_CONT,
	GS.FECHA
FROM
	GRL_SALDOS_DIARIOS GS WITH(NOLOCK)
INNER JOIN SALDOS S WITH(NOLOCK) ON
	GS.SALDOS_JTS_OID = S.JTS_OID 
	AND S.C1785 IN (2, 3, 4)
INNER JOIN VTA_SALDOS VS WITH(NOLOCK) ON
	S.JTS_OID = VS.JTS_OID_SALDO
	AND VS.FONDOGARANTIA = '' ''
GROUP BY GS.FECHA
	
UNION ALL
--10) 
SELECT
	10 AS NRO_CAMPO,
	COUNT(GS.SALDOS_JTS_OID) AS SUM_CONT,
	GS.FECHA
FROM
	GRL_SALDOS_DIARIOS GS WITH(NOLOCK)
INNER JOIN SALDOS S WITH(NOLOCK) ON
	GS.SALDOS_JTS_OID = S.JTS_OID
	AND S.C1785 = 4
INNER JOIN MONEDAS M WITH(NOLOCK) ON
	GS.MONEDA = M.C6399
	AND M.C6403 = ''N''
GROUP BY GS.FECHA

UNION ALL
--11)
SELECT
	11 AS NRO_CAMPO,
	COUNT(GS.SALDOS_JTS_OID) AS SUM_CONT,
	GS.FECHA
FROM
	GRL_SALDOS_DIARIOS GS WITH(NOLOCK)
INNER JOIN SALDOS S WITH(NOLOCK) ON
	GS.SALDOS_JTS_OID = S.JTS_OID
	AND S.C1785 = 4
INNER JOIN MONEDAS M WITH(NOLOCK) ON
	GS.MONEDA = M.C6399
	AND M.C6403 = ''E''
GROUP BY GS.FECHA

UNION ALL
--18)
SELECT
	18 AS NRO_CAMPO,
	COUNT(*) AS SUM_CONT,
	GS.FECHA
FROM
	CLI_CLIENTEPERSONA CP WITH(NOLOCK)
INNER JOIN SALDOS S WITH(NOLOCK) ON
	CP.CODIGOCLIENTE = S.C1803
INNER JOIN GRL_SALDOS_DIARIOS GS WITH(NOLOCK) ON
	S.JTS_OID = GS.SALDOS_JTS_OID
INNER JOIN CLI_CLIENTES C WITH(NOLOCK) ON
	CP.CODIGOCLIENTE = C.CODIGOCLIENTE
	AND C.SUBDIVISION1 = ''01''
GROUP BY GS.FECHA
	
UNION ALL
--19)
SELECT
	19 AS NRO_CAMPO,
	COUNT(*) AS SUM_CONT,
	GS.FECHA
FROM
	CLI_CLIENTEPERSONA CP WITH(NOLOCK)
INNER JOIN SALDOS S WITH(NOLOCK) ON
	CP.CODIGOCLIENTE = S.C1803
	AND S.C1785 = 5
INNER JOIN GRL_SALDOS_DIARIOS GS WITH(NOLOCK) ON
	S.JTS_OID = GS.SALDOS_JTS_OID
INNER JOIN CLI_CLIENTES C WITH(NOLOCK) ON
	CP.CODIGOCLIENTE = C.CODIGOCLIENTE
	AND C.SUBDIVISION1 = ''01''
GROUP BY GS.FECHA	
	
UNION ALL

--22)
SELECT
	22 AS NRO_CAMPO,
	COUNT(*) AS SUM_CONT,
	GS.FECHA
FROM
	CLI_CLIENTEPERSONA CP WITH(NOLOCK)
INNER JOIN SALDOS S WITH(NOLOCK) ON
	CP.CODIGOCLIENTE = S.C1803
	AND S.C1785 = 2
INNER JOIN GRL_SALDOS_DIARIOS GS WITH(NOLOCK) ON
	S.JTS_OID = GS.SALDOS_JTS_OID
INNER JOIN CLI_CLIENTES C WITH(NOLOCK) ON
	CP.CODIGOCLIENTE = C.CODIGOCLIENTE
	AND C.SUBDIVISION1 = ''01''
GROUP BY GS.FECHA	
	
UNION ALL
	
	--23) PENDIENTE: RESTA ''Cantidad de Cajas de Ahorro p/el pago de planes o programas de ayuda social’'' y ‘''Cantidad de cuentas previsiones’''
	SELECT
	23 AS NRO_CAMPO,
	COUNT(*) AS SUM_CONT,
	GS.FECHA
FROM
	CLI_CLIENTEPERSONA CP WITH(NOLOCK) 
INNER JOIN SALDOS S WITH(NOLOCK)  ON
	CP.CODIGOCLIENTE = S.C1803
	AND S.C1785 = 3
INNER JOIN GRL_SALDOS_DIARIOS GS WITH(NOLOCK)  ON
	S.JTS_OID = GS.SALDOS_JTS_OID
INNER JOIN CLI_CLIENTES C WITH(NOLOCK)  ON
	CP.CODIGOCLIENTE = C.CODIGOCLIENTE
	AND C.SUBDIVISION1 = ''01''
GROUP BY GS.FECHA	
	
UNION ALL
--24)
SELECT
	24 AS NRO_CAMPO,
	COUNT(*) AS SUM_CONT,
	GS.FECHA
FROM
	CLI_CLIENTEPERSONA CP WITH(NOLOCK) 
INNER JOIN SALDOS S WITH(NOLOCK)  ON
	CP.CODIGOCLIENTE = S.C1803
	AND S.C1785 = 4
INNER JOIN GRL_SALDOS_DIARIOS GS WITH(NOLOCK) ON
	S.JTS_OID = GS.SALDOS_JTS_OID
INNER JOIN CLI_CLIENTES C WITH(NOLOCK)  ON
	CP.CODIGOCLIENTE = C.CODIGOCLIENTE
	AND C.SUBDIVISION1 = ''01''
GROUP BY GS.FECHA	
	
UNION ALL
--27) Y 28) JUNTOS

SELECT
	27 AS NRO_CAMPO,
	CASE WHEN CP.NUMEROPERSONA IN (	SELECT NUMEROPERSONAFJ 
									FROM CLI_DocumentosPFPJ WITH(NOLOCK) 
									WHERE TIPOPERSONA = ''F'') THEN 1
	ELSE 2
	END SUM_CONT,
	GS.FECHA
FROM
	CLI_CLIENTEPERSONA CP WITH(NOLOCK)
INNER JOIN SALDOS S WITH(NOLOCK) ON
	CP.CODIGOCLIENTE = S.C1803
	AND S.C1785 = 3
INNER JOIN GRL_SALDOS_DIARIOS GS WITH(NOLOCK) ON
	S.JTS_OID = GS.SALDOS_JTS_OID
INNER JOIN CLI_CLIENTES C WITH(NOLOCK) ON
	CP.CODIGOCLIENTE = C.CODIGOCLIENTE
GROUP BY
	GS.FECHA,
	CP.NUMEROPERSONA ; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RCT_NOVEDADES'')
DROP view [dbo].VW_RCT_NOVEDADES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_RCT_NOVEDADES] (
											   TZ_LOCK, 
											   ID_CONVENIO, 
											   SERVICIO_REFERENCIA, 
											   CLIENTE, 
											   NOMBRE, 
											   ESTADO, 
											   MARCA, 
											   FECHA)
AS 
  
SELECT 
    N.TZ_LOCK, 
    N.ID_CONVENIO, 
    N.SERVICIO_REFERENCIA, 
      
        (
        SELECT S.CLIENTE_DEUDOR
        FROM dbo.RCT_SUSCRIPCION_SERVICIO  AS S WITH (NOLOCK)
        WHERE N.ID_CONVENIO = S.ID_CONVENIO 
			AND N.SERVICIO_REFERENCIA = S.SERVICIO_REFERENCIA
        ) AS CLIENTE, 
    N.NOMBRE, 
    N.ESTADO, 
    N.MARCA, 
    N.FECHA
FROM dbo.RCT_NOVEDADES  AS N WITH (NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''V_CO_BALANCE_RESULTADOS_GRAL'')
DROP view [dbo].V_CO_BALANCE_RESULTADOS_GRAL; ')
execute(' CREATE OR ALTER   VIEW [dbo].[V_CO_BALANCE_RESULTADOS_GRAL] (
														   FECHA, 
														   MONEDA, 
														   CODIGO_INTERNO, 
														   DESCRIPCION, 
														   ID_BCE, 
														   TIPO_BALANCE, 
														   SALDOFINMESMO, 
														   DEBITOSMO, 
														   CREDITOSMO)
AS 

SELECT 
    CBR.FECHA, 
    CBR.MONEDA, 
    CBR.CODIGO_INTERNO, 
        (
        SELECT CBI.DESCRIPCION
        FROM dbo.CO_BALANCE_IMPRESION  AS CBI WITH (NOLOCK)
        WHERE CBI.ID_BCE = CBR.ID_BCE AND CBI.CODIGO_INTERNO = CBR.CODIGO_INTERNO
        ) AS DESCRIPCION, 
    CBR.ID_BCE, 
    CBR.TIPO_BALANCE, 
    sum(CBR.SALDOFINMESMO) AS SALDOFINMESMO, 
    sum(CBR.DEBITOSMO) AS DEBITOSMO, 
    sum(CBR.CREDITOSMO) AS CREDITOSMO
FROM dbo.CO_BALANCE_RESULTADOS  AS CBR WITH (NOLOCK)
GROUP BY 
    CBR.FECHA, 
    CBR.MONEDA, 
    CBR.CODIGO_INTERNO, 
    CBR.ID_BCE, 
    CBR.TIPO_BALANCE; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_DIR_BANCO'')
DROP view [dbo].VW_DIR_BANCO; ')
execute(' CREATE OR ALTER      VIEW [dbo].[VW_DIR_BANCO] 
AS 

SELECT CONCAT(''NBCH - '', c.CALLE,'' '', c.NUMERO) AS DIR  
FROM SUCURSALES s WITH (NOLOCK)
INNER JOIN cli_direcciones c WITH (NOLOCK) ON
								s.SUCURSAL=c.ID 
								AND c.FORMATO=''S'' 
								AND c.TIPODIRECCION=''R''
								AND  s.SUCURSAL=97; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RRII_BALANCE_SALDOS'')
DROP view [dbo].VW_RRII_BALANCE_SALDOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_RRII_BALANCE_SALDOS]
as
SELECT DISTINCT
	LEFT(CONVERT(VARCHAR,CBR.CODIGO_INTERNO) + REPLICATE(''0'',6), 6) AS CUENTA,
	--LEFT(CONVERT(VARCHAR,CBR.CODIGO_INTERNO) + REPLICATE(''0'',6), 6) AS CUENTA,	
	CASE WHEN P.FECHA=CBR.FECHA AND M.C6403=''N'' THEN ROUND(ROUND(SUM(CBR.SALDOFINMESMO),0) * H.TIPO_CAMBIO_OFICIAL,0)*-1
		 ELSE ROUND(ROUND(SUM(CBR.SALDOFINMESMO),0) * (SELECT H.TIPO_CAMBIO_OFICIAL WHERE H.FECHA_COTIZACION=CBR.FECHA AND H.MONEDA=CBR.MONEDA),0)*-1 
	END IMPORTE,	
 	CBR.FECHA  	
FROM CO_BALANCE_RESULTADOS CBR WITH (NOLOCK)
JOIN HISTORICOTIPOSCAMBIO H WITH (NOLOCK) ON CBR.MONEDA=H.MONEDA 
							AND CBR.FECHA=H.FECHA_COTIZACION	
JOIN MONEDAS M WITH (NOLOCK) ON CBR.MONEDA = M.C6399,
PARAMETROSGENERALES P WITH (NOLOCK)
GROUP BY CBR.SALDOFINMESMO,
		CBR.CODIGO_INTERNO,
		CBR.MONEDA, 
		P.FECHA,CBR.FECHA,
		H.FECHA_COTIZACION,
		H.MONEDA, 
		P.CODIGO, 
		H.TIPO_CAMBIO_OFICIAL, 
		M.C6403; ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_REFERENCIAS_PERSONAS_DOC'')
DROP view [dbo].VW_REFERENCIAS_PERSONAS_DOC; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_REFERENCIAS_PERSONAS_DOC] (
														   TIPODOC, 
														   NUMERODOC, 
														   NUMEROPERSONA, 
														   TIPO_PERSONA, 
														   TIPOREFERENCIA, 
														   NOMBRE, 
														   PLAZA_GIROACTIVIDAD, 
														   COD_PROFESION, 
														   DIRECCION, 
														   TELEFONOS, 
														   RESULTADO, 
														   OBSERVACIONES, 
														   ORDINAL)
AS 

SELECT TOP 9223372036854775807 WITH TIES 
		V.TIPODOCUMENTO AS TIPODOC, 
		V.NUMERODOCUMENTO AS NUMERODOC, 
		U.COD_PERSONA AS NUMEROPERSONA, 
		U.TIPO_PERSONA, 
		U.TIPOREFERENCIA, 
		U.NOMBRE, 
		U.PLAZA_GIROACTIVIDAD, 
		U.COD_PROFESION, 
		U.DIRECCION, 
		U.TELEFONOS, 
		U.RESULTADO, 
		U.OBSERVACIONES, 
		U.ORDINAL
FROM dbo.CLI_REFERENCIAS_PERSONAS  AS U WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON
    U.COD_PERSONA = V.NUMEROPERSONAFJ 
	AND(	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
		AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)) 
	AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
		AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
ORDER BY NUMEROPERSONA; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PERSONASJURIDICAS'')
DROP view [dbo].VW_PERSONASJURIDICAS; ')
execute(' CREATE OR ALTER   view [dbo].[VW_PERSONASJURIDICAS] 
as

select
	d.TIPODOCUMENTO,
	d.NUMERODOCUMENTO,
	d.NUMEROPERSONAFJ,
	j.RAZONSOCIAL,
	j.NIVEL_APERTURA as APERTURA
from CLI_DOCUMENTOSPFPJ d WITH (NOLOCK)
inner join CLI_PERSONASJURIDICAS j WITH (NOLOCK) on d.TIPOPERSONA = ''J'' 
												and d.NUMEROPERSONAFJ = j.NUMEROPERSONAJURIDICA
												AND (d.TZ_LOCK < 300000000000000 or d.TZ_LOCK >= 400000000000000)
												and (d.TZ_LOCK < 100000000000000 or d.TZ_LOCK >= 200000000000000)
												and (j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
												and (j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
												and j.NIVEL_APERTURA < 4
union all
select
	v.TIPODOCUMENTO,
	v.NUMERODOCUMENTO,
	v.NUMEROPERSONAJURIDICA as NUMEROPERSONAFJ,
	v.RAZONSOCIAL,
	0 as APERTURA
from CLI_VINCULADOSJURIDICOS v WITH (NOLOCK)
where
(v.TZ_LOCK < 300000000000000 or v.TZ_LOCK >= 400000000000000) 
and (v.TZ_LOCK < 100000000000000 or v.TZ_LOCK >= 200000000000000)
and v.TIPO_PERSONA = ''J'' 
AND (v.TIPODOCUMENTO + v.NUMERODOCUMENTO) NOT IN (
												SELECT (d.TIPODOCUMENTO+d.NUMERODOCUMENTO)
												from CLI_DOCUMENTOSPFPJ d WITH (NOLOCK)
												inner join CLI_PERSONASJURIDICAS j WITH (NOLOCK) 
														on d.TIPOPERSONA = ''J'' 
														and d.NUMEROPERSONAFJ = j.NUMEROPERSONAJURIDICA
														AND (d.TZ_LOCK < 300000000000000 or d.TZ_LOCK >= 400000000000000) 
														and (d.TZ_LOCK < 100000000000000 or d.TZ_LOCK >= 200000000000000)
														and (j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
														and (j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
														and j.NIVEL_APERTURA < 4); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''V_MAXFCHINFORMEVIGILANCIA'')
DROP view [dbo].V_MAXFCHINFORMEVIGILANCIA; ')
execute(' CREATE OR ALTER   VIEW [dbo].[V_MAXFCHINFORMEVIGILANCIA] (COD_INFORME, 
														COD_CLIENTE, 
														FCH_MAX)
AS 

SELECT	CRE_INFORLISTAVIGILANCIA.COD_INFORME, 
		CRE_INFORLISTAVIGILANCIA.COD_CLIENTE, 
		max(CRE_INFORLISTAVIGILANCIA.FCH_INFORME) AS FCH_MAX
FROM dbo.CRE_INFORLISTAVIGILANCIA WITH (NOLOCK)
GROUP BY CRE_INFORLISTAVIGILANCIA.COD_INFORME, 
		CRE_INFORLISTAVIGILANCIA.COD_CLIENTE
HAVING max(CRE_INFORLISTAVIGILANCIA.FCH_INFORME) >= 
													(SELECT max(MAXIMO.FECHA_MAX) AS expr
													FROM(	SELECT max(PP.FCH_INFORME) AS FECHA_MAX
															FROM dbo.CRE_INFORLISTAVIGILANCIA  AS PP WITH (NOLOCK)
															GROUP BY PP.COD_CLIENTE
													)AS MAXIMO
													); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_EST_SIT_ACTIVO'')
DROP view [dbo].VW_EST_SIT_ACTIVO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_EST_SIT_ACTIVO] 
AS

SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0101000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0101010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0101020000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0101021000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0101022000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0101030000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0102000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0103000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0104000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0105000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0106000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0106010000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0106020000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0106030000'' 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0106040000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0107000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0108000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0109000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0110000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4 
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0111000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0112000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0113000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0114000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO  WITH(NOLOCK)
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0115000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0116000000''
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4
UNION ALL
SELECT columna1, columna2, columna3, columna4 
FROM RRII_ESTADO WITH(NOLOCK) 
WHERE informe=''ESTADO_SIT'' 
and CODIGO = ''0100000000'' 
UNION ALL
SELECT NULL AS columna1, null AS columna2, null AS columna3, NULL AS columna4; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CLI_INHABILITADOS_INAES'')
DROP view [dbo].VW_CLI_INHABILITADOS_INAES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_CLI_INHABILITADOS_INAES]
														(
														[Tipo de entidad],
														[Descripción Tipo de Entidad],
														[Matrícula],
														[Provincia],
														[Razón Social],
														[CUIT],
														[Observaciones],
														[Estado],
														[Descripción Estado],
														[Motivo],
														[Descripción Motivo],
														[Fecha Importación],
														[Nro. Interno]
													)AS 

SELECT	
	I.TIPO_ENTIDAD,
	(SELECT DESCRIPCION 
	FROM OPCIONES WITH (NOLOCK) 
	WHERE NUMERODECAMPO = 33216 
	AND OPCIONINTERNA = I.TIPO_ENTIDAD 
	AND IDIOMA=''E'') AS DESC_TIPO_ENTIDAD,
	I.MATRICULA,
	I.PROVINCIA,
	I.RAZON_SOCIAL,
	I.CUIT,
	I.OBSERVACIONES,
	I.ESTADO,
	(SELECT DESCRIPCION 
	FROM OPCIONES WITH (NOLOCK) 
	WHERE NUMERODECAMPO = 33222 
	AND OPCIONINTERNA = I.ESTADO 
	AND IDIOMA=''E'') AS DESC_ESTADO,
	I.MOTIVO,
	(SELECT DESCRIPCION 
	FROM OPCIONES  WITH (NOLOCK)
	WHERE NUMERODECAMPO = 33223 
	AND OPCIONINTERNA = I.MOTIVO 
	AND IDIOMA=''E'') AS DESC_MOTIVO,
    I.FECHA_IMPORTACION,
	I.NRO_INTERNO
FROM  
      dbo.CLI_INHABILITADOS_INAES AS I WITH (NOLOCK)
WHERE 
	  (	(I.TZ_LOCK < 300000000000000 OR I.TZ_LOCK >= 400000000000000) 
		AND (I.TZ_LOCK < 100000000000000 OR I.TZ_LOCK >= 200000000000000)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_EMERIX_PERSONAS'')
DROP view [dbo].VW_ITF_EMERIX_PERSONAS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_ITF_EMERIX_PERSONAS] 
AS 

SELECT 
	cp.NUMEROPERSONAFISICA AS num_per,
	cd.NUMERODOCUMENTO AS doc_identificativo,
	ccp.CODIGOCLIENTE AS cod_cli,
	''F'' AS tipo_per,
	ccp.TITULARIDAD AS titularidad,
	cp.IVA AS iva,
	dbo.NCADENAS(cd.NUMERODOCUMENTO,45,''0'',''P'') AS inper_clave, /* 45 */
	(case
	  WHEN (  SELECT TOP 1 CODIGO_ACTIVIDAD  
			  FROM CLI_ACTIVIDAD_ECONOMICA WITH (NOLOCK) 
			  WHERE CODIGO_PERSONA_CLIENTE=cp.NUMEROPERSONAFISICA 
			  AND (ORDINAL_ACTIVIDAD = 1 OR ORDEN_AFIP = 1)) IS NULL THEN dbo.NCADENAS(''0'',10,''0'',''P'')
	  ELSE (SELECT TOP 1 dbo.NCADENAS(CODIGO_ACTIVIDAD,10,''0'',''P'')  
			FROM CLI_ACTIVIDAD_ECONOMICA WITH (NOLOCK)
			WHERE CODIGO_PERSONA_CLIENTE=cp.NUMEROPERSONAFISICA 
			AND(ORDINAL_ACTIVIDAD = 1 OR ORDEN_AFIP = 1))
	END) AS inper_acv,
	dbo.NCADENAS(cp.NUMEROPERSONAFISICA,20,''0'',''P'') AS inper_cli,  /* 20 */
	'''' AS inper_slg,
	''        '' AS inper_fec_slg, /* 8 */
	(CASE
	  WHEN cp.GRUPOECONOMICO IS NULL THEN dbo.NCADENAS(''0'',10,''0'',''P'')
	  ELSE dbo.NCADENAS(cp.GRUPOECONOMICO,10,''0'',''P'')
	END) AS inper_gec,
	(CASE 
	  WHEN cp.ESTADOCIVIL IS NULL THEN dbo.NCADENAS(''S/I'',10,'' '',''P'')
	  ELSE dbo.NCADENAS(cp.ESTADOCIVIL,10,'' '',''P'')
	END) AS inper_ecv,  /* 10 */
	dbo.NCADENAS(concat(ltrim(rtrim(cp.APELLIDOPATERNO)),'' '', ltrim(rtrim(cp.APELLIDOMATERNO))),60,'' '', ''P'') AS inper_apellido,
	dbo.NCADENAS(concat(ltrim(rtrim(cp.PRIMERNOMBRE)),'' '', ltrim(rtrim(cp.SEGUNDONOMBRE))),40,'' '', ''P'') AS inper_nombre,
	(CASE
	  WHEN cp.IVA IS NULL THEN dbo.NCADENAS('''',10,'' '',''P'')
	  ELSE dbo.NCADENAS(cp.IVA,10,'' '',''P'')
	END) AS inper_civ,
	dbo.NCADENAS(CONVERT (CHAR(8),cp.FECHANACIMIENTO,112),8,''0'',''P'') AS inper_fec_nac, 
	(CASE
	  WHEN ce.EMAIL IS NULL THEN dbo.NCADENAS('''', 100,'' '',''P'')
	  ELSE dbo.NCADENAS(ce.EMAIL, 100,'' '',''P'')
	END) AS inper_email,
	dbo.NCADENAS('''',100,'' '',''P'') AS inper_obs, 
	(CASE
	  WHEN cp.SEXO IS NULL THEN '' ''
	  ELSE cp.SEXO
	END) AS inper_sexo,
	''F'' AS inper_fis_jur,
	(CASE
	  WHEN cp.NACIONALIDAD IS NULL THEN dbo.NCADENAS('''',20,'' '',''P'')
	  ELSE dbo.NCADENAS(cp.NACIONALIDAD,20,'' '',''P'')
	END) AS inper_nacionalidad,
	(CASE
	  WHEN cp.MOTIVO_INHABILITADO IS NULL OR cp.MOTIVO_INHABILITADO=0 THEN dbo.NCADENAS(''HABILITADO'',500,'' '',''P'')
	  ELSE (SELECT dbo.NCADENAS(DESCRIPCION,500,'' '',''P'') 
			FROM OPCIONES WITH (NOLOCK) 
			WHERE NUMERODECAMPO=33368 
			AND IDIOMA=''E'' 
			AND OPCIONINTERNA=cp.MOTIVO_INHABILITADO)
	END) AS inper_notas,
	dbo.NCADENAS(''NBCH'',10,'' '',''P'') AS inper_ent,
	dbo.NCADENAS(cp.SUC_ALTA,10,''0'',''P'') AS inper_suc,
	dbo.NCADENAS(''S/I'',10,'' '',''P'') AS inper_seg,
	dbo.NCADENAS(''S/I'',10,'' '',''P'') AS inper_sus,
	dbo.NCADENAS('''',255,'' '',''P'') AS inper_filler, 
	dbo.NCADENAS('''',10,'' '',''P'') AS inper_error,
	dbo.NCADENAS('''',29,'' '',''P'') AS inper_error_campo,  
	''*'' AS fin_linea
FROM CLI_PERSONASFISICAS cp WITH (NOLOCK) 
left JOIN CLI_ClientePersona ccp WITH (NOLOCK) ON cp.NUMEROPERSONAFISICA=ccp.NUMEROPERSONA 
													AND ccp.TZ_LOCK=0
INNER JOIN CLI_DocumentosPFPJ cd WITH (NOLOCK) ON cp.NUMEROPERSONAFISICA=cd.NUMEROPERSONAFJ
											AND cd.TZ_LOCK=0
left JOIN cli_emails ce WITH (NOLOCK) ON cp.NUMEROPERSONAFISICA=ce.ID 
									AND ce.FORMATO=''PF'' 
									AND ce.TIPO=''PE'' 
									AND ce.TZ_LOCK=0
WHERE  cp.TZ_LOCK=0
UNION ALL
SELECT 
	cp.NUMEROPERSONAJURIDICA AS num_per,
	cd.NUMERODOCUMENTO AS doc_identificativo,
	ccp.CODIGOCLIENTE AS cod_cli,
	''J'' AS tipo_per,
	ccp.TITULARIDAD AS titularidad,
	cp.IVA AS iva,
	dbo.NCADENAS(cd.NUMERODOCUMENTO,45,''0'',''P'') AS inper_clave, /* 45 */
	(case
	  WHEN (SELECT TOP 1 CODIGO_ACTIVIDAD  
	  FROM CLI_ACTIVIDAD_ECONOMICA WITH (NOLOCK) 
	  WHERE CODIGO_PERSONA_CLIENTE=cp.NUMEROPERSONAJURIDICA 
	  AND (ORDINAL_ACTIVIDAD = 1 OR ORDEN_AFIP = 1)) IS NULL THEN dbo.NCADENAS(''0'',10,''0'',''P'')
	  ELSE (SELECT TOP 1 dbo.NCADENAS(CODIGO_ACTIVIDAD,10,''0'',''P'')  
	  FROM CLI_ACTIVIDAD_ECONOMICA WITH (NOLOCK) 
	  WHERE CODIGO_PERSONA_CLIENTE=cp.NUMEROPERSONAJURIDICA 
	  AND (ORDINAL_ACTIVIDAD = 1 OR ORDEN_AFIP = 1))
	END) AS inper_acv,
	dbo.NCADENAS(cp.NUMEROPERSONAJURIDICA,20,''0'',''P'') AS inper_cli,  /* 20 */
	'''' AS inper_slg,
	''        '' AS inper_fec_slg, /* 8 */
	(CASE
	  WHEN cp.GRUPOECONOMICO IS NULL THEN dbo.NCADENAS(''0'',10,''0'',''P'')
	  ELSE dbo.NCADENAS(cp.GRUPOECONOMICO,10,''0'',''P'')
	END) AS inper_gec,
	dbo.NCADENAS(''S/I'',10,'' '',''P'') AS inper_ecv,  /* 10 */

	dbo.NCADENAS(cp.RAZONSOCIAL,60,'' '',''P'') AS inper_apellido,
	dbo.NCADENAS('''',40,'' '',''P'') AS inper_nombre,
	(CASE
	  WHEN cp.IVA IS NULL THEN dbo.NCADENAS('''',10,'' '',''P'')
	  ELSE dbo.NCADENAS(cp.IVA,10,'' '',''P'')
	END) AS inper_civ,
	dbo.NCADENAS(CONVERT (CHAR(8),cp.FECHACONSTITUCION,112),8,''0'',''P'') AS inper_fec_nac, 
	(CASE
	  WHEN ce.EMAIL IS NULL THEN dbo.NCADENAS('''', 100,'' '',''P'')
	  ELSE dbo.NCADENAS(ce.EMAIL, 100,'' '',''P'')
	END) AS inper_email,
	dbo.NCADENAS('''',100,'' '',''P'') AS inper_obs, 
	'' '' AS inper_sexo,
	''F'' AS inper_fis_jur,
	dbo.NCADENAS(''ARGENTINO'',20,'' '',''P'') AS inper_nacionalidad,
	(CASE
	  WHEN cp.MOTIVO_INHABILITADO IS NULL OR cp.MOTIVO_INHABILITADO=0 THEN dbo.NCADENAS(''HABILITADO'',500,'' '',''P'')
	  ELSE (SELECT dbo.NCADENAS(DESCRIPCION,500,'' '',''P'') 
			FROM OPCIONES  WITH (NOLOCK)
			WHERE NUMERODECAMPO=33368 
			AND IDIOMA=''E'' 
			AND OPCIONINTERNA=cp.MOTIVO_INHABILITADO)
	END) AS inper_notas,
	dbo.NCADENAS(''NBCH'',10,'' '',''P'') AS inper_ent,
	dbo.NCADENAS(cp.SUC_ALTA,10,''0'',''P'') AS inper_suc,
	dbo.NCADENAS(''S/I'',10,'' '',''P'') AS inper_seg,
	dbo.NCADENAS(''S/I'',10,'' '',''P'') AS inper_sus,
	dbo.NCADENAS('''',255,'' '',''P'') AS inper_filler, 
	dbo.NCADENAS('''',10,'' '',''P'') AS inper_error,
	dbo.NCADENAS('''',29,'' '',''P'') AS inper_error_campo,  
	''*'' AS fin_linea
FROM CLI_PERSONASJURIDICAS cp  WITH (NOLOCK)
left JOIN CLI_ClientePersona ccp WITH (NOLOCK) ON cp.NUMEROPERSONAJURIDICA=ccp.NUMEROPERSONA 
													AND ccp.TZ_LOCK=0
INNER JOIN CLI_DocumentosPFPJ cd WITH (NOLOCK) ON cp.NUMEROPERSONAJURIDICA=cd.NUMEROPERSONAFJ
												AND cd.TZ_LOCK=0
left JOIN cli_emails ce WITH (NOLOCK) ON cp.NUMEROPERSONAJURIDICA=ce.ID 
										AND ce.FORMATO=''PF'' 
										AND ce.TIPO=''PE'' 
										AND ce.TZ_LOCK=0
WHERE  cp.TZ_LOCK=0 ; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_REG_CONTABLES'')
DROP view [dbo].VW_REG_CONTABLES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_REG_CONTABLES] (
											   TZ_LOCK, 
											   ID_REGISTRO, 
											   MONEDA, 
											   TOTALDEBITOS, 
											   TOTALCREDITOS)
AS 

SELECT 
    0 AS TZ_LOCK, 
      
        (
        SELECT CON_REGISTROSCONTABLES.ID_REGISTRO
        FROM dbo.CON_REGISTROSCONTABLES WITH (NOLOCK)
        WHERE CON_REGISTROSCONTABLES.ID_REGISTRO = R.ID_REGISTRO
        ) AS ID_REGISTRO, 
    R.MONEDA, 
    CAST(
        (
        SELECT ISNULL(sum(CON_REGISTROSPROCESAR.IMPORTE), 0) AS expr
        FROM dbo.CON_REGISTROSPROCESAR WITH (NOLOCK)
        WHERE 
            upper(CON_REGISTROSPROCESAR.DEB_CRED) = ''D'' AND 
            CON_REGISTROSPROCESAR.MONEDA = R.MONEDA AND 
            CON_REGISTROSPROCESAR.ID_REGISTRO = R.ID_REGISTRO
        ) AS numeric(15, 2)) AS TOTALDEBITOS, 
    CAST(
        (
        SELECT ISNULL(sum(CON_REGISTROSPROCESAR$2.IMPORTE), 0) AS expr
        FROM dbo.CON_REGISTROSPROCESAR  AS CON_REGISTROSPROCESAR$2 WITH (NOLOCK)
        WHERE 
            upper(CON_REGISTROSPROCESAR$2.DEB_CRED) = ''C'' AND 
            CON_REGISTROSPROCESAR$2.MONEDA = R.MONEDA AND 
            CON_REGISTROSPROCESAR$2.ID_REGISTRO = R.ID_REGISTRO
        ) AS numeric(15, 2)) AS TOTALCREDITOS
FROM dbo.CON_REGISTROSPROCESAR  AS R  WITH (NOLOCK)
WHERE R.ID_REGISTRO IN 
						(SELECT C.ID_REGISTRO
						FROM dbo.CON_REGISTROSCONTABLES  AS C WITH (NOLOCK)
						WHERE C.ESTADO = 0)
GROUP BY R.ID_REGISTRO, 
		R.MONEDA; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_INSTITUCIONESFINANCIERAS'')
DROP view [dbo].VW_INSTITUCIONESFINANCIERAS; ')
execute(' CREATE OR ALTER   view [dbo].[VW_INSTITUCIONESFINANCIERAS] 
as
select
	d.TIPODOCUMENTO,
	d.NUMERODOCUMENTO,
	d.NUMEROPERSONAFJ,
	j.RAZONSOCIAL,
	j.NIVEL_APERTURA as APERTURA
from CLI_DOCUMENTOSPFPJ d WITH (NOLOCK)
inner join CLI_PERSONASJURIDICAS j WITH (NOLOCK) on d.TIPOPERSONA = ''J'' 
												and d.NUMEROPERSONAFJ = j.NUMEROPERSONAJURIDICA
												AND (d.TZ_LOCK < 300000000000000 or d.TZ_LOCK >= 400000000000000) 
												and (d.TZ_LOCK < 100000000000000 or d.TZ_LOCK >= 200000000000000)
												and (j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
												and (j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
												and j.NIVEL_APERTURA = 4
union all
select
	v.TIPODOCUMENTO,
	v.NUMERODOCUMENTO,
	v.NUMEROPERSONAJURIDICA as NUMEROPERSONAFJ,
	v.RAZONSOCIAL,
	0 as APERTURA
from CLI_VINCULADOSJURIDICOS v WITH (NOLOCK)
where (v.TZ_LOCK < 300000000000000 or v.TZ_LOCK >= 400000000000000) 
	and (v.TZ_LOCK < 100000000000000 or v.TZ_LOCK >= 200000000000000)
	and v.TIPO_PERSONA = ''I'' 
	AND (v.TIPODOCUMENTO + v.NUMERODOCUMENTO) NOT IN (
														SELECT (d.TIPODOCUMENTO+d.NUMERODOCUMENTO)
														from CLI_DOCUMENTOSPFPJ d  WITH (NOLOCK)
														inner join CLI_PERSONASJURIDICAS j WITH (NOLOCK) on d.TIPOPERSONA = ''J'' 
																									and d.NUMEROPERSONAFJ = j.NUMEROPERSONAJURIDICA
																									AND (d.TZ_LOCK < 300000000000000 or d.TZ_LOCK >= 400000000000000) 
																									and (d.TZ_LOCK < 100000000000000 or d.TZ_LOCK >= 200000000000000)
																									and (j.TZ_LOCK < 300000000000000 or j.TZ_LOCK >= 400000000000000) 
																									and (j.TZ_LOCK < 100000000000000 or j.TZ_LOCK >= 200000000000000)
																									and j.NIVEL_APERTURA = 4); ')
execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RELGARANTIASALDO_VALORES'')
DROP view [dbo].VW_RELGARANTIASALDO_VALORES; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_RELGARANTIASALDO_VALORES] (
														   NUM_GARANTIA, 
														   CARACTER_GARANTIA, 
														   CUENTA_SALDO, 
														   CLIENTE_SALDO, 
														   PRODUCTO_SALDO, 
														   MONEDA_SALDO, 
														   CAPITAL_SALDO, 
														   FCHINICIAL_SALDO, 
														   FCHVTO_SALDO, 
														   OPERACION, 
														   CLAVE_SALDO, 
														   SUCURSAL_SALDO, 
														   TITULOVALOR_LIBERAR)
AS 
SELECT 
    CRE_GARANTIASALDO.NUM_GARANTIA AS NUM_GARANTIA, 
    CRE_GARANTIASRECIBIDAS.CARACTER_GARANTIA AS CARACTER_GARANTIA, 
    SALDOS.CUENTA AS CUENTA_SALDO, 
    SALDOS.C1803 AS CLIENTE_SALDO, 
    SALDOS.PRODUCTO AS PRODUCTO_SALDO, 
    SALDOS.MONEDA AS MONEDA_SALDO, 
    SALDOS.C1604 AS CAPITAL_SALDO, 
    SALDOS.C1621 AS FCHINICIAL_SALDO, 
    SALDOS.C1627 AS FCHVTO_SALDO, 
    SALDOS.OPERACION AS OPERACION, 
    SALDOS.JTS_OID AS CLAVE_SALDO, 
    SALDOS.SUCURSAL AS SUCURSAL_SALDO, 
    CRE_GARANTIASALDO.TITULOVALOR_LIBERAR
FROM dbo.CRE_GARANTIASALDO WITH(NOLOCK)
INNER JOIN dbo.SALDOS WITH(NOLOCK) ON CRE_GARANTIASALDO.JTSOID_SALDO = SALDOS.JTS_OID
INNER JOIN dbo.CRE_GARANTIASRECIBIDAS WITH(NOLOCK) ON CRE_GARANTIASRECIBIDAS.NUM_GARANTIA = CRE_GARANTIASALDO.NUM_GARANTIA
WHERE 
    CRE_GARANTIASALDO.TZ_LOCK = 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VIEW_CLIENTEENGRUPO'')
DROP view [dbo].VIEW_CLIENTEENGRUPO; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VIEW_CLIENTEENGRUPO] (GRUPO, 
												CLIENTE, 
												NOMBRE)
AS 

SELECT TOP 9223372036854775807 WITH TIES GPO.CODIGOGRUPOECONOMICO AS GRUPO, 
		CLI.CODIGOCLIENTE AS CLIENTE, 
		CLI.NOMBRECLIENTE AS NOMBRE
FROM dbo.CLI_CLIENTES  AS CLI WITH (NOLOCK)
INNER JOIN dbo.CLI_GRUPOSECONOMICOSCLIENTE AS GPO WITH (NOLOCK) ON 
														 CLI.CODIGOCLIENTE = GPO.CODIGOCLIENTE
ORDER BY GPO.CODIGOGRUPOECONOMICO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_RRII_ANEXO_2'')
DROP view [dbo].VW_RRII_ANEXO_2; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_RRII_ANEXO_2] 
AS
SELECT	DISTINCT CBR.CODIGO_INTERNO, 
		SUM(VBS.IMPORTE) AS IMPORTE, 
		VBS.FECHA
FROM CO_BALANCE_ESTRUCTURA CBR WITH (NOLOCK)
LEFT JOIN VW_RRII_BALANCE_SALDOS VBS WITH (NOLOCK) ON VBS.CUENTA = CBR.CODIGO_BCE
												AND CBR.ID_BCE=2
												AND CBR.TZ_LOCK=0 
GROUP BY CBR.CODIGO_INTERNO, 
		VBS.FECHA; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SALDOS_CALCULO_IRPF_ANUAL'')
DROP view [dbo].VW_SALDOS_CALCULO_IRPF_ANUAL; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_SALDOS_CALCULO_IRPF_ANUAL] (	IDSALDO, 
															MONTOINPONIBLE, 
															MONEDA)
AS 

SELECT	S.JTS_OID AS IDSALDO, 
		(S.C1609 - S.C1610) AS MONTOINPONIBLE, 
		S.MONEDA AS MONEDA
FROM dbo.SALDOS  AS S WITH(NOLOCK)
INNER JOIN dbo.CLI_CLIENTES  AS C WITH(NOLOCK)ON
												S.C1803 = C.CODIGOCLIENTE 
												AND S.C1628 >(	SELECT PARAMETROS.FECHAPROCESO
																FROM dbo.PARAMETROS WITH(NOLOCK)) 
												AND S.C1785 = 4 
												AND S.TZ_LOCK = 0 
												AND C.TZ_LOCK = 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_PERSONASFISICAS'')
DROP view [dbo].VW_PERSONASFISICAS; ')
execute(' CREATE OR ALTER   view [dbo].[VW_PERSONASFISICAS] 
as

select
	d.TIPODOCUMENTO,
	d.NUMERODOCUMENTO,
	d.NUMEROPERSONAFJ,
	f.APELLIDOPATERNO,
	f.APELLIDOMATERNO,
	f.PRIMERNOMBRE,
	f.SEGUNDONOMBRE,
	f.NIVEL_APERTURA as APERTURA
from CLI_DOCUMENTOSPFPJ d WITH(NOLOCK)
inner join CLI_PERSONASFISICAS f WITH(NOLOCK) on d.TIPOPERSONA = ''F'' 
									and d.NUMEROPERSONAFJ = f.NUMEROPERSONAFISICA
									AND (d.TZ_LOCK < 300000000000000 or d.TZ_LOCK >= 400000000000000) 
									and (d.TZ_LOCK < 100000000000000 or d.TZ_LOCK >= 200000000000000)
									and (f.TZ_LOCK < 300000000000000 or f.TZ_LOCK >= 400000000000000) 
									and (f.TZ_LOCK < 100000000000000 or f.TZ_LOCK >= 200000000000000); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VSL_ALTERNSOLICITMETOD'')
DROP view [dbo].VSL_ALTERNSOLICITMETOD; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VSL_ALTERNSOLICITMETOD] (
													   NRO_SOLICITUD, 
													   ID_MET, 
													   COD_CRITERIO, 
													   COD_ELEMENTO, 
													   COD_ALTERNATIVA, 
													   DESCALTERN, 
													   PUNTAJE, 
													   APLICA, 
													   CLIENTE, 
													   MONEDA)
AS 
SELECT 
    ACSOL.NROSOLICITUD AS NRO_SOLICITUD, 
    ACSOL.ID_MET, 
    ACSOL.COD_CRITERIO, 
    ACSOL.COD_ELEMENTO, 
    ACSOL.COD_ALTERNATIVA, 
    ACSOL.DESCALTERN, 
    CAST(ACSOL.PUNTAJE AS numeric(4)) AS PUNTAJE, 
    A.APLICA, 
    ACSOL.CLIENTE, 
    ACSOL.MONEDA
FROM dbo.SL_ANALISISCUALITATIVO  AS A WITH(NOLOCK)
INNER JOIN dbo.SL_ANALISISCUALITATIVOSOL  AS ACSOL WITH(NOLOCK) ON 
																A.NROSOLICITUD = ACSOL.NROSOLICITUD 
																AND A.CODCRITERIO = ACSOL.COD_CRITERIO 
																AND A.CODELEMENTO = ACSOL.COD_ELEMENTO 
																AND A.CODALTERNATIVA = ACSOL.COD_ALTERNATIVA 
																AND A.TZ_LOCK = 0
UNION
SELECT 
    ACSOL2.NROSOLICITUD AS NRO_SOLICITUD, 
    ACSOL2.ID_MET, 
    ACSOL2.COD_CRITERIO, 
    ACSOL2.COD_ELEMENTO, 
    ACSOL2.COD_ALTERNATIVA, 
    ACSOL2.DESCALTERN, 
    CAST(ACSOL2.PUNTAJE AS numeric(4)) AS PUNTAJE, 
    NULL, 
    ACSOL2.CLIENTE, 
    ACSOL2.MONEDA
FROM dbo.SL_ANALISISCUALITATIVOSOL  AS ACSOL2  WITH(NOLOCK)
WHERE ACSOL2.COD_ALTERNATIVA = 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ITF_LINK_UMOZ_SALDOPDF'')
DROP view [dbo].VW_ITF_LINK_UMOZ_SALDOPDF; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_ITF_LINK_UMOZ_SALDOPDF] 
as
SELECT	( RIGHT(''0000000000000000000''+ VT.CTA_REDLINK, 18)) AS ''NROCUENTA'',
		(SELECT CASE	WHEN S.C1604 < 0 then (''-''+RIGHT(''00000000''+(S.C1604*100),8))
						when S.C1604 >= 0 then (''+''+RIGHT(''00000000''+((s.C1604*100)),8)) 
				end) as SALDO,
		SPACE(23) AS ''FILLER'',
		HV.CONCEPTO AS ''CONCEPTO'',
		(SELECT (	case	when hv.DEBITO_CREDITO = ''C'' THEN (''+''+RIGHT(''00000000''+CAST((select CONVERT(VARCHAR(15), CONVERT(NUMERIC(15), (HV.MONTO)*100))) AS VARCHAR(8)),8)) 
						when hv.DEBITO_CREDITO  = ''D'' then (''-''+RIGHT(''00000000''+CAST((select CONVERT(VARCHAR(15), CONVERT(NUMERIC(15), (HV.MONTO)*100))) AS VARCHAR(8)),8))
					END))  AS ''IMPORTEDETALLE'',
		(SELECT (case	when hv.DEBITO_CREDITO = ''C'' THEN (''+'') 
						when hv.DEBITO_CREDITO = ''D'' then (''-'') 
				end)) as ''SIGNO'',
		(select convert(varchar(6),HV.FECHA_VALOR,12)) AS ''FECHA'',
		(SELECT(CASE	WHEN s.moneda=80 and S.C1785 =2 THEN ''Cuenta Corriente en Pesos''
						WHEN s.moneda = 2 and S.C1785 = 3 then ''Caja Ahorro en Dolares''
						WHEN s.moneda = 80 and S.C1785 = 3 then ''Caja Ahorro en Pesos'' 
				END)) as ''TipoDetalle'',
		(select CONVERT(VARCHAR(15), CONVERT(NUMERIC(15), (HV.MONTO)*100)))  as IMPORTEORIGINAL

FROM ITF_MOVCONFORMADOS ITF WITH(NOLOCK)
INNER JOIN HISTORIA_VISTA HV WITH(NOLOCK) ON ITF.asiento=HV.ASIENTO  
							AND itf.fch_procesado=hv.FECHA_PROCESADO 
							AND itf.sucursal=hv.SUCURSAL
							AND itf.nro_mov=hv.NUMERO_MOVIMIENTO 
							and itf.ordinal=hv.ORDINAL 
							AND itf.ordinal=hv.ORDINAL 
							AND itf.TRTIPO=hv.TRTIPO 
							AND itf.TRVIRTUAL=hv.TRVIRTUAL 
							AND itf.jts_oid=hv.SALDO_JTS_OID
INNER JOIN saldos s WITH(NOLOCK) ON s.JTS_OID=itf.jts_oid 
INNER JOIN VTA_SALDOS VT WITH(NOLOCK) ON VT.JTS_OID_SALDO=ITF.JTS_OID; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SALDOS_CUENTASVISTA'')
DROP view [dbo].VW_SALDOS_CUENTASVISTA; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_SALDOS_CUENTASVISTA] (
													   SUCURSAL, 
													   PRODUCTO, 
													   MONEDA, 
													   CLIENTES, 
													   CUENTA, 
													   OPERACION, 
													   SALDOJTS, 
													   SALDOACTUAL, 
													   FECHAINMOV, 
													   FECHATESORO, 
													   FECHA_PROCESO)
AS 

SELECT 
    S.SUCURSAL AS SUCURSAL, 
    S.PRODUCTO AS PRODUCTO, 
    S.MONEDA AS MONEDA, 
    S.C1803 AS CLIENTES, 
    S.CUENTA AS CUENTA, 
    S.OPERACION AS OPERACION, 
    S.JTS_OID AS SALDOJTS, 
    S.C1604 AS SALDOACTUAL, 
    S.C1626 AS FECHAINMOV, 
    dateadd(m, 60, S.C1626) AS FECHATESORO, 
      
        (
        SELECT PARAMETROS.FECHAPROCESO
        FROM dbo.PARAMETROS WITH(NOLOCK)
        ) AS FECHA_PROCESO
FROM dbo.SALDOS  AS S WITH (NOLOCK) 
INNER JOIN dbo.CLI_CLIENTES  AS C WITH (NOLOCK) ON S.C1803 = C.CODIGOCLIENTE
												AND S.TZ_LOCK = 0 
												AND S.C1785 IN ( 2, 3 ) 
													AND C.INTERMEDIACIONFINANCIERA = ''00'' 
													AND S.C1604 > 0 
													AND S.C1679 = '' '' 
													AND C.CODIGOBLOQUEO = '' '' 
													AND dateadd(m, 60, S.C1626) <= 
																				(SELECT PARAMETROS$2.FECHAPROCESO
																				FROM dbo.PARAMETROS AS PARAMETROS$2 WITH (NOLOCK)); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VTC_NOMUSUARIOS'')
DROP view [dbo].VTC_NOMUSUARIOS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VTC_NOMUSUARIOS] (
											   C9420, 
											   C9421, 
											   C9422, 
											   C9423, 
											   C9424)
AS 

SELECT 
    USUARIOS.INICIALES AS C9420, 
    USUARIOS.NOMBRE AS C9421, 
    USUARIOS.CLAVE AS C9422, 
    USUARIOS.NROSUCURSAL AS C9423, 
    USUARIOS.NRODECAJA AS C9424
FROM dbo.USUARIOS WITH(NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SALDOS_DIARIO_ACT_ANT'')
DROP view [dbo].VW_SALDOS_DIARIO_ACT_ANT; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_SALDOS_DIARIO_ACT_ANT] (
													   SALDOS_JTS_OID, 
													   FECHA, 
													   SALDO_DIA, 
													   FECHA_ANTERIOR, 
													   SALDO_ANTERIOR)
AS 
SELECT 
    G1.SALDOS_JTS_OID, 
    G1.FECHA, 
    G1.SALDO_AL_CORTE AS SALDO_DIA, 
    G2.FECHA AS FECHA_ANTERIOR, 
    CASE 
        WHEN G2.SALDO_AL_CORTE IS NULL THEN 0
        ELSE G2.SALDO_AL_CORTE
    END AS SALDO_ANTERIOR
FROM dbo.GRL_SALDOS_DIARIOS  AS G1 WITH(NOLOCK)
LEFT OUTER JOIN dbo.GRL_SALDOS_DIARIOS AS G2 WITH(NOLOCK) ON G2.SALDOS_JTS_OID = G1.SALDOS_JTS_OID 
															AND G2.FECHA = DATEADD(D, -1, G1.FECHA); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''V_DJ_CUENTAS'')
DROP view [dbo].V_DJ_CUENTAS; ')
execute(' CREATE OR ALTER   VIEW [dbo].[V_DJ_CUENTAS]
AS
SELECT
	S.JTS_OID, --565,
	COALESCE(CC.NRO_CAUSA, 0) AS NRO_CAUSA, --50033,
	S.CUENTA, --2615,
	VS.NOMBRE_CUENTA, --910,
	S.PRODUCTO, --2613,
	P.C6251 AS NOMBRE_PRODUCTO, --4968,
	S.SUCURSAL, --2612,
	SUC.NOMBRESUCURSAL AS NOMBRE_SUCURSAL, --324,
	S.MONEDA, --611,
	M.C6400 AS NOMBRE_MONEDA, --622,
	CC.NRO_OFICIO --1850
FROM SALDOS S  WITH(NOLOCK)
LEFT JOIN DJ_CAUSA_CUENTA CC WITH(NOLOCK) ON S.JTS_OID=CC.JTS_OID_CUENTA 
								AND CC.TZ_LOCK=0
JOIN SUCURSALES SUC WITH(NOLOCK) ON SUC.SUCURSAL=S.SUCURSAL
JOIN MONEDAS M WITH(NOLOCK) ON M.C6399=S.MONEDA
JOIN PRODUCTOS P WITH(NOLOCK) ON P.C6250=S.PRODUCTO
JOIN VTA_SALDOS VS WITH(NOLOCK) ON VS.JTS_OID_SALDO=S.JTS_OID
WHERE S.PRODUCTO IN (SELECT TC.PRODUCTO 
					FROM DJ_TIPOS_CAUSAS TC  WITH(NOLOCK)
					WHERE TC.TZ_LOCK=0) 
	AND S.TZ_LOCK=0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VVAL_CUSTODIAVALORES'')
DROP view [dbo].VVAL_CUSTODIAVALORES; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VVAL_CUSTODIAVALORES] (
												   CODIGOBCO, 
												   CODINTERNACIONAL, 
												   CUSTODIOS, 
												   NOMBRECLIENTE, 
												   VALORNOMINAL, 
												   CODTITULO, 
												   FECHAVENCIMIENTO)
AS 
SELECT 
    VAL_TITULOS.CODIGOBCO, 
    VAL_TITULOS.CODINTERNACIONAL, 
    VAL_CUSTODIO_VALORES.CUSTODIOS, 
    CLI_CLIENTES.NOMBRECLIENTE, 
    VAL_CUSTODIO_VALORES.VALORNOMINAL, 
    VAL_TITULOS.CODTITULO, 
    VAL_CUSTODIO_VALORES.FECHAVENCIMIENTO
FROM dbo.VAL_CUSTODIO_VALORES WITH(NOLOCK)
INNER JOIN dbo.VAL_TITULOS  WITH(NOLOCK)
        ON VAL_TITULOS.CODTITULO = VAL_CUSTODIO_VALORES.CODTITULO 
		AND VAL_CUSTODIO_VALORES.TZ_LOCK = 0 
INNER JOIN dbo.CLI_CLIENTES  WITH(NOLOCK)
        ON VAL_CUSTODIO_VALORES.CUSTODIOS = CLI_CLIENTES.CODIGOCLIENTE; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_CTAS_LINK'')
DROP view [dbo].VW_CTAS_LINK; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VW_CTAS_LINK] 
AS
SELECT CTA_REDLINK, NOMBRE_CUENTA 
FROM VTA_SALDOS WITH(NOLOCK)
WHERE TZ_LOCK=0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SALDOS_DIARIOS'')
DROP view [dbo].VW_SALDOS_DIARIOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_SALDOS_DIARIOS] (
												MONEDA, 
												FECHA, 
												SALDO_AL_CORTE, 
												SALDO_AJUSTADO)
AS 
SELECT TOP 9223372036854775807 WITH TIES fci.MONEDA, 
		fci.FECHA, 
		fci.SALDO_AL_CORTE, 
		fci.SALDO_AJUSTADO
FROM (	SELECT SALDOS.MONEDA, 
			GRL_SALDOS_DIARIOS.FECHA, 
			sum(GRL_SALDOS_DIARIOS.SALDO_AL_CORTE) AS SALDO_AL_CORTE, 
			sum(GRL_SALDOS_DIARIOS.SALDO_AJUSTADO) AS SALDO_AJUSTADO
        FROM dbo.SALDOS WITH(NOLOCK)
		INNER JOIN dbo.GRL_SALDOS_DIARIOS WITH(NOLOCK) ON 
													GRL_SALDOS_DIARIOS.SALDOS_JTS_OID = SALDOS.JTS_OID 
													AND (GRL_SALDOS_DIARIOS.RUBROCONTABLE < 60000000 OR GRL_SALDOS_DIARIOS.RUBROCONTABLE > 69999999) 
													AND (	(SALDOS.TZ_LOCK < 300000000000000 OR SALDOS.TZ_LOCK >= 400000000000000) 
														AND (GRL_SALDOS_DIARIOS.TZ_LOCK < 300000000000000 OR GRL_SALDOS_DIARIOS.TZ_LOCK >= 400000000000000))
        GROUP BY SALDOS.MONEDA, GRL_SALDOS_DIARIOS.FECHA
    )  AS fci
ORDER BY fci.MONEDA ASC; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VVAL_ESTADOCUENTAVALORES'')
DROP view [dbo].VVAL_ESTADOCUENTAVALORES; ')
execute(' CREATE OR ALTER   VIEW [dbo].[VVAL_ESTADOCUENTAVALORES] (
													   CODIGOCLIENTE, 
													   NOMBRE, 
													   MONEDAEMISION, 
													   NOMBREPAPEL, 
													   CALIFICADORA, 
													   CALIFICACION, 
													   COMISIONNOMINAL, 
													   COMISIONCUPONES, 
													   TASA, 
													   FECHAINICIAL, 
													   PRECIOCOMPRA, 
													   PRECIOVALUACION, 
													   INTERESESCORRIDOS, 
													   TOTALALAFECHA, 
													   VALORNOMINAL, 
													   PRECIOMERCADO, 
													   TIPOENVIO, 
													   FECHAVENCIMIENTO, 
													   CODTITULO)
AS 
 
SELECT DISTINCT 
		L.CODIGOCLIENTE AS CODIGOCLIENTE, 
		L.NOMBRECLIENTE AS NOMBRE, 
		T.MONEDAEMISION AS MONEDAEMISION, 
		T.NOMBREPAPEL AS NOMBREPAPEL, 
		T.CALIFICADORA AS CALIFICADORA, 
		T.CALIFICACION AS CALIFICACION, 
		T.COMISCUSTNOMINAL AS COMISIONNOMINAL, 
		T.COMISCUSTCUPONES AS COMISIONCUPONES, 
		S.C1632 AS TASA, 
		S.C1621 AS FECHAINICIAL, 
		S.C6672 AS PRECIOCOMPRA, 
		S.C6673 AS PRECIOVALUACION, 
		S.C1611 AS INTERESESCORRIDOS, 
		S.C1600 AS TOTALALAFECHA, 
		S.C6674 AS VALORNOMINAL, 
		Z.PRECIO AS PRECIOMERCADO, 
		I.TIPOENVIO AS TIPOENVIO, 
		T.FECHAVENCIMIENTO AS FECHAVENCIMIENTO, 
		T.CODTITULO AS CODTITULO
FROM dbo.SALDOS  AS S WITH(NOLOCK)
INNER JOIN dbo.CLI_CLIENTES  AS L WITH(NOLOCK) ON S.C1803 = L.CODIGOCLIENTE 
INNER JOIN dbo.VAL_TITULOS  AS T WITH(NOLOCK) ON S.OPERACION = T.CODTITULO 
INNER JOIN dbo.VAL_COTIZACIONVALORES  AS Z WITH(NOLOCK) ON T.CODTITULO = Z.CODIGOTITULO 
INNER JOIN dbo.VAL_CUENTAINVERSION  AS I WITH(NOLOCK) ON S.C1803 = I.CODIGOCLIENTE 
INNER JOIN dbo.SUCURSALES  AS Q WITH(NOLOCK) ON Q.SUCURSAL = S.SUCURSAL 
INNER JOIN dbo.VAL_ESQUEMASRUBROS  AS E WITH(NOLOCK) ON S.C1804 = E.RUBNEGOCIACION 
														OR S.C1804 = E.RUBTRADING 
														OR S.C1804 = E.RUBVENCIMIENTO 
														OR S.C1804 = E.RUBACTSIMPLE 
														OR S.C1804 = E.RUBACTGARANTIA; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SALDOS_FUERA_LIMITE'')
DROP view [dbo].VW_SALDOS_FUERA_LIMITE; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_SALDOS_FUERA_LIMITE] (
													   CODIGOCLIENTE, 
													   RIESGO, 
													   SALDO_SOLICITUD, 
													   IDENTIFICACION, 
													   CAPITAL_MONEDA_LIMITE)
AS 
SELECT 
    CLI_CLIENTES.CODIGOCLIENTE, 
    NULL AS RIESGO, 
    ''X'' AS SALDO_SOLICITUD, 
    SALDOS.JTS_OID AS IDENTIFICACION, 
    0 AS CAPITAL_MONEDA_LIMITE
FROM dbo.CLI_CLIENTES WITH (NOLOCK)
INNER JOIN dbo.CRE_LIMITEINST  WITH (NOLOCK) ON CLI_CLIENTES.CODIGOCLIENTE = CRE_LIMITEINST.INSTITUCION 
												AND CLI_CLIENTES.TIPO = ''I'' 
												AND (CLI_CLIENTES.TZ_LOCK < 300000000000000 OR CLI_CLIENTES.TZ_LOCK >= 400000000000000) 
												AND(CRE_LIMITEINST.TZ_LOCK < 300000000000000 OR CRE_LIMITEINST.TZ_LOCK >= 400000000000000) 
INNER JOIN dbo.SALDOS  WITH (NOLOCK)ON SALDOS.C1803 = CLI_CLIENTES.CODIGOCLIENTE 
									AND (SALDOS.TZ_LOCK < 300000000000000 OR SALDOS.TZ_LOCK >= 400000000000000) 
INNER JOIN dbo.PRODUCTOS  WITH (NOLOCK)ON SALDOS.PRODUCTO = PRODUCTOS.C6250 
										AND PRODUCTOS.C6252 IN ( 5, 6, 7 ) 
										AND PRODUCTOS.EVALUA_DEUDA = ''S'' 
										AND SALDOS.C1604 < 0 
										AND (PRODUCTOS.TZ_LOCK < 300000000000000 OR PRODUCTOS.TZ_LOCK >= 400000000000000)
WHERE SALDOS.JTS_OID NOT IN (	SELECT CRE_RESULTADO_LIMITE_CLIENTE.IDENTIFICACION
								FROM dbo.CRE_RESULTADO_LIMITE_CLIENTE  WITH (NOLOCK)
								WHERE CRE_RESULTADO_LIMITE_CLIENTE.SOLICITUD_CLIENTE = ''C'' 
								AND CRE_RESULTADO_LIMITE_CLIENTE.SALDO_SOLICITUD = ''A''); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VVAL_ORDENESCODNBCCLTE'')
DROP view [dbo].VVAL_ORDENESCODNBCCLTE; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VVAL_ORDENESCODNBCCLTE] (
													   CODIGOBCO, 
													   CODINTERNACIONAL, 
													   NROORDEN, 
													   CODCLIENTE, 
													   NOMBRECLIENTE, 
													   DESTINATARIO_REMITENTE, 
													   CODTITULO, 
													   TIPOFE, 
													   ESTADOORDEN, 
													   TIPOORDEN)
AS 
   
SELECT TOP 9223372036854775807 WITH TIES 
    T.CODIGOBCO, 
    T.CODINTERNACIONAL, 
    O.NROORDEN, 
    O.CODCLIENTE, 
    C.NOMBRECLIENTE, 
    O.DESTINATARIO_REMITENTE, 
    O.CODTITULO, 
    O.TIPOFE, 
    O.ESTADOORDEN, 
    O.TIPOORDEN
FROM dbo.VAL_TITULOS  AS T WITH (NOLOCK)
INNER JOIN dbo.VAL_ORDENES  AS O WITH (NOLOCK)ON T.CODTITULO = O.CODTITULO
												AND(	(O.TZ_LOCK < 300000000000000 OR O.TZ_LOCK >= 400000000000000) 
													AND (O.TZ_LOCK < 100000000000000 OR O.TZ_LOCK >= 200000000000000))
												AND(	(T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
													AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) 
INNER JOIN dbo.CLI_CLIENTES  AS C WITH (NOLOCK)ON O.CODCLIENTE = C.CODIGOCLIENTE
ORDER BY T.CODIGOBCO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_COFRES_CONTRATOS'')
DROP view [dbo].VW_COFRES_CONTRATOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_COFRES_CONTRATOS] ( TZ_LOCK,
											SECTOR,
											NUMERO_COFRE,
											CODIGO_COFRE,
											ESTADO_COFRE,
											CODIGO_CONTRATO,
											ESTADO,
											CLIENTE,
											NOMBRE_CLIENTE,
											FECHA_INICIO,
											FECHA_VENCIMIENTO,
											MONEDA,
											IMPORTE,
											CANT_VISITAS_CORTESIA,
											CANT_VISITAS_EFECTUADAS,
											FORMA_PAGO,
											CUENTA_DEBITO,
											BONIFICACION,
											ACTUACION_AUTORIZADOS,
											RETIENE_CORRESPONDENCIA,
											DIRECCION_CORRESPONDENCIA,
											OBSERVACIONES,
											ACTUACION_TITULARES,
											CONTRATO_MIGRADO,
											SUCURSAL_DEBITO,
											PRODUCTO_DEBITO,
											OPERACION_DEBITO,
											ORDINAL_DEBITO,
											MONEDA_DEBITO,
											DEPENDENCIA,
											NOMBRE_DEPENDENCIA,
											TIPODOCUMENTO,
											NUMERODOCUMENTO
											) AS
SELECT
	0 AS TZ_LOCK,
	C.SECTOR,
	C.NUMERO_COFRE,
	CC.CODIGO_COFRE,
	C.ESTADO AS ESTADO_COFRE,
	CC.CODIGO AS CODIGO_CONTRATO,
	CC.ESTADO,
	CC.CLIENTE,
	CL.NOMBRECLIENTE AS NOMBRE_CLIENTE,
	CC.FECHA_INICIO,
	CC.FECHA_VENCIMIENTO,
	CC.MONEDA,
	CC.IMPORTE,
	CC.CANT_VISITAS_CORTESIA,
	CC.CANT_VISITAS_EFECTUADAS,
	CC.FORMA_PAGO,
	CC.CUENTA_DEBITO,
	CC.BONIFICACION,
	CC.ACTUACION_AUTORIZADOS,
	CC.RETIENE_CORRESPONDENCIA,
	CC.DIRECCION_CORRESPONDENCIA,
	CC.OBSERVACIONES,
	CC.ACTUACION_TITULARES,
	CC.CONTRATO_MIGRADO,
	CC.SUCURSAL_DEBITO,
	CC.PRODUCTO_DEBITO,
	CC.OPERACION_DEBITO,
	CC.ORDINAL_DEBITO,
	CC.MONEDA_DEBITO,
	C.DEPENDENCIA,
	S.NOMBRESUCURSAL AS NOMBRE_DEPENDENCIA,
	D.TIPODOCUMENTO,
	D.NUMERODOCUMENTO
FROM COF_COFRES_CONTRATOS AS CC WITH (NOLOCK)
INNER JOIN COF_COFRES AS C WITH (NOLOCK) ON CC.CODIGO_COFRE = C.CODIGO
											AND C.TZ_LOCK = 0
											AND CC.TZ_LOCK = 0
INNER JOIN SUCURSALES AS S WITH (NOLOCK) ON C.DEPENDENCIA = S.SUCURSAL
											AND S.TZ_LOCK = 0
INNER JOIN CLI_CLIENTES AS CL WITH (NOLOCK) ON CC.CLIENTE = CL.CODIGOCLIENTE
												AND CL.TZ_LOCK = 0
												AND CC.TZ_LOCK = 0
INNER JOIN CLI_CLIENTEPERSONA AS CP WITH (NOLOCK) ON CL.CODIGOCLIENTE = CP.CODIGOCLIENTE 
													AND CP.TZ_LOCK = 0
													AND CP.TITULARIDAD = ''T''
INNER JOIN CLI_DOCUMENTOSPFPJ AS D WITH (NOLOCK) ON CP.NUMEROPERSONA = D.NUMEROPERSONAFJ 
													AND D.TZ_LOCK = 0; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SALDOS_MOV_CONT'')
DROP view [dbo].VW_SALDOS_MOV_CONT; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_SALDOS_MOV_CONT] (
												   JTS_OID_MOV, 
												   FECHAPROCESO, 
												   DEBITO, 
												   CREDITO)
AS 
SELECT	fci.JTS_OID_MOV, 
		fci.FECHAPROCESO, sum(fci.DEBITO) AS DEBITO,
		sum(fci.CREDITO) AS CREDITO
FROM 
    (	SELECT S.JTS_OID AS JTS_OID_MOV, 
			M.FECHAPROCESO, 
			CASE 
				WHEN M.DEBITOCREDITO = ''D'' THEN M.CAPITALREALIZADO
				ELSE 0
			END AS DEBITO, 
			CASE 
				WHEN M.DEBITOCREDITO = ''C'' THEN M.CAPITALREALIZADO
				ELSE 0
			END AS CREDITO
        FROM dbo.SALDOS  AS S WITH (NOLOCK)
		INNER JOIN dbo.MOVIMIENTOS_CONTABLES  AS M WITH (NOLOCK) ON M.SUCURSAL_CUENTA = S.SUCURSAL
																AND M.PRODUCTO = S.PRODUCTO
																AND M.CUENTA = S.CUENTA 
																AND M.MONEDA = S.MONEDA 
																AND M.OPERACION_CUENTA = S.OPERACION 
																AND M.ORDINAL_CUENTA = S.ORDINAL 														
		INNER JOIN dbo.ASIENTOS  AS A  WITH (NOLOCK)ON A.FECHAPROCESO = M.FECHAPROCESO
													AND A.ASIENTO = M.ASIENTO
													AND A.SUCURSAL = M.SUCURSAL
													AND A.ESTADO = 77
        WHERE (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
			AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))  
    )  AS fci
GROUP BY fci.JTS_OID_MOV, 
		fci.FECHAPROCESO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VVAL_SALDOSRUBROSESQUEMAS'')
DROP view [dbo].VVAL_SALDOSRUBROSESQUEMAS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VVAL_SALDOSRUBROSESQUEMAS] (
													   COD, 
													   OPERACION, 
													   C1627, 
													   C1804, 
													   C1604, 
													   C6674)
AS 
   
SELECT 
    1 AS COD, 
    SALDOS.OPERACION, 
    SALDOS.C1627, 
    SALDOS.C1804, 
    sum(SALDOS.C1604) * (-1) AS C1604, 
    sum(SALDOS.C6674) * (-1) AS C6674
FROM(	SELECT	VAL_TITULOS.CODTITULO, 
				VAL_ESQUEMASRUBROS.RUBNEGOCIACION
        FROM dbo.VAL_TITULOS WITH (NOLOCK) 
        INNER JOIN dbo.VAL_ESQUEMASRUBROS  WITH (NOLOCK)
            ON VAL_TITULOS.ESQUEMARUBRO = VAL_ESQUEMASRUBROS.CODIGO 
				AND (	(VAL_TITULOS.TZ_LOCK < 300000000000000 OR VAL_TITULOS.TZ_LOCK >= 400000000000000) 
					AND (VAL_TITULOS.TZ_LOCK < 100000000000000 OR VAL_TITULOS.TZ_LOCK >= 200000000000000)) 
				AND(	(VAL_ESQUEMASRUBROS.TZ_LOCK < 300000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 400000000000000) 
					AND (VAL_ESQUEMASRUBROS.TZ_LOCK < 100000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 200000000000000))
    )  AS fci 
        INNER JOIN dbo.SALDOS WITH (NOLOCK) 
        ON 
        fci.RUBNEGOCIACION = SALDOS.C1804 AND 
        fci.CODTITULO = SALDOS.OPERACION AND 
        (		(SALDOS.TZ_LOCK < 300000000000000 OR SALDOS.TZ_LOCK >= 400000000000000) 
			AND (SALDOS.TZ_LOCK < 100000000000000 OR SALDOS.TZ_LOCK >= 200000000000000))
GROUP BY 
    SALDOS.OPERACION, 
    SALDOS.C1804, 
    SALDOS.C1627
UNION
   SELECT 
      2 AS COD, 
      SALDOS.OPERACION, 
      SALDOS.C1627, 
      SALDOS.C1804, 
      sum(SALDOS.C1604) * (-1) AS C1604, 
      sum(SALDOS.C6674) * (-1) AS C6674
   FROM 
      (
         SELECT VAL_TITULOS.CODTITULO, 
				VAL_ESQUEMASRUBROS.RUBTRADING
         FROM dbo.VAL_TITULOS  WITH (NOLOCK)
         INNER JOIN dbo.VAL_ESQUEMASRUBROS  WITH (NOLOCK)
               ON VAL_TITULOS.ESQUEMARUBRO = VAL_ESQUEMASRUBROS.CODIGO 
				  AND (	(VAL_TITULOS.TZ_LOCK < 300000000000000 OR VAL_TITULOS.TZ_LOCK >= 400000000000000) 
					AND (VAL_TITULOS.TZ_LOCK < 100000000000000 OR VAL_TITULOS.TZ_LOCK >= 200000000000000)) 
				AND(	(VAL_ESQUEMASRUBROS.TZ_LOCK < 300000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 400000000000000) 
					AND (VAL_ESQUEMASRUBROS.TZ_LOCK < 100000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 200000000000000))
      )  AS fci 
         INNER JOIN dbo.SALDOS WITH (NOLOCK) ON 
            fci.RUBTRADING = SALDOS.C1804 
			AND fci.CODTITULO = SALDOS.OPERACION 
			AND (	(SALDOS.TZ_LOCK < 300000000000000 OR SALDOS.TZ_LOCK >= 400000000000000) 
				AND (SALDOS.TZ_LOCK < 100000000000000 OR SALDOS.TZ_LOCK >= 200000000000000))
   GROUP BY 
      SALDOS.OPERACION, 
      SALDOS.C1804, 
      SALDOS.C1627
UNION
   SELECT 
      3 AS COD, 
      SALDOS.OPERACION, 
      SALDOS.C1627, 
      SALDOS.C1804, 
      sum(SALDOS.C1604) * (-1) AS C1604, 
      sum(SALDOS.C6674) * (-1) AS C6674
   FROM 
      (
         SELECT VAL_TITULOS.CODTITULO, VAL_ESQUEMASRUBROS.RUBVENCIMIENTO
         FROM dbo.VAL_TITULOS WITH (NOLOCK) 
         INNER JOIN dbo.VAL_ESQUEMASRUBROS  WITH (NOLOCK)
               ON VAL_TITULOS.ESQUEMARUBRO = VAL_ESQUEMASRUBROS.CODIGO 
			   AND(	(VAL_TITULOS.TZ_LOCK < 300000000000000 OR VAL_TITULOS.TZ_LOCK >= 400000000000000) 
				AND (VAL_TITULOS.TZ_LOCK < 100000000000000 OR VAL_TITULOS.TZ_LOCK >= 200000000000000)) 
			AND (	(VAL_ESQUEMASRUBROS.TZ_LOCK < 300000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 400000000000000) 
				AND (VAL_ESQUEMASRUBROS.TZ_LOCK < 100000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 200000000000000))
      )  AS fci 
         INNER JOIN dbo.SALDOS WITH (NOLOCK) 
										 ON fci.RUBVENCIMIENTO = SALDOS.C1804 
											AND fci.CODTITULO = SALDOS.OPERACION 
											AND (	(SALDOS.TZ_LOCK < 300000000000000 OR SALDOS.TZ_LOCK >= 400000000000000) 
												AND (SALDOS.TZ_LOCK < 100000000000000 OR SALDOS.TZ_LOCK >= 200000000000000))
   GROUP BY 
      SALDOS.OPERACION, 
      SALDOS.C1804, 
      SALDOS.C1627
UNION
   SELECT 
      4 AS COD, 
      SALDOS.OPERACION, 
      SALDOS.C1627, 
      SALDOS.C1804, 
      sum(SALDOS.C1604) AS C1604, 
      sum(SALDOS.C6674) AS C6674
   FROM( SELECT VAL_TITULOS.CODTITULO, 
				VAL_ESQUEMASRUBROS.RUBACTSIMPLE
         FROM dbo.VAL_TITULOS  WITH (NOLOCK)
         INNER JOIN dbo.VAL_ESQUEMASRUBROS  WITH (NOLOCK) ON 
                  VAL_TITULOS.ESQUEMARUBRO = VAL_ESQUEMASRUBROS.CODIGO 
				AND(	(VAL_TITULOS.TZ_LOCK < 300000000000000 OR VAL_TITULOS.TZ_LOCK >= 400000000000000) 
					AND (VAL_TITULOS.TZ_LOCK < 100000000000000 OR VAL_TITULOS.TZ_LOCK >= 200000000000000)) 
				AND (	(VAL_ESQUEMASRUBROS.TZ_LOCK < 300000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 400000000000000) 
					AND (VAL_ESQUEMASRUBROS.TZ_LOCK < 100000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 200000000000000))
      )  AS fci 
         INNER JOIN dbo.SALDOS WITH (NOLOCK)ON fci.RUBACTSIMPLE = SALDOS.C1804 
			AND fci.CODTITULO = SALDOS.OPERACION 
			AND(	(SALDOS.TZ_LOCK < 300000000000000 OR SALDOS.TZ_LOCK >= 400000000000000) 
				AND (SALDOS.TZ_LOCK < 100000000000000 OR SALDOS.TZ_LOCK >= 200000000000000))
   GROUP BY 
      SALDOS.OPERACION, 
      SALDOS.C1804, 
      SALDOS.C1627
UNION
   SELECT 
      5 AS COD, 
      SALDOS.OPERACION, 
      SALDOS.C1627, 
      SALDOS.C1804, 
      sum(SALDOS.C1604) AS C1604, 
      sum(SALDOS.C6674) AS C6674
   FROM 
      (
         SELECT VAL_TITULOS.CODTITULO, 
				VAL_ESQUEMASRUBROS.RUBPASSIMPLE
         FROM dbo.VAL_TITULOS  WITH (NOLOCK)
         INNER JOIN dbo.VAL_ESQUEMASRUBROS WITH (NOLOCK) 
               ON VAL_TITULOS.ESQUEMARUBRO = VAL_ESQUEMASRUBROS.CODIGO 
			   AND(		(VAL_TITULOS.TZ_LOCK < 300000000000000 OR VAL_TITULOS.TZ_LOCK >= 400000000000000) 
					AND (VAL_TITULOS.TZ_LOCK < 100000000000000 OR VAL_TITULOS.TZ_LOCK >= 200000000000000)) 
				AND(	(VAL_ESQUEMASRUBROS.TZ_LOCK < 300000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 400000000000000) 
					AND (VAL_ESQUEMASRUBROS.TZ_LOCK < 100000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 200000000000000))
      )  AS fci 
         INNER JOIN dbo.SALDOS WITH (NOLOCK) 
         ON	fci.RUBPASSIMPLE = SALDOS.C1804 
			AND fci.CODTITULO = SALDOS.OPERACION 
			AND(	(SALDOS.TZ_LOCK < 300000000000000 OR SALDOS.TZ_LOCK >= 400000000000000) 
				AND (SALDOS.TZ_LOCK < 100000000000000 OR SALDOS.TZ_LOCK >= 200000000000000))
   GROUP BY 
      SALDOS.OPERACION, 
      SALDOS.C1804, 
      SALDOS.C1627
UNION
   SELECT 
      6 AS COD, 
      SALDOS.OPERACION, 
      SALDOS.C1627, 
      SALDOS.C1804, 
      sum(SALDOS.C1604) AS C1604, 
      sum(SALDOS.C6674) AS C6674
   FROM 
      (
         SELECT VAL_TITULOS.CODTITULO, 
				VAL_ESQUEMASRUBROS.RUBACTGARANTIA
         FROM dbo.VAL_TITULOS  WITH (NOLOCK)
         INNER JOIN dbo.VAL_ESQUEMASRUBROS  WITH (NOLOCK)
														   ON 
															  VAL_TITULOS.ESQUEMARUBRO = VAL_ESQUEMASRUBROS.CODIGO 
															AND (	(VAL_TITULOS.TZ_LOCK < 300000000000000 OR VAL_TITULOS.TZ_LOCK >= 400000000000000) 
																AND (VAL_TITULOS.TZ_LOCK < 100000000000000 OR VAL_TITULOS.TZ_LOCK >= 200000000000000)) 
															AND(	(VAL_ESQUEMASRUBROS.TZ_LOCK < 300000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 400000000000000) 
																AND (VAL_ESQUEMASRUBROS.TZ_LOCK < 100000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 200000000000000))
      )  AS fci 
         INNER JOIN dbo.SALDOS WITH (NOLOCK) ON 
												fci.RUBACTGARANTIA = SALDOS.C1804 
												AND fci.CODTITULO = SALDOS.OPERACION 
												AND(	(SALDOS.TZ_LOCK < 300000000000000 OR SALDOS.TZ_LOCK >= 400000000000000) 
													AND (SALDOS.TZ_LOCK < 100000000000000 OR SALDOS.TZ_LOCK >= 200000000000000))
   GROUP BY 
      SALDOS.OPERACION, 
      SALDOS.C1804, 
      SALDOS.C1627
    UNION
   SELECT 
      7 AS COD, 
      SALDOS.OPERACION, 
      SALDOS.C1627, 
      SALDOS.C1804, 
      sum(SALDOS.C1604) AS C1604, 
      sum(SALDOS.C6674) AS C6674
   FROM 
      (
         SELECT VAL_TITULOS.CODTITULO, 
				VAL_ESQUEMASRUBROS.RUBPASGARANTIA
         FROM dbo.VAL_TITULOS  WITH (NOLOCK)
         INNER JOIN dbo.VAL_ESQUEMASRUBROS  WITH (NOLOCK) ON 
														  VAL_TITULOS.ESQUEMARUBRO = VAL_ESQUEMASRUBROS.CODIGO 
														AND (	(VAL_TITULOS.TZ_LOCK < 300000000000000 OR VAL_TITULOS.TZ_LOCK >= 400000000000000) 
															AND (VAL_TITULOS.TZ_LOCK < 100000000000000 OR VAL_TITULOS.TZ_LOCK >= 200000000000000)) 
														AND (	(VAL_ESQUEMASRUBROS.TZ_LOCK < 300000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 400000000000000) 
															AND (VAL_ESQUEMASRUBROS.TZ_LOCK < 100000000000000 OR VAL_ESQUEMASRUBROS.TZ_LOCK >= 200000000000000))
      )  AS fci 
         INNER JOIN dbo.SALDOS WITH (NOLOCK) ON 
												fci.RUBPASGARANTIA = SALDOS.C1804 
												AND fci.CODTITULO = SALDOS.OPERACION 
												AND(	(SALDOS.TZ_LOCK < 300000000000000 OR SALDOS.TZ_LOCK >= 400000000000000) 
													AND (SALDOS.TZ_LOCK < 100000000000000 OR SALDOS.TZ_LOCK >= 200000000000000))
   GROUP BY 
      SALDOS.OPERACION, 
      SALDOS.C1804, 
      SALDOS.C1627; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VVAL_VISTAPRODUCTOS'')
DROP view [dbo].VVAL_VISTAPRODUCTOS; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VVAL_VISTAPRODUCTOS] (
												   NUMEROPRODUCTO, 
												   TIPOTASA, 
												   NUMERADOR, 
												   DIVISOR, 
												   TIPOPRODUCTO)
AS 

SELECT 
    PRODUCTOS.C6250 AS NUMEROPRODUCTO, 
    PRODUCTOS.C6253 AS TIPOTASA, 
    PRODUCTOS.C6254 AS NUMERADOR, 
    PRODUCTOS.C6255 AS DIVISOR, 
    PRODUCTOS.C6252 AS TIPOPRODUCTO
FROM dbo.PRODUCTOS WITH(NOLOCK); ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ACT_TJD_ATM_DIARIO'')
DROP view [dbo].VW_ACT_TJD_ATM_DIARIO; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_ACT_TJD_ATM_DIARIO] (
												   ID_TARJETA, 
												   TOPAZPROCESSDATE, 
												   COMPRA_12, 
												   COMPRA_15, 
												   COMPRA_16, 
												   DEPOSITO, 
												   CONSULTA, 
												   CONSULTA_TIPO_CAMBIO, 
												   CAMBIO_PIN, 
												   TRANSFERENCIA, 
												   STATEMENT_PRINT, 
												   AFILIACIONES_WEB_27, 
												   AFILIACIONES_WEB_82)
AS 
SELECT 
    fci.ID_TARJETA, 
    fci.TOPAZPROCESSDATE, 
    sum(fci.COMPRA_12) AS COMPRA_12, 
    sum(fci.COMPRA_15) AS COMPRA_15, 
    sum(fci.COMPRA_16) AS COMPRA_16, 
    sum(fci.DEPOSITO) AS DEPOSITO, 
    sum(fci.CONSULTA) AS CONSULTA, 
    sum(fci.CONSULTA_TIPO_CAMBIO) AS CONSULTA_TIPO_CAMBIO, 
    sum(fci.CAMBIO_PIN) AS CAMBIO_PIN, 
    sum(fci.TRANSFERENCIA) AS TRANSFERENCIA, 
    sum(fci.STATEMENT_PRINT) AS STATEMENT_PRINT, 
    sum(fci.AFILIACIONES_WEB_27) AS AFILIACIONES_WEB_27, 
    sum(fci.AFILIACIONES_WEB_82) AS AFILIACIONES_WEB_82
FROM (	SELECT 
            fci$2.ID_TARJETA, 
            fci$2.TOPAZPROCESSDATE, 
            fci$2.ELEMENT0, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.COMPRA_12 * -1
               ELSE fci$2.COMPRA_12
            END AS COMPRA_12, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.COMPRA_15 * -1
               ELSE fci$2.COMPRA_15
            END AS COMPRA_15, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.COMPRA_16 * -1
               ELSE fci$2.COMPRA_16
            END AS COMPRA_16, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.DEPOSITO * -1
               ELSE fci$2.DEPOSITO
            END AS DEPOSITO, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.CONSULTA * -1
               ELSE fci$2.CONSULTA
            END AS CONSULTA, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.CONSULTA_TIPO_CAMBIO * -1
               ELSE fci$2.CONSULTA_TIPO_CAMBIO
            END AS CONSULTA_TIPO_CAMBIO, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.CAMBIO_PIN * -1
               ELSE fci$2.CAMBIO_PIN
            END AS CAMBIO_PIN, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.TRANSFERENCIA * -1
               ELSE fci$2.TRANSFERENCIA
            END AS TRANSFERENCIA, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.STATEMENT_PRINT * -1
               ELSE fci$2.STATEMENT_PRINT
            END AS STATEMENT_PRINT, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.AFILIACIONES_WEB_27 * -1
               ELSE fci$2.AFILIACIONES_WEB_27
            END AS AFILIACIONES_WEB_27, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.AFILIACIONES_WEB_82 * -1
               ELSE fci$2.AFILIACIONES_WEB_82
            END AS AFILIACIONES_WEB_82
         FROM 
            (
               SELECT 
                  fci$3.ID_TARJETA, 
                  fci$3.TOPAZPROCESSDATE, 
                  fci$3.ELEMENT0, 
                  1 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL.ELEMENT0, 
							TP_TOPAZPOSCONTROL.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL.ELEMENT3, 0, 2) = ''12''
                  )  AS fci$3
                UNION ALL
               SELECT 
                  fci$4.ID_TARJETA, 
                  fci$4.TOPAZPROCESSDATE, 
                  fci$4.ELEMENT0, 
                  0 AS COMPRA_12, 
                  1 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$2.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$2.ELEMENT0, 
							TP_TOPAZPOSCONTROL$2.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$2  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$2.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$2.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$2.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$2.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$2.ELEMENT3, 0, 2) = ''15''
                  )  AS fci$4
                UNION ALL
               SELECT 
                  fci$5.ID_TARJETA, 
                  fci$5.TOPAZPROCESSDATE, 
                  fci$5.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  1 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$3.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$3.ELEMENT0, 
							TP_TOPAZPOSCONTROL$3.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$3  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$3.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$3.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$3.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$3.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$3.ELEMENT3, 0, 2) = ''16''
                  )  AS fci$5
                UNION ALL
               SELECT 
                  fci$6.ID_TARJETA, 
                  fci$6.TOPAZPROCESSDATE, 
                  fci$6.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  1 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$4.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$4.ELEMENT0, 
							TP_TOPAZPOSCONTROL$4.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$4  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$4.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$4.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$4.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$4.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$4.ELEMENT3, 0, 2) = ''21''
                  )  AS fci$6
                UNION ALL
               SELECT 
                  fci$7.ID_TARJETA, 
                  fci$7.TOPAZPROCESSDATE, 
                  fci$7.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  1 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$5.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$5.ELEMENT0, 
							TP_TOPAZPOSCONTROL$5.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$5  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$5.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$5.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$5.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$5.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$5.ELEMENT3, 0, 2) = ''27''
                  )  AS fci$7
                UNION ALL
               SELECT 
                  fci$8.ID_TARJETA, 
                  fci$8.TOPAZPROCESSDATE, 
                  fci$8.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  1 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$6.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$6.ELEMENT0, 
							TP_TOPAZPOSCONTROL$6.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$6  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$6.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$6.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$6.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$6.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$6.ELEMENT3, 0, 2) = ''31''
                  )  AS fci$8
                UNION ALL
               SELECT 
                  fci$9.ID_TARJETA, 
                  fci$9.TOPAZPROCESSDATE, 
                  fci$9.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  1 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$7.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$7.ELEMENT0, 
							TP_TOPAZPOSCONTROL$7.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$7  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$7.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$7.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$7.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$7.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$7.ELEMENT3, 0, 2) = ''32''
                  )  AS fci$9
                UNION ALL
               SELECT 
                  fci$10.ID_TARJETA, 
                  fci$10.TOPAZPROCESSDATE, 
                  fci$10.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  1 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$8.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$8.ELEMENT0, 
							TP_TOPAZPOSCONTROL$8.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$8  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$8.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$8.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$8.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$8.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$8.ELEMENT3, 0, 2) = ''33''
                  )  AS fci$10
                UNION ALL
               SELECT 
                  fci$11.ID_TARJETA, 
                  fci$11.TOPAZPROCESSDATE, 
                  fci$11.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  1 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$9.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$9.ELEMENT0, 
							TP_TOPAZPOSCONTROL$9.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$9  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$9.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$9.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$9.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$9.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$9.ELEMENT3, 0, 2) = ''40''
                  )  AS fci$11
                UNION ALL
               SELECT 
                  fci$12.ID_TARJETA, 
                  fci$12.TOPAZPROCESSDATE, 
                  fci$12.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  1 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$10.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$10.ELEMENT0, 
							TP_TOPAZPOSCONTROL$10.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$10  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$10.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$10.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$10.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$10.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$10.ELEMENT3, 0, 2) = ''82''
                  )  AS fci$12
                UNION ALL
               SELECT 
                  fci$13.ID_TARJETA, 
                  fci$13.TOPAZPROCESSDATE, 
                  fci$13.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  1 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT SUBSTRING(TP_TOPAZPOSCONTROL$11.ELEMENT35, 0, 19) AS ID_TARJETA, 
							TP_TOPAZPOSCONTROL$11.ELEMENT0, 
							SUBSTRING(TP_TOPAZPOSCONTROL$11.ELEMENT3, 0, 2) AS TIPO, 
							TP_TOPAZPOSCONTROL$11.TOPAZPROCESSDATE
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$11  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$11.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$11.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$11.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$11.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$11.ELEMENT3, 0, 2) = ''94''
                  )  AS fci$13
            )  AS fci$2
      )  AS fci
   GROUP BY fci.ID_TARJETA, 
			fci.TOPAZPROCESSDATE; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_SALDOS_CONTABLES'')
DROP view [dbo].VW_SALDOS_CONTABLES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_SALDOS_CONTABLES](
												Cuenta,
												Nombre,
												Producto,
												Descripción,
												Moneda,
												Desc_Moneda,
												Sucursal,
												Ordinal,
												Operación,
												Rubro
) AS 
SELECT	S.CUENTA, 
		L.C6300, 
		S.PRODUCTO, 
		P.C6251, 
		S.MONEDA, 
		M.C6400, 
		S.SUCURSAL, 
		S.ORDINAL, 
		S.OPERACION,
		S.C1730
FROM SALDOS AS S WITH (NOLOCK)
INNER JOIN PRODUCTOS AS P WITH (NOLOCK) ON S.PRODUCTO = P.C6250 
										AND S.C1785 = P.C6252
										AND P.TZ_LOCK = 0
INNER JOIN MONEDAS AS M WITH (NOLOCK) ON S.MONEDA = M.C6399
INNER JOIN PLANCTAS AS L WITH (NOLOCK) ON S.CUENTA = L.C6326
WHERE S.TZ_LOCK = 0  AND S.C1785 = 1; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_ACT_TJD_ATM_MES'')
DROP view [dbo].VW_ACT_TJD_ATM_MES; ')
execute(' CREATE OR ALTER     VIEW [dbo].[VW_ACT_TJD_ATM_MES] (
												   ID_TARJETA, 
												   MES, 
												   ANIO, 
												   COMPRA_12, 
												   COMPRA_15, 
												   COMPRA_16, 
												   DEPOSITO, 
												   CONSULTA, 
												   CONSULTA_TIPO_CAMBIO, 
												   CAMBIO_PIN, 
												   TRANSFERENCIA, 
												   STATEMENT_PRINT, 
												   AFILIACIONES_WEB_27, 
												   AFILIACIONES_WEB_82)
AS 

   SELECT 
      fci.ID_TARJETA, 
      fci.MES, 
      fci.ANIO, 
      sum(fci.COMPRA_12) AS COMPRA_12, 
      sum(fci.COMPRA_15) AS COMPRA_15, 
      sum(fci.COMPRA_16) AS COMPRA_16, 
      sum(fci.DEPOSITO) AS DEPOSITO, 
      sum(fci.CONSULTA) AS CONSULTA, 
      sum(fci.CONSULTA_TIPO_CAMBIO) AS CONSULTA_TIPO_CAMBIO, 
      sum(fci.CAMBIO_PIN) AS CAMBIO_PIN, 
      sum(fci.TRANSFERENCIA) AS TRANSFERENCIA, 
      sum(fci.STATEMENT_PRINT) AS STATEMENT_PRINT, 
      sum(fci.AFILIACIONES_WEB_27) AS AFILIACIONES_WEB_27, 
      sum(fci.AFILIACIONES_WEB_82) AS AFILIACIONES_WEB_82
   FROM 
      (
         SELECT 
            fci$2.ID_TARJETA, 
            fci$2.MES, 
            fci$2.ANIO, 
            fci$2.ELEMENT0, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.COMPRA_12 * -1
               ELSE fci$2.COMPRA_12
            END AS COMPRA_12, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.COMPRA_15 * -1
               ELSE fci$2.COMPRA_15
            END AS COMPRA_15, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.COMPRA_16 * -1
               ELSE fci$2.COMPRA_16
            END AS COMPRA_16, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.DEPOSITO * -1
               ELSE fci$2.DEPOSITO
            END AS DEPOSITO, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.CONSULTA * -1
               ELSE fci$2.CONSULTA
            END AS CONSULTA, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.CONSULTA_TIPO_CAMBIO * -1
               ELSE fci$2.CONSULTA_TIPO_CAMBIO
            END AS CONSULTA_TIPO_CAMBIO, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.CAMBIO_PIN * -1
               ELSE fci$2.CAMBIO_PIN
            END AS CAMBIO_PIN, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.TRANSFERENCIA * -1
               ELSE fci$2.TRANSFERENCIA
            END AS TRANSFERENCIA, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.STATEMENT_PRINT * -1
               ELSE fci$2.STATEMENT_PRINT
            END AS STATEMENT_PRINT, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.AFILIACIONES_WEB_27 * -1
               ELSE fci$2.AFILIACIONES_WEB_27
            END AS AFILIACIONES_WEB_27, 
            CASE 
               WHEN fci$2.ELEMENT0 = 0430 THEN fci$2.AFILIACIONES_WEB_82 * -1
               ELSE fci$2.AFILIACIONES_WEB_82
            END AS AFILIACIONES_WEB_82
         FROM 
            (
               SELECT 
                  fci$3.ID_TARJETA, 
                  fci$3.MES, 
                  fci$3.ANIO, 
                  fci$3.ELEMENT0, 
                  1 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL.ELEMENT3, 0, 2) = ''12''
                  )  AS fci$3
                UNION ALL
               SELECT 
                  fci$4.ID_TARJETA, 
                  fci$4.MES, 
                  fci$4.ANIO, 
                  fci$4.ELEMENT0, 
                  0 AS COMPRA_12, 
                  1 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$2.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$2.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$2.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$2.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$2.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$2  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$2.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$2.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$2.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$2.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$2.ELEMENT3, 0, 2) = ''15''
                  )  AS fci$4
                UNION ALL
               SELECT 
                  fci$5.ID_TARJETA, 
                  fci$5.MES, 
                  fci$5.ANIO, 
                  fci$5.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  1 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$3.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$3.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$3.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$3.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$3.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$3  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$3.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$3.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$3.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$3.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$3.ELEMENT3, 0, 2) = ''16''
                  )  AS fci$5
                UNION ALL
               SELECT 
                  fci$6.ID_TARJETA, 
                  fci$6.MES, 
                  fci$6.ANIO, 
                  fci$6.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  1 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$4.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$4.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$4.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$4.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$4.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$4  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$4.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$4.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$4.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$4.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$4.ELEMENT3, 0, 2) = ''21''
                  )  AS fci$6
                UNION ALL
               SELECT 
                  fci$7.ID_TARJETA, 
                  fci$7.MES, 
                  fci$7.ANIO, 
                  fci$7.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  1 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$5.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$5.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$5.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$5.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$5.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$5  WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$5.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$5.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$5.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$5.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$5.ELEMENT3, 0, 2) = ''27''
                  )  AS fci$7
                UNION ALL
               SELECT 
                  fci$8.ID_TARJETA, 
                  fci$8.MES, 
                  fci$8.ANIO, 
                  fci$8.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  1 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$6.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$6.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$6.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$6.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$6.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$6 WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$6.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$6.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$6.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$6.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$6.ELEMENT3, 0, 2) = ''31''
                  )  AS fci$8
                UNION ALL
               SELECT 
                  fci$9.ID_TARJETA, 
                  fci$9.MES, 
                  fci$9.ANIO, 
                  fci$9.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  1 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$7.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$7.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$7.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$7.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$7.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$7 WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$7.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$7.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$7.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$7.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$7.ELEMENT3, 0, 2) = ''32''
                  )  AS fci$9
                UNION ALL
               SELECT 
                  fci$10.ID_TARJETA, 
                  fci$10.MES, 
                  fci$10.ANIO, 
                  fci$10.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  1 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$8.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$8.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$8.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$8.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$8.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$8 WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$8.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$8.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$8.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$8.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$8.ELEMENT3, 0, 2) = ''33''
                  )  AS fci$10
                UNION ALL
               SELECT 
                  fci$11.ID_TARJETA, 
                  fci$11.MES, 
                  fci$11.ANIO, 
                  fci$11.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  1 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$9.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$9.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$9.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$9.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$9.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$9 WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$9.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$9.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$9.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$9.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$9.ELEMENT3, 0, 2) = ''40''
                  )  AS fci$11
                UNION ALL
               SELECT 
                  fci$12.ID_TARJETA, 
                  fci$12.MES, 
                  fci$12.ANIO, 
                  fci$12.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  0 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  1 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$10.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$10.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$10.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$10.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$10.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$10 WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$10.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$10.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$10.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$10.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$10.ELEMENT3, 0, 2) = ''82''
                  )  AS fci$12
                UNION ALL
               SELECT 
                  fci$13.ID_TARJETA, 
                  fci$13.MES, 
                  fci$13.ANIO, 
                  fci$13.ELEMENT0, 
                  0 AS COMPRA_12, 
                  0 AS COMPRA_15, 
                  0 AS COMPRA_16, 
                  0 AS DEPOSITO, 
                  0 AS CONSULTA, 
                  0 AS CONSULTA_TIPO_CAMBIO, 
                  0 AS CAMBIO_PIN, 
                  0 AS TRANSFERENCIA, 
                  1 AS STATEMENT_PRINT, 
                  0 AS AFILIACIONES_WEB_27, 
                  0 AS AFILIACIONES_WEB_82
               FROM 
                  (
                     SELECT 
                        SUBSTRING(TP_TOPAZPOSCONTROL$11.ELEMENT35, 0, 19) AS ID_TARJETA, 
                        TP_TOPAZPOSCONTROL$11.ELEMENT0, 
                        SUBSTRING(TP_TOPAZPOSCONTROL$11.ELEMENT3, 0, 2) AS TIPO, 
                        MONTH(TP_TOPAZPOSCONTROL$11.TOPAZPROCESSDATE) AS MES, 
                        CONVERT(varchar(4), TP_TOPAZPOSCONTROL$11.TOPAZPROCESSDATE, 102) AS ANIO
                     FROM dbo.TP_TOPAZPOSCONTROL  AS TP_TOPAZPOSCONTROL$11 WITH (NOLOCK)
                     WHERE 
                        TP_TOPAZPOSCONTROL$11.ELEMENT0 IN ( 0210, 0215, 0430 ) AND 
                        upper(TP_TOPAZPOSCONTROL$11.ELEMENT41) NOT LIKE ''%MIDDLEWARE%'' AND 
                        TP_TOPAZPOSCONTROL$11.ELEMENT66 = 3 AND 
                        TP_TOPAZPOSCONTROL$11.ELEMENT39 = 0 AND 
                        SUBSTRING(TP_TOPAZPOSCONTROL$11.ELEMENT3, 0, 2) = ''94''
                  )  AS fci$13
            )  AS fci$2
      )  AS fci
   GROUP BY 
      fci.ID_TARJETA, 
      fci.MES, 
      fci.ANIO; ')

execute(' IF  EXISTS (select * from sys.views where  name = ''VW_INTEGRANTESPJ'')
DROP view [dbo].VW_INTEGRANTESPJ; ')
execute(' CREATE OR ALTER VIEW [dbo].[VW_INTEGRANTESPJ] (
												[Tipo Documento Identificativo], 
												[Número Documento Identificativo],
												[Tipo Documento Físico],
												[Número Documento Físico],
												[Razón Social/Nombre],
												[Tipo Persona], 
												[Nivel de Apertura],
												[Estado Persona],
												[Motivo Inhabilitado],
												[Persona Jurídica],
												[Integrante PJ],
												[Tipo Vinculación],
												[Cargo]
												)
AS 
(	SELECT TOP 1000000000
		V.TIPODOCUMENTO , 
		V.NUMERODOCUMENTO ,
		V.TIPO_DOC_FISICO,
		V.NUM_DOC_FISICO,
		(U.RAZONSOCIAL) AS RAZONSOCIAL,
		V.TIPOPERSONA ,  
		(	SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA=''E'' 
			AND O.OPCIONINTERNA=U.NIVEL_APERTURA 
			AND O.NUMERODECAMPO = 2203) AS NIVEL_APERTURA,
		(	SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA=''E'' 
		AND O.OPCIONINTERNA=U.ESTADO 
		AND O.NUMERODECAMPO = 33367) AS ESTADO,   
		(	SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA=''E'' 
		AND O.OPCIONINTERNA=U.MOTIVO_INHABILITADO 
		AND O.NUMERODECAMPO = 33369) AS  MOTIVO_INHABILITADO,
		I.NUMEROPERSONAJURIDICA,
        I.NUMEROPERSONAFISICA,
		(	SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA=''E'' 
		AND O.OPCIONINTERNA=I.TIPOVINCULACION 
		AND O.NUMERODECAMPO = 1212) AS  TIPOVINCULACION,
		(	SELECT CARGO 
		FROM dbo.CLI_CARGOS_PERSONAS C WITH (NOLOCK) 
		WHERE C.CODIGO=I.CODIGOCARGO ) AS  CARGO
       
FROM dbo.CLI_PERSONASJURIDICAS  AS U WITH (NOLOCK)
INNER JOIN dbo.CLI_INTEGRANTESPJ AS I WITH (NOLOCK)ON I.NUMEROPERSONAFISICA = U.NUMEROPERSONAJURIDICA
													AND I.TZ_LOCK =0
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON I.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
													AND V.TIPOPERSONA = ''J''
WHERE 
		(U.TZ_LOCK < 300000000000000 or U.TZ_LOCK >= 400000000000000) 
		and (U.TZ_LOCK < 100000000000000 or U.TZ_LOCK >= 200000000000000)
	    AND (V.TZ_LOCK < 300000000000000 or V.TZ_LOCK >= 400000000000000) 
	    and (V.TZ_LOCK < 100000000000000 or V.TZ_LOCK >= 200000000000000)												
)
UNION ALL
  ( SELECT TOP 1000000000
      V.TIPODOCUMENTO , 
      V.NUMERODOCUMENTO ,
      V.TIPO_DOC_FISICO,
      V.NUM_DOC_FISICO,
      (F.APELLIDOPATERNO + '' '' + F.PRIMERNOMBRE) AS NOMBRES,
      V.TIPOPERSONA ,  
      (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA=''E'' 
		AND O.OPCIONINTERNA=F.NIVEL_APERTURA 
		AND O.NUMERODECAMPO = 2203) AS NIVEL_APERTURA,
      (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA=''E'' 
		AND O.OPCIONINTERNA=F.ESTADO 
		AND O.NUMERODECAMPO = 33366) AS ESTADO,   
	  (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA=''E'' 
		AND O.OPCIONINTERNA=F.MOTIVO_INHABILITADO 
		AND O.NUMERODECAMPO = 33368) AS  MOTIVO_INHABILITADO,
      I.NUMEROPERSONAJURIDICA,
      I.NUMEROPERSONAFISICA,
      (	SELECT DESCRIPCION 
		FROM OPCIONES O WITH (NOLOCK) 
		WHERE O.IDIOMA=''E'' 
		AND O.OPCIONINTERNA=I.TIPOVINCULACION 
		AND O.NUMERODECAMPO = 1212) AS  TIPOVINCULACION,
      (	SELECT CARGO 
		FROM dbo.CLI_CARGOS_PERSONAS C WITH (NOLOCK) 
		WHERE C.CODIGO=I.CODIGOCARGO ) AS  CARGO 
   FROM dbo.CLI_PERSONASFISICAS  AS F WITH (NOLOCK)
   INNER JOIN dbo.CLI_INTEGRANTESPJ AS I WITH (NOLOCK)ON I.NUMEROPERSONAFISICA = F.NUMEROPERSONAFISICA
													   	AND I.TZ_LOCK =0 
   INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON I.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
														AND V.TIPOPERSONA = ''F''
													   
        WHERE 
        (F.TZ_LOCK < 300000000000000 or F.TZ_LOCK >= 400000000000000) 
        and (F.TZ_LOCK < 100000000000000 or F.TZ_LOCK >= 200000000000000)
	    AND (V.TZ_LOCK < 300000000000000 or V.TZ_LOCK >= 400000000000000) 
	    and (V.TZ_LOCK < 100000000000000 or V.TZ_LOCK >= 200000000000000)
   
   ); ')


