EXECUTE('
ALTER TABLE VTA_CONT_CIERRE_CTA DROP COLUMN TIPO_CONTROL

DELETE FROM dbo.DICCIONARIO
WHERE NUMERODECAMPO = 34577
')

EXECUTE('
INSERT INTO dbo.DESCRIPTORES (TITULO, IDENTIFICACION, TIPODEARCHIVO, DESCRIPCION, GRUPODELMAPA, NOMBREFISICO, TIPODEDBMS, LARGODELREGISTRO, INICIALIZACIONDELREGISTRO, BASE, SELECCION, ACEPTA_MOVS_DIFERIDO)
VALUES (35, 3530, NULL, ''VTA_CONTROLES_CIERRE_CTA'', 0, ''VTA_CONTROLES_CIERRE_CTA'', ''D'', NULL, NULL, ''TOP/CLIENTES'', NULL, ''N'')


INSERT INTO dbo.INDICES (NUMERODEARCHIVO, NUMERODEINDICE, DESCRIPCION, CLAVESREPETIDAS, CAMPO1, CAMPO2, CAMPO3, CAMPO4, CAMPO5, CAMPO6, CAMPO7, CAMPO8, CAMPO9, CAMPO10, CAMPO11, CAMPO12, CAMPO13, CAMPO14, CAMPO15, CAMPO16, CAMPO17, CAMPO18, CAMPO19, CAMPO20)
VALUES (3530, 0, NULL, 0, 35352, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL)
')

EXECUTE('
IF OBJECT_ID (''dbo.VTA_CONTROLES_CIERRE_CTA'') IS NOT NULL
	DROP TABLE dbo.VTA_CONTROLES_CIERRE_CTA
')

EXECUTE('
CREATE TABLE dbo.VTA_CONTROLES_CIERRE_CTA
	(
	CONTROL     NUMERIC (3) DEFAULT ((0)) NOT NULL,
	DESCRIPCION VARCHAR (250) DEFAULT ('' ''),
	TIPO        VARCHAR (1) DEFAULT ('' ''),
	TIPO_CUENTA VARCHAR (2) DEFAULT ('' ''),
	TZ_LOCK     NUMERIC (15) DEFAULT ((0)) NOT NULL,
	PRIMARY KEY (CONTROL)
	)
')

EXECUTE('
INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (35352, '' '', 0, ''CONTROL'', ''Códi de control'', 3, ''N'', 0, NULL, 0, 0, 0, 0, 0, 0, 0, 3530, ''CONTROL'', 0, NULL)


INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (35353, '' '', 0, ''DESCRIPCION'', ''Descripción'', 250, ''A'', 0, NULL, 0, 0, 0, 0, 0, 0, 0, 3530, ''DESCRIPCION'', 0, NULL)


INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (35354, '' '', 0, ''TIPO'', ''Tipo de control'', 1, ''A'', 0, NULL, 0, 0, 0, 0, 0, 0, 1, 3530, ''TIPO'', 0, NULL)


INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (35355, '' '', 0, ''TIPO_CUENTA'', ''Tipo de cuenta'', 2, ''A'', 0, NULL, 0, 0, 0, 0, 0, 0, 1, 3530, ''TIPO_CUENTA'', 0, NULL)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (1, ''Aviso previo al cierre'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (2, ''Genera el Certificado de Saldo Deudor'', ''A'', ''CC'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (3, ''Ingreso de Cheques Previos al Cierre'', ''A'', ''CC'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (4, ''Acta por destrucción de chequeras'', ''A'', ''CC'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (5, ''Cuenta con comisiones pendientes'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (6, ''Tiene tarjeta de débito'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (7, ''Cuenta pertenece a convenio'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (8, ''Cuenta con plazo fijo'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (9, ''Cuenta con caja de seguridad'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (10, ''Cuenta con créditos activos'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (11, ''Cuenta con descuento de documentos'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (12, ''Cuenta con acuerdos en cuentas'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (13, ''Cuenta con Débitos automáticos'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (14, ''Cuenta es origen de transferencias automáticas'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (15, ''Cuenta con tarjeta de crédito'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (16, ''Cheques pendientes de acreditación'', ''A'', ''CC'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (17, ''Transferencias pendientes de acreditación (cuenta es destino)'', ''A'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (18, ''Intereses devengados pendientes de acreditación'', ''A'', ''AC'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (19, ''Beneficios ANSES en los últimos 730 días'', ''A'', ''AC'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (20, ''Retiro del saldo acreedor'', ''A'', ''AC'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (21, ''Formulario de cierre de cuenta'', ''A'', ''AC'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (22, ''Envío de aviso vía correo'', ''M'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (23, ''Separa y anula Registro de Firma físico'', ''M'', ''AM'', 0)


INSERT INTO dbo.VTA_CONTROLES_CIERRE_CTA (CONTROL, DESCRIPCION, TIPO, TIPO_CUENTA, TZ_LOCK)
VALUES (24, ''Cuenta pertenece a grupo'', ''A'', ''AM'', 0)
')

EXECUTE('
IF OBJECT_ID (''dbo.VW_CONTROLES_CIERRE'') IS NOT NULL
	DROP VIEW dbo.VW_CONTROLES_CIERRE
')

EXECUTE('
CREATE VIEW [dbo].[VW_CONTROLES_CIERRE] (
   CONTROL,
   DESCRIPCION,
   ESTADO,
   TIPO_CUENTA
   )
AS 
   SELECT
   V.CONTROL,
   V.DESCRIPCION,
   ''Sin realizar'',
   V.TIPO_CUENTA
   FROM VTA_CONTROLES_CIERRE_CTA V
   WHERE V.TZ_LOCK = 0

')

EXECUTE('
IF OBJECT_ID (''dbo.VW_CONTROLES_CIERRE_CTA'') IS NOT NULL
	DROP VIEW dbo.VW_CONTROLES_CIERRE_CTA
')

EXECUTE('
CREATE   VIEW [dbo].[VW_CONTROLES_CIERRE_CTA] (
													   CONTROL,
													   DESCRIPCION,
													   ESTADO,
													   TIPO,
													   SUCURSAL,
													   PRODUCTO,
													   CUENTA,
													   MONEDA,
													   OPERACION,
													   ORDINAL)
AS 
   SELECT
      V.CONTROL,
      V.DESCRIPCION,
      CASE 
		  WHEN C.ESTADO = ''R'' THEN ''Realizado''
		  WHEN C.ESTADO = ''S'' THEN ''Sin realizar''
		  WHEN C.ESTADO IS NULL THEN ''Sin realizar''
      END,
      CASE 
		  WHEN V.TIPO = ''M'' THEN ''Manual''
		  WHEN V.TIPO = ''A'' THEN ''Automático''
      END,
      C.SUCURSAL,
      C.PRODUCTO,
      C.CUENTA,
      C.MONEDA,
      C.OPERACION,
      C.ORDINAL
   FROM 
      dbo.VTA_CONTROLES_CIERRE_CTA AS V WITH (NOLOCK)
      INNER JOIN dbo.VTA_CONT_CIERRE_CTA AS C WITH (NOLOCK) ON V.CONTROL = C.CONTROL
')

EXECUTE('
UPDATE dbo.AYUDAS
SET CAMPOS = ''616R;3184;44871R;2612I;2613I;2614I;2615I;2616I;2617I;''
WHERE NUMERODEAYUDA = 3405
')


