EXECUTE('DROP PROCEDURE IF EXISTS dbo.SP_ITF_ALTA_TJD_LINK_MAESTRO;')
EXECUTE('
CREATE PROCEDURE dbo.SP_ITF_ALTA_TJD_LINK_MAESTRO 

@NRO_TARJETA VARCHAR(19), @COD_TRAN VARCHAR(6), @TIPO VARCHAR(2), @ESTADO VARCHAR(1), @FECHA_ENTREGA VARCHAR(8), @VENCIMIENTO VARCHAR(4), 

@MONTO_LIMITE VARCHAR(2), @NUM_VERSION VARCHAR(1), @DIGITO_VERIF VARCHAR(1), @NRO_PERSONA NUMERIC(12), @NRO_CLIENTE NUMERIC(12), @PRODUCTO VARCHAR(4),

@NOMBRE VARCHAR(15), @APELLIDO VARCHAR (15), @LIMITE_CREDITO VARCHAR(2), @SALIDA NUMERIC(1) OUTPUT

AS
BEGIN
	DECLARE @flag NUMERIC(2);
	DECLARE @NOMBRE_COMPLETO VARCHAR(30);

	SET @flag = (SELECT COUNT(*) FROM TJD_LINK_MAESTRO WHERE ID_TARJETA = @NRO_TARJETA AND COD_TRAN = @COD_TRAN);
	SET @NOMBRE_COMPLETO = (LEFT(concat(@APELLIDO,'' '', @NOMBRE), 30));
	
	IF (@flag = 0 AND @NRO_PERSONA <> 0 AND @NRO_CLIENTE <> 0)
	  BEGIN
	  	INSERT INTO TJD_LINK_MAESTRO (ID_TARJETA, COD_TRAN, TIPO_TARJETA, ESTADO_TARJETA, FECHA_ENTREGA_TARJ, VENCIMIENTO_TARJETA, LIMITE_MONTO_TARJETA, NUM_VERSION_TARJ, DIGITO_VERIFICADOR_TARJ, NRO_PERSONA, NRO_CLIENTE, PRODUCTO, NOMBRE_TARJETA, LIMITE_CREDITO) 
	  	VALUES (@NRO_TARJETA, @COD_TRAN, @TIPO, @ESTADO, @FECHA_ENTREGA, @VENCIMIENTO, @MONTO_LIMITE, @NUM_VERSION, @DIGITO_VERIF, @NRO_PERSONA, @NRO_CLIENTE, @PRODUCTO, @NOMBRE_COMPLETO, @LIMITE_CREDITO);  
	  	SET @SALIDA = 0;
      END 
    ELSE
      BEGIN
        SET @SALIDA = 1;
      END   
    
  
END;')