EXECUTE('
IF OBJECT_ID (''dbo.VW_SNP_STOP_DEBIT_DD'') IS NOT NULL
	DROP VIEW dbo.VW_SNP_STOP_DEBIT_DD
')
EXECUTE('
CREATE VIEW VW_SNP_STOP_DEBIT_DD
AS
SELECT
	SD.CLIENTE_ADHERIDO,
	C.NOMBRECLIENTE,
	SD.CORRELATIVO,
	OS.DESCRIPCION AS TIPO_CUENTA,
	S.CUENTA,
	CASE 
		WHEN SD.PRESTACION = ''''
			THEN ''TODAS''
		ELSE SD.PRESTACION
	END AS PRESTACION,
	CASE
		WHEN SD.CUIT_EO = 0
			THEN ''TODAS''
		ELSE PE.NOMBRE_EMPRESA
	END AS NOMBRE_EMPRESA,
	ISNULL(SD.CUIT_EO, 0) AS CUIT_EO,
	OE.DESCRIPCION AS ESTADO,
	SD.FECHA_ALTA
FROM 
	SNP_STOP_DEBIT AS SD WITH (nolock)
LEFT JOIN CLI_CLIENTES AS C WITH (nolock) ON
	C.CODIGOCLIENTE = SD.CLIENTE_ADHERIDO
	AND ((C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)
		AND (C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN SNP_PRESTACIONES_EMPRESAS AS PE WITH (nolock) ON
	PE.CUIT_EO = SD.CUIT_EO
	AND PE.PRESTACION = (	SELECT TOP 1 PRESTACION
							FROM SNP_PRESTACIONES_EMPRESAS
							WHERE CUIT_EO = PE.CUIT_EO
								AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
									AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  
								)
						)
	AND ((PE.TZ_LOCK < 100000000000000 OR PE.TZ_LOCK >= 200000000000000)
		AND (PE.TZ_LOCK < 300000000000000 OR PE.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN OPCIONES AS OE WITH (nolock) ON
	OE.NUMERODECAMPO = 44563
	AND OE.IDIOMA = ''E''
	AND OE.OPCIONINTERNA = SD.ESTADO
LEFT JOIN SALDOS AS S WITH (nolock) ON
	S.JTS_OID = SD.SALDO_JTS_OID
	AND SD.TZ_LOCK = 0
LEFT JOIN OPCIONES AS OS WITH (nolock) ON
	OS.NUMERODECAMPO = 1785
	AND OS.IDIOMA = ''E''
	AND OS.OPCIONINTERNA = S.C1785
WHERE
	SD.DEBITO_DIRECTO = ''S''
	AND ((SD.TZ_LOCK < 100000000000000 OR SD.TZ_LOCK >= 200000000000000)
		AND (SD.TZ_LOCK < 300000000000000 OR SD.TZ_LOCK >= 400000000000000)  )
')