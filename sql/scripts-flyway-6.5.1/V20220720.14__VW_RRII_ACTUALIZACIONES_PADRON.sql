EXECUTE('
CREATE OR ALTER VIEW [dbo].[VW_RRII_ACTUALIZACIONES_PADRON] 
AS
WITH AUX AS(
SELECT	P.FECHAPROCESO,D.NUMERODOCUMENTO, 
		10 AS TIPOMOVIMIENTO, 
		PP.TIPO_IDENT_TRIB, 
		PP.TIPO_DOCUMENTO_IDENTIDAD, 
		D.NUM_DOC_FISICO,
		PF.PRIMERNOMBRE+'' ''+PF.SEGUNDONOMBRE+'' ''+PF.APELLIDOPATERNO+'' ''+PF.APELLIDOMATERNO AS DENOMINACION,''2'' AS PEP_CAMBIO, 
		--''0'' AS SCOD_POSTAL_CAMBIO,
		DIR.CPA_NUEVO AS SCOD_POSTAL_CAMBIO,
		ROW_NUMBER() OVER(PARTITION BY D.NUMERODOCUMENTO ORDER BY D.NUMERODOCUMENTO ASC) AS NUMERADOR_REPETIDO
	
FROM PARAMETROS P WITH(nolock),  
CLI_DocumentosPFPJ D WITH(nolock) 
LEFT JOIN CLI_PERSONASFISICAS PF WITH(nolock) ON D.NUMEROPERSONAFJ = PF.NUMEROPERSONAFISICA 
INNER JOIN CLI_DIRECCIONES DIR WITH(nolock) ON DIR.ID = PF.NUMEROPERSONAFISICA
LEFT JOIN RRII_PARAMETROS_PADRON PP WITH(nolock) ON D.TIPO_DOC_FISICO = PP.NOMBRE_TIPO_DOC 
											AND D.TIPOPERSONA = PP.TIPO_PERSONA
--Chequeo en pyf_apoderados, para saber si es tutor / curador, con cod_apoderamiento = 5
LEFT JOIN PYF_APODERADOS APO WITH(nolock) ON PF.NUMEROPERSONAFISICA = APO.ID_PERSONA 
WHERE PF.FECHAALTA BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) AND dateadd(d,-(day(dateadd(m,1,FECHAPROCESO))),dateadd(m,1,FECHAPROCESO))
	AND PF.NUMEROPERSONAFISICA IN (	SELECT NUMEROPERSONA 
									FROM CLI_CLIENTEPERSONA CP WITH(nolock) 
 									LEFT JOIN CLI_CLIENTES C WITH(nolock) ON CP.CODIGOCLIENTE = C.CODIGOCLIENTE 
										AND C.FECHAAPERTURA BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) AND dateadd(d,-(day(dateadd(m,1,FECHAPROCESO))),dateadd(m,1,FECHAPROCESO))
  									WHERE CP.FECHAALTARELACION BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) AND dateadd(d,-(day(dateadd(m,1,P.FECHAPROCESO))),dateadd(m,1,P.FECHAPROCESO)))
	AND PP.NACIONALIDAD =	CASE	WHEN PF.PAISNACIMIENTO = 32 THEN '' ''
									WHEN PF.PAISNACIMIENTO <> 32 THEN ''E''
							END
	AND (PF.NUMEROPERSONAFISICA IN (SELECT NUMEROPERSONAFISICA 
									FROM CLI_INTEGRANTESPJ WITH(nolock) 
									WHERE CODIGOCARGO IN(''REP'',''APO''))
	OR APO.TIPO_PODER IN (	SELECT CODPODER 
							FROM PYF_APODERAMIENTO WITH(nolock) 
							WHERE CODAPODERAMIENTO = 5))
--OR PF.NUMEROPERSONAFISICA IN (SELECT ID_PERSONA FROM PYF_APODERADOS WHERE TIPO_PODER IN (SELECT CODPODER FROM PYF_APODERAMIENTO WHERE CODAPODERAMIENTO = 5))
	AND PF.TZ_LOCK = 0 
	AND D.TZ_LOCK=0
	--OR PF.NUMEROPERSONAFISICA IN (SELECT ID_PERSONA FROM PYF_APODERADOS))
UNION ALL
--persona juridica, lo mismo que la fisica. Solamente que pj siempre es con pais 32, nunca es extranjera
SELECT	P.FECHAPROCESO,
		D.NUMERODOCUMENTO, 
		10 AS TIPOMOVIMIENTO, 
		PP.TIPO_IDENT_TRIB, 
		PP.TIPO_DOCUMENTO_IDENTIDAD, 
		D.NUM_DOC_FISICO, 
		PJ.RAZONSOCIAL AS DENOMINACION,
		''0'' AS PEP_CAMBIO, 
--''0'' AS SCOD_POSTAL_CAMBIO, 
		DIR.CPA_NUEVO AS SCOD_POSTAL_CAMBIO,
		ROW_NUMBER() OVER(PARTITION BY D.NUMERODOCUMENTO ORDER BY D.NUMERODOCUMENTO ASC) AS NUMERADOR_REPETIDO
FROM PARAMETROS P WITH(nolock), 
CLI_INTEGRANTESPJ IPJ WITH(nolock), 
CLI_DIRECCIONES DIR WITH(nolock), 
CLI_DocumentosPFPJ D WITH(nolock)
LEFT JOIN CLI_PERSONASJURIDICAS PJ WITH(nolock) ON D.NUMEROPERSONAFJ = PJ.NUMEROPERSONAJURIDICA 
LEFT JOIN RRII_PARAMETROS_PADRON PP WITH(nolock) ON D.TIPOPERSONA = PP.TIPO_PERSONA
WHERE PJ.FECHAALTA BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) 
	AND dateadd(d,-(day(dateadd(m,1,FECHAPROCESO))),dateadd(m,1,FECHAPROCESO))
	AND PJ.NUMEROPERSONAJURIDICA IN (SELECT NUMEROPERSONA 
									FROM CLI_CLIENTEPERSONA CP WITH(nolock) 
 									LEFT JOIN CLI_CLIENTES C WITH(nolock) ON CP.CODIGOCLIENTE = C.CODIGOCLIENTE 
									AND C.FECHAAPERTURA BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) 
									AND dateadd(d,-(day(dateadd(m,1,FECHAPROCESO))),dateadd(m,1,FECHAPROCESO))
  									WHERE CP.FECHAALTARELACION BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) 
										AND dateadd(d,-(day(dateadd(m,1,P.FECHAPROCESO))),dateadd(m,1,P.FECHAPROCESO)))
	AND PJ.NUMEROPERSONAJURIDICA = IPJ.NUMEROPERSONAFISICA
	AND IPJ.CODIGOCARGO IN (''SDE'',''FCO'',''APO'')
	AND PP.CARGO_SDE_FCO	=	CASE	WHEN IPJ.CODIGOCARGO = ''SDE'' THEN ''SDE''
  										WHEN IPJ.CODIGOCARGO = ''FCO'' THEN ''FCO''
  								ELSE ''N''
  								END
	AND DIR.ID = PJ.NUMEROPERSONAJURIDICA
    AND PJ.TZ_LOCK=0 
	AND D.TZ_LOCK=0
 -- duda de si consultar cargo de apoderado en PYF_APODERADOS o en CODIGOCARGO, como los anteriores
 --	OR PJ.NUMEROPERSONAJURIDICA IN (SELECT ID_PERSONA FROM PYF_APODERADOS))
UNION
/*
esto es para el punto B)
trae docs de personas fisicas que pertenecen a un cliente que se dio de baja en el mes actual
*/
--persona fisica
SELECT	DISTINCT P.FECHAPROCESO,D.NUMERODOCUMENTO, 20 AS TIPOMOVIMIENTO, 
		PP.TIPO_IDENT_TRIB, 
		PP.TIPO_DOCUMENTO_IDENTIDAD,  
		D.NUM_DOC_FISICO, 
		PF.PRIMERNOMBRE+'' ''+PF.SEGUNDONOMBRE+'' ''+PF.APELLIDOPATERNO+'' ''+PF.APELLIDOMATERNO AS DENOMINACION,
		''2'' AS PEP_CAMBIO, ''0'' AS SCOD_POSTAL_CAMBIO,
		ROW_NUMBER() OVER(PARTITION BY D.NUMERODOCUMENTO ORDER BY D.NUMERODOCUMENTO ASC) AS NUMERADOR_REPETIDO
FROM PARAMETROS P WITH(nolock),
CLI_CLIENTES C WITH(nolock) 
INNER JOIN CLI_BLOQUEOS B WITH(nolock)on C.CODIGOCLIENTE=B.NROCLIENTE 
INNER JOIN CLI_CLIENTEPERSONA CP WITH(nolock)on C.CODIGOCLIENTE=CP.CODIGOCLIENTE
INNER JOIN CLI_PERSONASFISICAS PF WITH(nolock) ON PF.NUMEROPERSONAFISICA = CP.NUMEROPERSONA
												AND PF.TZ_LOCK=0 
LEFT JOIN PYF_APODERADOS APO WITH(nolock) ON PF.NUMEROPERSONAFISICA = APO.ID_PERSONA  
INNER JOIN CLI_DocumentosPFPJ D WITH(nolock)on D.NUMEROPERSONAFJ = PF.NUMEROPERSONAFISICA 
											AND D.TZ_LOCK=0
LEFT JOIN RRII_PARAMETROS_PADRON PP WITH(nolock) ON D.TIPO_DOC_FISICO = PP.NOMBRE_TIPO_DOC 
												AND D.TIPOPERSONA = PP.TIPO_PERSONA
												AND PP.NACIONALIDAD = CASE WHEN PF.PAISNACIMIENTO = 32 THEN '' ''
																			WHEN PF.PAISNACIMIENTO <> 32 THEN ''E''
																			END
WHERE  C.ESTADO=1 
AND PF.NUMEROPERSONAFISICA IN (SELECT NUMEROPERSONA 
								FROM CLI_CLIENTEPERSONA CP WITH(nolock))
AND B.FECHABLOQUEO BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) 
AND dateadd(d,-(day(dateadd(m,1,P.FECHAPROCESO))),dateadd(m,1,P.FECHAPROCESO))
--Comentada porque sino no muestra ningun registro
AND (PF.NUMEROPERSONAFISICA IN (SELECT NUMEROPERSONAFISICA 
								FROM CLI_INTEGRANTESPJ WITH(nolock) 
								WHERE CODIGOCARGO IN(''REP'',''APO''))
	OR APO.TIPO_PODER IN (	SELECT CODPODER 
							FROM PYF_APODERAMIENTO  WITH(nolock)
							WHERE CODAPODERAMIENTO = 5))


UNION ALL
--persona juridica
SELECT	P.FECHAPROCESO,
		D.NUMERODOCUMENTO, 
		20 AS TIPOMOVIMIENTO, 
		PP.TIPO_IDENT_TRIB, 
		PP.TIPO_DOCUMENTO_IDENTIDAD,
		D.NUM_DOC_FISICO , 
		PJ.RAZONSOCIAL AS DENOMINACION,
		''0'' AS PEP_CAMBIO,''0'' AS SCOD_POSTAL_CAMBIO,
		ROW_NUMBER() OVER(PARTITION BY D.NUMERODOCUMENTO ORDER BY D.NUMERODOCUMENTO ASC) AS NUMERADOR_REPETIDO
FROM dbo.PARAMETROS P WITH(nolock),
dbo.CLI_CLIENTES C WITH(nolock)
INNER JOIN dbo.CLI_BLOQUEOS B WITH(nolock)ON  C.CODIGOCLIENTE=B.NROCLIENTE 

INNER JOIN dbo.CLI_CLIENTEPERSONA CP WITH(nolock) ON C.CODIGOCLIENTE=CP.CODIGOCLIENTE
INNER JOIN dbo.CLI_PERSONASJURIDICAS PJ WITH(nolock)ON PJ.NUMEROPERSONAJURIDICA = CP.NUMEROPERSONA
												AND PJ.TZ_LOCK=0 
INNER JOIN dbo.CLI_DocumentosPFPJ D WITH(nolock)ON  D.NUMEROPERSONAFJ = PJ.NUMEROPERSONAJURIDICA
											AND D.TZ_LOCK=0
LEFT JOIN dbo.RRII_PARAMETROS_PADRON PP WITH(nolock) ON D.TIPOPERSONA = PP.TIPO_PERSONA
INNER JOIN dbo.CLI_INTEGRANTESPJ IPJ WITH(nolock)ON PJ.NUMEROPERSONAJURIDICA = IPJ.NUMEROPERSONAFISICA
												AND IPJ.CODIGOCARGO IN (''SDE'',''FCO'',''APO'')
WHERE	C.ESTADO=1 
		AND B.FECHABLOQUEO BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) 
		AND dateadd(d,-(day(dateadd(m,1,P.FECHAPROCESO))),dateadd(m,1,P.FECHAPROCESO))
		AND PJ.NUMEROPERSONAJURIDICA IN (	SELECT NUMEROPERSONA 
											FROM dbo.CLI_CLIENTEPERSONA CP WITH(nolock))
		AND PP.CARGO_SDE_FCO	=	CASE	WHEN IPJ.CODIGOCARGO = ''SDE'' THEN ''SDE''
  											WHEN IPJ.CODIGOCARGO = ''FCO'' THEN ''FCO''
  									ELSE ''N''
  									END
),
--Punto C)
AUX2 AS(
--PERSONA FISICA
 SELECT
	MAX(BD.FECHA) AS MAX_FECHA,
	DOC.NUMERODOCUMENTO,
	30 AS TIPOMOVIMIENTO,
	PP.TIPO_IDENT_TRIB,
	PP.TIPO_DOCUMENTO_IDENTIDAD,
	DOC.NUM_DOC_FISICO,
	PF.PRIMERNOMBRE + '' '' + PF.SEGUNDONOMBRE + '' '' + PF.APELLIDOPATERNO + '' '' + PF.APELLIDOMATERNO AS DENOMINACION,
	''2'' AS PEP_CAMBIO,
	CASE
		WHEN D.PAIS = 32 THEN BD_AUX.CPA_NUEVO
		WHEN D.PAIS <> 32 THEN CONCAT(PA.CODIGOSWIFT, ''000000'')
	END SCOD_POSTAL_CAMBIO,
	--BD_AUX.SCOD_POSTAL AS SCOD_POSTAL_CAMBIO,
 ROW_NUMBER() OVER(PARTITION BY DOC.NUMERODOCUMENTO
ORDER BY
	DOC.NUMERODOCUMENTO ASC) AS NUMERADOR_REPETIDO
FROM DBO.PARAMETROS P WITH(nolock),
DBO.BITACORA_DIRECCIONES BD WITH(nolock) 
LEFT JOIN dbo.CLI_PERSONASFISICAS PF WITH(nolock) ON BD.ID = PF.NUMEROPERSONAFISICA 
													AND PF.TZ_LOCK = 0
LEFT JOIN dbo.PYF_APODERADOS APO WITH(nolock) ON PF.NUMEROPERSONAFISICA = APO.ID_PERSONA
INNER JOIN dbo.BITACORA_DIRECCIONES BD_AUX WITH(nolock)ON BD.ID = BD_AUX.ID
													AND BD.CPA_NUEVO <> BD_AUX.CPA_NUEVO
INNER JOIN dbo.CLI_DIRECCIONES D WITH(nolock)ON D.ID = BD_AUX.ID
										AND BD_AUX.CPA_NUEVO = D.CPA_NUEVO
										AND D.TZ_LOCK = 0
LEFT JOIN dbo.CLI_PAISES PA WITH(nolock) ON	D.PAIS = PA.CODIGOPAIS
INNER JOIN dbo.CLI_DocumentosPFPJ DOC WITH(nolock)ON DOC.NUMEROPERSONAFJ = PF.NUMEROPERSONAFISICA
LEFT JOIN dbo.RRII_PARAMETROS_PADRON PP WITH(nolock) ON	DOC.TIPO_DOC_FISICO = PP.NOMBRE_TIPO_DOC
												AND DOC.TIPOPERSONA = PP.TIPO_PERSONA
WHERE BD.FECHA < DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0)
		AND BD_AUX.FECHA BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) AND P.FECHAPROCESO
		AND PF.NUMEROPERSONAFISICA IN (
										SELECT
											NUMEROPERSONA
										FROM
											CLI_CLIENTEPERSONA CP WITH(nolock)) 
		AND PP.NACIONALIDAD =
								CASE
									WHEN PF.PAISNACIMIENTO = 32 THEN '' ''
									WHEN PF.PAISNACIMIENTO <> 32 THEN ''E''
								END
		AND (PF.NUMEROPERSONAFISICA IN (
										SELECT
											NUMEROPERSONAFISICA
										FROM
											CLI_INTEGRANTESPJ WITH(nolock)
										WHERE
											CODIGOCARGO IN(''REP'', ''APO''))
				OR APO.TIPO_PODER IN (SELECT CODPODER FROM PYF_APODERAMIENTO WHERE CODAPODERAMIENTO = 5))
GROUP BY
		BD.ID,
		BD.CPA_NUEVO,
		BD_AUX.CPA_NUEVO,
		DOC.NUMERODOCUMENTO,
		PP.TIPO_IDENT_TRIB,
		PP.TIPO_DOCUMENTO_IDENTIDAD,
		PF.PRIMERNOMBRE,
		PF.SEGUNDONOMBRE,
		PF.APELLIDOPATERNO,
		PF.APELLIDOMATERNO,
		DOC.NUM_DOC_FISICO,
		D.PAIS,
		PA.CODIGOSWIFT
UNION ALL

--PERSONA JURIDICA
SELECT	MAX(BD.FECHA) AS MAX_FECHA, 
		DOC.NUMERODOCUMENTO, 30 AS TIPOMOVIMIENTO, 
		PP.TIPO_IDENT_TRIB, 
		PP.TIPO_DOCUMENTO_IDENTIDAD, 
		DOC.NUM_DOC_FISICO,
		PJ.RAZONSOCIAL AS DENOMINACION, 
		''0'' AS PEP_CAMBIO,
		BD_AUX.CPA_NUEVO AS SCOD_POSTAL_CAMBIO, 
		ROW_NUMBER() OVER(PARTITION BY DOC.NUMERODOCUMENTO ORDER BY DOC.NUMERODOCUMENTO ASC) AS NUMERADOR_REPETIDO
FROM PARAMETROS P WITH(nolock), 
BITACORA_DIRECCIONES BD WITH(nolock) 
LEFT JOIN CLI_PERSONASJURIDICAS PJ  WITH(nolock) ON BD.ID = PJ.NUMEROPERSONAJURIDICA
											AND PJ.TZ_LOCK=0 
INNER JOIN BITACORA_DIRECCIONES BD_AUX  WITH(nolock)ON  BD.ID = BD_AUX.ID 
												AND BD.CPA_NUEVO <> BD_AUX.CPA_NUEVO
INNER JOIN CLI_DIRECCIONES D  WITH(nolock)ON D.ID = BD_AUX.ID
									AND BD_AUX.CPA_NUEVO = D.CPA_NUEVO
									AND D.TZ_LOCK=0
INNER JOIN CLI_DocumentosPFPJ DOC  WITH(nolock) ON DOC.NUMEROPERSONAFJ = PJ.NUMEROPERSONAJURIDICA
LEFT JOIN RRII_PARAMETROS_PADRON PP  WITH(nolock) ON DOC.TIPO_DOC_FISICO = PP.NOMBRE_TIPO_DOC 
										AND DOC.TIPOPERSONA = PP.TIPO_PERSONA
INNER JOIN CLI_INTEGRANTESPJ IPJ WITH(nolock)ON PJ.NUMEROPERSONAJURIDICA = IPJ.NUMEROPERSONAFISICA
											AND IPJ.CODIGOCARGO IN (''SDE'',''FCO'',''APO'')

WHERE	BD.FECHA < DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0)
		AND BD_AUX.FECHA BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0) AND P.FECHAPROCESO
		AND PJ.NUMEROPERSONAJURIDICA IN (SELECT NUMEROPERSONA FROM CLI_CLIENTEPERSONA CP  WITH(nolock))
  
 		 
		AND PP.CARGO_SDE_FCO	= CASE	WHEN IPJ.CODIGOCARGO = ''SDE'' THEN ''SDE''
  										WHEN IPJ.CODIGOCARGO = ''FCO'' THEN ''FCO''
  										ELSE ''N''
  										END
GROUP BY BD.ID, 
		BD.CPA_NUEVO, 
		BD_AUX.CPA_NUEVO, 
		DOC.NUMERODOCUMENTO, 
		PP.TIPO_IDENT_TRIB, 
		PP.TIPO_DOCUMENTO_IDENTIDAD,
		PJ.RAZONSOCIAL, 
		DOC.NUM_DOC_FISICO
),
--Punto D)
--s.INCLUIDO_PEP es el valor que tenia ese campo en el ultimo regtistro del mes pasado
--BP_INCLUIDO_PEP es el valor que tiene este mes.
--se chequea si son iguales o no
--Se debe usar campo CPA_NUEVO en vez de SCOD_POSTAL???
--WITH 
aux3 AS (
		-- persona fisica
		SELECT	MAX(BPF.FECHA) AS MAX_FECHA, 
				D.NUMERODOCUMENTO, 
				30 AS TIPOMOVIMIENTO,  
				PP.TIPO_IDENT_TRIB, 
				PP.TIPO_DOCUMENTO_IDENTIDAD, 
				D.NUM_DOC_FISICO,
				PF.PRIMERNOMBRE+'' ''+PF.SEGUNDONOMBRE+'' ''+PF.APELLIDOPATERNO+'' ''+PF.APELLIDOMATERNO AS DENOMINACION,
		 --BPF_AUX.INCLUIDO_PEP AS PEP_CAMBIO,
				''1'' AS PEP_CAMBIO,
				''0'' AS SCOD_POSTAL_CAMBIO, 
				ROW_NUMBER() OVER(PARTITION BY D.NUMERODOCUMENTO ORDER BY D.NUMERODOCUMENTO ASC) AS NUMERADOR_REPETIDO
		FROM PARAMETROS P WITH(nolock),
		BITACORA_PERSONAS_FISICAS BPF WITH(nolock) 
		LEFT JOIN CLI_PERSONASFISICAS PF WITH(nolock) ON BPF.NUMEROPERSONAFISICA = PF.NUMEROPERSONAFISICA 
		LEFT JOIN PYF_APODERADOS APO  WITH(nolock) ON PF.NUMEROPERSONAFISICA = APO.ID_PERSONA
		INNER JOIN BITACORA_PERSONAS_FISICAS BPF_AUX WITH(nolock)on BPF.NUMEROPERSONAFISICA = BPF_AUX.NUMEROPERSONAFISICA 
		INNER JOIN CLI_DocumentosPFPJ D WITH(nolock) ON D.NUMEROPERSONAFJ = BPF.NUMEROPERSONAFISICA 
													AND D.NUMEROPERSONAFJ = PF.NUMEROPERSONAFISICA
		LEFT JOIN RRII_PARAMETROS_PADRON PP  WITH(nolock) ON D.TIPO_DOC_FISICO = PP.NOMBRE_TIPO_DOC 
													AND D.TIPOPERSONA = PP.TIPO_PERSONA
		WHERE   BPF.FECHA < DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0)
				AND BPF_AUX.FECHA BETWEEN DATEADD(MONTH, DATEDIFF(MONTH, 0, P.FECHAPROCESO), 0)AND P.FECHAPROCESO
				AND BPF_AUX.INCLUIDO_PEP = PF.INCLUIDO_PEP
				AND BPF.INCLUIDO_PEP <> BPF_AUX.INCLUIDO_PEP
				AND PF.NUMEROPERSONAFISICA IN (	SELECT NUMEROPERSONA 
												FROM CLI_CLIENTEPERSONA CP WITH(nolock))
				AND PP.NACIONALIDAD =	CASE	WHEN PF.PAISNACIMIENTO = 32 THEN '' ''
												WHEN PF.PAISNACIMIENTO <> 32 THEN ''E''
										END
				AND (PF.NUMEROPERSONAFISICA IN (SELECT NUMEROPERSONAFISICA 
												FROM CLI_INTEGRANTESPJ WITH(nolock) 
												WHERE CODIGOCARGO IN(''REP'',''APO''))
				OR APO.TIPO_PODER IN (	SELECT CODPODER 
										FROM PYF_APODERAMIENTO WITH(nolock)
										WHERE CODAPODERAMIENTO = 5)
		)
AND PF.TZ_LOCK = 0 
AND D.TZ_LOCK=0  
GROUP BY D.NUMERODOCUMENTO, 
		BPF.INCLUIDO_PEP, 
		BPF_AUX.INCLUIDO_PEP,
		PP.TIPO_IDENT_TRIB, 
		PP.TIPO_DOCUMENTO_IDENTIDAD,
		PF.PRIMERNOMBRE, 
		PF.SEGUNDONOMBRE, 
		PF.APELLIDOPATERNO, 
		PF.APELLIDOMATERNO,
		D.NUM_DOC_FISICO
)
SELECT * FROM AUX WITH(NOLOCK)
UNION ALL
SELECT * FROM AUX2  WITH(NOLOCK)WHERE SCOD_POSTAL_CAMBIO IS NOT NULL
UNION ALL
SELECT * FROM aux3 WITH(NOLOCK) WHERE PEP_CAMBIO IS NOT NULL


')
