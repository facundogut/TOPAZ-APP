EXECUTE ('
CREATE OR ALTER VIEW [dbo].[VW_ACT_ECO] 
AS

WITH ACTIVIDADES_ORDENADAS
AS (
    SELECT
        ROW_NUMBER() OVER(PARTITION BY C.CODIGO_PERSONA_CLIENTE ORDER BY C.ORDEN_AFIP, C.ORDINAL_ACTIVIDAD) AS ORDEN,
        C.CODIGO_ACTIVIDAD AS COD_ACTIVIDAD,
        A.DESCRIPCION,
        c.INICIO_ACTIVIDAD AS PERIODO_ACTIVIDAD,
        c.VERIFICADO_AFIP AS VERIFICADO_AFIP,
        C.FECHA_VERIFICADO,
        C.CODIGO_PERSONA_CLIENTE AS CODIGO_PERSONA,
        D.TIPODOCUMENTO AS TIPO_DOCUMENTO,
		D.NUMERODOCUMENTO AS NUMERO_DOCUMENTO,
        C.ORDINAL_ACTIVIDAD AS ORDINAL,
        C.ORDEN_AFIP
    FROM CLI_ACTIVIDAD_ECONOMICA AS C WITH(nolock)
    INNER JOIN CLI_Cod_Act_AFIP AS A WITH(nolock) ON
        A.CODIGO_ACT_AFIP = C.CODIGO_ACTIVIDAD
        AND ((A.TZ_LOCK < 100000000000000 OR A.TZ_LOCK >= 200000000000000)
            AND (A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000)  
        )
    INNER JOIN CLI_DocumentosPFPJ AS D WITH(nolock) ON
        D.NUMEROPERSONAFJ = C.CODIGO_PERSONA_CLIENTE
        AND ((D.TZ_LOCK < 100000000000000 OR D.TZ_LOCK >= 200000000000000)
            AND (D.TZ_LOCK < 300000000000000 OR D.TZ_LOCK >= 400000000000000)  
        )
        AND D.TIPODOCUMENTO = ( SELECT TOP 1 TIPODOCUMENTO
                                FROM CLI_DocumentosPFPJ WITH(nolock)
                                WHERE NUMEROPERSONAFJ = D.NUMEROPERSONAFJ
                                    AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
                                        AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  
                                    )
                            )
        AND D.NUMERODOCUMENTO = (
                                SELECT TOP 1 NUMERODOCUMENTO
                                FROM CLI_DocumentosPFPJ WITH(nolock)
                                WHERE NUMEROPERSONAFJ = D.NUMEROPERSONAFJ
                                    AND TIPODOCUMENTO = D.TIPODOCUMENTO
                                    AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
                                        AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  
                                    )
                            )
    WHERE
        ((C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)
            AND (C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000)  
        )  
)
SELECT  *,
		case when ORDEN=1 then ''Primaria'' 
		else ''Secundaria'' end as TIPO_ACTIVIDAD
FROM ACTIVIDADES_ORDENADAS


')