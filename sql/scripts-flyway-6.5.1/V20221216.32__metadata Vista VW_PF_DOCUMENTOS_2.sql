EXECUTE('
IF OBJECT_ID (''VW_PF_DOCUMENTOS_2'') IS NOT NULL
	DROP VIEW VW_PF_DOCUMENTOS_2
')

EXECUTE('
CREATE     VIEW [VW_PF_DOCUMENTOS_2] 
AS 
SELECT 
    V.TIPODOCUMENTO,
    V.NUMERODOCUMENTO,
    V.TIPO_DOC_FISICO,
    V.NUM_DOC_FISICO,
    concat(U.APELLIDOPATERNO,'' '', U.PRIMERNOMBRE) AS APELLIDO_NOMBRE,
    CASE V.TIPOPERSONA 
    WHEN ''F'' THEN ''Persona Humana'' END AS TIPO_PERSONA,
    OA.DESCRIPCION AS NIVEL_APERTURA,
    OE.DESCRIPCION AS ESTADO_PERSONA,
    OM.DESCRIPCION AS MOTIVO_INHABILITADO,
    V.NUMEROPERSONAFJ AS NUMERO_PERSONA,  
    U.EMPLEADO_BC_BANCO
FROM dbo.CLI_PERSONASFISICAS  AS U WITH(NOLOCK) 
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK) ON  U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ 
												AND (V.TIPOPERSONA = ''F'' OR V.TIPOPERSONA = ''U'') 
												AND (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
													AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)) 
												AND(	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
													AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
LEFT JOIN OPCIONES AS OA WITH (NOLOCK) ON
	OA.NUMERODECAMPO = 2203
	AND OA.IDIOMA = ''E''
	AND OA.OPCIONINTERNA = U.NIVEL_APERTURA
LEFT JOIN OPCIONES AS OE WITH (NOLOCK) ON
	OE.NUMERODECAMPO = 33366
	AND OE.IDIOMA = ''E''
	AND OE.OPCIONINTERNA = U.ESTADO
LEFT JOIN OPCIONES AS OM WITH (NOLOCK) ON
	OM.NUMERODECAMPO = 33368
	AND OM.IDIOMA = ''E''
	AND OM.OPCIONINTERNA = U.MOTIVO_INHABILITADO
')
