EXECUTE('
IF OBJECT_ID (''dbo.VW_CLIENTES_EXCLUIDOS'') IS NOT NULL
	DROP VIEW dbo.VW_CLIENTES_EXCLUIDOS

')

EXECUTE('
CREATE VIEW VW_CLIENTES_EXCLUIDOS AS
SELECT 
A.PRODUCTO AS ''Producto'',
A.NOMBREPRODUCTO AS ''Nombre Producto'',
A.CLIENTE AS ''Cliente'',
A.CUENTA AS ''Cuenta'',
A.OPERACION AS ''Operación'',
CASE 
WHEN EC.GRADUACION =''S'' THEN ''Cliente''
WHEN EA.GRADUACION =''S'' THEN ''Asistencia''
WHEN EP.GRADUACION =''S'' THEN ''Producto/Familia''
ELSE ''No''
END AS ''Ex Graduación'',
CASE 
WHEN EC.FRACCIONAMIENTO =''S'' THEN ''Cliente''
WHEN EA.FRACCIONAMIENTO =''S'' THEN ''Asistencia''
WHEN EP.FRACCIONAMIENTO =''S'' THEN ''Producto/Familia''
ELSE ''No'' 
END AS ''Ex Fraccionamiento'',
A.MONEDA AS ''Moneda'',
AD.SALDO_DEUDA AS ''Saldo Deuda'',
A.SUCURSAL AS ''Sucursal'',
A.NOMBRESUCURSAL AS ''Nombre Sucursal'',
A.VENCIMIENTO AS ''Fecha Vencimiento'',
A.JTS_OID AS ''JTS OID'',
A.FAMILIA AS ''Familia''
FROM VW_ASISTENCIAS A
LEFT JOIN VW_ASISTENCIAS_DEUDA AD ON A.JTS_OID=AD.JTS_OID
LEFT JOIN CRE_EXCLUSIONES_ASISTENCIAS EA ON AD.JTS_OID=EA.ASISTENCIA_JTS_OID AND EA.TZ_LOCK=0
LEFT JOIN CRE_EXCLUSIONES_CLIENTES EC ON EC.CODIGOCLIENTE=A.CLIENTE AND EC.TZ_LOCK=0
LEFT JOIN CRE_EXCLUSIONES_PRODUCTOS EP ON (CASE WHEN EP.TIPO=''F'' THEN A.FAMILIA ELSE A.PRODUCTO END) = EP.ITEM AND EP.TZ_LOCK=0
WHERE AD.SALDO_DEUDA>0

')