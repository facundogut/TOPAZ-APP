EXECUTE('
IF OBJECT_ID (''dbo.VW_CHEQUES_DESCONTADOS'') IS NOT NULL
	DROP VIEW dbo.VW_CHEQUES_DESCONTADOS
')

EXECUTE('
CREATE VIEW [dbo].[VW_CHEQUES_DESCONTADOS] 
(
	TipoDocumento, Serie, Numero, Banco, SucursalBanco, Cuenta, Importe, FechaAcreditacion,  Vencimiento, JTS_OID_DESCUENTO
)
AS
SELECT TIPO_DOCUMENTO AS TipoDocumento, SERIE_DEL_CHEQUE AS Serie, NUMERO_CHEQUE AS Numero, BANCO_GIRADO AS Banco, SUCURSAL_BANCO_GIRADO AS SucursalBanco, 
NUMERICO_CUENTA_GIRADORA AS Cuenta, IMPORTE AS Importe, FECHA_ACREDITACION AS FechaAcreditacion, VENCIMIENTO AS Vencimiento, JTS_OID_DESCUENTO
FROM(
	SELECT TIPO_DOCUMENTO, SERIE_DEL_CHEQUE, NUMERO_CHEQUE, BANCO_GIRADO, SUCURSAL_BANCO_GIRADO, NUMERICO_CUENTA_GIRADORA, IMPORTE, FECHA_ACREDITACION, FECHA_ALTA AS VENCIMIENTO, JTS_OID_DESCUENTO
	FROM CLE_CHEQUES_SALIENTE WITH(NOLOCK)
	WHERE FECHA_ENVIO_COMPENSACION IS NULL 
	AND FECHA_ENVIO_CAMARA >= (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK)) 
	AND TZ_LOCK = 0 AND ACREDITADO = 0 AND DESTINO_CHEQUE = 3 AND
	NRO_SOLICITUD NOT IN (SELECT NRO_SOLICITUD FROM CHE_CHEQUES WITH(NOLOCK) WHERE TZ_LOCK = 0)
	UNION
	SELECT TIPO_DOCUMENTO, SERIE_DEL_CHEQUE, NUMERO_CHEQUE, BANCO_GIRADO, SUCURSAL_BANCO_GIRADO, NUMERICO_CUENTA_GIRADORA, IMPORTE, FECHA_ACREDITACION, FECHA_ALTA AS VENCIMIENTO, JTS_OID_DESCUENTO
	FROM CLE_CHEQUES_SALIENTE WITH(NOLOCK)
	WHERE FECHA_ENVIO_COMPENSACION >= (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK))
	AND FECHA_ENVIO_CAMARA >= (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK)) 
	AND TZ_LOCK = 0 AND ACREDITADO = 0 AND DESTINO_CHEQUE = 3 AND
	NRO_SOLICITUD IN (SELECT NRO_SOLICITUD FROM CHE_CHEQUES WITH(NOLOCK) WHERE TZ_LOCK = 0)) a
')
