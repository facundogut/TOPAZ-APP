EXECUTE('
IF OBJECT_ID (''dbo.VBS_ESTADO_CUENTA_ORIGINAL'') IS NOT NULL
	DROP VIEW dbo.VBS_ESTADO_CUENTA_ORIGINAL

')

EXECUTE('
CREATE VIEW dbo.VBS_ESTADO_CUENTA_ORIGINAL
AS
SELECT 
	ROW_NUMBER() OVER(PARTITION BY PP.SALDO_JTS_OID,PP.NUMERO_CUOTA ORDER BY PP.NUMERO_CUOTA ASC) AS NUMERADOR,
	PP.SALDO_JTS_OID,
	PP.NUMERO_CUOTA AS NCUOTA,
	PP.FECHA_FIN AS VENCIMIENTOCUOTA,
	ISNULL(PP.CAPITAL,0) AS CAPITAL,
	ISNULL(PP.INTERES,0) AS INTERES, 	 
	ISNULL(PP.IVAINTERES,0)  AS IVAINTERES,
	ISNULL(PP.IVAPERCEPCIONINTERES,0) AS IVAPERCEPCIONINTERES,
	ISNULL((SELECT SUM(IMPORTE_GASTO) FROM GASTOS_POR_CUOTA WITH (NOLOCK) WHERE SALDOS_JTS_OID=S.JTS_OID AND NUMERO_CUOTA=PP.NUMERO_CUOTA AND TZ_LOCK=0),0) AS GASTOS,	
	ROUND(PP.REMANENTE_CAPITAL- PP.CAPITAL,2) AS SALDO_CAPITAL
FROM PLANPAGOS_ORIGINAL PP WITH (NOLOCK) 
INNER JOIN SALDOS S WITH (NOLOCK) 
	ON PP.SALDO_JTS_OID=S.JTS_OID AND S.TZ_LOCK=0
')