/****** Object:  StoredProcedure [dbo].[SP_CONTROL_DIRECCIONES]    Script Date: 28/05/2021 9:01:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[SP_CONTROL_DIRECCIONES]  
   @P_DATO NUMERIC (1),	
   @P_FORMATO VARCHAR (2),
   @P_TIPO VARCHAR (2), 	
   @P_NUMEROPERSONA NUMERIC(12),
   @P_RETURN NUMERIC(3)  OUTPUT
AS 
	BEGIN
	SET NOCOUNT ON;  
	SET @P_RETURN = NULL
				IF(@P_DATO = 1)
				BEGIN
				SET @P_RETURN =(
				      SELECT COUNT(*) 
					  FROM dbo.CLI_DIRECCIONES AS D with (nolock)
				      WHERE D.FORMATO= @P_FORMATO 
							AND D.TIPODIRECCION = @P_TIPO 
							AND D.ID = @P_NUMEROPERSONA 
							--AND D.TZ_LOCK BETWEEN 200000000000000 AND 300000000000000) LF 28-05-2021 performance
							AND D.TZ_LOCK >= 200000000000000
							AND D.TZ_LOCK <= 300000000000000)
				END
				ELSE IF (@P_DATO = 3)
				BEGIN 
				SET @P_RETURN =(
				      SELECT COUNT(*) 
					  FROM dbo.CLI_TELEFONOS AS T with (nolock)
				      WHERE T.FORMATO= @P_FORMATO 
							AND T.TIPO= @P_TIPO 
							AND T.ID = @P_NUMEROPERSONA AND T.TZ_LOCK BETWEEN 200000000000000 AND 300000000000000)
			    END	
			    ELSE IF (@P_DATO = 2)
			    BEGIN
			    SET @P_RETURN =(
				      SELECT COUNT(*) FROM dbo.CLI_EMAILS AS E
				      WHERE E.FORMATO= @P_FORMATO AND E.TIPO= @P_TIPO AND E.ID = @P_NUMEROPERSONA AND E.TZ_LOCK BETWEEN 200000000000000 AND 300000000000000)  
				END
				 
   -- SET @P_RETURN = @@ROWCOUNT
	END