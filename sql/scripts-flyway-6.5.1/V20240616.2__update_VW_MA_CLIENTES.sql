
CREATE OR ALTER VIEW [dbo].[VW_MA_CLIENTES] (
		NUMEROPERSONA,
		TIPODOC, 
		NUMERODOC, 
		FECHANACIMIENTO, 
		NOMBRE, 
		APELLIDO,
		NIVELAPERTURA_PER,
		CODIGOCLIENTE,
		TITULARIDAD, 
		NOMBRECLIENTE,
		SECTOR,
		SEGMENTOCLIENTE,
		SUBSEGMENTOCLIENTE,
		NIVELAPERTURA_CLI,
		ESTADO_PER,
		ESTADO_CLI)
AS 
SELECT 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    U.FECHANACIMIENTO AS FECHANACIMIENTO, 
    ISNULL(U.PRIMERNOMBRE, '') + ' ' + ISNULL(U.APELLIDOPATERNO, '')  AS NOMBRE, 
    ISNULL(U.APELLIDOPATERNO, '') + ' ' + ISNULL(U.PRIMERNOMBRE, '') AS APELLIDO,
    U.NIVEL_APERTURA AS NIVELAPERTURA_PER,
    R.CODIGOCLIENTE, 
    T.TITULARIDAD,
    R.NOMBRECLIENTE,
    R.SUBDIVISION1 AS SECTOR,
    R.SEGMENTOCLIENTE AS SEGMENTOCLIENTE,
    R.SUBSEGMENTOCLIENTE AS SUBSEGMENTOCLIENTE,
    R.NIVEL_APERTURA AS NIVELAPERTURA_CLI,
    U.ESTADO AS ESTADO_PER,
    R.ESTADO AS ESTADO_CLI
FROM CLI_CLIENTES AS R WITH(NOLOCK) 
INNER JOIN CLI_CLIENTEPERSONA AS T WITH(NOLOCK) ON
	R.CODIGOCLIENTE=T.CODIGOCLIENTE 
INNER JOIN CLI_PERSONASFISICAS AS U WITH(NOLOCK) ON
	T.NUMEROPERSONA=U.NUMEROPERSONAFISICA 
INNER JOIN CLI_DOCUMENTOSPFPJ AS V WITH(NOLOCK) ON
	V.NUMEROPERSONAFJ=U.NUMEROPERSONAFISICA
WHERE 
    R.CODIGOCLIENTE = T.CODIGOCLIENTE 
    AND R.TIPO='F'
    AND U.NUMEROPERSONAFISICA = T.NUMEROPERSONA
    AND U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
    AND T.titularidad='T' 
    AND R.TZ_LOCK =0 
    AND T.TZ_LOCK =0 
	AND U.TZ_LOCK =0
	AND V.TZ_LOCK =0

