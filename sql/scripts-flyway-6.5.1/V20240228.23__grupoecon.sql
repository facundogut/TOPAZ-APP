EXECUTE('
IF OBJECT_ID (''dbo.VW_GRUPOS_CLIENTES'') IS NOT NULL
	DROP VIEW dbo.VW_GRUPOS_CLIENTES
')

EXECUTE('
CREATE   VIEW [dbo].[VW_GRUPOS_CLIENTES] (
										[Cliente], 
										[Nombre Cliente], 
										[Grupo], 
										[Nombre grupo], 
										[Deuda total])
AS 
   SELECT 
      U.CODIGOCLIENTE, 
      U.NOMBRECLIENTE, 
      GE.CODIGOGRUPOECONOMICO,
      GE.NOMBRE,
      SUM(ISNULL(DC.SALDO_DEUDA,0))
   FROM dbo.CLI_CLIENTES U WITH(NOLOCK)
   INNER JOIN dbo.CLI_GRUPOSECONOMICOSCLIENTE GC WITH(NOLOCK) ON GC.CODIGOCLIENTE = U.CODIGOCLIENTE AND GC.TZ_LOCK = 0
   INNER JOIN dbo.CLI_GRUPOSECONOMICOS GE WITH(NOLOCK) ON GE.CODIGOGRUPOECONOMICO = GC.CODIGOGRUPOECONOMICO AND GE.TZ_LOCK = 0
   LEFT JOIN dbo.VW_DEUDA_CLIENTES DC WITH(NOLOCK) ON DC.CLIENTE = U.CODIGOCLIENTE
   WHERE (	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
		AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000))
   GROUP BY U.CODIGOCLIENTE, U.NOMBRECLIENTE, GE.CODIGOGRUPOECONOMICO, GE.NOMBRE
')


EXECUTE('
INSERT INTO dbo.AYUDAS (NUMERODEARCHIVO, NUMERODEAYUDA, DESCRIPCION, FILTRO, MOSTRARTODOS, CAMPOS, CAMPOSVISTA, BASEVISTA, NOMBREVISTA, AYUDAGRANDE)
VALUES (0, 45636, ''Grupos Econ. Graduacion'', '''', 0, ''618R;410;665;1373;7997;'', ''Cliente;Nombre Cliente;Grupo;Nombre grupo;Deuda total;'', ''TOP/CLIENTES'', ''VW_GRUPOS_CLIENTES'', 0)

INSERT INTO dbo.DICCIONARIO (NUMERODECAMPO, USODELCAMPO, REFERENCIA, DESCRIPCION, PROMPT, LARGO, TIPODECAMPO, DECIMALES, EDICION, CONTABILIZA, CONCEPTO, CALCULO, VALIDACION, TABLADEVALIDACION, TABLADEAYUDA, OPCIONES, TABLA, CAMPO, BASICO, MASCARA)
VALUES (44040, '' '', 0, ''Grupo economico G y GE'', ''Grupo economico G y GE'', 12, ''N'', 0, NULL, 0, 0, 0, 0, 0, 45636, 0, 0, NULL, 0, NULL)
')
