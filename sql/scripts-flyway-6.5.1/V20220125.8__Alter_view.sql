EXECUTE ('
CREATE OR ALTER  VIEW [dbo].[VW_INTEGRANTES_PJ_PIF] (
											[Tipo Documento Identificativo],
											[Número Documento Identificativo],
											[Razón Social],
											[Nivel Apertura],
											[Estado],
											[Tipo Documento Identificativo PH/PJ],
											[Número Documento Identificativo PH/PJ],
											[Nombre],
											[Nivel Apertura PH/PJ],
											[Estado PH/PJ],
											[Cargo],
											[Tipo persona],
											[Numero PJ],
											[Numero PH/PJ])
AS
SELECT 
    V.TIPODOCUMENTO AS TIPODOC, 
    V.NUMERODOCUMENTO AS NUMERODOC, 
    T.RAZONSOCIAL, 
    CASE WHEN T.NIVEL_APERTURA=1 THEN ''BASICO'' ELSE 
    CASE WHEN T.NIVEL_APERTURA=3 THEN ''ACTIVO'' ELSE 
    CASE WHEN T.NIVEL_APERTURA=4 THEN ''INSTITUCION FINANCIERA'' END END END AS NIVEL_APERTURA,
    CASE WHEN T.ESTADO=0 THEN ''HABILITADO'' ELSE ''INHABILITADO'' END AS ESTADO,
    ID.TIPODOC AS TIPODOCINTEGRANTE, 
    ID.NUMERODOC AS NRODOCINTEGRANTE,
    CASE 
        WHEN (IJ.TIPO_PERSONA = ''J'') THEN 
        (
            SELECT JJ.RAZONSOCIAL
            FROM dbo.CLI_PERSONASJURIDICAS  AS JJ WITH (NOLOCK)
            WHERE JJ.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAFISICA
        )
        ELSE 
        (
            SELECT ISNULL(PF.APELLIDOPATERNO, '''') + '' '' + ISNULL(PF.PRIMERNOMBRE, '''') AS expr
            FROM dbo.CLI_PERSONASFISICAS  AS PF WITH (NOLOCK)
            WHERE PF.NUMEROPERSONAFISICA = IJ.NUMEROPERSONAFISICA
        )
    END AS NOMBRE,   
    CASE 
        WHEN (IJ.TIPO_PERSONA = ''J'') THEN 
        (SELECT CASE WHEN JJ.NIVEL_APERTURA=1 THEN ''BASICO'' ELSE 
      	CASE WHEN JJ.NIVEL_APERTURA=3 THEN ''ACTIVO'' ELSE 
      	CASE WHEN JJ.NIVEL_APERTURA=4 THEN ''INSTITUCION FINANCIERA'' END END END AS NIVEL_APERTURA
            FROM dbo.CLI_PERSONASJURIDICAS  AS JJ WITH (NOLOCK)
            WHERE JJ.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAFISICA)
        ELSE 
        CASE WHEN (ij.tipo_persona=''f'') then 
        (SELECT CASE WHEN PF.NIVEL_APERTURA=1 THEN ''BASICO'' ELSE 
      	CASE WHEN PF.NIVEL_APERTURA=3 THEN ''ACTIVO'' ELSE 
      	CASE WHEN PF.NIVEL_APERTURA=4 THEN ''INSTITUCION FINANCIERA'' END END END AS NIVEL_APERTURA
            FROM dbo.CLI_PERSONASFISICAS  AS PF WITH (NOLOCK)
            WHERE PF.NUMEROPERSONAFISICA = IJ.NUMEROPERSONAFISICA)
        END END AS NIVEL_APERTURA_INTEGRANTE,  
        CASE 
        WHEN (IJ.TIPO_PERSONA = ''J'') THEN 
        (SELECT CASE WHEN jj.ESTADO=0 THEN ''HABILITADO'' ELSE ''INHABILITADO'' END AS ESTADO
            FROM dbo.CLI_PERSONASJURIDICAS  AS JJ WITH (NOLOCK)
            WHERE JJ.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAFISICA)
        ELSE 
        CASE WHEN (ij.tipo_persona=''f'') then 
        (SELECT CASE WHEN PF.ESTADO=0 THEN ''HABILITADO'' ELSE ''INHABILITADO'' END AS ESTADO
            FROM dbo.CLI_PERSONASFISICAS  AS PF WITH (NOLOCK)
            WHERE PF.NUMEROPERSONAFISICA = IJ.NUMEROPERSONAFISICA)
        END END AS ESTADO_INTEGRANTE,    
    CASE 
    WHEN CP.CARGO IS NOT NULL THEN CP.CARGO
    ELSE A.Descripcion
    END AS CARGO, 
    IJ.TIPO_PERSONA AS TIPOPERSONA, 
    T.NUMEROPERSONAJURIDICA AS NUMEROPERSONA, 
    IJ.NUMEROPERSONAFISICA AS NUMEROPINTEGRANTE    
FROM dbo.CLI_PERSONASJURIDICAS  AS T WITH (NOLOCK)
INNER JOIN dbo.CLI_INTEGRANTESPJ  AS IJ WITH (NOLOCK)
      												ON T.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAJURIDICA
													AND IJ.TZ_LOCK = 0
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)
      								ON T.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
									AND V.TIPOPERSONA = ''J''
									AND V.TZ_LOCK = 0
INNER JOIN dbo.VW_PFPJ_DOCUMENTOS AS ID WITH (NOLOCK)
									ON IJ.NUMEROPERSONAFISICA = ID.NUMEROPERSONA
LEFT JOIN dbo.CLI_CARGOS_PERSONAS  AS CP WITH (NOLOCK)
      								ON IJ.CODIGOCARGO = CP.CODIGO -- AND (CP.TZ_LOCK = 0)
LEFT JOIN DJ_ACTORES A WITH (NOLOCK)
      								ON A.Id = IJ.CODIGOCARGO_DJ
WHERE
	(	(t.TZ_LOCK < 300000000000000 OR t.TZ_LOCK >= 400000000000000) 
	AND (t.TZ_LOCK < 100000000000000 OR t.TZ_LOCK >= 200000000000000));

')


