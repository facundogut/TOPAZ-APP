EXECUTE('
IF OBJECT_ID (''dbo.VW_SNP_EMPRESAS_HOMOLOGADAS'') IS NOT NULL
	DROP VIEW dbo.VW_SNP_EMPRESAS_HOMOLOGADAS

')
EXECUTE('
CREATE VIEW VW_SNP_EMPRESAS_HOMOLOGADAS
AS
SELECT
	DISTINCT
		PE.CUIT_EO,
		PE.NOMBRE_EMPRESA,
		PE.ENTIDAD AS ENTIDAD_ORIGINANTE,
		(select TOP 1 PE2.NOMENTIDAD 
		   from SNP_PRESTACIONES_EMPRESAS PE2
		  where PE2.cuit_EO = PE.CUIT_EO
		    AND PE2.entidad = PE.ENTIDAD
		   ) NOMBRE_ENTIDAD
FROM SNP_PRESTACIONES_EMPRESAS AS PE WITH (nolock)
WHERE
	((PE.TZ_LOCK < 100000000000000 OR PE.TZ_LOCK >= 200000000000000)
		AND (PE.TZ_LOCK < 300000000000000 OR PE.TZ_LOCK >= 400000000000000)  )
')
