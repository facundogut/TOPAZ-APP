EXECUTE('
IF OBJECT_ID (''dbo.VW_CHEQUE_RECHAZO_DEPOSITARIA'') IS NOT NULL
	DROP VIEW dbo.VW_CHEQUE_RECHAZO_DEPOSITARIA
')
EXECUTE('
CREATE VIEW [dbo].[VW_CHEQUE_RECHAZO_DEPOSITARIA] (
	ID_LIQUIDACION,
	MONEDA,
	NUMERO_CHEQUE,
	FECHA_VALOR,
	NUMERO_BANCO,
	NUMERO_DEPENDENCIA,
	CUENTA,
	ORDINAL_LISTA,
	SERIE_CHEQUE,
	CODIGO_CAUSAL_DEVOLUCION)
AS
SELECT 
	ROW_NUMBER() OVER(ORDER BY R.NUMERO_CHEQUE) AS ID_LIQUIDACION,
	R.MONEDA,
	R.NUMERO_CHEQUE,
	R.FECHA_VALOR,
	R.NUMERO_BANCO,
	R.NUMERO_DEPENDENCIA,
	R.CUENTA,
	R.ORDINAL_LISTA,
	R.SERIE_CHEQUE,
	R.CODIGO_CAUSAL_DEVOLUCION
FROM CLE_CHEQUES_CLEARING_RECH_DEPOSITARIA AS R WITH (nolock)
INNER JOIN CHE_CHEQUES AS CH WITH (nolock) ON 
	CH.SUCURSAL = R.NUMERO_DEPENDENCIA
	AND CH.MONEDA = R.MONEDA
	AND CH.CUENTA = R.CUENTA
	AND CH.PRODUCTO = R.PRODUCTO
	AND CH.OPERACION = 0
	AND CH.ORDINAL = 0
	AND CH.NUMEROCHEQUE = R.NUMERO_CHEQUE
	AND CH.SERIE = R.SERIE_CHEQUE
	AND CH.ESTADO IN (''P'',''R'')
	AND CH.TZ_LOCK = 0
WHERE 
	R.FECHA_VALOR = (SELECT dbo.diaHabil(DATEADD(day,-1,fechaproceso),''D'') FROM PARAMETROS)
	AND R.TZ_LOCK = 0
')