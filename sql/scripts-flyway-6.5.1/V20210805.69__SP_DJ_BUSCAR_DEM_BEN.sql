
CREATE OR ALTER PROCEDURE [dbo].[SP_DJ_BUSCAR_DEM_BEN]
@pTipoDoc VARCHAR(4),
@pTipoPersona VARCHAR(1),
@pNroDoc VARCHAR(20),
@pNroPersona NUMERIC(12) OUT
AS
DECLARE
	@vNroPersona NUMERIC(12),
	@vCont NUMERIC(6)
BEGIN
	SELECT TOP 1 @vNroPersona = d.NUMEROPERSONAFJ  
	FROM CLI_DocumentosPFPJ D WITH (NOLOCK)
	WHERE D.TIPODOCUMENTO=@pTipoDoc AND 
	D.NUMERODOCUMENTO=@pNroDoc AND
	d.TZ_LOCK=0
	
	IF @pTipoPersona = 'F'
		SELECT @vCont = COUNT(*) 
		FROM CLI_PERSONASFISICAS PF WITH (NOLOCK)
		WHERE PF.NUMEROPERSONAFISICA=@vNroPersona
	ELSE
		SELECT @vCont = COUNT(*) 
		FROM CLI_PERSONASJURIDICAS PJ WITH (NOLOCK)
		WHERE PJ.NUMEROPERSONAJURIDICA=@vNroPersona
	
	IF @vCont = 0 BEGIN
		SET @vNroPersona = 0
	END
	
	SET @pNroPersona = @vNroPersona
END