EXECUTE('
-----------------------------------
--MODIFICAR VISTA DE PYF_FORMULAS--
-----------------------------------
ALTER VIEW VW_PYF_FORMULAS
(TipoEntidad, DESCRIPCION_TIPO_ENTIDAD,IdEntidad,Cuenta,DENOMINACION_CUENTA,TipoPoder,DESCRIPCION_TIPO_PODER,
TipoDoc,NumDoc,NOMBRE_PERSONA)
AS
SELECT F.TIPO_ENTIDAD, E.DESCRIPCION, F.ID_ENTIDAD, ISNULL(S.CUENTA,0),  
CASE WHEN F.TIPO_ENTIDAD = 2 THEN V.NOMBRE_CUENTA
	ELSE C.NOMBRECLIENTE
END,
F.TIPO_PODER, P.DESCRIPCION,
CASE WHEN F.TIPO_ENTIDAD = 2 THEN ISNULL(DS.TIPODOC,0)
	ELSE ISNULL(DC.TIPODOC,0)
END,
CASE WHEN F.TIPO_ENTIDAD = 2 THEN ISNULL(DS.NUMERODOC,0)
	ELSE ISNULL(DC.NUMERODOC,0)
END,
CASE WHEN F.TIPO_ENTIDAD = 2 AND DS.TIPOPERSONA = ''F'' 
		THEN (SELECT CONCAT(PF.PRIMERNOMBRE + '' '', PF.APELLIDOPATERNO) FROM CLI_PERSONASFISICAS AS PF 
		WHERE DS.NUMEROPERSONA = PF.NUMEROPERSONAFISICA AND PF.TZ_LOCK =0 )
	WHEN F.TIPO_ENTIDAD = 2 AND DS.TIPOPERSONA = ''J''
		THEN (SELECT PJ.RAZONSOCIAL FROM CLI_PERSONASJURIDICAS AS PJ 
		WHERE DS.NUMEROPERSONA = PJ.NUMEROPERSONAJURIDICA AND PJ.TZ_LOCK = 0)
	WHEN F.TIPO_ENTIDAD = 1 AND DC.TIPOPERSONA = ''F''
		THEN (SELECT CONCAT(PF.PRIMERNOMBRE + '' '', PF.APELLIDOPATERNO) FROM CLI_PERSONASFISICAS AS PF 
		WHERE DC.NUMEROPERSONA = PF.NUMEROPERSONAFISICA AND PF.TZ_LOCK =0 )
	ELSE (SELECT PJ.RAZONSOCIAL FROM CLI_PERSONASJURIDICAS AS PJ 
		WHERE DC.NUMEROPERSONA = PJ.NUMEROPERSONAJURIDICA AND PJ.TZ_LOCK = 0)
END
FROM PYF_FORMULAS AS F
LEFT JOIN SALDOS S ON F.ID_ENTIDAD = S.JTS_OID AND F.TIPO_ENTIDAD = 2 AND S.TZ_LOCK=0
LEFT JOIN CLI_CLIENTES AS C ON F.ID_ENTIDAD = C.CODIGOCLIENTE AND F.TIPO_ENTIDAD = 1 AND C.TZ_LOCK = 0
LEFT JOIN PYF_TIPOENTIDAD AS E ON F.TIPO_ENTIDAD = E.TIPO_ENTIDAD AND E.TZ_LOCK = 0
LEFT JOIN PYF_TIPOPODERES AS P ON F.TIPO_PODER = P.TIPO_PODER AND P.TZ_LOCK = 0
LEFT JOIN VTA_SALDOS AS V ON S.JTS_OID = V.JTS_OID_SALDO AND V.TZ_LOCK = 0
LEFT JOIN VW_CLI_X_DOC AS DS ON S.C1803 = DS.CODIGOCLIENTE
LEFT JOIN VW_CLI_X_DOC AS DC ON C.CODIGOCLIENTE = DC.CODIGOCLIENTE
WHERE F.TZ_LOCK=0
----
')