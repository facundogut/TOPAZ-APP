

execute('CREATE  OR ALTER    VIEW [dbo].[VW_PERSONAS_FYJ_ACTIVAS] (
											   TipoDocIdent, 
											   NroDocIdent, 
											   TipoDocFisico,
											   NumDocFisico,
											   NOMBRE,
											   NIVELAPERTURA, 
											   TIPOPERSONA, 
											   NUMEROPERSONA
											   ,SUC_ALTA)
AS 
SELECT  
    V.TIPODOCUMENTO AS TipoDocIdent, 
    TRY_CONVERT(NUMERIC,V.NUMERODOCUMENTO) AS NroDocIdent, 
    V.TIPO_DOC_FISICO AS TIPO_DOC_FISICO,
    V.NUM_DOC_FISICO AS NUM_DOC_FISICO,
    ISNULL(U.PRIMERNOMBRE, '''') + '' '' + ISNULL(U.APELLIDOPATERNO, '''') + '' '' + ISNULL(U.APELLIDOMATERNO, '''') AS NOMBRE,
    CASE U.NIVEL_APERTURA
        WHEN 0 THEN ''REGISTRO''
        WHEN 1 THEN ''BÁSICO''
        -- WHEN 2 THEN ''PASIVOS''
        WHEN 3 THEN ''ACTIVOS''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA
    , u.SUC_ALTA AS SUC_ALTA
FROM dbo.CLI_PERSONASFISICAS  AS U WITH (NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH (NOLOCK)ON U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ
													AND(	(U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) 
														AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)) 
													AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
														AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
WHERE U.ESTADO=0
UNION ALL
SELECT  
    V.TIPODOCUMENTO AS TipoDocIdent, 
    TRY_CONVERT(NUMERIC,V.NUMERODOCUMENTO) AS NroDocIdent, 
    V.TIPO_DOC_FISICO AS TIPO_DOC_FISICO,
    V.NUM_DOC_FISICO AS NUM_DOC_FISICO,
    S.RAZONSOCIAL AS NOMBRE,
    CASE S.NIVEL_APERTURA
        WHEN 0 THEN ''REGISTRO''
        WHEN 1 THEN ''BÁSICO''
        -- WHEN 2 THEN ''PASIVOS''
        WHEN 3 THEN ''ACTIVOS''
        WHEN 4 THEN ''INST. FINANCIERA''
    END AS NIVELAPERTURA, 
    V.TIPOPERSONA, 
    V.NUMEROPERSONAFJ AS NUMEROPERSONA
    , S.SUC_ALTA AS SUC_ALTA
FROM dbo.CLI_PERSONASJURIDICAS  AS S WITH(NOLOCK)
INNER JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V WITH(NOLOCK) ON S.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ 
														AND (	(S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
															AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)) 
														AND (	(V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) 
															AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000))
WHERE S.ESTADO=0
');


