/****** Object:  View [dbo].[VW_CARGO_SALDOS_INMOVILIZADOS_DPF]    Script Date: 24/02/2021 17:54:05 ******/
DROP VIEW [dbo].[VW_CARGO_SALDOS_INMOVILIZADOS_DPF]
GO

/****** Object:  View [dbo].[VW_CARGO_SALDOS_INMOVILIZADOS_DPF]    Script Date: 24/02/2021 17:54:05 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[VW_CARGO_SALDOS_INMOVILIZADOS_DPF] 
														(
														   JTS_OID_SALDO,
														   MONEDA,
														   SALDO_ACTUAL,
														   DIAS_NOTIFICADO,
														   MESES_NOTIFICADO,
														   DIAS_PARAMETRO,
														   USF,
														   FECHA_INMOVILIZACION)
AS 

SELECT S.JTS_OID, 
	S.MONEDA, 
	S.C1604 + S.C1683 + S.C1605 + S.C2627 + S.C50107 AS SALDOACTUAL, 
	DATEDIFF(day,SI.FECHA_INMOVILIZACION, (SELECT P.FECHAPROCESO 
											FROM PARAMETROS P with (nolock))) AS DIASNOTIFICADO,
	DATEDIFF(month,SI.FECHA_INMOVILIZACION, (SELECT P.FECHAPROCESO 
												FROM PARAMETROS P with (nolock))) AS MESESNOTIFICADO,
	(SELECT PG.NUMERICO 
	FROM PARAMETROSGENERALES PG with (nolock)
	WHERE PG.CODIGO = 223 
			AND PG.TZ_LOCK = 0),
	C.USF,
	SI.FECHA_INMOVILIZACION
FROM SALDOS S with (nolock) 
	INNER JOIN DPF_SALDOS_INMOVILIZADOS SI with (nolock) ON S.JTS_OID = SI.JTS_OID_SALDO_DPF 
	INNER JOIN CLI_CLIENTES C with (nolock) ON C.[CODIGOCLIENTE] = S.C1803
WHERE S.C1785 = 4
	AND ((S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000))
	AND SI.TZ_LOCK = 0
	AND C.TZ_LOCK = 0;
GO


