EXECUTE('
DROP PROCEDURE IF EXISTS dbo.SP_CALCULO_DEUDA
')

EXECUTE('
CREATE PROCEDURE dbo.SP_CALCULO_DEUDA
   @P_CLIENTE NUMERIC(12),
   @P_DEUDA NUMERIC(20,2) OUT
AS 
   BEGIN
      SELECT @P_DEUDA=SUM(CASE WHEN AD.CAPITAL_ORIGEN > AD.SALDO_DEUDA THEN AD.CAPITAL_ORIGEN ELSE AD.SALDO_DEUDA END)
      FROM VW_ASISTENCIAS_DEUDA AD WITH(NOLOCK)
      INNER JOIN SALDOS S WITH(NOLOCK) ON S.JTS_OID = AD.JTS_OID
      WHERE S.C1785 IN (1,5,6)
      AND AD.CLIENTE = @P_CLIENTE AND AD.SALDO_DEUDA <> 0
   END
')
