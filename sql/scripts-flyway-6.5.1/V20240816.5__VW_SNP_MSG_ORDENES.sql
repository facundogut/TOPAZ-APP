EXECUTE('
IF OBJECT_ID (''dbo.VW_SNP_MSG_ORDENES'') IS NOT NULL
	DROP VIEW dbo.VW_SNP_MSG_ORDENES
')
EXECUTE('
CREATE VIEW VW_SNP_MSG_ORDENES
AS
SELECT
	C.FECHA_RECEPCION,
	O.CUIT_EO,
	E.NOMBRE_EMPRESA,
	O.PRESTACION,
	O.TIPO_DOCUMENTO AS TIPO_DOC_CLIENTE,
	O.NRO_DOCUMENTO AS DOCUMENTO_CLIENTE,
	B.CODIGOBC AS BANCO,
	B.NOMBRE AS NOMBRE_BANCO,
	O.CUENTA,
	O.MONEDA,
	M.C6400 AS NOMBRE_MONEDA,
	O.IMPORTE,
	O.FECHA_VENCIMIENTO,
	O.SEGUNDO_VTO,
	OE.DESCRIPCION AS ESTADO,
	O.ID_ARCHIVO,
	O.NRO_ARCHIVO,
	O.CORRELATIVO
FROM SNP_MSG_ORDENES AS O WITH (nolock)
INNER JOIN SNP_MSG_CABEZAL AS C WITH (nolock) ON
	C.CUIT_EO = O.CUIT_EO
	AND C.ID_ARCHIVO = O.ID_ARCHIVO
	AND C.NRO_ARCHIVO = O.NRO_ARCHIVO
	AND ((C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)
		AND (C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN SNP_PRESTACIONES_EMPRESAS AS E WITH (nolock) ON
	E.CUIT_EO = O.CUIT_EO
	AND E.PRESTACION = O.PRESTACION
	AND ((E.TZ_LOCK < 100000000000000 OR E.TZ_LOCK >= 200000000000000)
		AND (E.TZ_LOCK < 300000000000000 OR E.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN MONEDAS AS M WITH (nolock) ON
	M.C6399 = O.MONEDA
	AND ((M.TZ_LOCK < 100000000000000 OR M.TZ_LOCK >= 200000000000000)
		AND (M.TZ_LOCK < 300000000000000 OR M.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN OPCIONES AS OE WITH (nolock) ON
	OE.NUMERODECAMPO = 44613
	AND OE.IDIOMA = ''E''
	AND OE.OPCIONINTERNA = O.ESTADO
LEFT JOIN CLI_BANCOSPLAZA AS B WITH (nolock) ON
	CONVERT(VARCHAR, B.CODIGOBC) = LEFT(O.CBU, 3)
	AND B.SUCURSAL = 0
	AND ((B.TZ_LOCK < 100000000000000 OR B.TZ_LOCK >= 200000000000000)
		AND (B.TZ_LOCK < 300000000000000 OR B.TZ_LOCK >= 400000000000000)  
	)
WHERE
	O.TIPO_ORDEN = ''DEBENV''
	AND O.TZ_LOCK = 0
')

