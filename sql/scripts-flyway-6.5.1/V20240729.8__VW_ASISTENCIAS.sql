EXECUTE('
IF OBJECT_ID (''dbo.VW_ASISTENCIAS'') IS NOT NULL
	DROP VIEW dbo.VW_ASISTENCIAS
')

EXECUTE('
CREATE VIEW [dbo].[VW_ASISTENCIAS] (
									SUCURSAL,    
									NOMBRESUCURSAL, 
									PRODUCTO, 
									NOMBREPRODUCTO, 
									CUENTA, 
									OPERACION,
									DESGLOSE, 
									MONEDA, 
									MONTOORIGEN,
									SALDO,
									VENCIMIENTO,
									CLIENTE,
									TIPO,
									JTS_OID,
									ORDINAL,
									PORCENTAJE_PAGO,
									TASA,
									GARANTIA_DESEMBOLSO,
									SITUACION,
									FAMILIA,
									CLASIFICACION,
									ESTADO,
									TIPODOC, 
									NUMERODOC,
									PAISDOCUMENTO,
									NUMEROPERSONA)
AS
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		s.PRODUCTO AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		s.OPERACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		CASE WHEN C1785=6 THEN s.C1600 ELSE s.C1601 END AS MONTOORIGEN, 
		CASE WHEN C1785 = 1 THEN s.C1604 
			 WHEN C1785 = 6 THEN ((C1604*-1)+C1608) 
			 ELSE s.C1604*-1 END AS SALDO,  
		s.C1627 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		0 AS ORDINAL,
		CASE WHEN s.C1644 > 0 AND s.C1785 = 5 THEN round(s.C1645 * 100 / s.C1644,2) ELSE NULL END AS PORCENTAJE_PAGO,
		s.C1632 AS TASA,
		ext.GARANTIA_DESEMBOLSO,
		c.CATEGORIARESULTANTE AS SITUACION,
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		CASE WHEN s.C1728 = ''Z'' THEN ''Cedido'' WHEN s.C1728 = ''C'' THEN ''Castigado'' ELSE ''Normal'' END AS ESTADO,
		d.TIPODOC, 
		d.NUMERODOC,
		d.PAISDOCUMENTO,
		d.NUMEROPERSONA
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND ( (p.tz_lock < 300000000000000 OR p.tz_lock >= 400000000000000) AND (p.tz_lock < 100000000000000 OR p.tz_lock >= 200000000000000)  )
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND ( (f.tz_lock < 300000000000000 OR f.tz_lock >= 400000000000000) AND (f.tz_lock < 100000000000000 OR f.tz_lock >= 200000000000000)  )					
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND ( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000) AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND ( (suc.tz_lock < 300000000000000 OR suc.tz_lock >= 400000000000000) AND (suc.tz_lock < 100000000000000 OR suc.tz_lock >= 200000000000000)  )
LEFT JOIN CRE_SALDOS ext WITH(NOLOCK) ON s.JTS_OID = ext.SALDOS_JTS_OID AND ( (ext.tz_lock < 300000000000000 OR ext.tz_lock >= 400000000000000) AND (ext.tz_lock < 100000000000000 OR ext.tz_lock >= 200000000000000)  )						
INNER JOIN CLI_CLIENTES c WITH (NOLOCK) ON s.C1803 = c.CODIGOCLIENTE AND ( (c.tz_lock < 300000000000000 OR c.tz_lock >= 400000000000000) AND (c.tz_lock < 100000000000000 OR c.tz_lock >= 200000000000000)  )	
INNER JOIN VW_CLI_X_DOC d ON d.CODIGOCLIENTE=s.C1803
WHERE (s.C1785 IN (5,6) OR (s.C1785 = 1 AND p.C6800 = ''GO'')) AND ( (s.tz_lock < 300000000000000 OR s.tz_lock >= 400000000000000) AND (s.tz_lock < 100000000000000 OR s.tz_lock >= 200000000000000)  )	
UNION
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		v.NROLINEA AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		v.NRO_AUTORIZACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		v.IMPORTE AS MONTOORIGEN, 
		v.IMPORTE - v.IMPORTE_CONSUMIDO AS SALDO, 
		v.FECHA_VENCIMIENTO AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		1 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		v.ORDINAL AS ORDINAL,
		NULL AS PORCENTAJE_PAGO,
		NULL AS TASA,
		NULL AS GARANTIA_DESEMBOLSO,
		NULL AS SITUACION,
		NULL AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		''Normal'' AS ESTADO,
		d.TIPODOC, 
		d.NUMERODOC,
		d.PAISDOCUMENTO,
		d.NUMEROPERSONA		
FROM VTA_SOBREGIROS v WITH(NOLOCK)
INNER JOIN SALDOS s WITH(NOLOCK) ON v.JTS_OID_SALDO = s.JTS_OID 
					AND ( (s.tz_lock < 300000000000000 OR s.tz_lock >= 400000000000000) AND (s.tz_lock < 100000000000000 OR s.tz_lock >= 200000000000000)  )	
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON v.NROLINEA = p.C6250 
						AND ( (p.tz_lock < 300000000000000 OR p.tz_lock >= 400000000000000) AND (p.tz_lock < 100000000000000 OR p.tz_lock >= 200000000000000)  )						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
					AND ( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000) AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )	
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON v.SUCURSAL_ACUERDO = suc.SUCURSAL 
						AND ( (suc.tz_lock < 300000000000000 OR suc.tz_lock >= 400000000000000) AND (suc.tz_lock < 100000000000000 OR suc.tz_lock >= 200000000000000)  )	
INNER JOIN VW_CLI_X_DOC d ON d.CODIGOCLIENTE=s.C1803						
WHERE v.ESTADO = 1 AND ( (v.tz_lock < 300000000000000 OR v.tz_lock >= 400000000000000) AND (v.tz_lock < 100000000000000 OR v.tz_lock >= 200000000000000)  )	
UNION
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		s.PRODUCTO AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		s.OPERACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		s.C1832 AS MONTOORIGEN, 
		s.AJUSTEINFLACION AS SALDO,  
		s.C1761 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		0 AS ORDINAL,
		NULL AS PORCENTAJE_PAGO,
		NULL AS TASA,
		NULL AS GARANTIA_DESEMBOLSO,
		NULL AS SITUACION,
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		''Normal'' AS ESTADO,
		d.TIPODOC, 
		d.NUMERODOC,
		d.PAISDOCUMENTO,
		d.NUMEROPERSONA				
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND  ( (p.tz_lock < 300000000000000 OR p.tz_lock >= 400000000000000) AND (p.tz_lock < 100000000000000 OR p.tz_lock >= 200000000000000)  )	
						AND p.C6800 = ''T'' 
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND ( (f.tz_lock < 300000000000000 OR f.tz_lock >= 400000000000000) AND (f.tz_lock < 100000000000000 OR f.tz_lock >= 200000000000000)  )						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND ( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000) AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )	
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND ( (suc.tz_lock < 300000000000000 OR suc.tz_lock >= 400000000000000) AND (suc.tz_lock < 100000000000000 OR suc.tz_lock >= 200000000000000)  )						
INNER JOIN CLI_CLIENTES c WITH(NOLOCK) ON s.C1803 = c.CODIGOCLIENTE AND ( (c.tz_lock < 300000000000000 OR c.tz_lock >= 400000000000000) AND (c.tz_lock < 100000000000000 OR c.tz_lock >= 200000000000000)  )	
INNER JOIN VW_CLI_X_DOC d ON d.CODIGOCLIENTE=s.C1803
WHERE s.C1785 = 1 
	AND  ( (s.tz_lock < 300000000000000 OR s.tz_lock >= 400000000000000) AND (s.tz_lock < 100000000000000 OR s.tz_lock >= 200000000000000)  )
')

EXECUTE('
IF OBJECT_ID (''dbo.VW_ASISTENCIAS_COBRADOR'') IS NOT NULL
	DROP VIEW dbo.VW_ASISTENCIAS_COBRADOR
')

EXECUTE('
CREATE   VIEW [dbo].[VW_ASISTENCIAS_COBRADOR] (
									SUCURSAL,    
									NOMBRESUCURSAL, 
									PRODUCTO, 
									NOMBREPRODUCTO, 
									CUENTA, 
									OPERACION,
									DESGLOSE, 
									MONEDA, 
									MONTOORIGEN,
									SALDO,
									VENCIMIENTO,
									CLIENTE,
									TIPO,
									JTS_OID,
									ORDINAL,
									PORCENTAJE_PAGO,
									TASA,
									GARANTIA_DESEMBOLSO,
									SITUACION,
									FAMILIA,
									CLASIFICACION,
									ESTADO)
AS
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		s.PRODUCTO AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		s.OPERACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		s.C1601 AS MONTOORIGEN, 
		CASE WHEN C1785 = 1 THEN s.C1604 ELSE s.C1604*-1 END AS SALDO, 
		s.C1628 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		0 AS ORDINAL,
		CASE WHEN s.C1644 > 0 AND s.C1785 = 5 THEN round(s.C1645 * 100 / s.C1644,2) ELSE NULL END AS PORCENTAJE_PAGO,
		s.C1632 AS TASA,
		ext.GARANTIA_DESEMBOLSO,
		c.CATEGORIARESULTANTE AS SITUACION,
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		CASE WHEN s.C1728 = ''Z'' THEN ''Cedido'' WHEN s.C1728 = ''C'' THEN ''Castigado'' ELSE ''Normal'' END AS ESTADO
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND ( (p.tz_lock < 300000000000000 OR p.tz_lock >= 400000000000000) AND (p.tz_lock < 100000000000000 OR p.tz_lock >= 200000000000000)  )
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND ( (f.tz_lock < 300000000000000 OR f.tz_lock >= 400000000000000) AND (f.tz_lock < 100000000000000 OR f.tz_lock >= 200000000000000)  )					
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND ( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000) AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND ( (suc.tz_lock < 300000000000000 OR suc.tz_lock >= 400000000000000) AND (suc.tz_lock < 100000000000000 OR suc.tz_lock >= 200000000000000)  )
LEFT JOIN CRE_SALDOS ext WITH(NOLOCK) ON s.JTS_OID = ext.SALDOS_JTS_OID AND ( (ext.tz_lock < 300000000000000 OR ext.tz_lock >= 400000000000000) AND (ext.tz_lock < 100000000000000 OR ext.tz_lock >= 200000000000000)  )						
INNER JOIN CLI_CLIENTES c WITH(NOLOCK) ON s.C1803 = c.CODIGOCLIENTE AND ( (c.tz_lock < 300000000000000 OR c.tz_lock >= 400000000000000) AND (c.tz_lock < 100000000000000 OR c.tz_lock >= 200000000000000)  )	
WHERE (s.C1785 IN (5,6) OR (s.C1785 = 1 AND p.C6800 = ''GO'')) AND ( (s.tz_lock < 300000000000000 OR s.tz_lock >= 400000000000000) AND (s.tz_lock < 100000000000000 OR s.tz_lock >= 200000000000000)  )	
UNION
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		v.NROLINEA AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		v.NRO_AUTORIZACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		v.IMPORTE AS MONTOORIGEN, 
		v.IMPORTE - v.IMPORTE_CONSUMIDO AS SALDO, 
		v.FECHA_VENCIMIENTO AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		1 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		v.ORDINAL AS ORDINAL,
		NULL AS PORCENTAJE_PAGO,
		NULL AS TASA,
		NULL AS GARANTIA_DESEMBOLSO,
		NULL AS SITUACION,
		NULL AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		''Normal'' AS ESTADO
FROM VTA_SOBREGIROS v WITH(NOLOCK)
INNER JOIN SALDOS s WITH(NOLOCK) ON v.JTS_OID_SALDO = s.JTS_OID 
					AND ( (s.tz_lock < 300000000000000 OR s.tz_lock >= 400000000000000) AND (s.tz_lock < 100000000000000 OR s.tz_lock >= 200000000000000)  )	
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON v.NROLINEA = p.C6250 
						AND ( (p.tz_lock < 300000000000000 OR p.tz_lock >= 400000000000000) AND (p.tz_lock < 100000000000000 OR p.tz_lock >= 200000000000000)  )						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
					AND ( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000) AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )	
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON v.SUCURSAL_ACUERDO = suc.SUCURSAL 
						AND ( (suc.tz_lock < 300000000000000 OR suc.tz_lock >= 400000000000000) AND (suc.tz_lock < 100000000000000 OR suc.tz_lock >= 200000000000000)  )	
WHERE v.ESTADO = 1 AND ( (v.tz_lock < 300000000000000 OR v.tz_lock >= 400000000000000) AND (v.tz_lock < 100000000000000 OR v.tz_lock >= 200000000000000)  )	
UNION
SELECT	s.SUCURSAL AS SUCURSAL, 
		suc.NOMBRESUCURSAL AS NOMBRESUCURSAL, 
		s.PRODUCTO AS PRODUCTO, 
		p.C6251 AS NOMBREPRODUCTO,
		s.CUENTA AS CUENTA, 
		s.OPERACION AS OPERACION, 
		s.ORDINAL AS DESGLOSE, 
		m.C6401 AS MONEDA, 
		s.C1832 AS MONTOORIGEN, 
		s.AJUSTEINFLACION AS SALDO, 
		s.C1761 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		0 AS ORDINAL,
		NULL AS PORCENTAJE_PAGO,
		NULL AS TASA,
		NULL AS GARANTIA_DESEMBOLSO,
		NULL AS SITUACION,
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION,
		''Normal'' AS ESTADO
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND  ( (p.tz_lock < 300000000000000 OR p.tz_lock >= 400000000000000) AND (p.tz_lock < 100000000000000 OR p.tz_lock >= 200000000000000)  )	
						AND p.C6800 = ''T'' 
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND ( (f.tz_lock < 300000000000000 OR f.tz_lock >= 400000000000000) AND (f.tz_lock < 100000000000000 OR f.tz_lock >= 200000000000000)  )						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND ( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000) AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )	
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND ( (suc.tz_lock < 300000000000000 OR suc.tz_lock >= 400000000000000) AND (suc.tz_lock < 100000000000000 OR suc.tz_lock >= 200000000000000)  )						
INNER JOIN CLI_CLIENTES c WITH(NOLOCK) ON s.C1803 = c.CODIGOCLIENTE AND ( (c.tz_lock < 300000000000000 OR c.tz_lock >= 400000000000000) AND (c.tz_lock < 100000000000000 OR c.tz_lock >= 200000000000000)  )	
WHERE s.C1785 = 1 
	AND  ( (s.tz_lock < 300000000000000 OR s.tz_lock >= 400000000000000) AND (s.tz_lock < 100000000000000 OR s.tz_lock >= 200000000000000)  )

')