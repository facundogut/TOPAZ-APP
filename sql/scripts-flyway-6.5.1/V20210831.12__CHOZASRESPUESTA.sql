EXECUTE('

ALTER VIEW [dbo].[VW_ITF_CHOZAS_SOLICITUD] AS

SELECT 			''311'' AS NROBANCO,

				(CASE WHEN CH.TIPOCHEQUES = ''C'' AND CH.TIPOCHEQUERA = ''C'' THEN ''01''  
					  WHEN CH.TIPOCHEQUES = ''D'' AND CH.TIPOCHEQUERA = ''T'' THEN ''02''
					  WHEN CH.TIPOCHEQUES = ''C'' AND CH.TIPOCHEQUERA = ''T'' THEN ''03''
					  WHEN CH.TIPOCHEQUES = ''D'' AND CH.TIPOCHEQUERA = ''C'' THEN ''04''					  		
				ELSE ''08'' 
				END) AS TIPOFORMULARIO,
				RIGHT(''000''+CAST(SUCURSAL AS VARCHAR(3)),3) AS NRO_SUCURSAL,
				RIGHT(''00000000000''+CAST(CUENTA AS VARCHAR(11)),11) AS NRO_CUENTA,
				RIGHT(''000''+CAST(CANTIDAD AS VARCHAR(3)),3) AS CANTIDAD_LIBRETAS,
			   	RIGHT(''00000''+CAST( PaquetesDe  AS VARCHAR(5)),5) AS TIPO_LIBRETA,
			   	CH.ESTADO,									
		   		(SELECT DOMICILIO FROM (
				SELECT TOP 1 CAST((rtrim(ltrim(concat(D.CALLE , '' - '' , 
						D.NUMERO , '' - '' , 
						D.LOCALIDAD , '' - '' , 
						D.CPA_NUEVO , '' - '' , 
						D.PROVINCIA)))) AS VARCHAR(60)) AS DOMICILIO,
						(CASE 	  WHEN D.TIPODIRECCION = ''E''  THEN 1  
									WHEN D.TIPODIRECCION = ''L''  THEN 2 
									WHEN D.TIPODIRECCION = ''PR'' THEN 3
									WHEN D.TIPODIRECCION = ''F''  THEN 4 					  		
									ELSE 0 END ) AS ORDENDIR 
				FROM VW_CLI_DIRECCIONES D WITH (NOLOCK)			  
				WHERE D.CODIGOCLIENTE=CH.CLIENTE 
					AND D.FORMATO IN (''PF'',''PJ'') 
					AND D.TIPODIRECCION IN (''E'',''L'',''PR'',''F'') 
				ORDER BY ORDENDIR ASC 
				) AS DOMICILIO) AS DOMICILIO,
				
				LEFT((	SELECT MAX (FORMAT(C1621,''MMyy'')) 
						FROM SALDOS S WITH (NOLOCK) 
						WHERE S.CUENTA = CH.CUENTA 
							AND TZ_LOCK = 0),4)  AS FECHA_APERTURA,
				
				CONCAT(dbo.NCADENAS(CAST(CH.NROSOLICITUD_SUCURSAL_CUENTA AS VARCHAR(10)),10,''0'',''P''),
				dbo.NCADENAS(CAST(CH.NROSOLICITUD AS VARCHAR(10)),10,''0'',''P'')) AS NRO_PEDIDO,
				SUBSTRING(LETRA_NUMERO_IMPRENTA, 1, 1) AS LETRA,
				RIGHT(''0000000000''+ CAST(SUBSTRING(LETRA_NUMERO_IMPRENTA, 2, 10) AS VARCHAR(10)),10) AS NROCHEQUERA,								
				CH.CLIENTE AS CODCLIENTE
FROM CHE_CHEQUESIMPRENTA CH  WITH (NOLOCK)
WHERE CH.TZ_LOCK = 0;

')

