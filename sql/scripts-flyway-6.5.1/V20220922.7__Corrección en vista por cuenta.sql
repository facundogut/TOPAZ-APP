EXECUTE('

IF OBJECT_ID (''dbo.VW_CLE_DPF_RECIBIDO'') IS NOT NULL
	DROP VIEW dbo.VW_CLE_DPF_RECIBIDO
')


EXECUTE('
CREATE   VIEW [dbo].[VW_CLE_DPF_RECIBIDO]
												(NUMERO_DPF, 
												SUCURSAL, 
												CUENTA, 
												NOMBRE_CLIENTE, 
												PRODUCTO, 
												DESC_PRODUCTO, 
												MONEDA, 
												OPERACION,
												IMPORTE, 
												ESTADO, 
												CAUSAL, 
												DESCRIPCION_CAUSAL, 
												FECHA,
												CUENTA_RECIBIDA)
AS
SELECT D.NUMERO_DPF,
	D.NUMERO_DEPENDENCIA,
	S.CUENTA AS NUMERICO_CUENTA,
	C.NOMBRECLIENTE,
	D.PRODUCTO,
	P.C6251,
	D.MONEDA,
	D.OPERACION,
	D.IMPORTE,
	D.ESTADO_DPF,
	D.CODIGO_CAUSAL_RECHAZO,
	T.DESCRIPCION,
	D.FECHA_VALOR,
	d.NUMERICO_CUENTA
FROM CLE_DPF_RECIBIDO AS D WITH (nolock)
LEFT JOIN CLI_CLIENTES AS C WITH (nolock) ON
										D.CLIENTE = C.CODIGOCLIENTE
										AND C.TZ_LOCK = 0
LEFT JOIN PRODUCTOS AS P WITH (nolock) ON
										D.PRODUCTO = P.C6250
										AND P.TZ_LOCK = 0
LEFT JOIN CLE_TIPO_CAUSAL AS T WITH (nolock) ON
											D.CODIGO_CAUSAL_RECHAZO = T.CODIGO_DE_CAUSAL
											AND T.TZ_LOCK = 0
LEFT JOIN saldos s WITH (nolock) ON 
								 s.SUCURSAL = D.NUMERO_DEPENDENCIA
								 AND s.PRODUCTO=D.PRODUCTO
								 AND s.MONEDA=D.MONEDA
								 AND s.OPERACION=D.OPERACION
								 AND s.TZ_LOCK=0
WHERE D.TZ_LOCK = 0
')





