EXECUTE('
IF OBJECT_ID (''dbo.VW_SNP_DEBITOS'') IS NOT NULL
	DROP VIEW dbo.VW_SNP_DEBITOS
')
EXECUTE('
CREATE VIEW VW_SNP_DEBITOS
AS
SELECT
	D.ID_DEBITO,
	D.PRESTACION,
	PJ.RAZONSOCIAL AS NOMBRE_EMPRESA,
	D.CUIT_EO,
	M.C6400 AS MONEDA,
	CASE
		WHEN REVERSA = 1 THEN -(D.IMPORTE)
		ELSE D.IMPORTE
	END AS IMPORTE,
	D.FECHA_VTO,
	OS.DESCRIPCION AS TIPO_CUENTA_DEBITADA,
	S.CUENTA AS CUENTA_DEBITADA,
	C.CODIGOCLIENTE AS CLIENTE,
	C.NOMBRECLIENTE AS NOMBRE_CLIENTE,
	OE.DESCRIPCION AS ESTADO_DEBITO,
	CASE
		WHEN REVERSA = 1 THEN ''Si''
		ELSE ''No''
	END AS REVERSA,
	D.FECHA_ESTADO,
	D.MOTIVO_RECHAZO,
	D.SALDO_JTS_OID
FROM SNP_DEBITOS AS D WITH (nolock)
INNER JOIN MONEDAS AS M WITH (nolock) ON
	M.C6399 = D.MONEDA
	AND ((M.TZ_LOCK < 100000000000000 OR M.TZ_LOCK >= 200000000000000)
		AND (M.TZ_LOCK < 300000000000000 OR M.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN SALDOS AS S WITH (nolock) ON
	S.JTS_OID = D.SALDO_JTS_OID
	AND ((S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)
		AND (S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN OPCIONES AS OS WITH (nolock) ON
	OS.NUMERODECAMPO = 1785
	AND OS.IDIOMA = ''E''
	AND OS.OPCIONINTERNA = S.C1785
INNER JOIN CLI_CLIENTES AS C WITH (nolock) ON
	C.CODIGOCLIENTE = S.C1803
	AND ((C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)
		AND (C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN OPCIONES AS OE WITH (nolock) ON
	OE.NUMERODECAMPO = 44701
	AND OE.IDIOMA = ''E''
	AND OE.OPCIONINTERNA = D.ESTADO	
LEFT JOIN CLI_DOCUMENTOSPFPJ AS DOC WITH (nolock) ON
	DOC.NUMERODOCUMENTO = D.CUIT_EO
	AND DOC.NUMEROPERSONAFJ IN (SELECT TOP 1 NUMEROPERSONAFJ
								FROM CLI_DOCUMENTOSPFPJ
								WHERE NUMERODOCUMENTO = DOC.NUMERODOCUMENTO
									AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
										AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  
									)
								ORDER BY NUMEROPERSONAFJ, TIPODOCUMENTO
								)
	AND DOC.TIPODOCUMENTO IN 	(SELECT TOP 1 TIPODOCUMENTO
								FROM CLI_DOCUMENTOSPFPJ
								WHERE NUMERODOCUMENTO = DOC.NUMERODOCUMENTO
									AND NUMEROPERSONAFJ = DOC.NUMEROPERSONAFJ
									AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
										AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  
									)
								ORDER BY NUMEROPERSONAFJ, TIPODOCUMENTO
								)
	AND ((DOC.TZ_LOCK < 100000000000000 OR DOC.TZ_LOCK >= 200000000000000)
		AND (DOC.TZ_LOCK < 300000000000000 OR DOC.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN CLI_PERSONASJURIDICAS AS PJ WITH (nolock) ON
	PJ.NUMEROPERSONAJURIDICA = DOC.NUMEROPERSONAFJ
	AND ((PJ.TZ_LOCK < 100000000000000 OR PJ.TZ_LOCK >= 200000000000000)
		AND (PJ.TZ_LOCK < 300000000000000 OR PJ.TZ_LOCK >= 400000000000000)  
	)
WHERE
	D.TZ_LOCK = 0
')

