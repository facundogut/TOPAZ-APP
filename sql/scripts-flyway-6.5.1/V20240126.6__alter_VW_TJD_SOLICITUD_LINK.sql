execute('
CREATE OR ALTER VIEW [dbo].[VW_TJD_SOLICITUD_LINK]
AS
SELECT
	TS.ID_SOLICITUD,
	TS.TIPO_SOLICITUD,
	TTN.DESCRIPCION AS DESC_TIPO_SOLICITUD,
	TS.ESTADO,
	O.DESCRIPCION AS DESC_ESTADO,
	''CUIL'' AS TIPO_DOCUMENTO,
	TS.CUIL AS NRO_DOCUMENTO,
	TS.APELLIDO,
	TS.NOMBRE,
	TS.NRO_TARJETA_BASE,
	CASE 
		WHEN TT.ID_TARJETA IS NULL 
			THEN ''''
		ELSE TT.ID_TARJETA
	END NRO_TARJETA_COMPLETA,
	TS.USUARIO_SOLICITUD,
	TS.FECHA_SOLICITUD,
	TS.HORA_SOLICITUD
FROM 
	TJD_SOLICITUD_LINK AS TS WITH (nolock)
INNER JOIN TJD_TIPOS_NOVEDADES_LINK AS TTN WITH (nolock) ON 
	TTN.CODIGO_LINK = TS.TIPO_SOLICITUD
	AND ((TTN.TZ_LOCK < 100000000000000 OR TTN.TZ_LOCK >= 200000000000000)
		AND (TTN.TZ_LOCK < 300000000000000 OR TTN.TZ_LOCK >= 400000000000000)  
	)
	AND TTN.CODIGO = (	SELECT TOP 1 CODIGO 
						FROM TJD_TIPOS_NOVEDADES_LINK
						WHERE
							CODIGO_LINK = TTN.CODIGO_LINK
							AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
								AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  
							)
					)
LEFT JOIN TJD_TARJETAS AS TT WITH (nolock) ON 
	TT.ID_TARJETA_BASE = TS.NRO_TARJETA_BASE
	AND TT.ID_TARJETA=TS.NRO_TARJETA_COMPLETA	
	AND ((TT.TZ_LOCK < 100000000000000 OR TT.TZ_LOCK >= 200000000000000)
		AND (TT.TZ_LOCK < 300000000000000 OR TT.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN OPCIONES AS O WITH (nolock) ON 
	O.OPCIONINTERNA = TS.ESTADO
	AND O.IDIOMA = ''E''
	AND O.NUMERODECAMPO = 34812
WHERE 
	TS.TZ_LOCK = 0

	')
