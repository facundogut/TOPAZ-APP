EXECUTE('
IF OBJECT_ID (''dbo.VW_CLI_PERSONAS_FIRMAS'') IS NOT NULL
	DROP VIEW dbo.VW_CLI_PERSONAS_FIRMAS
')
EXECUTE('
CREATE VIEW [dbo].[VW_CLI_PERSONAS_FIRMAS]
													(TIPO_DOC,
													NRO_DOC,
													NRO_PERSONA,
													NOMBRE_APELLIDO,
													NRO_FIRMA,
													VENCIMIENTO,
													AUTORIZADOR,
													TIENE_FIRMA)
AS 
SELECT	D.TIPODOCUMENTO, 
		D.NUMERODOCUMENTO, 
		F.NUMEROPERSONAFISICA, 
		CONCAT(P.PRIMERNOMBRE+'' '',
		P.APELLIDOPATERNO),
		F.NUMERO_FIRMA, 
		F.VENCIMIENTO, 
		F.AUTORIZADOR,
		CASE 
			WHEN (F.FIRMA IS NULL OR F.FIRMA = '''') THEN 0
			ELSE 1
		END
FROM 
	CLI_PERSONAS_FIRMAS AS F WITH (NOLOCK)
INNER JOIN CLI_PERSONASFISICAS AS P WITH (NOLOCK) ON 
	F.NUMEROPERSONAFISICA = P.NUMEROPERSONAFISICA 
	AND P.TZ_LOCK = 0
LEFT JOIN CLI_DOCUMENTOSPFPJ AS D WITH (NOLOCK) ON 
	F.NUMEROPERSONAFISICA = D.NUMEROPERSONAFJ 
	AND D.TZ_LOCK = 0
WHERE F.TZ_LOCK = 0
')
