EXECUTE('

ALTER   VIEW [dbo].[VW_BILLETAJE_PARA_REPORTE] AS
SELECT 
		b.SUCURSAL,
		b.ASIENTO,
		b.CAJA,
		c.ESTADO,
		c.MINIFILIAL,
		b.FECHA,
		b.MONEDA,
		b.TIPO,
		(CASE 
			WHEN b.TIPO=''Billete'' THEN ''B''
			WHEN b.TIPO=''Moneda'' THEN ''M''
		END
		) AS ''TIPO_BM'',
		b.DENOMINACION,
		b.DETERIORADO,
		b.CANTIDAD,
		(b.DENOMINACION*b.CANTIDAD) AS ''IMPORTE'',
		(s.SALDOINICIAL+s.ENTRADAS-s.SALIDAS) AS ''ACTUAL_CONTABLE_MONEDA''
FROM CAJ_HISTORIAL_BILLETAJE b WITH (NOLOCK)
LEFT JOIN VW_CAJ_CAJAS c WITH (NOLOCK) ON c.NRO_CAJA=b.CAJA 
										AND c.SUCURSAL=b.SUCURSAL 
LEFT JOIN SALDOSCAJA_HISTORICO s WITH (NOLOCK) ON s.FECHAPROCESO=b.FECHA 
												AND s.NROCAJA=b.CAJA 
												AND s.MONEDA=b.MONEDA 
												AND s.SUCURSAL=b.SUCURSAL
WHERE b.ASIENTO IN (SELECT MAX(ASIENTO) 
					FROM CAJ_HISTORIAL_BILLETAJE  WITH (NOLOCK)
					WHERE SUCURSAL=b.SUCURSAL 
						AND CAJA=b.CAJA  
						AND FECHA=b.FECHA 
						AND TZ_LOCK=0 
					GROUP BY CAJA)
AND ((b.TZ_LOCK < 300000000000000 OR b.TZ_LOCK >= 400000000000000) 
AND (b.TZ_LOCK < 100000000000000 OR b.TZ_LOCK >= 200000000000000));

')