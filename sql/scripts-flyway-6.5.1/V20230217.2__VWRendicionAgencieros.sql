execute('

ALTER VIEW VW_RENDICION_AGENCIEROS as
SELECT a.Id_ConvRec AS ''ID_CONVENIO'', a.NomConvRec AS ''NOMBRE_CONVENIO'', a.Cuit AS ''CUIT'', a.NOMBRECLIENTE AS ''NOMBRE_CLIENTE'',
a.Acreditacion AS ''PLAZO_ACRED'',a.FECHA_COBRO_PAGO AS ''FECHA_COBROPAGO'', 
a.[ESTADO REND] AS ''ESTADO_REND'', A.SIG_IMP_LIQUIDO AS ''SIGNO'',
a.[TOTAL REGISTROS] AS ''TOTAL_REGISTROS'', a.[TOTAL IMPORTE] AS ''TOTAL_IMPORTE'', A.[IMPORTE JUEGOS] AS ''IMPORTE_JUEGOS'',
a.FECHA_REND

FROM 
	-- DEBITOS
	(SELECT C.Id_ConvRec, C.NomConvRec, C.Cuit,
		CLI.NOMBRECLIENTE, C.Acreditacion, A.FECHA_COBRO_PAGO, 
		O.DESCRIPCION AS [ESTADO REND],A.SIG_IMP_LIQUIDO, 
		COUNT(*) AS [TOTAL REGISTROS], SUM(A.IMPORTE_LIQUIDO) AS [TOTAL IMPORTE], SUM(A.IMPORTE_JUEGOS) AS [IMPORTE JUEGOS],
		CAST((CASE WHEN C.Acreditacion = OE.OPCIONINTERNA AND OE.OPCIONINTERNA = ''24H''
			THEN dbo.diaHabil(DATEADD(day,1,a.FECHA_COBRO_PAGO),''A'')
			WHEN C.Acreditacion = OE.OPCIONINTERNA AND 	OE.OPCIONINTERNA = ''48H''
			THEN dbo.diaHabil(DATEADD(day,2,a.FECHA_COBRO_PAGO),''A'') END) AS DATETIME) AS [FECHA_REND]  
	FROM REC_Agencieros A
		JOIN OPCIONES O ON O.OPCIONINTERNA = A.ESTADO_REND AND O.NUMERODECAMPO = 45226 AND O.IDIOMA = ''E'',
		CONV_CONVENIOS_REC C
		JOIN OPCIONES OE ON OE.OPCIONINTERNA = C.Acreditacion AND OE.NUMERODECAMPO = 44755 AND OE.IDIOMA = ''E''
		LEFT JOIN CLI_CLIENTES CLI ON C.Cliente = CLI.CODIGOCLIENTE AND CLI.TZ_LOCK = 0
		JOIN PARAMETROSGENERALES p ON C.Id_ConvRec = p.NUMERICO AND p.CODIGO IN(300) AND p.TZ_LOCK = 0
	WHERE A.ESTADO = ''P'' AND A.ESTADO_REND = ''P'' AND A.SIG_IMP_LIQUIDO =1
	GROUP BY C.Id_ConvRec, C.NomConvRec, C.Cuit, CLI.NOMBRECLIENTE, C.Acreditacion, A.FECHA_COBRO_PAGO, O.DESCRIPCION, OE.OPCIONINTERNA, A.SIG_IMP_LIQUIDO

union
	-- CREDITOS
	SELECT C.Id_ConvRec, C.NomConvRec, C.Cuit,
		CLI.NOMBRECLIENTE, C.Acreditacion, A.FECHA_COBRO_PAGO, 
		O.DESCRIPCION AS [ESTADO REND], A.SIG_IMP_LIQUIDO,
		COUNT(*) AS [TOTAL REGISTROS], SUM(A.IMPORTE_LIQUIDO) AS [TOTAL IMPORTE],  SUM(A.IMPORTE_JUEGOS) AS [IMPORTE JUEGOS],
		CAST((CASE WHEN C.Acreditacion = OE.OPCIONINTERNA AND OE.OPCIONINTERNA = ''24H''
			THEN dbo.diaHabil(DATEADD(day,1,a.FECHA_COBRO_PAGO),''A'')
			WHEN C.Acreditacion = OE.OPCIONINTERNA AND 	OE.OPCIONINTERNA = ''48H''
			THEN dbo.diaHabil(DATEADD(day,2,a.FECHA_COBRO_PAGO),''A'') END) AS DATETIME) AS [FECHA_REND] 
	FROM REC_Agencieros A
		JOIN OPCIONES O ON O.OPCIONINTERNA = A.ESTADO_REND AND O.NUMERODECAMPO = 45226 AND O.IDIOMA = ''E'',
		CONV_CONVENIOS_REC C
		JOIN OPCIONES OE ON OE.OPCIONINTERNA = C.Acreditacion AND OE.NUMERODECAMPO = 44755 AND OE.IDIOMA = ''E''
		LEFT JOIN CLI_CLIENTES CLI ON C.Cliente = CLI.CODIGOCLIENTE AND CLI.TZ_LOCK = 0
		JOIN PARAMETROSGENERALES p ON C.Id_ConvRec = p.NUMERICO AND p.CODIGO IN(301) AND p.TZ_LOCK = 0
	WHERE A.ESTADO = ''P'' AND A.ESTADO_REND = ''P'' AND A.SIG_IMP_LIQUIDO =2
	GROUP BY C.Id_ConvRec, C.NomConvRec, C.Cuit, CLI.NOMBRECLIENTE, C.Acreditacion, A.FECHA_COBRO_PAGO, O.DESCRIPCION, OE.OPCIONINTERNA, A.SIG_IMP_LIQUIDO) a
GROUP by
a.Id_ConvRec, a.NomConvRec, a.Cuit, a.NOMBRECLIENTE,
a.Acreditacion, a.FECHA_COBRO_PAGO, 
a.[ESTADO REND], a.[TOTAL IMPORTE], a.[IMPORTE JUEGOS], a.FECHA_REND, a.[TOTAL REGISTROS], A.SIG_IMP_LIQUIDO

')