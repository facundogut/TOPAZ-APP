EXECUTE('
CREATE PROCEDURE SP_CRE_ULTIMA_ACREDITACION
    @JTS_OID INT,
    @Resultado INT OUTPUT
AS
BEGIN
	DECLARE @FechaSistema DATETIME = (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK));
	DECLARE @Dias INT = (SELECT NUMERICO FROM PARAMETROSGENERALES WHERE CODIGO=752);
	DECLARE @FechaMaxima DATETIME;

    SELECT @FechaMaxima = MAX(FECHA)
    FROM CRE_SOL_ACREDITACIONES_SUELDOS WITH(NOLOCK) WHERE
    FORMAT(FECHA,''MM'') = FORMAT(DATEADD(MM,-1,@FechaSistema),''MM'') AND 
    FORMAT(FECHA,''yyyy'') = FORMAT(DATEADD(MM, -1,@FechaSistema),''yyyy'')
    AND SALDO_JTS_OID =@JTS_OID 
	
	IF @FechaMaxima IS NOT NULL
		SET @FechaMaxima = DATEADD(MONTH, 1, @FechaMaxima) 
			IF DATEDIFF(DAY, @FechaMaxima, @FechaSistema) < @Dias
   				SET @Resultado=1
   			ELSE 
   		  		SET @Resultado=0	
   	END;
')