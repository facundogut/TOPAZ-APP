EXECUTE('
IF OBJECT_ID (''dbo.VW_ASISTENCIAS_COBRADOR'') IS NOT NULL
	DROP VIEW dbo.VW_ASISTENCIAS_COBRADOR
')

EXECUTE('
CREATE   VIEW [dbo].[VW_ASISTENCIAS_COBRADOR] (
									PRODUCTO,  
									SALDO,
									VENCIMIENTO,
									CLIENTE,
									TIPO,
									JTS_OID,
									FAMILIA,
									CLASIFICACION)
AS
SELECT
		s.PRODUCTO AS PRODUCTO, 
		s.C1604*-1 AS SALDO, 
		s.C1628 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND p.C6800 IN (''PP'',''AH'')
						AND ( (p.tz_lock < 300000000000000 OR p.tz_lock >= 400000000000000) AND (p.tz_lock < 100000000000000 OR p.tz_lock >= 200000000000000)  )
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND ( (f.tz_lock < 300000000000000 OR f.tz_lock >= 400000000000000) AND (f.tz_lock < 100000000000000 OR f.tz_lock >= 200000000000000)  )					
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND ( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000) AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND ( (suc.tz_lock < 300000000000000 OR suc.tz_lock >= 400000000000000) AND (suc.tz_lock < 100000000000000 OR suc.tz_lock >= 200000000000000)  )
WHERE s.C1785 = 5 AND s.C1728<>''C'' AND ( (s.tz_lock < 300000000000000 OR s.tz_lock >= 400000000000000) AND (s.tz_lock < 100000000000000 OR s.tz_lock >= 200000000000000)  )	
UNION
SELECT	
		s.PRODUCTO AS PRODUCTO,  
		s.AJUSTEINFLACION AS SALDO, 
		s.C1761 AS VENCIMIENTO, 
		s.C1803 AS CLIENTE, 
		s.C1785 AS TIPO, 
		s.JTS_OID AS JTS_OID, 
		f.FAMILIAPROD AS FAMILIA,
		p.C6800 AS CLASIFICACION
FROM SALDOS s WITH(NOLOCK)
INNER JOIN PRODUCTOS p WITH(NOLOCK) ON s.PRODUCTO = p.C6250 
						AND  ( (p.tz_lock < 300000000000000 OR p.tz_lock >= 400000000000000) AND (p.tz_lock < 100000000000000 OR p.tz_lock >= 200000000000000)  )	
						AND p.C6800 = ''T'' 
INNER JOIN CRE_FAMILIAS f ON p.C6283 = f.FAMILIAPROD AND ( (f.tz_lock < 300000000000000 OR f.tz_lock >= 400000000000000) AND (f.tz_lock < 100000000000000 OR f.tz_lock >= 200000000000000)  )						
INNER JOIN MONEDAS m WITH(NOLOCK) ON s.MONEDA = m.C6399 
						AND ( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000) AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )	
INNER JOIN SUCURSALES suc WITH(NOLOCK) ON s.SUCURSAL = suc.SUCURSAL 
							AND ( (suc.tz_lock < 300000000000000 OR suc.tz_lock >= 400000000000000) AND (suc.tz_lock < 100000000000000 OR suc.tz_lock >= 200000000000000)  )						
WHERE s.C1785 = 1 AND s.C1728<>''C''
	AND  ( (s.tz_lock < 300000000000000 OR s.tz_lock >= 400000000000000) AND (s.tz_lock < 100000000000000 OR s.tz_lock >= 200000000000000)  )
')