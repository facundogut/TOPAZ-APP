EXECUTE('
IF OBJECT_ID (''dbo.VW_CARGO_ESTADOCUENTA'') IS NOT NULL
	DROP VIEW dbo.VW_CARGO_ESTADOCUENTA
')
EXECUTE('
CREATE VIEW [dbo].[VW_CARGO_ESTADOCUENTA] (
   JTS_OID_COBRO,
   CLIENTE,
   MONEDA,
   PERIODO_PROD,
   PERIODO_EST,
   TIPO_PRODUCTO,
   COBRA_RESUMEN,
   SALDO_ACTUAL,
   USF,
   INMOVILIZADO)
AS 
SELECT
	DISTINCT
		S.JTS_OID AS JTS_OID_COBRO,
		S.C1803 AS CLIENTE,
		S.MONEDA,
		P.PERIODOLEGALESTCTA AS PERIODO_PROD,
		E.PERIODICIDAD AS PERIODO_EST,
		S.C1785 AS TIPO_PRODUCTO,
		T.COBRA_RESUMEN,
		S.C1604+S.C1683+S.C1605+S.C2627+S.C50107 AS SALDO_ACTUAL,
		C.USF,
		S.C1728 AS INMOVILIZADO
FROM SALDOS AS S WITH (nolock)
INNER JOIN TOPESPRODUCTO AS T WITH (nolock) ON
	T.CODPRODUCTO = S.PRODUCTO
	AND T.COBRA_RESUMEN = ''S''
	AND ((T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) 
		AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)
	)
INNER JOIN CLI_CLIENTES AS C WITH (nolock) ON
	C.CODIGOCLIENTE = S.C1803
	AND C.USF <> ''S''
	AND ((C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000) 
		AND (C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)
	)
INNER JOIN PRODUCTOS AS P WITH (nolock) ON
	P.C6250 = S.PRODUCTO
	AND ((P.TZ_LOCK < 300000000000000 OR P.TZ_LOCK >= 400000000000000) 
		AND (P.TZ_LOCK < 100000000000000 OR P.TZ_LOCK >= 200000000000000)
	)
INNER JOIN GRL_ESTADOS_DE_CUENTA AS E WITH (nolock) ON
	E.SUCURSAL = S.SUCURSAL
	AND E.PRODUCTO = S.PRODUCTO
	AND E.MONEDA = S.MONEDA
	AND E.CUENTA = S.CUENTA
	AND E.OPERACION = S.OPERACION
	AND E.ORDINAL = S.ORDINAL
	AND ((E.TZ_LOCK < 300000000000000 OR E.TZ_LOCK >= 400000000000000) 
		AND (E.TZ_LOCK < 100000000000000 OR E.TZ_LOCK >= 200000000000000)
	)
WHERE
	S.C1785 IN (2,3)
	AND S.C1651 <> ''1''
	AND S.C1679 = ''0'' 
	AND S.TIPO_SALDO_FONDO=0
	AND S.C1728 <> ''I''
	AND ((S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000) 
		AND (S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)
		
	)
')
