EXECUTE('
	IF OBJECT_ID (''VW_CONSULTA_CREDEB'') IS NOT NULL
	DROP VIEW dbo.VW_CONSULTA_CREDEB
')

EXECUTE('
	CREATE VIEW [VW_CONSULTA_CREDEB] AS
	SELECT 
		PFPJ.NUMEROPERSONAFJ AS NumeroCliente,
		PFPJ.NUMERODOCUMENTO AS NumeroDocumento,
		V.CTA_CBU AS CBU,
		RRII.SEGMENTO AS Segmento,
		IMP.TASA AS Tasa,
		RRII.FECHA AS Fecha,
		RRII.TIPO_CARGO_IMPOSITIVO AS Cargo,
		RRII.PADRON_BENEF_FISCAL AS PadronFiscal,
		RRII.PADRON_MiPyme AS PadronMiPyme,
		S.CREDEB_Condicion AS CondicionCREDEB, 
		V.JTS_OID_SALDO AS JTS_OID  
	FROM
		SALDOS S
	INNER JOIN CLI_ClientePersona CP WITH(NOLOCK) ON
		S.C1803 = CP.CODIGOCLIENTE
	INNER JOIN VTA_SALDOS V WITH(NOLOCK) ON 
		V.JTS_OID_SALDO = S.JTS_OID
	INNER JOIN CLI_DOCUMENTOSPFPJ PFPJ WITH (NOLOCK) ON 
		PFPJ.NUMEROPERSONAFJ = CP.NUMEROPERSONA
	INNER JOIN RRII_BITACORA_CREDEB RRII WITH (NOLOCK) ON
		S.JTS_OID = RRII.JTS_OID_SALDOS
	INNER JOIN IMP_PARAM_SEG_TASAS IMP WITH (NOLOCK) ON
		IMP.SEGMENTO = RRII.SEGMENTO
	WHERE
		S.C1785 IN (2, 3)
		AND CP.TITULARIDAD = ''T''
		AND RRII.FECHA = (SELECT MAX(FECHA) FROM RRII_BITACORA_CREDEB R WHERE S.JTS_OID = R.JTS_OID_SALDOS)
		AND RRII.JTS_OID_SALDOS = S.JTS_OID
')