EXECUTE('
CREATE PROCEDURE SP_CLE_DESCUENTOS_ECHEQ
    @COD_NEGOCIACION NUMERIC(15),
    @COD_LISTA NUMERIC(15),
    @NRO_DOC VARCHAR(20),
    @REFERENCIA NUMERIC(15)
AS
BEGIN
		--DELETE FROM IO_CAPTURA_CHEQUES WHERE REFERENCIA=@COD_LISTA;
		
        -- Insertar los datos en IO_CAPTURA_CHEQUES
        INSERT INTO IO_CAPTURA_CHEQUES (
            TZ_LOCK,
            BANCO_EMISOR,
            SUC_BANCO_EMISOR,
            COD_POSTAL,
            NUM_CHEQUE,
            NUM_CUENTA,          
            SERIE_CHEQUE,
            IMPORTE,
            REFERENCIA,
            FECHA,
            BANDAMAGNETICA            
        )
        SELECT 
        0 AS TZ_LOCK ,
		CODIGO_BANCO, 
		SUCURSAL, 
		CODIGO_POSTAL, 
		NUMERO_CHEQUE, 
		NUMERO_CUENTA,
		''E'', 
		IMPORTE, 
		@REFERENCIA,
		FECHA_VTO, 
		CMC7
		FROM dbo.CLE_DESCUENTOS_ECHEQ WITH (NOLOCK)
        WHERE COD_NEGOCIACION = @COD_NEGOCIACION 
          AND CUIT_NEGOCIADOR = @NRO_DOC
          AND ESTADO=''A'' AND NUM_LISTA <> @COD_LISTA
          
       -- Actualizar el campo NUM_LISTA en CLE_DESCUENTOS_ECHEQ
        UPDATE dbo.CLE_DESCUENTOS_ECHEQ
        SET NUM_LISTA = @COD_LISTA
        WHERE COD_NEGOCIACION = @COD_NEGOCIACION 
          AND CUIT_NEGOCIADOR = @NRO_DOC
          AND ESTADO = ''A'';
END

')