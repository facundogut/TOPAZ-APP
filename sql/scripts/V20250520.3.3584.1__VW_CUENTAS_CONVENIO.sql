EXECUTE('
IF OBJECT_ID (''dbo.VW_CUENTAS_CONVENIO'') IS NOT NULL
	DROP VIEW dbo.VW_CUENTAS_CONVENIO
')

EXECUTE('
CREATE   VIEW [dbo].[VW_CUENTAS_CONVENIO]
		 AS 
SELECT	dom.ID_CONVENIO,
		dom.ID_DOMINIO,
		dom.SUB_DOMINIO,
		S.CUENTA, 
		VS.NOMBRE_CUENTA, 
		S.PRODUCTO, 
		P.C6251 AS DESC_PRODUCTO, 
		S.MONEDA,
		M.C6400 AS DESC_MONEDA,
		S.SUCURSAL, 
		suc.NOMBRESUCURSAL,
		S.ORDINAL, 
		S.OPERACION, 
		S.C1803 AS CLIENTE, 
		D.TIPODOC, 
		D.NUMERODOC , 
   		CASE WHEN S.C1679=''1'' THEN ''Si'' ELSE ''No'' END AS BLOQUEO, 
		S.C1728 AS INMOVILIZADA, 
		S.C1651 AS CUENTA_CANCELADA, 
		(S.C1604 + S.C1605 + S.C1683) AS Disponible,
		S.JTS_OID,
		dom.CONC_CONT_TRANSITORIO AS CONCEPTO_CONT
FROM SALDOS AS S with (nolock)
INNER JOIN CONV_DOMINIOS AS dom WITH(NOLOCK) ON S.JTS_OID = dom.CUENTA_PRINCIPAL AND dom.TZ_LOCK = 0
INNER JOIN CONV_CONVENIOS_PAG AS pag WITH(NOLOCK) ON pag.ID_ConvPago = dom.ID_CONVENIO AND pag.TZ_LOCK = 0
INNER JOIN SUCURSALES AS suc WITH(NOLOCK) ON suc.SUCURSAL = S.SUCURSAL
INNER JOIN VTA_SALDOS AS VS with (nolock) ON 
	S.JTS_OID = VS.JTS_OID_SALDO
	AND VS.TZ_LOCK = 0
INNER JOIN PRODUCTOS AS P with (nolock) ON 
	S.PRODUCTO = P.C6250 
	AND S.C1785 = P.C6252
	AND P.TZ_LOCK = 0 
INNER JOIN VW_CLI_X_DOC AS D with (nolock) ON 
	S.C1803 = D.[CODIGOCLIENTE] 
INNER JOIN MONEDAS M with (nolock) ON 
	S.MONEDA = M.C6399
	AND M.TZ_LOCK = 0
WHERE 
	S.TZ_LOCK = 0 AND pag.ESTADO = ''A'' 
	AND (pag.FecVto IS NULL OR pag.FecVto >= (SELECT FECHAPROCESO FROM PARAMETROS WITH(NOLOCK)))
')