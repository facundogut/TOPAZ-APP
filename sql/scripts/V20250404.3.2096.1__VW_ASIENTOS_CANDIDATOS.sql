EXECUTE('

IF OBJECT_ID (''dbo.VW_ASIENTOS_CANDIDATOS'') IS NOT NULL
	DROP VIEW dbo.VW_ASIENTOS_CANDIDATOS;
')
EXECUTE('
DELETE FROM JTSSALDOS_DIARIOS;
')
EXECUTE('

CREATE VIEW VW_ASIENTOS_CANDIDATOS 
AS SELECT distinct
a.ASIENTO, a.FECHAPROCESO, a.SUCURSAL
from MOVIMIENTOS_CONTABLES  m , asientos a 
where m.marcaajuste=''A''  and m.fechaproceso <> m.fechavalor
and a.FECHAPROCESO=m.FECHAPROCESO
and a.ASIENTO=m.ASIENTO
and a.SUCURSAL=m.SUCURSAL;
')
EXECUTE('
-----INSERTAR JTS OID PARA REGENERACION DE SALDOS DIARIOS
insert into JTSSALDOS_DIARIOS 
SELECT saldo_jts_oid 
FROM MOVIMIENTOS_CONTABLES m, VW_ASIENTOS_CANDIDATOS VW WHERE 
m.asiento=VW.ASIENTO AND
m.FECHAPROCESO=VW.FECHAPROCESO AND
m.SUCURSAL=VW.SUCURSAL AND
m.MARCAAJUSTE='' '' AND m.FECHAPROCESO <> m.FECHAVALOR;
')
EXECUTE('
-----AJUSTE A MOVIMIENTOS_CONTABLES
UPDATE m 
SET MARCAAJUSTE = ''A'', 
FECHACONTABLE=FECHAVALOR 
 FROM MOVIMIENTOS_CONTABLES m 
 inner join  VW_ASIENTOS_CANDIDATOS VW   
 on m.asiento=VW.ASIENTO AND
m.FECHAPROCESO=VW.FECHAPROCESO AND
m.SUCURSAL=VW.SUCURSAL
where m.MARCAAJUSTE='' '' AND m.FECHAPROCESO <> m.FECHAVALOR;
')
EXECUTE('
---- AJUSTE A MOVIMIENTOS
UPDATE M 
SET C7844 = ''A''  
FROM MOVIMIENTOS m 
inner join  VW_ASIENTOS_CANDIDATOS VW 
on m.asiento=VW.ASIENTO AND
m.FECHAPROCESO=VW.FECHAPROCESO AND
m.SUCURSAL=VW.SUCURSAL 
where m.FECHAPROCESO <> cast( m.C0025 as datetime) and 
m.C7844 is null and OPERACION<>19
and m.C0028 like ''%extorno%'';
')