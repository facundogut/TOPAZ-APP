EXECUTE('
CREATE OR ALTER PROCEDURE SP_OBTENER_COTIZACION_BNA
	@FECHA DATETIME2,
	@MONEDA NUMERIC (4),
	@TC_COMPRA NUMERIC(15,9) OUTPUT,
	@TC_VENTA  NUMERIC(15,9) OUTPUT
AS 
BEGIN

	SELECT @TC_COMPRA=A.TC_COMPRA, @TC_VENTA= A.TC_VENTA  FROM CON_COTIZACIONES_BNA A
WHERE A.Fecha_Cotizacion< @FECHA
  AND A.Moneda = @MONEDA 
  AND A.Fecha_Cotizacion = (SELECT max(B.Fecha_Cotizacion) FROM CON_COTIZACIONES_BNA B
  							WHERE B.Fecha_Cotizacion< @FECHA
  							  AND B.Moneda = @MONEDA 
  							  AND B.TZ_LOCK=0 )
  AND A.TZ_LOCK=0				
	
END
')
