EXECUTE('
IF OBJECT_ID (''dbo.VW_COMISION_BANCA_EMPRESA'') IS NOT NULL
	DROP VIEW dbo.VW_COMISION_BANCA_EMPRESA
')
EXECUTE('
CREATE VIEW [dbo].[VW_COMISION_BANCA_EMPRESA] (
	SALDO_JTS_OID,
	MONEDA,
	SALDO,
	TIPO_PRODUCTO,
	CLIENTE,
	TIPO_CLIENTE,
	MONOTRIBUTO,
	IVA,
	USF,
	COBRA_COMISION)
AS 
SELECT
	S.JTS_OID,
	S.MONEDA,
	S.C1604+S.C1683+S.C1605+S.C2627+S.C50107,
	S.C1785,
	S.C1803,
	C.TIPO,
	C.MONOTRIBUTO,
	C.IVA,
	C.USF,
	VS.OPERABE
FROM SALDOS AS S WITH (nolock)
INNER JOIN VTA_SALDOS AS VS WITH (nolock) ON
	VS.JTS_OID_SALDO = S.JTS_OID
	AND VS.OPERABE = ''S''
	AND ((VS.TZ_LOCK < 100000000000000 OR VS.TZ_LOCK >= 200000000000000)
		AND (VS.TZ_LOCK < 300000000000000 OR VS.TZ_LOCK >= 400000000000000)  
	)
INNER JOIN CLI_CLIENTES AS C WITH (nolock) ON
	C.CODIGOCLIENTE = S.C1803
	AND ((C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)
		AND (C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000)  
	)
WHERE
	S.C1785 IN (2,3)
	AND S.C1728 <> ''I''
	AND S.TZ_LOCK = 0
	AND S.TIPO_SALDO_FONDO=0
')
