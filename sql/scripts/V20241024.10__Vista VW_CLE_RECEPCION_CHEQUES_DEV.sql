EXECUTE('
IF OBJECT_ID (''dbo.VW_CLE_RECEPCION_CHEQUES_DEV'') IS NOT NULL
	DROP VIEW dbo.VW_CLE_RECEPCION_CHEQUES_DEV
')
EXECUTE('
CREATE VIEW [dbo].[VW_CLE_RECEPCION_CHEQUES_DEV]
		(BANCO,
		SUCURSAL,
		NOMBRE_BANCO,
		NUMERO_CUENTA_GIRADORA,
		FECHA_DEVUELTO,
		SUCURSAL_INGRESO,
		NOMBRE_SUC_INGRESO,
		SERIE_CHEQUE,
		NUMERO_CHEQUE,
		CODIGO_RECHAZO,
		CAUSAL_RECHAZO,
		ESTADO,
		DESCRIPCION_ESTADO,
		TIPO_DOCUMENTO)
AS
SELECT	
	R.BANCO_GIRADO,
	R.SUCURSAL_BANCO_GIRADO,
	B.NOMBRE,
	R.NUMERO_CUENTA_GIRADORA,
	R.FECHA_ALTA,
	L.SUCURSAL_DE_INGRESO,
	S.NOMBRESUCURSAL,
	R.SERIE_DEL_CHEQUE,
	R.NUMERO_CHEQUE,
	R.CODIGO_RECHAZO,
	C.DESCRIPCION,
	R.ESTADO_DEVOLUCION,
	OE.DESCRIPCION AS DESCRIPCION_ESTADO,
	R.TIPO_DOCUMENTO
FROM CLE_RECEPCION_CHEQUES_DEV AS R WITH (nolock)
INNER JOIN CLE_CHEQUES_SALIENTE AS L WITH (nolock) ON
	L.SERIE_DEL_CHEQUE = R.SERIE_DEL_CHEQUE
	AND L.NUMERO_CHEQUE = R.NUMERO_CHEQUE
	AND L.BANCO_GIRADO = R.BANCO_GIRADO
	AND L.SUCURSAL_BANCO_GIRADO = R.SUCURSAL_BANCO_GIRADO
	AND L.NUMERICO_CUENTA_GIRADORA = R.NUMERO_CUENTA_GIRADORA
	AND L.TIPO_DOCUMENTO = R.TIPO_DOCUMENTO
	--AND L.ESTADO = 70
	AND ((L.TZ_LOCK < 100000000000000 OR L.TZ_LOCK >= 200000000000000)
		AND (L.TZ_LOCK < 300000000000000 OR L.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN SUCURSALES AS S WITH (nolock) ON
	S.SUCURSAL = L.SUCURSAL_DE_INGRESO
	AND ((S.TZ_LOCK < 100000000000000 OR S.TZ_LOCK >= 200000000000000)
		AND (S.TZ_LOCK < 300000000000000 OR S.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN CLI_BANCOSPLAZA AS B WITH (nolock) ON 
	B.CODIGOBC = R.BANCO_GIRADO
	AND B.SUCURSAL = 0
	AND ((B.TZ_LOCK < 100000000000000 OR B.TZ_LOCK >= 200000000000000)
		AND (B.TZ_LOCK < 300000000000000 OR B.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN CLE_TIPO_CAUSAL AS C WITH (nolock) ON 
	C.CODIGO_NACHA = R.CODIGO_RECHAZO
	AND C.CODIGO_DE_CAUSAL IN (	
		SELECT TOP 1 CODIGO_DE_CAUSAL 
		FROM CLE_TIPO_CAUSAL WITH (nolock)
		WHERE 
			CODIGO_NACHA = C.CODIGO_NACHA
			AND ((TZ_LOCK < 100000000000000 OR TZ_LOCK >= 200000000000000)
				AND (TZ_LOCK < 300000000000000 OR TZ_LOCK >= 400000000000000)  
			)
		ORDER BY CODIGO_DE_CAUSAL)
	AND ((C.TZ_LOCK < 100000000000000 OR C.TZ_LOCK >= 200000000000000)
		AND (C.TZ_LOCK < 300000000000000 OR C.TZ_LOCK >= 400000000000000)  
	)
LEFT JOIN OPCIONES AS OE WITH (nolock) ON
	OE.NUMERODECAMPO = 3291
	AND OE.IDIOMA = ''E''
	AND OE.OPCIONINTERNA = R.ESTADO_DEVOLUCION
WHERE
	R.TZ_LOCK = 0
')

