EXECUTE('
IF OBJECT_ID (''dbo.VW_CLIENTE_PFPJ'') IS NOT NULL
	DROP VIEW dbo.VW_CLIENTE_PFPJ
')

EXECUTE('
CREATE VIEW VW_CLIENTE_PFPJ
AS
SELECT z.TIPODOCUMENTO, z.NUMERODOCUMENTO, z.CODIGOCLIENTE, z.NOMBRECLIENTE, z.NUMEROPERSONA, z.TIPO
FROM
(
SELECT DOC.TIPODOCUMENTO, DOC.NUMERODOCUMENTO, CP.CODIGOCLIENTE, cli.NOMBRECLIENTE, CP.NUMEROPERSONA, cli.TIPO,
  (SELECT COUNT(1) FROM CLI_ClientePersona CPX WITH(NOLOCK)
   WHERE CPX.CODIGOCLIENTE = CP.CODIGOCLIENTE AND CPX.TZ_LOCK = 0) AS NROREGISTRO
FROM CLI_CLIENTES cli WITH(NOLOCK)
  INNER JOIN CLI_ClientePersona CP WITH(NOLOCK) ON CP.CODIGOCLIENTE = cli.CODIGOCLIENTE
  INNER JOIN CLI_DocumentosPFPJ DOC WITH(NOLOCK) ON DOC.NUMEROPERSONAFJ = CP.NUMEROPERSONA
WHERE DOC.TZ_LOCK = 0
  AND CP.TZ_LOCK = 0
  AND cli.TZ_LOCK = 0
) z
WHERE z.NROREGISTRO = 1
')