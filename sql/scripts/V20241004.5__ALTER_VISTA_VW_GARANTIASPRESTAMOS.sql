EXECUTE('
ALTER     VIEW [dbo].[VW_GARANTIASPRESTAMOS] (
												Operacion,
												Linea,
												"Nombre Linea",
												Familia,
												Garantia, 
												Tipo_Garantia,
												SubClass_Garantia,
												Descripcion,
												Moneda, 
												Monto, 
												Monto_Utilizado,
												Vencimiento,
												JTS_OID)
AS 
SELECT 	
	s.OPERACION AS Operacion,
	s.PRODUCTO AS Linea,
	p.C6251 AS Nombre_Linea,
	p.C6283 AS Familia,
	gc.NUM_GARANTIA AS Garantia, 
	g.TIPOGARANTIA AS Tipo_Garantia,
	g.COD_SUBCLAGARANTIA AS SubClass_Garantia,
	c.DSC_CLASIFICACION AS Descripcion,
	m.C6401 AS Moneda, 
	g.IMPORTE_REAL AS Monto, 
	(SELECT ISNULL(SUM(MONTO_GARANTIZADO_MG), 0)
	FROM CRE_HISTORICO_DEUDA_GARANTIAS WITH (NOLOCK)
	LEFT JOIN VTA_SOBREGIROS VTA ON SALDO_JTS_OID = VTA.NRO_AUTORIZACION 
                               AND VTA.TZ_LOCK = 0 
                               AND VTA.ESTADO = 1
	WHERE NRO_GARANTIA = g.NUM_GARANTIA
	 AND ((TIPO_ASISTENCIA <> ''A'' AND SALDO_JTS_OID = s.JTS_OID)
	OR (TIPO_ASISTENCIA = ''A'' AND VTA.JTS_OID_SALDO = s.JTS_OID))
	AND FECHA_PROCESO = (SELECT FECHAPROCESOANTERIOR FROM PARAMETROS WITH (NOLOCK))) AS MontoUtilizado,
	g.FCHVTO_GARANTIA AS Vencimiento,
	s.JTS_OID AS JTS_OID
FROM CRE_GARANTIACREDITO gc WITH (NOLOCK)
INNER JOIN CRE_GARANTIASRECIBIDAS g WITH (NOLOCK)ON gc.NUM_GARANTIA = g.NUM_GARANTIA AND ( (g.tz_lock < 300000000000000 OR g.tz_lock >= 400000000000000) AND (g.tz_lock < 100000000000000 OR g.tz_lock >= 200000000000000)  )
INNER JOIN MONEDAS m WITH (NOLOCK)ON g.MONEDA_GARANTIA = m.C6399 AND ( (m.tz_lock < 300000000000000 OR m.tz_lock >= 400000000000000) AND (m.tz_lock < 100000000000000 OR m.tz_lock >= 200000000000000)  )
INNER JOIN CRE_CLASGARANTIAS c WITH (NOLOCK)ON g.TIPOGARANTIA = c.TIPOGARANTIA AND c.SUBTIPOGTIA=g.SUBTIPOGARANTIA AND 
	 c.COD_SUBCLA_GARANTIA=g.COD_SUBCLAGARANTIA AND c.PAIS_GARANTIA= g.PAIS_GARANTIA AND ( (c.tz_lock < 300000000000000 OR c.tz_lock >= 400000000000000) AND (c.tz_lock < 100000000000000 OR c.tz_lock >= 200000000000000)  )
INNER JOIN SALDOS s WITH (NOLOCK)ON gc.JTSOID_SALDO = s.JTS_OID AND ( (s.tz_lock < 300000000000000 OR s.tz_lock >= 400000000000000) AND (s.tz_lock < 100000000000000 OR s.tz_lock >= 200000000000000)  )
INNER JOIN PRODUCTOS p WITH (NOLOCK)ON s.PRODUCTO = p.C6250 AND ( (p.tz_lock < 300000000000000 OR p.tz_lock >= 400000000000000) AND (p.tz_lock < 100000000000000 OR p.tz_lock >= 200000000000000)  )
WHERE gc.DESVINCULADO = ''N'' 
	AND ( (gc.tz_lock < 300000000000000 OR gc.tz_lock >= 400000000000000) AND (gc.tz_lock < 100000000000000 OR gc.tz_lock >= 200000000000000)  );
')