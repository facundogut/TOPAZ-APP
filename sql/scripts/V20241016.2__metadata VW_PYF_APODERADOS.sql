EXECUTE('
IF OBJECT_ID (''dbo.VW_PYF_APODERADOS'') IS NOT NULL
	DROP VIEW dbo.VW_PYF_APODERADOS
')


EXECUTE('
CREATE   VIEW [dbo].[VW_PYF_APODERADOS] 
AS
SELECT	
	a.TIPO_ENTIDAD AS [TipoEntidad],
	te.DESCRIPCION AS [DescEntidad],
	a.ID_ENTIDAD AS [IdEntidad],
	ISNULL(s.CUENTA,0) AS [Cuenta],
	CASE 
		WHEN a.TIPO_ENTIDAD = 2
			THEN (ISNULL(vs.NOMBRE_CUENTA, ''''))
		WHEN a.TIPO_ENTIDAD = 1
			THEN ISNULL(vw.NOMBRE,'''')
	END AS [Denominacion],
	ISNULL(s.PRODUCTO,0) AS [Producto],
	ISNULL(p.C6251,'''') AS [DescProducto],
	a.TIPO_PODER AS [TipoPoder],
	tp.DESCRIPCION AS [DescPoder],
	ISNULL(vw.TipoDocIdent,0) AS [TipoDoc],
	ISNULL(vw.NroDocIdent,0) AS [NroDoc],
	ISNULL(vw.NOMBRE,'''') AS Nombre,
	a.CATEGORIA AS Categoria,
	a.MONEDA_MONTO_INDIV AS [MonedaMontoIndiv],
	a.MONTO_MAX_INDIV AS [MontoMaxIndiv],
	a.MONEDA_MONTO_GRUPAL AS [MonedaMontoGrupal],
	a.MONTO_MAX_GRUPAL AS [MontoMaxGrupal],
	a.FECHA_VENCIMIENTO AS [FechaVto],
	a.FECHA_INI_VIGENCIA AS [FechaIniVigencia],
	a.FECHA_INI_SUSPENSION AS [FechaIniSuspension],
	a.FECHA_FIN_SUSPENSION AS [FechaFinSuspension],
	a.ID_PERSONA AS [IdPersona],
	ISNULL(ta.CODAPODERAMIENTO,0) AS [CODAPODERAMIENTO],
	ISNULL(ta.DESCRIPCION,'''') AS [DescApoderamiento]
FROM PYF_APODERADOS a WITH (nolock)
LEFT JOIN SALDOS s WITH (nolock) ON
	s.JTS_OID=a.ID_ENTIDAD
	AND s.TZ_LOCK = 0
LEFT JOIN VTA_SALDOS AS vs WITH (nolock) ON
	vs.JTS_OID_SALDO = s.JTS_OID
	AND vs.TZ_LOCK = 0
LEFT JOIN PRODUCTOS AS p WITH (nolock) ON
	p.C6250 = s.PRODUCTO
	AND p.TZ_LOCK = 0
LEFT JOIN PYF_TIPOPODERES AS tp WITH (nolock) ON
	a.TIPO_PODER = tp.TIPO_PODER
	AND tp.TZ_LOCK = 0
LEFT JOIN PYF_TIPOENTIDAD AS te WITH (nolock) ON
	a.TIPO_ENTIDAD = te.TIPO_ENTIDAD
	AND te.TZ_LOCK = 0
LEFT JOIN PYF_TIPOAPODERAMIENTO AS ta WITH (nolock) ON
a.APODERAMIENTO = ta.CODAPODERAMIENTO
INNER JOIN	VW_PERSONAS_F_Y_J AS vw WITH (nolock) ON 
	vw.NUMEROPERSONA = a.ID_PERSONA
WHERE 
	a.TZ_LOCK=0
')