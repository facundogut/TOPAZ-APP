
CREATE VIEW dbo.VW_CLI_DIRECCIONES  (
	TIPODOCUMENTO,
	NUMERODOCUMENTO,
	NOMBRE,
	FORMATO,
	TIPODIRECCION,
	ORDINAL_DIR,
	PAIS,
	PROVINCIA,
	DEPARTAMENTO,
	LOCALIDAD,
	CPA_NUEVO,
	BARRIO,
	CALLE,
	NUMERO,
	PROVINCIA_EXT,
	DEPARTAMENTO_EXT,
	LOCALIDAD_EXT,
	TIPO_CLIENTE,
	NOMBRECLIENTE,
	CODIGOCLIENTE,
	NUMEROPERSONA,
	TIPOPERSONA
)
AS
 SELECT 
 	  v.TIPODOCUMENTO,
 	  v.NUMERODOCUMENTO,
 	  concat(u.APELLIDOPATERNO,' ',u.PRIMERNOMBRE) AS NOMBRE,
   	  a.FORMATO,
   	  a.TIPODIRECCION,
   	  a.ORDINAL_DIR,
   	  p.NOMBREPAIS AS PAIS,
   	  PP.DESCRIPCION AS PROVINCIA,
   	  D.NOMBREDEP AS DEPARTAMENTO,
      L.DESCRIPCION_DIM3 AS LOCALIDAD,
      a.CPA_NUEVO,
      A.BARRIO,
      A.CALLE,
      A.NUMERO,
      A.PROVINCIA_EXTERIOR AS LOCALIDAD_EXT,
      A.DEPARTAMENTO_EXTERIOR AS LOCALIDAD_EXT,
      A.LOCALIDAD_EXTERIOR AS LOCALIDAD_EXT,
   	 (SELECT DESCRIPCION FROM OPCIONES WHERE IDIOMA = 'E' AND NUMERODECAMPO = 1040 AND OPCIONINTERNA = r.tipo) AS TIPO_CLIENTE,
   	  R.NOMBRECLIENTE,
   	  R.CODIGOCLIENTE,  
      V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
      (SELECT DESCRIPCION FROM OPCIONES WHERE IDIOMA = 'E' AND NUMERODECAMPO = 1861 AND OPCIONINTERNA = V.TIPOPERSONA) AS TIPOPERSONA
         
   FROM 
   	  dbo.CLI_DIRECCIONES AS A
   	  LEFT JOIN dbo.CLI_PAISES AS P ON P.CODIGOPAIS = A.PAIS
   	  LEFT JOIN dbo.CLI_PROVINCIAS AS PP ON PP.DIM1 = A.PROVINCIA  	  
      LEFT JOIN dbo.CLI_DEPARTAMENTOS AS D ON (a.DEPARTAMENTO=d.DEPARTAMENTO) AND (PP.DIM1=d.PROVINCIA)
      LEFT JOIN dbo.CLI_LOCALIDADES AS l ON (a.LOCALIDAD=l.DIM3) AND (l.DIM1=PP.DIM1) AND (l.DIM2=d.DEPARTAMENTO), 
      dbo.CLI_CLIENTES  AS R, 
      dbo.CLI_CLIENTEPERSONA  AS T, 
      dbo.CLI_PERSONASFISICAS  AS U, 
      dbo.CLI_DOCUMENTOSPFPJ  AS V
     
   WHERE 
      (R.CODIGOCLIENTE = T.CODIGOCLIENTE) AND 
      (U.NUMEROPERSONAFISICA = T.NUMEROPERSONA AND U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ) AND 
      (T.TITULARIDAD='T') AND
      (T.NUMEROPERSONA=A.ID) AND (a.ID=t.NUMEROPERSONA) AND 

      ((R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) AND 
      ((T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) AND 
      ((U.TZ_LOCK < 300000000000000 OR U.TZ_LOCK >= 400000000000000) AND (U.TZ_LOCK < 100000000000000 OR U.TZ_LOCK >= 200000000000000)) AND 
      ((V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)) AND
      ((A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000) AND (A.TZ_LOCK < 100000000000000 OR A.TZ_LOCK >= 200000000000000))
      
UNION ALL

   SELECT 
 	  v.TIPODOCUMENTO,
 	  v.NUMERODOCUMENTO,
 	  j.RAZONSOCIAL AS NOMBRE,
   	  a.FORMATO,
   	  a.TIPODIRECCION,
   	  a.ORDINAL_DIR,
   	  p.NOMBREPAIS AS PAIS,
   	  PP.DESCRIPCION AS PROVINCIA,
   	  D.NOMBREDEP AS DEPARTAMENTO,
      L.DESCRIPCION_DIM3 AS LOCALIDAD,
      a.CPA_NUEVO,
      A.BARRIO,
      A.CALLE,
      A.NUMERO,
      A.PROVINCIA_EXTERIOR AS PROVINCIA_EXT,
      A.DEPARTAMENTO_EXTERIOR AS DEPARTAMENTO_EXT,
      A.LOCALIDAD_EXTERIOR AS LOCALIDAD_EXT,
      (SELECT DESCRIPCION FROM OPCIONES WHERE IDIOMA = 'E' AND NUMERODECAMPO = 1040 AND OPCIONINTERNA = r.tipo) AS TIPO_CLIENTE,
      R.NOMBRECLIENTE,
      R.CODIGOCLIENTE,  
      V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
      (SELECT DESCRIPCION FROM OPCIONES WHERE IDIOMA = 'E' AND NUMERODECAMPO = 1861 AND OPCIONINTERNA = V.TIPOPERSONA) AS TIPOPERSONA       
   FROM 
      dbo.CLI_DIRECCIONES AS A
      LEFT JOIN dbo.CLI_PAISES AS P ON P.CODIGOPAIS = A.PAIS
      LEFT JOIN dbo.CLI_PROVINCIAS AS PP ON PP.DIM1 = A.PROVINCIA  	  
      LEFT JOIN dbo.CLI_DEPARTAMENTOS AS D ON (a.DEPARTAMENTO=d.DEPARTAMENTO) AND (PP.DIM1=d.PROVINCIA)
      LEFT JOIN dbo.CLI_LOCALIDADES AS l ON (a.LOCALIDAD=l.DIM3) AND (l.DIM1=PP.DIM1) AND (l.DIM2=d.DEPARTAMENTO),
      dbo.CLI_CLIENTES  AS R, 
      dbo.CLI_CLIENTEPERSONA  AS T, 
      dbo.CLI_PERSONASJURIDICAS  AS J, 
      dbo.CLI_DOCUMENTOSPFPJ  AS V
   WHERE 
      (R.CODIGOCLIENTE = T.CODIGOCLIENTE) AND 
      (J.NUMEROPERSONAJURIDICA = T.NUMEROPERSONA AND J.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ) AND 
      (T.TITULARIDAD='T') AND
      (T.NUMEROPERSONA=A.ID) AND (a.ID=t.NUMEROPERSONA) AND 
      ((R.TZ_LOCK < 300000000000000 OR R.TZ_LOCK >= 400000000000000) AND (R.TZ_LOCK < 100000000000000 OR R.TZ_LOCK >= 200000000000000)) AND 
      ((T.TZ_LOCK < 300000000000000 OR T.TZ_LOCK >= 400000000000000) AND (T.TZ_LOCK < 100000000000000 OR T.TZ_LOCK >= 200000000000000)) AND 
      ((J.TZ_LOCK < 300000000000000 OR J.TZ_LOCK >= 400000000000000) AND (J.TZ_LOCK < 100000000000000 OR J.TZ_LOCK >= 200000000000000)) AND 
      ((V.TZ_LOCK < 300000000000000 OR V.TZ_LOCK >= 400000000000000) AND (V.TZ_LOCK < 100000000000000 OR V.TZ_LOCK >= 200000000000000)) AND
      ((A.TZ_LOCK < 300000000000000 OR A.TZ_LOCK >= 400000000000000) AND (A.TZ_LOCK < 100000000000000 OR A.TZ_LOCK >= 200000000000000))

