EXECUTE('IF OBJECT_ID (''VW_FISICAS_JURIDICAS'') IS NOT NULL
	DROP VIEW VW_FISICAS_JURIDICAS')


EXECUTE('CREATE VIEW VW_FISICAS_JURIDICAS (
   TIPODOC, 
   NUMERODOC, 
   NUMEROPERSONA, 
   NIVELAPERTURA, 
   TIPOPERSONA, 
   NOMBRE, 
   ESTADO,
   MOTIVO_INHABILITADO)
AS 
   SELECT TOP 9223372036854775807 WITH TIES 
      V.TIPODOCUMENTO AS TIPODOC, 
      V.NUMERODOCUMENTO AS NUMERODOC, 
      V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
      CASE U.NIVEL_APERTURA
         WHEN 0 THEN ''REGISTRO''
         WHEN 1 THEN ''BÁSICO''
         WHEN 3 THEN ''ACTIVOS''
      END AS NIVELAPERTURA, 
      V.TIPOPERSONA, 
      (U.PRIMERNOMBRE + '' '' +U.SEGUNDONOMBRE+'' '' +U.APELLIDOPATERNO+'' ''+U.APELLIDOMATERNO) AS NOMBRE,
      CASE U.ESTADO
      	 WHEN 0 THEN ''HABILITADO''
         WHEN 1 THEN ''INHABILITADO''
       END AS ESTADO,   
      CASE U.MOTIVO_INHABILITADO
      	 WHEN 1 THEN ''INHABILITADO POR EL BCRA''
         WHEN 2 THEN ''INHABILITADO POR FALLECIMIENTO''
         WHEN 3 THEN ''INHABILITADO UIF''
         WHEN 4 THEN ''INHABILITADO TERRORISMO''
         WHEN 5 THEN ''INHABILITACION ADMINISTRATIVA''
       END AS MOTIVO_INHABILITADO
   FROM CLI_PERSONASFISICAS  AS U, CLI_DOCUMENTOSPFPJ  AS V
   WHERE 
      U.NUMEROPERSONAFISICA = V.NUMEROPERSONAFJ AND 
      (V.TIPOPERSONA = ''F'') AND 
      (U.TZ_LOCK=0) AND 
      (V.TZ_LOCK=0)
   ORDER BY NUMEROPERSONA
UNION ALL
   SELECT TOP 9223372036854775807 WITH TIES 
      V.TIPODOCUMENTO AS TIPODOC, 
      V.NUMERODOCUMENTO AS NUMERODOC, 
      V.NUMEROPERSONAFJ AS NUMEROPERSONA, 
      CASE T.NIVEL_APERTURA
         WHEN 1 THEN ''BÁSICO''
         WHEN 3 THEN ''ACTIVOS''
         WHEN 4 THEN ''INST.FINANCIERA''
      END AS NIVELAPERTURA, 
      V.TIPOPERSONA, 
      T.RAZONSOCIAL AS NOMBRE,  
      CASE T.ESTADO
      	 WHEN 0 THEN ''HABILITADO''
         WHEN 1 THEN ''INHABILITADO''
      END AS ESTADO,   
      CASE T.MOTIVO_INHABILITADO
      	 WHEN 1 THEN ''INHABILITADO POR EL BCRA''
         WHEN 3 THEN ''INHABILITADO UIF''
         WHEN 4 THEN ''INHABILITADO TERRORISMO''
         WHEN 5 THEN ''INHABILITACION ADMINISTRATIVA''
         WHEN 6 THEN ''P/LIQ TOTAL DE LA SOCIEDAD''
      END AS MOTIVO_INHABILITADO
   FROM CLI_PERSONASJURIDICAS  AS T, CLI_DOCUMENTOSPFPJ  AS V
   WHERE 
      T.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ AND 
      (V.TIPOPERSONA = ''J'' OR V.TIPOPERSONA = ''I'')AND  
      (T.TZ_LOCK = 0) AND 
      (V.TZ_LOCK = 0)
   ORDER BY NUMEROPERSONA
');
