CREATE VIEW dbo.VW_INTEGRANTES_PJ_VISTA (
   TIPODOC, 
   NUMERODOC, 
   NUMEROPERSONA, 
   NUMEROPFISICA,
   TIPODOCINTEGRANTE,
   NRODOCINTEGRANTE, 
   NOMBRE, 
   [CARGO], 
   TIPOPERSONA, 
   RAZONSOCIAL, 
   NOMBREFANTASIA)
AS
   SELECT 
      V.TIPODOCUMENTO AS TIPODOC, 
      V.NUMERODOCUMENTO AS NUMERODOC, 
      T.NUMEROPERSONAJURIDICA AS NUMEROPERSONA, 
      IJ.NUMEROPERSONAFISICA AS NUMEROPFISICA, 
      ID.TIPODOC AS TIPODOCINTEGRANTE, 
      ID.NUMERODOC AS NRODOCINTEGRANTE, 
      CASE 
         WHEN (IJ.TIPO_PERSONA = 'J') THEN 
            (
               SELECT JJ.RAZONSOCIAL
               FROM dbo.CLI_PERSONASJURIDICAS  AS JJ
               WHERE JJ.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAFISICA
            )
         ELSE 
            (
               SELECT ISNULL(PF.PRIMERNOMBRE, '') + ' ' + ISNULL(PF.APELLIDOPATERNO, '') + ' ' + ISNULL(PF.APELLIDOMATERNO, '') AS expr
               FROM dbo.CLI_PERSONASFISICAS  AS PF
               WHERE PF.NUMEROPERSONAFISICA = IJ.NUMEROPERSONAFISICA
            )
      END AS NOMBRE,   
      CASE 
      	WHEN CP.[CARGO] IS NOT NULL THEN CP.[CARGO]
      	ELSE A.Descripcion
      END AS [CARGO], 
      IJ.TIPO_PERSONA AS TIPOPERSONA, 
      T.RAZONSOCIAL, 
      T.NOMBREFANTASIA
   FROM 
      dbo.CLI_PERSONASJURIDICAS  AS T JOIN dbo.CLI_INTEGRANTESPJ  AS IJ
      	ON T.NUMEROPERSONAJURIDICA = IJ.NUMEROPERSONAJURIDICA
      JOIN dbo.CLI_DOCUMENTOSPFPJ  AS V
      	ON T.NUMEROPERSONAJURIDICA = V.NUMEROPERSONAFJ
      JOIN dbo.VW_PFPJ_DOCUMENTOS AS ID 
        ON IJ.NUMEROPERSONAFISICA = ID.NUMEROPERSONA
      LEFT JOIN dbo.CLI_CARGOS_PERSONAS  AS CP
      	ON IJ.[CODIGOCARGO] = CP.[CODIGO] AND (CP.TZ_LOCK = 0)
      LEFT JOIN DJ_ACTORES A
      	ON A.Id = IJ.[CODIGOCARGO_DJ]
   WHERE
      V.TIPOPERSONA = 'J' AND  
      (T.TZ_LOCK = 0) AND 
      (V.TZ_LOCK = 0) AND 
      (IJ.TZ_LOCK = 0)
GO